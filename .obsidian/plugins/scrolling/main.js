/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD!
If you want to view the source, please visit https://github.com/omeyenburg/obsidian-scrolling.
*/
var F=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var X=(o,e)=>{for(var t in e)F(o,t,{get:e[t],enumerable:!0})},G=(o,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Y(e))!q.call(o,s)&&s!==t&&F(o,s,{get:()=>e[s],enumerable:!(i=z(e,s))||i.enumerable});return o};var K=o=>G(F({},"__esModule",{value:!0}),o);var J={};X(J,{default:()=>A});module.exports=K(J);var U=require("obsidian");var D=require("obsidian"),E=class{constructor(e){this.codeBlockLines=[];this.currentScrollLeft=0;this.currentScrollVelocity=0;this.currentScrollWidth=0;this.lastHorizontalTimeStamp=0;this.lastVerticalTimeStamp=0;this.scrollAnimationFrame=0;this.cursorScheduled=!1;this.cachedCursor=null;this.FRICTION_COFFICIENT=.8;this.DELTA_TIME_THRESHOLD=50;this.EXTRA_LINE_LENGTH=1e6;this.EXTRA_LINE_LENGTH_WITH_PADDING=1000015;this.plugin=e,this.verticalWheelScrollDebouncer=(0,D.debounce)(this.verticalWheelScroll.bind(this),50,!1),document.body.style.setProperty("--scrolling-extra-line-length",`${this.EXTRA_LINE_LENGTH_WITH_PADDING}px`),this.updateStyle(),e.register(()=>{window.cancelAnimationFrame(this.scrollAnimationFrame),document.body.style.removeProperty("--scrolling-scrollbar-width"),document.body.removeClass("scrolling-horizontal-code-blocks")})}updateStyle(){this.plugin.settings.horizontalScrollingCodeBlockEnabled?document.body.addClass("scrolling-horizontal-code-blocks"):document.body.removeClass("scrolling-horizontal-code-blocks")}leafChangeHandler(){if(this.cachedCursor=null,this.currentScrollLeft=0,!this.plugin.app.workspace.activeEditor?.editor||!this.plugin.settings.horizontalScrollingCodeBlockEnabled)return;let t=document.querySelector(".cm-line.cm-active");t&&(this.searchCodeLines(t),this.updateCursorPassive())}wheelHandler(e){let t=e.target,i=t?.parentElement;if(!this.plugin.settings.horizontalScrollingCodeBlockEnabled||!t?.classList?.contains("HyperMD-codeblock")&&!i?.classList?.contains("HyperMD-codeblock"))return;let s=this.insideCodeBlock(i?.classList)?i:t;s===t&&!this.insideCodeBlock(t?.classList)||(Math.abs(e.deltaX)>Math.abs(e.deltaY)&&e.timeStamp-this.lastVerticalTimeStamp>=this.DELTA_TIME_THRESHOLD||e.timeStamp-this.lastHorizontalTimeStamp<this.DELTA_TIME_THRESHOLD?(e.preventDefault(),this.horizontalWheelScroll(e,s),this.lastHorizontalTimeStamp=e.timeStamp):(this.lastVerticalTimeStamp=e.timeStamp,this.verticalWheelScrollDebouncer(s)))}cursorHandler(e){let t=this.plugin.app.workspace.activeEditor?.editor;if(this.cursorScheduled||!t||!this.plugin.settings.horizontalScrollingCodeBlockEnabled)return;let i=document.querySelector(".cm-line.cm-active");if(!i?.classList?.contains("HyperMD-codeblock")){this.codeBlockLines=[];return}this.cursorScheduled=!0,window.requestAnimationFrame(()=>{this.cursorScheduled=!1;let s=this.getCursorEl(t);s&&((!this.codeBlockLines.contains(i)||!e)&&this.searchCodeLines(i),this.updateCursorActive(t,i,s))})}getCursorEl(e){return this.cachedCursor&&this.cachedCursor.isConnected?this.cachedCursor:(this.cachedCursor=e.cm.dom.querySelector(".cm-cursor-primary"),this.cachedCursor)}verticalWheelScroll(e){this.searchCodeLines(e),this.updateHorizontalScroll()}horizontalWheelScroll(e,t){!this.codeBlockLines.contains(t)||!this.currentScrollWidth?this.currentScrollWidth=Math.max(0,this.searchCodeLines(t)-this.EXTRA_LINE_LENGTH-t.clientWidth):this.codeBlockLines.filter(i=>i.isConnected),this.currentScrollVelocity=e.deltaX,this.lastVerticalTimeStamp=0,this.currentScrollLeft=this.codeBlockLines[0].scrollLeft,window.cancelAnimationFrame(this.scrollAnimationFrame),this.scrollAnimationFrame=window.requestAnimationFrame(()=>this.animateScroll())}animateScroll(){this.currentScrollLeft+=this.currentScrollVelocity,this.currentScrollLeft<0?(this.currentScrollVelocity=0,this.currentScrollLeft=0):this.currentScrollLeft>this.currentScrollWidth?(this.currentScrollLeft=this.currentScrollWidth,this.currentScrollVelocity=0):Math.abs(this.currentScrollVelocity)>.2?(this.currentScrollVelocity*=this.FRICTION_COFFICIENT,this.scrollAnimationFrame=window.requestAnimationFrame(()=>this.animateScroll())):this.scrollAnimationFrame=0,this.updateHorizontalScroll(),this.updateCursorPassive()}updateCursorActive(e,t,i){let s,l,r=e.cm.coordsAtPos(e.cm.state.selection.main.head);if(!r)return;s=r.left,l=r.right+(i?e.cm.defaultCharacterWidth:0);let n=t.getBoundingClientRect(),c=e.cm.defaultCharacterWidth*2;s<n.left+c?this.currentScrollLeft+=s-n.left-c:l>n.right-c&&(this.currentScrollLeft+=l-n.right+c),this.updateHorizontalScroll(),this.plugin.followScroll.skipCursor=!0,e.cm.dispatch({selection:e.cm.state.selection}),i&&i instanceof HTMLElement&&i.style.visibility!=="visible"&&(i.style.visibility="visible")}updateCursorPassive(){let e=this.plugin.app.workspace.activeEditor?.editor;if(!e||!this.codeBlockLines.length)return;let t=this.getCursorEl(e);if(!t||(this.plugin.followScroll.skipCursor=!0,e.cm.dispatch({selection:e.cm.state.selection,effects:[]}),!(t instanceof HTMLElement)))return;let i=t.getBoundingClientRect(),s=this.codeBlockLines[0].parentElement;if(!this.codeBlockLines[0].parentElement){this.codeBlockLines=[];return}let l=s.getBoundingClientRect(),r=i.left>=l.left&&i.right<=l.right;t.style.visibility=r?"visible":"hidden"}updateHorizontalScroll(){this.codeBlockLines.forEach(e=>{e.scrollLeft=this.currentScrollLeft})}searchCodeLines(e){return this.codeBlockLines=[e],Math.max(e.scrollWidth,this.searchCodeLinesAbove(e),this.searchCodeLinesBelow(e))}searchCodeLinesBelow(e){let t=0,i=e.nextElementSibling;for(;i&&this.insideCodeBlockBelow(i);)this.codeBlockLines.push(i),i.scrollWidth>t&&(t=i.scrollWidth),i=i.nextElementSibling;return t}searchCodeLinesAbove(e){let t=0,i=e.previousElementSibling;for(;i&&this.insideCodeBlockAbove(i);)this.codeBlockLines.push(i),i.scrollWidth>t&&(t=i.scrollWidth),i=i.previousElementSibling;return t}insideCodeBlock(e){let t=!1;for(let i=0;i<e.length;i++){let s=e[i];if(s==="HyperMD-codeblock"&&(t=!0),s==="HyperMD-codeblock-begin"||s==="HyperMD-codeblock-end")return!1}return t}insideCodeBlockBelow(e){let t=!1,i=e.classList;for(let s=0;s<i.length;s++){let l=i[s];if(l==="HyperMD-codeblock"&&(t=!0),l==="HyperMD-codeblock-end")return!1}return t}insideCodeBlockAbove(e){let t=!1,i=e.classList;for(let s=0;s<i.length;s++){let l=i[s];if(l==="HyperMD-codeblock"&&(t=!0),l==="HyperMD-codeblock-begin")return!1}return t}};var b=class{constructor(e){this.fileTreeScrollEnabled=!1;this.plugin=e,window.requestAnimationFrame(this.updateStyle.bind(this)),e.register(()=>{document.body.removeClass("scrolling-filetree-horizontal")})}updateStyle(){let e=this.plugin.settings.horizontalScrollingFileTreeEnabled;this.fileTreeScrollEnabled!=e&&(this.fileTreeScrollEnabled=e,e?document.body.addClass("scrolling-filetree-horizontal"):document.body.removeClass("scrolling-filetree-horizontal"))}};var k=require("obsidian"),v=class{constructor(e){this.recentEdit=!1;this.recentMouseUp=!1;this.animationFrame=0;this.scrollIntensity=0;this.scrollLastEvent=0;this.INTENSITY_DECAY_RATE=.01;this.INTENSITY_THRESHOLD=3;this.MOUSE_UP_TIMEOUT=100;this.plugin=e,e.register(()=>{window.cancelAnimationFrame(this.animationFrame)})}keyHandler(){this.recentMouseUp=!1}mouseUpHandler(){this.recentMouseUp=!0,window.setTimeout(()=>this.recentMouseUp=!1,this.MOUSE_UP_TIMEOUT)}editHandler(e){this.recentEdit=!0,this.invokeScroll(e)}cursorHandler(){if(this.recentEdit){this.recentEdit=!1;return}let e=this.plugin.app.workspace.getActiveViewOfType(k.MarkdownView);e?.editor&&(e.file&&this.plugin.restoreScroll.storeStateDebounced(e.file),!(this.recentMouseUp&&!this.plugin.settings.followCursorEnableMouse)&&(!this.plugin.settings.followCursorEnableSelection&&e.editor.somethingSelected()||this.invokeScroll(e.editor)))}invokeScroll(e){if(!this.plugin.settings.followCursorEnabled)return;let t=this.plugin.settings.followCursorDynamicAnimation;!this.recentEdit&&t?this.calculateScrollIntensity():this.scrollIntensity=0;let i=e.cm.scrollDOM.querySelector(".cm-active.cm-line");if(!i)return;let s=i.getBoundingClientRect(),l=e.cm.defaultLineHeight,r=e.cm.scrollDOM.getBoundingClientRect().top,n=s.top+l-r,c=e.getScrollInfo(),d=this.calculateGoalDistance(n,c);if(d===0)return;let m=c.top+d,f=this.calculateSteps(d,c.height);window.cancelAnimationFrame(this.animationFrame),this.animate(e,m,d/f,f)}animate(e,t,i,s){s<=0||(e.scrollTo(null,t-i*(s-1)),this.animationFrame=window.requestAnimationFrame(()=>this.animate(e,t,i,s-1)))}calculateScrollIntensity(){let e=performance.now(),t=e-this.scrollLastEvent;this.scrollLastEvent=e,this.scrollIntensity=Math.max(0,this.scrollIntensity-t*this.INTENSITY_DECAY_RATE)+1}calculateGoalDistance(e,t){let i=this.plugin.settings.followCursorRadius,s=t.height/2*i/100,l=t.height/2,r=e-l,n;if(r<-s)n=r+s;else if(r>s)n=r-s;else return 0;return Math.abs(n)<1?0:n}calculateSteps(e,t){let i=this.plugin.settings.followCursorInstantEditScroll;if(this.recentEdit&&i)return 1;let s=this.plugin.settings.followCursorSmoothness,l=this.plugin.settings.followCursorDynamicAnimation,r=Math.max(1,Math.ceil(2*(s/100)*Math.sqrt(Math.abs(e))));return l&&this.recentEdit&&this.calculateScrollIntensity(),(this.scrollIntensity>this.INTENSITY_THRESHOLD||Math.abs(e)>t)&&(r=Math.ceil(Math.sqrt(r))),r}};var M=require("obsidian"),_=require("@codemirror/state"),w=class{constructor(e){this.relativeLineOffset=null;this.skipCursor=!1;this.CURSOR_SKIP_DELAY=500;this.UPDATE_INTERVAL=70;this.plugin=e,this.resetSkip=(0,M.debounce)(()=>{this.skipCursor=!1},this.CURSOR_SKIP_DELAY,!0),this.wheelHandler=(0,M.debounce)(this.applyScroll.bind(this),this.UPDATE_INTERVAL,!1),window.requestAnimationFrame(this.cursorHandler.bind(this))}leafChangeHandler(){this.relativeLineOffset=null}cursorHandler(){let e=this.plugin.app.workspace.activeEditor?.editor;if(!e)return;let t=e.cm.lineBlockAt(e.posToOffset(e.getCursor())),i=e.cm.scrollDOM,s=(t.top+t.bottom)/2-i.scrollTop+i.getBoundingClientRect().top;this.relativeLineOffset=Math.max(0,Math.min(i.clientHeight,s))}applyScroll(e){if(!this.plugin.settings.cursorScrollEnabled||this.relativeLineOffset==null)return;let t=this.plugin.app.workspace.activeEditor?.editor;if(!t||t.cm.scrollDOM!==e)return;let i=t.cm,s=i.scrollDOM.scrollTop,l=i.scrollDOM.clientHeight,r=s+this.relativeLineOffset;if(r<s||r>s+l)return;let n=i.scrollDOM.getBoundingClientRect(),c={x:n.left+10,y:n.top+this.relativeLineOffset},d=i.posAtCoords(c);if(!d)return;let f=i.state.doc.lineAt(d).number-1;this.setCursorPosition(t,f)}setCursorPosition(e,t){this.skipCursor=!0,this.resetSkip();try{let i=e.cm.state.doc.line(t+1).from,s=_.EditorSelection.single(i);e.cm.dispatch({selection:s,effects:[]})}catch{}}};var P=require("obsidian");function j(o){return 1-(1-o)**2}function O(o){return o.reduce((e,t)=>e+t,0)/o.length}var y=class{constructor(e){this.touchpadLastUse=-1/0;this.touchpadFriction=0;this.touchpadVelocity=0;this.touchpadLastAnimation=0;this.touchpadScrolling=!1;this.touchpadAnimationFrame=0;this.mouseLastUse=0;this.MAX_FRICTION=.98;this.MIN_VELOCITY=.01;this.TOUCHPAD_GRACE_PERIOD=50;this.MIN_START_TRESHOLD=200;this.MAX_START_TRESHOLD=500;this.intervalSum=null;this.MAX_INTENSITY_INTERVAL=600;this.INTENSITY_SMOOTHING=.3;this.delays=[];this.avgDelay=10;this.WHEEL_DELAY_THRESHOLD=10;this.MAX_DELAY_SAMPLES=50;this.batchSizes=[];this.avgBatchSize=20;this.BATCH_SIZE_THRESHOLD=20;this.MAX_BATCH_SIZE_SAMPLES=3;this.currentEl=null;this.DEFAULT_FRAME_TIME=16.67;this.plugin=e,this.IS_MAC_OS=window.navigator.userAgent.includes("Mac OS"),e.register(()=>{window.cancelAnimationFrame(this.mouseAnimationFrame),window.cancelAnimationFrame(this.touchpadAnimationFrame)})}leafChangeHandler(){this.touchpadVelocity=0,window.cancelAnimationFrame(this.mouseAnimationFrame)}applyCustomScroll(e,t,i,s,l){if(P.Platform.isMobile||!this.plugin.settings.mouseEnabled)return;let r=e.deltaMode==e.DOM_DELTA_LINE?e.deltaY*20:e.deltaY;this.plugin.settings.touchpadEnabled&&this.isTouchpad(e,i,s,l)?this.startTouchpadScroll(t,r):this.startMouseScroll(t,r),e.preventDefault()}startMouseScroll(e,t){if(!e)return;window.cancelAnimationFrame(this.mouseAnimationFrame);let i=this.plugin.settings.mouseSmoothness*2,s=this.plugin.settings.mouseSpeed/50,l=this.plugin.settings.mouseInvert?-1:1,r=performance.now();this.mouseTarget&&this.mouseLastUse&&r-this.mouseLastUse<i&&(e.scrollTop=this.mouseTarget),this.mouseLastUse=r;let n=e.scrollTop,c=t*s*l;this.mouseTarget=n+c,this.animateMouseScroll(e,n,r,i,c)}animateMouseScroll(e,t,i,s,l){let r=performance.now(),n=Math.min(1,(r-i)/s);n=j(n),e.scrollTop=t+l*n,n<1?this.mouseAnimationFrame=window.requestAnimationFrame(()=>this.animateMouseScroll(e,t,i,s,l)):(e.scrollTop=t+l,this.mouseAnimationFrame=0)}startTouchpadScroll(e,t){e!==this.currentEl&&(window.cancelAnimationFrame(this.touchpadAnimationFrame),window.requestAnimationFrame(this.decoupledTouchpadScroll.bind(this,this.currentEl,this.touchpadVelocity,this.touchpadFriction)),this.currentEl=e,this.touchpadScrolling=!1,this.touchpadVelocity=0,this.touchpadLastAnimation=0);let i=this.plugin.settings.touchpadSmoothness/100,s=this.plugin.settings.touchpadSpeed/200/this.DEFAULT_FRAME_TIME,l=this.plugin.settings.touchpadFrictionThreshold,r=this.plugin.settings.mouseInvert?-1:1;this.touchpadVelocity+=t*s*r,this.touchpadFriction=Math.min(1,(Math.abs(t)/l)**3)*i,(!this.touchpadScrolling||Math.abs(this.touchpadVelocity)<this.MIN_VELOCITY)&&(this.touchpadScrolling=!0,this.animateTouchpadScroll(e))}animateTouchpadScroll(e){if(Math.abs(this.touchpadVelocity)>this.MIN_VELOCITY){let t=performance.now(),i=Math.max(8,Math.min(t-this.touchpadLastAnimation,60));this.touchpadLastAnimation=t;let s=e.scrollTop+this.touchpadVelocity*i;e.scrollTop=s,this.touchpadVelocity*=this.touchpadFriction,this.touchpadFriction=Math.max(0,Math.min(this.MAX_FRICTION,this.touchpadFriction+.05)),this.touchpadAnimationFrame=window.requestAnimationFrame(()=>this.animateTouchpadScroll(e))}else this.touchpadScrolling=!1,this.touchpadVelocity=0,this.touchpadLastAnimation=0,this.touchpadAnimationFrame=0}decoupledTouchpadScroll(e,t,i){Math.abs(t)>this.MIN_VELOCITY&&(e.scrollTop=e.scrollTop+t*this.DEFAULT_FRAME_TIME,t*=i,i=Math.max(0,Math.min(this.MAX_FRICTION,i+.05)),window.setTimeout(()=>this.decoupledTouchpadScroll(e,t,i),this.DEFAULT_FRAME_TIME))}isTouchpad(e,t,i,s){if(e.deltaMode!==WheelEvent.DOM_DELTA_PIXEL)return this.touchpadLastUse=0,!1;if(e.deltaX!==0&&e.deltaY!==0)return this.touchpadLastUse=t,!0;if(t-this.touchpadLastUse<this.TOUCHPAD_GRACE_PERIOD)return this.touchpadLastUse=t,!0;let l=this.getIntensity(i,e.deltaY);return s?l+=.1:this.avgDelay>this.WHEEL_DELAY_THRESHOLD&&(l+=.2),this.avgBatchSize<this.BATCH_SIZE_THRESHOLD&&(l+=.1),e.wheelDeltaY&&(e.wheelDeltaY%120===0||e.wheelDeltaY%164===0)&&(l+=.7),this.IS_MAC_OS&&(l-=.1,e.deltaY%1!=0&&Math.abs(e.deltaY)>5&&(l+=.3)),l+=Math.max(0,Math.abs(e.deltaY/200)-.5),l<1.2?(l<.7&&(this.touchpadLastUse=t),!0):!1}getIsStart(e){let t=Math.min(this.MIN_START_TRESHOLD+this.avgDelay,this.MAX_START_TRESHOLD);return e>t}analyzeDelay(e){let t=this.getIsStart(e);return t?(this.batchSizes.push(this.delays.length),this.batchSizes.length>this.MAX_BATCH_SIZE_SAMPLES&&this.batchSizes.shift(),this.avgBatchSize=O(this.batchSizes),this.delays=[],this.avgDelay=this.WHEEL_DELAY_THRESHOLD,!0):(this.delays.push(e),this.delays.length>this.MAX_DELAY_SAMPLES&&this.delays.shift(),this.avgDelay=O(this.delays),t)}getIntensity(e,t){return e<this.MAX_INTENSITY_INTERVAL&&this.intervalSum!==null?this.intervalSum=this.intervalSum*(1-this.INTENSITY_SMOOTHING)+e*this.INTENSITY_SMOOTHING*Math.max(Math.pow(t,2)):this.intervalSum=Math.max(Math.pow(t,2),1),Math.log2(this.intervalSum)/20}};var a=require("obsidian");function V(o){switch(o.getViewType()){case"markdown":return o.containerEl.querySelector(".markdown-preview-view");case"pdf":return o.containerEl.querySelector(".pdf-viewer-container");case"image":return o.containerEl.querySelector(".image-container")?.parentElement;default:return null}}var p=class p{constructor(e){this.ephemeralStates={};this.skipViewSet=!1;this.expectEphemeralState=!0;this.STORE_INTERVAL=97;this.FILE_WRITE_INTERVAL=293;this.plugin=e,this.storeStateDebounced=(0,a.debounce)(this.storeState.bind(this),this.STORE_INTERVAL,!1),this.writeStateFileDebounced=(0,a.debounce)(this.writeStateFile.bind(this),this.FILE_WRITE_INTERVAL,!0)}scrollHandler(){let e=this.plugin.app.workspace.getActiveFile();e&&(this.plugin.restoreScroll.storeStateDebounced(e),this.plugin.restoreScroll.writeStateFileDebounced())}openFileHandler(){this.expectEphemeralState=!0,window.setTimeout(()=>this.expectEphemeralState=!1,0)}ephemeralStateHandler(e,t){if(!this.expectEphemeralState||!t[0])return;if(this.expectEphemeralState=!1,this.plugin.app.workspace.containerEl.querySelector("span.is-flashing")||this.plugin.settings.restoreScrollMode==="top"){this.skipViewSet=!0,window.setTimeout(()=>this.skipViewSet=!1,0);return}if(!(e instanceof a.MarkdownView)||!e.file||e.getMode()!=="source")return;this.skipViewSet=!0,window.setTimeout(()=>this.skipViewSet=!1,0);let s=this.ephemeralStates[e.file.path];if(!s)return;let{cursor:l,scroll:r}=s;this.plugin.settings.restoreScrollMode==="bottom"?(t[0].cursor=void 0,t[0].focus=!1,t[0].scroll=1/0):l&&this.plugin.settings.restoreScrollMode==="cursor"?(delete t[0].scroll,t[0].focus=!0,t[0].cursor=l,window.requestAnimationFrame(()=>e.editor.scrollIntoView(l,!0))):(t[0].cursor=void 0,t[0].focus=!1,t[0].scroll=r)}viewStateHandler(e){if(this.writeStateFileDebounced(),this.skipViewSet||this.plugin.settings.restoreScrollMode==="top"||!e||!(e instanceof a.FileView)||!e.file)return;let t=this.ephemeralStates[e.file.path];if(!t)return;let{cursor:i,scroll:s,scrollTop:l}=t;e instanceof a.MarkdownView&&e.getMode()==="source"&&(s||i)?i&&this.plugin.settings.restoreScrollMode==="cursor"?(e.setEphemeralState({cursor:i,focus:!0}),e.editor.scrollIntoView(i,!0)):e.setEphemeralState({scroll:s}):l&&this.plugin.settings.restoreScrollAllFiles&&window.requestAnimationFrame(()=>{let r=V(e);r&&(r.scrollTop=l)})}deleteFileHandler(e){delete this.ephemeralStates[e.path]}renameFileHandler(e,t){this.ephemeralStates[e.path]=this.ephemeralStates[t],delete this.ephemeralStates[t]}quitHandler(){this.writeStateFile()}async directoryOfFileExists(e){let t=e.lastIndexOf("/");if(t===-1)return!0;let i=e.substring(0,t);return await this.plugin.app.vault.adapter.exists(i)}async checkWriteStorePath(){if(!await this.directoryOfFileExists(this.plugin.settings.restoreScrollFilePath)){if(await this.directoryOfFileExists(p.DEFAULT_FILE_PATH)){this.plugin.settings.restoreScrollFilePath=p.DEFAULT_FILE_PATH;return}if(await this.directoryOfFileExists(p.FALLBACK_FILE_PATH)){this.plugin.settings.restoreScrollFilePath=p.FALLBACK_FILE_PATH;return}}}async writeStateFile(){if(!this.plugin.settings.restoreScrollFileEnabled)return;await this.checkWriteStorePath();let e=this.plugin.settings.restoreScrollFilePath,t=JSON.stringify(this.ephemeralStates);this.plugin.app.vault.adapter.write(e,t)}async checkLoadStorePath(){return await this.plugin.app.vault.adapter.exists(this.plugin.settings.restoreScrollFilePath)?!0:await this.plugin.app.vault.adapter.exists(p.DEFAULT_FILE_PATH)?(this.plugin.settings.restoreScrollFilePath=p.DEFAULT_FILE_PATH,!0):await this.plugin.app.vault.adapter.exists(p.FALLBACK_FILE_PATH)?(this.plugin.settings.restoreScrollFilePath=p.FALLBACK_FILE_PATH,!0):!1}async loadData(){if(!await this.checkLoadStorePath())return;let t=this.plugin.settings.restoreScrollFilePath;try{let i=await this.plugin.app.vault.adapter.read(t);this.ephemeralStates=JSON.parse(i)}catch{this.ephemeralStates={}}}storeState(e){let t=this.plugin.settings.restoreScrollMode;if(t==="top"||t==="bottom")return;let i=this.plugin.app.workspace.getActiveViewOfType(a.FileView);if(!i||!i.file||i.file!==this.plugin.app.workspace.getActiveFile()||e&&i.file!==e)return;let s=Date.now();if(i instanceof a.MarkdownView&&i.getMode()=="source"){let l=i.editor.getScrollInfo().top,{cursor:r,scroll:n}=i.getEphemeralState();this.ephemeralStates[i.file.path]={timestamp:s,cursor:r,scroll:n,scrollTop:l}}else if(this.plugin.settings.restoreScrollAllFiles){let l=V(i)?.scrollTop;l&&(this.ephemeralStates[i.file.path]={timestamp:s,scrollTop:l})}this.discardOldStates()}discardOldStates(){let e=Object.entries(this.ephemeralStates);this.plugin.settings.restoreScrollLimit<=0||e.length<=this.plugin.settings.restoreScrollLimit||(e.sort(([,t],[,i])=>i.timestamp-t.timestamp),this.ephemeralStates=Object.fromEntries(e.slice(0,this.plugin.settings.restoreScrollLimit)))}countEphemeralStates(){return Object.keys(this.ephemeralStates).length}async renameStoreFile(e){if(!this.plugin.settings.restoreScrollFileEnabled)return;if(e===null){new a.Notice("Path unchanged.");return}if(!e||e.trim()===""||e==="."||e===".."){new a.Notice("Invalid file path!");return}let t=(0,a.normalizePath)(e),i=(0,a.normalizePath)(this.plugin.settings.restoreScrollFilePath);if(!t){new a.Notice("Invalid file path!");return}let s=this.plugin.app.vault.adapter;if(!await this.directoryOfFileExists(t)){new a.Notice("Directory of file does not exist.");return}if(await s.exists(t)){new a.Notice(`File already exists: ${t}`);return}if(i&&await s.exists(i))try{await s.rename(i,t)}catch{new a.Notice("Invalid file path!");return}return new a.Notice(`Renamed storage file to: ${t}`),t}};p.DEFAULT_FILE_PATH=".obsidian/plugins/scrolling/scrolling-positions.json",p.FALLBACK_FILE_PATH=".obsidian/plugins/obsidian-scrolling/scrolling-positions.json";var S=p;var T=require("obsidian");function $(o,e){o==="hide"?document.body.addClass("scrolling-visibility-hide"):o==="scroll"&&document.body.addClass("scrolling-visibility-scroll"),e>=0&&(document.body.addClass("scrolling-scrollbar-width"),document.body.style.setProperty("--scrolling-scrollbar-width",`${e}px`))}function x(){document.body.removeClasses(["scrolling-scrollbar-width","scrolling-visibility-hide","scrolling-visibility-scroll","scrolling-filetree-horizontal"]),document.body.style.removeProperty("--scrolling-scrollbar-width")}var L=class{constructor(e){this.currentWidth=0;this.currentVisibility="";this.scrollTimeouts=new Map;this.SCROLLBAR_IDLE_TIMEOUT=500;this.plugin=e,this.updateStyle(),e.register(x)}registerScrollbar(e){e.classList.add("scrolling-transparent")}scrollHandler(e){this.showScrollbarTemporary(e)}updateStyle(){if(T.Platform.isMacOS)return;let e=this.plugin.settings.scrollbarVisibility,t=T.Platform.isLinux?this.plugin.settings.scrollbarWidth:-1;this.currentWidth==t&&this.currentVisibility==e||(this.currentWidth=t,this.currentVisibility=e,x(),$(e,t))}showScrollbarTemporary(e){if(T.Platform.isMacOS||this.plugin.settings.scrollbarVisibility!="scroll")return;let t=e.currentTarget;if(!t)return;let i=this.scrollTimeouts.get(t);i&&window.clearTimeout(i),t.classList.remove("scrolling-transparent");let s=window.setTimeout(()=>this.hideScrollbarTemporary(t),this.SCROLLBAR_IDLE_TIMEOUT);this.scrollTimeouts.set(t,s)}hideScrollbarTemporary(e){e.classList.add("scrolling-transparent"),this.scrollTimeouts.delete(e)}};var g=require("obsidian"),B=require("@codemirror/view"),W=require("@codemirror/state");function I(o,e){let t=Object.keys(e).map(i=>Z(o,i,e[i]));return t.length===1?t[0]:function(){t.forEach(i=>i())}}function Z(o,e,t){let i=o[e],s=o.hasOwnProperty(e),l=s?i:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},r=t(l);return i&&Object.setPrototypeOf(r,i),Object.setPrototypeOf(n,r),o[e]=n,c;function n(...d){return r===l&&o[e]===n&&c(),r.apply(this,d)}function c(){o[e]===n&&(s?o[e]=l:delete o[e]),r!==l&&(r=l,Object.setPrototypeOf(n,i||Function))}}function R(o){return o.scrollTop==0}function N(o){return Math.ceil(o.scrollTop+o.clientHeight)>=o.scrollHeight}var C=class{constructor(e){this.scrollEventSkip=!1;this.lastWheelEventTime=0;this.manualPreventCursor=!1;this.LEAF_CHANGE_SCROLL_EVENT_DELAY=500;this.IMAGE_EXTENSIONS=new Set(["png","jpg","jpeg","gif","svg","webp","bmp","ico","apng","avif"]);this.skipViewUpdate=!1;this.plugin=e,this.scrollHandler=this.unboundScrollHandler.bind(this),g.Platform.isDesktop&&e.registerDomEvent(document,"wheel",this.wheelHandler.bind(this),{capture:!0,passive:!1}),e.registerDomEvent(document,"keydown",this.keyHandler.bind(this),{passive:!0});let t=e.app.workspace.on("editor-change",()=>{e.app.workspace.offref(t),e.registerEvent(e.app.workspace.on("editor-change",this.editHandler.bind(this)))});e.registerEvent(t),e.registerEditorExtension(B.EditorView.updateListener.of(this.viewUpdateHandler.bind(this))),g.Platform.isDesktop&&e.registerDomEvent(document,"mouseup",this.mouseUpHandler.bind(this),{passive:!0}),e.registerEvent(e.app.workspace.on("active-leaf-change",this.leafChangeHandler.bind(this))),window.requestAnimationFrame(()=>this.attachScrollHandler()),e.registerEvent(e.app.vault.on("delete",this.deleteFileHandler.bind(this))),e.registerEvent(e.app.vault.on("rename",this.renameFileHandler.bind(this))),e.registerEvent(e.app.workspace.on("quit",this.quitHandler.bind(this))),e.registerEvent(e.app.workspace.on("file-open",this.openFileHandler.bind(this)));let i=this;e.register(I(g.WorkspaceLeaf.prototype,{setViewState(s){return async function(...l){let r=await s.apply(this,l);return i.plugin.restoreScroll.viewStateHandler(this.view),r}}})),e.register(I(g.View.prototype,{setEphemeralState(s){return async function(...l){return i.plugin.restoreScroll.ephemeralStateHandler(this,l),await s.apply(this,l)}}}))}attachScrollHandler(){let e=this.plugin.app.workspace.getActiveViewOfType(g.FileView);!e||!e.file||(this.scrollEventSkip=!0,window.setTimeout(()=>this.scrollEventSkip=!1,this.LEAF_CHANGE_SCROLL_EVENT_DELAY),e.file.extension==="md"?this.attachScrollHandlerMarkdown(e):e.file.extension==="pdf"?this.attachScrollHandlerPdf(e):this.IMAGE_EXTENSIONS.has(e.file.extension.toLowerCase())&&this.attachScrollHandlerImage(e))}attachScrollHandlerMarkdown(e){let t=e.contentEl.querySelector(".cm-scroller"),i=e.contentEl.querySelector(".markdown-preview-view");!t||!i||(this.plugin.scrollbar.registerScrollbar(t),this.plugin.scrollbar.registerScrollbar(i),t.removeEventListener("scroll",this.scrollHandler),i.removeEventListener("scroll",this.scrollHandler),this.plugin.registerDomEvent(t,"scroll",this.scrollHandler,{passive:!0}),this.plugin.registerDomEvent(i,"scroll",this.scrollHandler,{passive:!0}))}attachScrollHandlerPdf(e){let t=e.contentEl.querySelector(".pdf-viewer-container");t&&(this.plugin.scrollbar.registerScrollbar(t),t.removeEventListener("scroll",this.scrollHandler),t.addEventListener("scroll",this.scrollHandler),this.plugin.register(()=>t.removeEventListener("scroll",this.scrollHandler)))}attachScrollHandlerImage(e){let t=e.contentEl.querySelector(".image-container")?.parentElement;t&&(this.plugin.scrollbar.registerScrollbar(t),t.removeEventListener("scroll",this.scrollHandler),t.addEventListener("scroll",this.scrollHandler),this.plugin.register(()=>t.removeEventListener("scroll",this.scrollHandler)))}leafChangeHandler(){this.plugin.mouseScroll.leafChangeHandler(),this.plugin.followScroll.leafChangeHandler(),this.plugin.codeBlock.leafChangeHandler(),this.attachScrollHandler()}unboundScrollHandler(e){this.scrollEventSkip||(this.plugin.scrollbar.scrollHandler(e),this.plugin.restoreScroll.scrollHandler())}openFileHandler(){this.plugin.restoreScroll.openFileHandler()}deleteFileHandler(e){this.plugin.restoreScroll.deleteFileHandler(e)}renameFileHandler(e,t){this.plugin.restoreScroll.renameFileHandler(e,t)}quitHandler(){this.plugin.restoreScroll.quitHandler()}keyHandler(){this.plugin.followCursor.keyHandler()}mouseUpHandler(){this.plugin.followCursor.mouseUpHandler(),this.plugin.restoreScroll.storeStateDebounced()}editHandler(e){this.plugin.followCursor.editHandler(e)}viewUpdateHandler(e){if(this.plugin.followScroll.skipCursor){this.plugin.followScroll.skipCursor=!1;return}if(e.selectionSet){for(let t of e.transactions)if(t.annotation(W.Transaction.userEvent)==="select.pointer")return;this.skipViewUpdate||(this.skipViewUpdate=!0,window.requestAnimationFrame(()=>this.skipViewUpdate=!1),this.plugin.codeBlock.cursorHandler(e.docChanged),this.plugin.followCursor.cursorHandler(),this.plugin.followScroll.cursorHandler())}}isWithinScrollContext(e){return e===this.lastWheelScrollElement||this.lastWheelScrollElement.contains(e)}wheelHandler(e){if(this.plugin.codeBlock.wheelHandler(e),!e.deltaY||!(g.Platform.isDesktop&&this.plugin.settings.mouseEnabled||this.plugin.settings.cursorScrollEnabled))return;let t=e.target,i=performance.now(),s=i-this.lastWheelEventTime;this.lastWheelEventTime=i;let l=this.plugin.mouseScroll.analyzeDelay(s);if(!l&&this.lastWheelScrollElement&&this.isWithinScrollContext(t)&&(e.deltaY<0&&!R(this.lastWheelScrollElement)||e.deltaY>0&&!N(this.lastWheelScrollElement))){this.plugin.mouseScroll.applyCustomScroll(e,this.lastWheelScrollElement,i,s,l),this.plugin.followScroll.wheelHandler(this.lastWheelScrollElement);return}for(;t&&t!=document.body;){let{overflowY:r}=getComputedStyle(t);if((r==="auto"||r==="scroll")&&t.scrollHeight>t.clientHeight){if(l){if(e.deltaY<0&&R(t)){t=t.parentElement;continue}if(e.deltaY>0&&N(t)){t=t.parentElement;continue}}this.plugin.mouseScroll.applyCustomScroll(e,t,i,s,l),this.plugin.followScroll.wheelHandler(t),this.lastWheelScrollElement=t;return}t=t.parentElement}}};var u=require("obsidian");var h={followCursorEnabled:!0,followCursorRadius:75,followCursorSmoothness:25,followCursorInstantEditScroll:!0,followCursorDynamicAnimation:!0,followCursorEnableMouse:!1,followCursorEnableSelection:!1,cursorScrollEnabled:!1,horizontalScrollingCodeBlockEnabled:!1,horizontalScrollingFileTreeEnabled:!1,restoreScrollMode:"scroll",restoreScrollLimit:-1,restoreScrollAllFiles:!0,restoreScrollFileEnabled:!0,restoreScrollFilePath:S.DEFAULT_FILE_PATH,scrollbarVisibility:"show",scrollbarWidth:12,mouseEnabled:!1,mouseInvert:!1,mouseSpeed:50,mouseSmoothness:75,touchpadEnabled:!0,touchpadSmoothness:75,touchpadFrictionThreshold:20,touchpadSpeed:50,enableExperimentalSettings:!1},H=class extends u.PluginSettingTab{constructor(t){super(t.app,t);this.settingsEnabled=!0;this.proposedRestoreScrollStoreFile=null;this.plugin=t}display(){let t=this.containerEl.scrollTop;this.containerEl.empty(),this.displayFollowCursorSettings(),this.displayCursorScrollSettings(),this.displayHorizontalScrollingSettings(),this.displayRestoreScrollSettings(),this.displayScrollbarSettings(),this.displayMouseScrollSettings(),this.createHeading("Issues & feature requests").setDesc(createFragment(i=>{i.createEl("span",{text:"To report bugs or provide feedback, please use the "}),i.createEl("a",{text:"issue tracker",href:"https://github.com/omeyenburg/obsidian-scrolling/issues"}),i.createEl("span",{text:" and the "}),i.createEl("a",{text:"discussion page",href:"https://github.com/omeyenburg/obsidian-scrolling/discussions"}),i.createEl("span",{text:"."})})),this.containerEl.scrollTop=t}setDesc(t,i){if(!i)return;if(!i.includes(`
`)){t.setDesc(i);return}let s=i.split(`
`);t.setDesc(createFragment(l=>s.forEach((r,n)=>{l.createEl("span",{text:r}),n<s.length-1&&l.createEl("br")})))}createHeading(t,i){let s=new u.Setting(this.containerEl).setName(t).setHeading();return this.setDesc(s,i),this.settingsEnabled=!0,s}createSetting(t,i,s){let l=new u.Setting(this.containerEl).setName(t);return this.setDesc(l,i),s&&l.addExtraButton(r=>{r.setIcon("reset").onClick(async()=>{s(),this.display(),await this.plugin.saveSettings()}),this.settingsEnabled&&r.setTooltip("Restore default")}),this.settingsEnabled?window.setTimeout(()=>{l.components.forEach(r=>{r instanceof u.SliderComponent&&r.setDynamicTooltip()})},1):(l.infoEl.style.opacity="0.4",l.controlEl.style.opacity="0.4",l.controlEl.style.filter="grayscale(100%)",window.setTimeout(()=>{l.components.forEach(r=>{r.setDisabled(!0)})},1)),l}displayFollowCursorSettings(){this.createHeading("Scroll follows text cursor"),this.createSetting("Enable",`Scroll the view to keep the cursor near the center when you move the cursor.
Can be used together with 'Text cursor follows scroll'.`).addToggle(t=>t.setValue(this.plugin.settings.followCursorEnabled).onChange(async i=>{this.plugin.settings.followCursorEnabled=i,this.display(),await this.plugin.saveSettings()})),this.settingsEnabled=this.plugin.settings.followCursorEnabled,this.createSetting("Trigger distance",`How far the cursor can move from the center before scrolling (%).
0% keeps the cursor perfectly centered.`,()=>this.plugin.settings.followCursorRadius=h.followCursorRadius).addSlider(t=>t.setValue(this.plugin.settings.followCursorRadius).setLimits(0,100,1).onChange(async i=>{this.plugin.settings.followCursorRadius=i,await this.plugin.saveSettings()})),this.createSetting("Animation smoothness","Duration of the scroll animation.",()=>this.plugin.settings.followCursorSmoothness=h.followCursorSmoothness).addSlider(t=>t.setValue(this.plugin.settings.followCursorSmoothness).setLimits(0,100,1).onChange(async i=>{this.plugin.settings.followCursorSmoothness=i,await this.plugin.saveSettings()})),this.createSetting("Instant scroll on edit","Do not scroll smoothly while editing text.").addToggle(t=>t.setValue(this.plugin.settings.followCursorInstantEditScroll).onChange(async i=>{this.plugin.settings.followCursorInstantEditScroll=i,await this.plugin.saveSettings()})),this.plugin.settings.enableExperimentalSettings?this.createSetting("Dynamic animations (Experimental)","If many scroll events happen quickly, skip animation frames to improve responsiveness.").addToggle(t=>t.setValue(this.plugin.settings.followCursorDynamicAnimation).onChange(async i=>{this.plugin.settings.followCursorDynamicAnimation=i,await this.plugin.saveSettings()})):this.plugin.settings.followCursorDynamicAnimation=h.followCursorDynamicAnimation,u.Platform.isDesktop&&(this.plugin.settings.enableExperimentalSettings?this.createSetting("Trigger on mouse interactions (Experimental)","Update when the cursor is moved using the mouse.").addToggle(t=>t.setValue(this.plugin.settings.followCursorEnableMouse).onChange(async i=>{this.plugin.settings.followCursorEnableMouse=i,this.display(),await this.plugin.saveSettings()})):this.plugin.settings.followCursorEnableMouse=h.followCursorEnableMouse,this.plugin.settings.enableExperimentalSettings?(this.settingsEnabled&&=this.plugin.settings.followCursorEnableMouse,this.createSetting("Trigger on mouse selection (Experimental)","Also update when text is selected using the mouse.").addToggle(t=>t.setValue(this.plugin.settings.followCursorEnableSelection).onChange(async i=>{this.plugin.settings.followCursorEnableSelection=i,await this.plugin.saveSettings()}))):this.plugin.settings.followCursorEnableSelection=h.followCursorEnableSelection)}displayCursorScrollSettings(){u.Platform.isMobile||(this.containerEl.createEl("br"),this.createHeading("Text cursor follows scroll"),this.createSetting("Enable",`Move the cursor to stay visible when scrolling manually.
Can be used together with 'Scroll follows text cursor'.`).addToggle(t=>t.setValue(this.plugin.settings.cursorScrollEnabled).onChange(async i=>{this.plugin.settings.cursorScrollEnabled=i,await this.plugin.saveSettings()})))}displayHorizontalScrollingSettings(){u.Platform.isDesktop&&(this.containerEl.createEl("br"),this.createHeading("Horizontal scrolling"),this.createSetting("Code blocks","Allow horizontal scrolling of code blocks in your notes.").addToggle(t=>t.setValue(this.plugin.settings.horizontalScrollingCodeBlockEnabled).onChange(async i=>{this.plugin.settings.horizontalScrollingCodeBlockEnabled=i,this.plugin.codeBlock.updateStyle(),await this.plugin.saveSettings()})),this.createSetting("File tree","Allow horizontal scrolling in the file tree and show a scrollbar.").addToggle(t=>t.setValue(this.plugin.settings.horizontalScrollingFileTreeEnabled).onChange(async i=>{this.plugin.settings.horizontalScrollingFileTreeEnabled=i,this.plugin.fileTree.updateStyle(),await this.plugin.saveSettings()})))}displayRestoreScrollSettings(){this.containerEl.createEl("br"),this.createHeading("Remember scroll/cursor position","Automatically save your position before closing a file and restore it upon opening the file again."),this.createSetting("Mode","Start at the top/bottom of the file, or restore the cursor or scroll position.",()=>this.plugin.settings.restoreScrollMode=h.restoreScrollMode).addDropdown(i=>i.addOption("top","Start at top (Obsidian's default)").addOption("bottom","Start at bottom").addOption("cursor","Restore cursor position").addOption("scroll","Restore scroll position").setValue(this.plugin.settings.restoreScrollMode).onChange(async s=>{this.plugin.settings.restoreScrollMode=s,this.display(),await this.plugin.saveSettings()})),this.settingsEnabled=["scroll","cursor"].includes(this.plugin.settings.restoreScrollMode);let t=this.plugin.restoreScroll.countEphemeralStates();this.createSetting("Saved positions limit",`Number of files to remember scroll positions for. Leave empty for unlimited.
Currently positions for ${t} file${t==1?"":"s"} are stored.`,()=>this.plugin.settings.restoreScrollLimit=h.restoreScrollLimit).addText(i=>{i.setPlaceholder("Unlimited").setValue(this.plugin.settings.restoreScrollLimit>0?this.plugin.settings.restoreScrollLimit.toString():"").onChange(s=>{let l=+s;if(!l.toString().contains(".")){if(l<=0){this.plugin.settings.restoreScrollLimit=-1;return}this.plugin.settings.restoreScrollLimit=l}})}),this.plugin.settings.enableExperimentalSettings?this.createSetting("Restore position in other files (Experimental)","Enable restoring scroll position in Markdown preview, images, and PDFs.").addToggle(i=>i.setValue(this.plugin.settings.restoreScrollAllFiles).onChange(async s=>{this.plugin.settings.restoreScrollAllFiles=s,await this.plugin.saveSettings()})):this.plugin.settings.restoreScrollAllFiles=h.restoreScrollAllFiles,this.createSetting("Store positions in file","Save positions inside a file to keep them after Obsidian restarts.").addToggle(i=>i.setValue(this.plugin.settings.restoreScrollFileEnabled).onChange(async s=>{this.plugin.settings.restoreScrollFileEnabled=s,this.display(),await this.plugin.saveSettings()})),this.settingsEnabled&&=this.plugin.settings.restoreScrollFileEnabled,this.createSetting("Storage file path","Where to store scrolling & cursor positions.").addText(i=>{i.setValue(this.plugin.settings.restoreScrollFilePath).onChange(m=>{this.proposedRestoreScrollStoreFile=m});let s=async()=>{let m=await this.plugin.restoreScroll.renameStoreFile(this.proposedRestoreScrollStoreFile);m&&(this.plugin.settings.restoreScrollFilePath=m,this.proposedRestoreScrollStoreFile=null,await this.plugin.saveSettings())},l=m=>{m.key==="Enter"&&s()};i.inputEl.addEventListener("keydown",l),this.plugin.register(()=>i.inputEl.removeEventListener("keydown",l));let r;i.inputEl.parentElement?(r=i.inputEl.parentElement,r.style.display="flex",r.style.alignItems="flex-end",r.style.flexDirection="column",r.style.marginBottom="-1.5em"):r=this.containerEl;let n=r.createDiv({cls:"setting-item-control"});n.style.display="flex";let c=n.createDiv({cls:"clickable-icon extra-setting-button"});this.settingsEnabled&&c.setAttr("aria-label","Cancel changes"),(0,u.setIcon)(c,"reset"),c.onclick=()=>{this.proposedRestoreScrollStoreFile!==null&&(i.setValue(this.plugin.settings.restoreScrollFilePath),this.proposedRestoreScrollStoreFile=null)};let d=n.createEl("button",{text:"Confirm"});d.onclick=s,d.disabled=!this.settingsEnabled})}displayScrollbarSettings(){this.containerEl.createEl("br"),this.createHeading("Scrollbar appearance"),u.Platform.isMacOS||this.createSetting("Scrollbar visibility","When to show the scrollbar in notes and PDFs.",()=>{this.plugin.settings.scrollbarVisibility=h.scrollbarVisibility,this.plugin.scrollbar.updateStyle()}).addDropdown(t=>t.addOption("hide","Always hide scrollbar").addOption("scroll","Show scrollbar while scrolling").addOption("show","Always show scrollbar").setValue(this.plugin.settings.scrollbarVisibility).onChange(async i=>{this.plugin.settings.scrollbarVisibility=i,this.plugin.scrollbar.updateStyle(),this.display(),await this.plugin.saveSettings()})),u.Platform.isLinux&&u.Platform.isDesktop&&(this.settingsEnabled=this.plugin.settings.scrollbarVisibility!=="hide",this.createSetting("Scrollbar thickness","Scrollbar width in pixels.",()=>{this.plugin.settings.scrollbarWidth=h.scrollbarWidth,this.plugin.scrollbar.updateStyle()}).addSlider(t=>t.setValue(this.plugin.settings.scrollbarWidth).setLimits(0,30,1).onChange(async i=>{this.plugin.settings.scrollbarWidth=i,this.plugin.scrollbar.updateStyle(),await this.plugin.saveSettings()})))}displayMouseScrollSettings(){u.Platform.isMobile||(this.containerEl.createEl("br"),this.createHeading("Mouse & Touchpad (Experimental)"),this.createSetting("Enable","Enable custom scrolling behavior.").addToggle(t=>t.setValue(this.plugin.settings.mouseEnabled).onChange(async i=>{this.plugin.settings.mouseEnabled=i,this.display(),await this.plugin.saveSettings()})),this.settingsEnabled=this.plugin.settings.mouseEnabled,this.plugin.settings.enableExperimentalSettings?this.createSetting("Invert scroll direction (Experimental)","Reverse the scroll direction for mouse wheel and touchpad input.").addToggle(t=>t.setValue(this.plugin.settings.mouseInvert).onChange(async i=>{this.plugin.settings.mouseInvert=i,await this.plugin.saveSettings()})):this.plugin.settings.mouseInvert=h.mouseInvert,this.createSetting("Mouse scroll speed","How far the page scrolls.",()=>this.plugin.settings.mouseSpeed=h.mouseSpeed).addSlider(t=>t.setValue(this.plugin.settings.mouseSpeed).setLimits(1,100,1).onChange(async i=>{this.plugin.settings.mouseSpeed=i,await this.plugin.saveSettings()})),this.createSetting("Mouse scroll smoothness","Duration of the scroll animation.",()=>this.plugin.settings.mouseSmoothness=h.mouseSmoothness).addSlider(t=>t.setValue(this.plugin.settings.mouseSmoothness).setLimits(0,100,1).onChange(async i=>{this.plugin.settings.mouseSmoothness=i,await this.plugin.saveSettings()})),this.plugin.settings.enableExperimentalSettings?(this.createSetting("Touchpad detection (Experimental)",`Detect touchpad input and apply dedicated scrolling behavior.
Detection works reliably on most devices but may occasionally misidentify input type.`).addToggle(t=>t.setValue(this.plugin.settings.touchpadEnabled).onChange(async i=>{this.plugin.settings.touchpadEnabled=i,this.display(),await this.plugin.saveSettings()})),this.settingsEnabled&&=this.plugin.settings.touchpadEnabled):this.plugin.settings.mouseInvert=h.mouseInvert,this.createSetting("Touchpad scroll speed","How far the page scrolls.",()=>this.plugin.settings.touchpadSpeed=h.touchpadSpeed).addSlider(t=>t.setValue(this.plugin.settings.touchpadSpeed).setLimits(1,100,1).onChange(async i=>{this.plugin.settings.touchpadSpeed=i,await this.plugin.saveSettings()})),this.createSetting("Touchpad scroll smoothness","Duration of the scroll animation.",()=>this.plugin.settings.touchpadSmoothness=h.touchpadSmoothness).addSlider(t=>t.setValue(this.plugin.settings.touchpadSmoothness).setLimits(0,100,1).onChange(async i=>{this.plugin.settings.touchpadSmoothness=i,await this.plugin.saveSettings()})),this.createSetting("Touchpad friction threshold",`Threshold between precise and smooth scrolling.
Defines how much finger movement is needed before scrolling decelerates and stops.`,()=>this.plugin.settings.touchpadFrictionThreshold=h.touchpadFrictionThreshold).addSlider(t=>t.setValue(this.plugin.settings.touchpadFrictionThreshold).setLimits(1,100,1).onChange(async i=>{this.plugin.settings.touchpadFrictionThreshold=i,await this.plugin.saveSettings()})))}};var A=class extends U.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new H(this)),this.codeBlock=new E(this),this.fileTree=new b(this),this.followCursor=new v(this),this.followScroll=new w(this),this.mouseScroll=new y(this),this.restoreScroll=new S(this),this.scrollbar=new L(this),this.events=new C(this),await this.restoreScroll.loadData(),console.log("ScrollingPlugin loaded")}async onunload(){this.restoreScroll.quitHandler(),console.log("ScrollingPlugin unloaded")}async loadSettings(){this.settings=Object.assign({},h,await this.loadData());for(let e in this.settings)e in h||delete this.settings[e]}async saveSettings(){await this.saveData(this.settings)}};

/* nosourcemap */