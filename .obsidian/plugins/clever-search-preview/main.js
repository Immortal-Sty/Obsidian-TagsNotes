/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Dc=Object.create;var Zn=Object.defineProperty;var Ba=Object.getOwnPropertyDescriptor;var Rc=Object.getOwnPropertyNames;var jc=Object.getPrototypeOf,Nc=Object.prototype.hasOwnProperty;var Bc=(t,e)=>()=>(t&&(e=t(t=0)),e);var fe=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),za=(t,e)=>{for(var n in e)Zn(t,n,{get:e[n],enumerable:!0})},$a=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Rc(e))!Nc.call(t,i)&&i!==n&&Zn(t,i,{get:()=>e[i],enumerable:!(r=Ba(e,i))||r.enumerable});return t};var Te=(t,e,n)=>(n=t!=null?Dc(jc(t)):{},$a(e||!t||!t.__esModule?Zn(n,"default",{value:t,enumerable:!0}):n,t)),Gr=t=>$a(Zn({},"__esModule",{value:!0}),t),W=(t,e,n,r)=>{for(var i=r>1?void 0:r?Ba(e,n):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=(r?o(e,n,i):o(i))||i);return r&&i&&Zn(e,n,i),i},Xr=(t,e)=>(n,r)=>e(n,r,t);var Yr={};za(Yr,{__assign:()=>ds,__asyncDelegator:()=>Zc,__asyncGenerator:()=>Qc,__asyncValues:()=>Jc,__await:()=>Jn,__awaiter:()=>Hc,__classPrivateFieldGet:()=>rf,__classPrivateFieldSet:()=>sf,__createBinding:()=>qc,__decorate:()=>Vc,__exportStar:()=>Gc,__extends:()=>zc,__generator:()=>Wc,__importDefault:()=>nf,__importStar:()=>tf,__makeTemplateObject:()=>ef,__metadata:()=>Uc,__param:()=>Kc,__read:()=>Ka,__rest:()=>$c,__spread:()=>Xc,__spreadArrays:()=>Yc,__values:()=>ps});function zc(t,e){hs(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function $c(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function Vc(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function Kc(t,e){return function(n,r){e(n,r,t)}}function Uc(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Hc(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(f){o(f)}}function l(c){try{u(r.throw(c))}catch(f){o(f)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((r=r.apply(t,e||[])).next())})}function Wc(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(c){u=[6,c],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function qc(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]}function Gc(t,e){for(var n in t)n!=="default"&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function ps(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ka(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function Xc(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Ka(arguments[e]));return t}function Yc(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Jn(t){return this instanceof Jn?(this.v=t,this):new Jn(t)}function Qc(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){r[h]&&(i[h]=function(d){return new Promise(function(p,m){s.push([h,d,p,m])>1||a(h,d)})})}function a(h,d){try{l(r[h](d))}catch(p){f(s[0][3],p)}}function l(h){h.value instanceof Jn?Promise.resolve(h.value.v).then(u,c):f(s[0][2],h)}function u(h){a("next",h)}function c(h){a("throw",h)}function f(h,d){h(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Zc(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:Jn(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function Jc(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof ps=="function"?ps(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(u){s({value:u,done:a})},o)}}function ef(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function tf(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function nf(t){return t&&t.__esModule?t:{default:t}}function rf(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function sf(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}var hs,ds,Qr=Bc(()=>{hs=function(t,e){return hs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},hs(t,e)};ds=function(){return ds=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ds.apply(this,arguments)}});var ys=fe(gs=>{"use strict";Object.defineProperty(gs,"__esModule",{value:!0});var ms;(function(t){t[t.Transient=0]="Transient",t[t.Singleton=1]="Singleton",t[t.ResolutionScoped=2]="ResolutionScoped",t[t.ContainerScoped=3]="ContainerScoped"})(ms||(ms={}));gs.default=ms});var Ua=fe(vs=>{"use strict";Object.defineProperty(vs,"__esModule",{value:!0});var of=ys();Object.defineProperty(vs,"Lifecycle",{enumerable:!0,get:function(){return of.default}})});var en=fe(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.defineInjectionTokenMetadata=dt.getParamInfo=dt.INJECTION_TOKEN_METADATA_KEY=void 0;dt.INJECTION_TOKEN_METADATA_KEY="injectionTokens";function af(t){let e=Reflect.getMetadata("design:paramtypes",t)||[],n=Reflect.getOwnMetadata(dt.INJECTION_TOKEN_METADATA_KEY,t)||{};return Object.keys(n).forEach(r=>{e[+r]=n[r]}),e}dt.getParamInfo=af;function lf(t,e){return function(n,r,i){let s=Reflect.getOwnMetadata(dt.INJECTION_TOKEN_METADATA_KEY,n)||{};s[i]=e?{token:t,transform:e.transformToken,transformArgs:e.args||[]}:t,Reflect.defineMetadata(dt.INJECTION_TOKEN_METADATA_KEY,s,n)}}dt.defineInjectionTokenMetadata=lf});var _s=fe(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.isClassProvider=void 0;function uf(t){return!!t.useClass}Zr.isClassProvider=uf});var bs=fe(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});Jr.isFactoryProvider=void 0;function cf(t){return!!t.useFactory}Jr.isFactoryProvider=cf});var ti=fe(En=>{"use strict";Object.defineProperty(En,"__esModule",{value:!0});En.delay=En.DelayedConstructor=void 0;var ei=class{constructor(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}createProxy(e){let n={},r=!1,i,s=()=>(r||(i=e(this.wrap()),r=!0),i);return new Proxy(n,this.createHandler(s))}createHandler(e){let n={},r=i=>{n[i]=(...s)=>{s[0]=e();let o=Reflect[i];return o(...s)}};return this.reflectMethods.forEach(r),n}};En.DelayedConstructor=ei;function ff(t){if(typeof t=="undefined")throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new ei(t)}En.delay=ff});var ni=fe(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.isConstructorToken=bt.isTransformDescriptor=bt.isTokenDescriptor=bt.isNormalToken=void 0;var hf=ti();function df(t){return typeof t=="string"||typeof t=="symbol"}bt.isNormalToken=df;function pf(t){return typeof t=="object"&&"token"in t&&"multiple"in t}bt.isTokenDescriptor=pf;function mf(t){return typeof t=="object"&&"token"in t&&"transform"in t}bt.isTransformDescriptor=mf;function gf(t){return typeof t=="function"||t instanceof hf.DelayedConstructor}bt.isConstructorToken=gf});var ws=fe(ri=>{"use strict";Object.defineProperty(ri,"__esModule",{value:!0});ri.isTokenProvider=void 0;function yf(t){return!!t.useToken}ri.isTokenProvider=yf});var xs=fe(ii=>{"use strict";Object.defineProperty(ii,"__esModule",{value:!0});ii.isValueProvider=void 0;function vf(t){return t.useValue!=null}ii.isValueProvider=vf});var Es=fe(tn=>{"use strict";Object.defineProperty(tn,"__esModule",{value:!0});var _f=_s();Object.defineProperty(tn,"isClassProvider",{enumerable:!0,get:function(){return _f.isClassProvider}});var bf=bs();Object.defineProperty(tn,"isFactoryProvider",{enumerable:!0,get:function(){return bf.isFactoryProvider}});var wf=ni();Object.defineProperty(tn,"isNormalToken",{enumerable:!0,get:function(){return wf.isNormalToken}});var xf=ws();Object.defineProperty(tn,"isTokenProvider",{enumerable:!0,get:function(){return xf.isTokenProvider}});var Ef=xs();Object.defineProperty(tn,"isValueProvider",{enumerable:!0,get:function(){return Ef.isValueProvider}})});var Ha=fe(si=>{"use strict";Object.defineProperty(si,"__esModule",{value:!0});si.isProvider=void 0;var Af=_s(),Sf=xs(),Tf=ws(),Cf=bs();function Ff(t){return Af.isClassProvider(t)||Sf.isValueProvider(t)||Tf.isTokenProvider(t)||Cf.isFactoryProvider(t)}si.isProvider=Ff});var Ts=fe(Ss=>{"use strict";Object.defineProperty(Ss,"__esModule",{value:!0});var As=class{constructor(){this._registryMap=new Map}entries(){return this._registryMap.entries()}getAll(e){return this.ensure(e),this._registryMap.get(e)}get(e){this.ensure(e);let n=this._registryMap.get(e);return n[n.length-1]||null}set(e,n){this.ensure(e),this._registryMap.get(e).push(n)}setAll(e,n){this._registryMap.set(e,n)}has(e){return this.ensure(e),this._registryMap.get(e).length>0}clear(){this._registryMap.clear()}ensure(e){this._registryMap.has(e)||this._registryMap.set(e,[])}};Ss.default=As});var Wa=fe(Fs=>{"use strict";Object.defineProperty(Fs,"__esModule",{value:!0});var Pf=Ts(),Cs=class extends Pf.default{};Fs.default=Cs});var qa=fe(Is=>{"use strict";Object.defineProperty(Is,"__esModule",{value:!0});var Ps=class{constructor(){this.scopedResolutions=new Map}};Is.default=Ps});var Ms=fe(oi=>{"use strict";Object.defineProperty(oi,"__esModule",{value:!0});oi.formatErrorCtor=void 0;function If(t,e){return t===null?`at position #${e}`:`"${t.split(",")[e].trim()}" at position #${e}`}function Mf(t,e,n="    "){return[t,...e.message.split(`
`).map(r=>n+r)].join(`
`)}function kf(t,e,n){let[,r=null]=t.toString().match(/constructor\(([\w, ]+)\)/)||[],i=If(r,e);return Mf(`Cannot inject the dependency ${i} of "${t.name}" constructor. Reason:`,n)}oi.formatErrorCtor=kf});var Ga=fe(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});ai.isDisposable=void 0;function Of(t){return!(typeof t.dispose!="function"||t.dispose.length>0)}ai.isDisposable=Of});var Ya=fe(nn=>{"use strict";Object.defineProperty(nn,"__esModule",{value:!0});nn.PostResolutionInterceptors=nn.PreResolutionInterceptors=void 0;var Xa=Ts(),li=class extends Xa.default{};nn.PreResolutionInterceptors=li;var ui=class extends Xa.default{};nn.PostResolutionInterceptors=ui;var ks=class{constructor(){this.preResolution=new li,this.postResolution=new ui}};nn.default=ks});var rn=fe(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.instance=St.typeInfo=void 0;var Lf=(Qr(),Gr(Yr)),qe=Es(),Df=Ha(),ci=ni(),Rf=Wa(),Qe=ys(),Qa=qa(),jf=Ms(),Nf=ti(),Bf=Ga(),zf=Ya();St.typeInfo=new Map;var er=class{constructor(e){this.parent=e,this._registry=new Rf.default,this.interceptors=new zf.default,this.disposed=!1,this.disposables=new Set}register(e,n,r={lifecycle:Qe.default.Transient}){this.ensureNotDisposed();let i;if(Df.isProvider(n)?i=n:i={useClass:n},qe.isTokenProvider(i)){let s=[e],o=i;for(;o!=null;){let a=o.useToken;if(s.includes(a))throw new Error(`Token registration cycle detected! ${[...s,a].join(" -> ")}`);s.push(a);let l=this._registry.get(a);l&&qe.isTokenProvider(l.provider)?o=l.provider:o=null}}if((r.lifecycle===Qe.default.Singleton||r.lifecycle==Qe.default.ContainerScoped||r.lifecycle==Qe.default.ResolutionScoped)&&(qe.isValueProvider(i)||qe.isFactoryProvider(i)))throw new Error(`Cannot use lifecycle "${Qe.default[r.lifecycle]}" with ValueProviders or FactoryProviders`);return this._registry.set(e,{provider:i,options:r}),this}registerType(e,n){return this.ensureNotDisposed(),qe.isNormalToken(n)?this.register(e,{useToken:n}):this.register(e,{useClass:n})}registerInstance(e,n){return this.ensureNotDisposed(),this.register(e,{useValue:n})}registerSingleton(e,n){if(this.ensureNotDisposed(),qe.isNormalToken(e)){if(qe.isNormalToken(n))return this.register(e,{useToken:n},{lifecycle:Qe.default.Singleton});if(n)return this.register(e,{useClass:n},{lifecycle:Qe.default.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}let r=e;return n&&!qe.isNormalToken(n)&&(r=n),this.register(e,{useClass:r},{lifecycle:Qe.default.Singleton})}resolve(e,n=new Qa.default){this.ensureNotDisposed();let r=this.getRegistration(e);if(!r&&qe.isNormalToken(e))throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`);if(this.executePreResolutionInterceptor(e,"Single"),r){let i=this.resolveRegistration(r,n);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(ci.isConstructorToken(e)){let i=this.construct(e,n);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")}executePreResolutionInterceptor(e,n){if(this.interceptors.preResolution.has(e)){let r=[];for(let i of this.interceptors.preResolution.getAll(e))i.options.frequency!="Once"&&r.push(i),i.callback(e,n);this.interceptors.preResolution.setAll(e,r)}}executePostResolutionInterceptor(e,n,r){if(this.interceptors.postResolution.has(e)){let i=[];for(let s of this.interceptors.postResolution.getAll(e))s.options.frequency!="Once"&&i.push(s),s.callback(e,n,r);this.interceptors.postResolution.setAll(e,i)}}resolveRegistration(e,n){if(this.ensureNotDisposed(),e.options.lifecycle===Qe.default.ResolutionScoped&&n.scopedResolutions.has(e))return n.scopedResolutions.get(e);let r=e.options.lifecycle===Qe.default.Singleton,i=e.options.lifecycle===Qe.default.ContainerScoped,s=r||i,o;return qe.isValueProvider(e.provider)?o=e.provider.useValue:qe.isTokenProvider(e.provider)?o=s?e.instance||(e.instance=this.resolve(e.provider.useToken,n)):this.resolve(e.provider.useToken,n):qe.isClassProvider(e.provider)?o=s?e.instance||(e.instance=this.construct(e.provider.useClass,n)):this.construct(e.provider.useClass,n):qe.isFactoryProvider(e.provider)?o=e.provider.useFactory(this):o=this.construct(e.provider,n),e.options.lifecycle===Qe.default.ResolutionScoped&&n.scopedResolutions.set(e,o),o}resolveAll(e,n=new Qa.default){this.ensureNotDisposed();let r=this.getAllRegistrations(e);if(!r&&qe.isNormalToken(e))throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`);if(this.executePreResolutionInterceptor(e,"All"),r){let s=r.map(o=>this.resolveRegistration(o,n));return this.executePostResolutionInterceptor(e,s,"All"),s}let i=[this.construct(e,n)];return this.executePostResolutionInterceptor(e,i,"All"),i}isRegistered(e,n=!1){return this.ensureNotDisposed(),this._registry.has(e)||n&&(this.parent||!1)&&this.parent.isRegistered(e,!0)}reset(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()}clearInstances(){this.ensureNotDisposed();for(let[e,n]of this._registry.entries())this._registry.setAll(e,n.filter(r=>!qe.isValueProvider(r.provider)).map(r=>(r.instance=void 0,r)))}createChildContainer(){this.ensureNotDisposed();let e=new er(this);for(let[n,r]of this._registry.entries())r.some(({options:i})=>i.lifecycle===Qe.default.ContainerScoped)&&e._registry.setAll(n,r.map(i=>i.options.lifecycle===Qe.default.ContainerScoped?{provider:i.provider,options:i.options}:i));return e}beforeResolution(e,n,r={frequency:"Always"}){this.interceptors.preResolution.set(e,{callback:n,options:r})}afterResolution(e,n,r={frequency:"Always"}){this.interceptors.postResolution.set(e,{callback:n,options:r})}dispose(){return Lf.__awaiter(this,void 0,void 0,function*(){this.disposed=!0;let e=[];this.disposables.forEach(n=>{let r=n.dispose();r&&e.push(r)}),yield Promise.all(e)})}getRegistration(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null}getAllRegistrations(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null}construct(e,n){if(e instanceof Nf.DelayedConstructor)return e.createProxy(i=>this.resolve(i,n));let r=(()=>{let i=St.typeInfo.get(e);if(!i||i.length===0){if(e.length===0)return new e;throw new Error(`TypeInfo not known for "${e.name}"`)}let s=i.map(this.resolveParams(n,e));return new e(...s)})();return Bf.isDisposable(r)&&this.disposables.add(r),r}resolveParams(e,n){return(r,i)=>{try{return ci.isTokenDescriptor(r)?ci.isTransformDescriptor(r)?r.multiple?this.resolve(r.transform).transform(this.resolveAll(r.token),...r.transformArgs):this.resolve(r.transform).transform(this.resolve(r.token,e),...r.transformArgs):r.multiple?this.resolveAll(r.token):this.resolve(r.token,e):ci.isTransformDescriptor(r)?this.resolve(r.transform,e).transform(this.resolve(r.token,e),...r.transformArgs):this.resolve(r,e)}catch(s){throw new Error(jf.formatErrorCtor(n,i,s))}}}ensureNotDisposed(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")}};St.instance=new er;St.default=St.instance});var Za=fe(Ls=>{"use strict";Object.defineProperty(Ls,"__esModule",{value:!0});var $f=en(),Tt=rn(),Os=ni(),Vf=Ms();function Kf(){return function(t){let e=$f.getParamInfo(t);return class extends t{constructor(...n){super(...n.concat(e.slice(n.length).map((r,i)=>{try{return Os.isTokenDescriptor(r)?Os.isTransformDescriptor(r)?r.multiple?Tt.instance.resolve(r.transform).transform(Tt.instance.resolveAll(r.token),...r.transformArgs):Tt.instance.resolve(r.transform).transform(Tt.instance.resolve(r.token),...r.transformArgs):r.multiple?Tt.instance.resolveAll(r.token):Tt.instance.resolve(r.token):Os.isTransformDescriptor(r)?Tt.instance.resolve(r.transform).transform(Tt.instance.resolve(r.token),...r.transformArgs):Tt.instance.resolve(r)}catch(s){let o=i+n.length;throw new Error(Vf.formatErrorCtor(t,o,s))}})))}}}}Ls.default=Kf});var Ja=fe(Ds=>{"use strict";Object.defineProperty(Ds,"__esModule",{value:!0});var Uf=en();function Hf(t){return Uf.defineInjectionTokenMetadata(t)}Ds.default=Hf});var fi=fe(Rs=>{"use strict";Object.defineProperty(Rs,"__esModule",{value:!0});var Wf=en(),qf=rn();function Gf(){return function(t){qf.typeInfo.set(t,Wf.getParamInfo(t))}}Rs.default=Gf});var el=fe(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0});var Xf=(Qr(),Gr(Yr)),Yf=rn();function Qf(t=[]){return function(e){return t.forEach(n=>{var{token:r,options:i}=n,s=Xf.__rest(n,["token","options"]);return Yf.instance.register(r,s,i)}),e}}js.default=Qf});var tl=fe(Ns=>{"use strict";Object.defineProperty(Ns,"__esModule",{value:!0});var Zf=fi(),Jf=rn();function eh(){return function(t){Zf.default()(t),Jf.instance.registerSingleton(t)}}Ns.default=eh});var nl=fe(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0});var th=en();function nh(t){let e={token:t,multiple:!0};return th.defineInjectionTokenMetadata(e)}Bs.default=nh});var rl=fe(zs=>{"use strict";Object.defineProperty(zs,"__esModule",{value:!0});var rh=en();function ih(t,e,...n){let r={token:t,multiple:!0,transform:e,transformArgs:n};return rh.defineInjectionTokenMetadata(r)}zs.default=ih});var il=fe($s=>{"use strict";Object.defineProperty($s,"__esModule",{value:!0});var sh=en();function oh(t,e,...n){return sh.defineInjectionTokenMetadata(t,{transformToken:e,args:n})}$s.default=oh});var sl=fe(Vs=>{"use strict";Object.defineProperty(Vs,"__esModule",{value:!0});var ah=fi(),lh=rn();function uh(t,e){return function(n){ah.default()(n),lh.instance.register(e||n,n,{lifecycle:t})}}Vs.default=uh});var ol=fe(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});var ch=Za();Object.defineProperty(pt,"autoInjectable",{enumerable:!0,get:function(){return ch.default}});var fh=Ja();Object.defineProperty(pt,"inject",{enumerable:!0,get:function(){return fh.default}});var hh=fi();Object.defineProperty(pt,"injectable",{enumerable:!0,get:function(){return hh.default}});var dh=el();Object.defineProperty(pt,"registry",{enumerable:!0,get:function(){return dh.default}});var ph=tl();Object.defineProperty(pt,"singleton",{enumerable:!0,get:function(){return ph.default}});var mh=nl();Object.defineProperty(pt,"injectAll",{enumerable:!0,get:function(){return mh.default}});var gh=rl();Object.defineProperty(pt,"injectAllWithTransform",{enumerable:!0,get:function(){return gh.default}});var yh=il();Object.defineProperty(pt,"injectWithTransform",{enumerable:!0,get:function(){return yh.default}});var vh=sl();Object.defineProperty(pt,"scoped",{enumerable:!0,get:function(){return vh.default}})});var al=fe(Ks=>{"use strict";Object.defineProperty(Ks,"__esModule",{value:!0});function _h(t){let e;return n=>(e==null&&(e=t(n)),e)}Ks.default=_h});var ll=fe(Us=>{"use strict";Object.defineProperty(Us,"__esModule",{value:!0});function bh(t){let e=new WeakMap;return n=>{let r=e.get(n);return r==null&&(r=t(n),e.set(n,r)),r}}Us.default=bh});var ul=fe(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});function wh(t,e,n,r=!0){let i,s;return o=>{let a=t(o);return(!r||s!==a)&&((s=a)?i=o.resolve(e):i=o.resolve(n)),i}}Hs.default=wh});var cl=fe(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});var xh=al();Object.defineProperty(tr,"instanceCachingFactory",{enumerable:!0,get:function(){return xh.default}});var Eh=ll();Object.defineProperty(tr,"instancePerContainerCachingFactory",{enumerable:!0,get:function(){return Eh.default}});var Ah=ul();Object.defineProperty(tr,"predicateAwareClassFactory",{enumerable:!0,get:function(){return Ah.default}})});var Fe=fe(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});var Ws=(Qr(),Gr(Yr));if(typeof Reflect=="undefined"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var Sh=Ua();Object.defineProperty(Nt,"Lifecycle",{enumerable:!0,get:function(){return Sh.Lifecycle}});Ws.__exportStar(ol(),Nt);Ws.__exportStar(cl(),Nt);Ws.__exportStar(Es(),Nt);var Th=ti();Object.defineProperty(Nt,"delay",{enumerable:!0,get:function(){return Th.delay}});var Ch=rn();Object.defineProperty(Nt,"container",{enumerable:!0,get:function(){return Ch.instance}})});var gl=fe((cg,ml)=>{"use strict";var Fh=new Intl.Collator("en",{numeric:!0,sensitivity:"base"}).compare,Xs=1/0,qs=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),fl="eexxaacctt",Ph="A-Z",Ih="a-z",nr=(t,e,n)=>t.replace(Ph,e).replace(Ih,n),hl={unicode:!1,alpha:null,interSplit:"[^A-Za-z\\d']+",intraSplit:"[a-z][A-Z]",intraBound:"[A-Za-z]\\d|\\d[A-Za-z]|[a-z][A-Z]",interLft:0,interRgt:0,interChars:".",interIns:Xs,intraChars:"[a-z\\d']",intraIns:null,intraContr:"'[a-z]{1,2}\\b",intraMode:0,intraSlice:[1,Xs],intraSub:null,intraTrn:null,intraDel:null,intraFilt:(t,e,n)=>!0,sort:(t,e,n)=>{let{idx:r,chars:i,terms:s,interLft2:o,interLft1:a,start:l,intraIns:u,interIns:c}=t;return r.map((f,h)=>h).sort((f,h)=>i[h]-i[f]||u[f]-u[h]||s[h]+o[h]+.5*a[h]-(s[f]+o[f]+.5*a[f])||c[f]-c[h]||l[f]-l[h]||Fh(e[r[f]],e[r[h]]))}},Gs=(t,e)=>e==0?"":e==1?t+"??":e==Xs?t+"*?":t+`{0,${e}}?`,dl="(?:\\b|_)";function hi(t){var ue;t=Object.assign({},hl,t);let{unicode:e,interLft:n,interRgt:r,intraMode:i,intraSlice:s,intraIns:o,intraSub:a,intraTrn:l,intraDel:u,intraContr:c,intraSplit:f,interSplit:h,intraBound:d,intraChars:p}=t;o!=null||(o=i),a!=null||(a=i),l!=null||(l=i),u!=null||(u=i);let m=(ue=t.letters)!=null?ue:t.alpha;if(m!=null){let x=m.toLocaleUpperCase(),P=m.toLocaleLowerCase();h=nr(h,x,P),f=nr(f,x,P),d=nr(d,x,P),p=nr(p,x,P),c=nr(c,x,P)}let y=e?"u":"",g='".+?"',v=new RegExp(g,"gi"+y),w=new RegExp(`(?:\\s+|^)-(?:${p}+|${g})`,"gi"+y),{intraRules:_}=t;_==null&&(_=x=>{let P=hl.intraSlice,j=0,G=0,X=0,Y=0;if(/[^\d]/.test(x)){let se=x.length;se<=4?se>=3&&(X=Math.min(l,1),se==4&&(j=Math.min(o,1))):(P=s,j=o,G=a,X=l,Y=u)}return{intraSlice:P,intraIns:j,intraSub:G,intraTrn:X,intraDel:Y}});let A=!!f,T=new RegExp(f,"g"+y),C=new RegExp(h,"g"+y),F=new RegExp("^"+h+"|"+h+"$","g"+y),R=new RegExp(c,"gi"+y),N=x=>{let P=[];x=x.replace(v,G=>(P.push(G),fl)),x=x.replace(F,"").toLocaleLowerCase(),A&&(x=x.replace(T,G=>G[0]+" "+G[1]));let j=0;return x.split(C).filter(G=>G!="").map(G=>G===fl?P[j++]:G)},L=/[^\d]+|\d+/g,B=(x,P=0,j=!1)=>{let G=N(x);if(G.length==0)return[];let X=Array(G.length).fill("");G=G.map((he,ce)=>he.replace(R,Oe=>(X[ce]=Oe,"")));let Y;if(i==1)Y=G.map((he,ce)=>{if(he[0]==='"')return qs(he.slice(1,-1));let Oe="";for(let me of he.matchAll(L)){let de=me[0],{intraSlice:te,intraIns:ne,intraSub:Ae,intraTrn:re,intraDel:ve}=_(de);if(ne+Ae+re+ve==0)Oe+=de+X[ce];else{let[be,Ie]=te,He=de.slice(0,be),b=de.slice(Ie),E=de.slice(be,Ie);ne==1&&He.length==1&&He!=E[0]&&(He+="(?!"+He+")");let S=E.length,I=[de];if(Ae)for(let k=0;k<S;k++)I.push(He+E.slice(0,k)+p+E.slice(k+1)+b);if(re)for(let k=0;k<S-1;k++)E[k]!=E[k+1]&&I.push(He+E.slice(0,k)+E[k+1]+E[k]+E.slice(k+2)+b);if(ve)for(let k=0;k<S;k++)I.push(He+E.slice(0,k+1)+"?"+E.slice(k+1)+b);if(ne){let k=Gs(p,1);for(let pe=0;pe<S;pe++)I.push(He+E.slice(0,pe)+k+E.slice(pe)+b)}Oe+="(?:"+I.join("|")+")"+X[ce]}}return Oe});else{let he=Gs(p,o);P==2&&o>0&&(he=")("+he+")("),Y=G.map((ce,Oe)=>ce[0]==='"'?qs(ce.slice(1,-1)):ce.split("").map((me,de,te)=>(o==1&&de==0&&te.length>1&&me!=te[de+1]&&(me+="(?!"+me+")"),me)).join(he)+X[Oe])}let se=n==2?dl:"",ye=r==2?dl:"",Ye=ye+Gs(t.interChars,t.interIns)+se;return P>0?j?Y=se+"("+Y.join(")"+ye+"|"+se+"(")+")"+ye:(Y="("+Y.join(")("+Ye+")(")+")",Y="(.??"+se+")"+Y+"("+ye+".*)"):(Y=Y.join(Ye),Y=se+Y+ye),[new RegExp(Y,"i"+y),G,X]},D=(x,P,j)=>{let[G]=B(P);if(G==null)return null;let X=[];if(j!=null)for(let Y=0;Y<j.length;Y++){let se=j[Y];G.test(x[se])&&X.push(se)}else for(let Y=0;Y<x.length;Y++)G.test(x[Y])&&X.push(Y);return X},K=!!d,ee=new RegExp(h,y),Q=new RegExp(d,y),ae=(x,P,j)=>{let[G,X,Y]=B(j,1),[se]=B(j,2),ye=X.length,Ye=x.length,he=Array(Ye).fill(0),ce={idx:Array(Ye),start:he.slice(),chars:he.slice(),terms:he.slice(),interIns:he.slice(),intraIns:he.slice(),interLft2:he.slice(),interRgt2:he.slice(),interLft1:he.slice(),interRgt1:he.slice(),ranges:Array(Ye)},Oe=n==1||r==1,me=0;for(let de=0;de<x.length;de++){let te=P[x[de]],ne=te.match(G),Ae=ne.index+ne[1].length,re=Ae,ve=!1,be=0,Ie=0,He=0,b=0,E=0,S=0,I=0,k=0,pe=[];for(let $=0,U=2;$<ye;$++,U+=2){let V=ne[U].toLocaleLowerCase(),Z=X[$],J=Z[0]=='"'?Z.slice(1,-1):Z+Y[$],Se=J.length,je=V.length,We=V==J;if(!We&&ne[U+1].length>=Se){let Ce=ne[U+1].toLocaleLowerCase().indexOf(J);Ce>-1&&(pe.push(re,je,Ce,Se),re+=le(ne,U,Ce,Se),V=J,je=Se,We=!0,$==0&&(Ae=re))}if(Oe||We){let Ce=re-1,At=re+je,Zt=!1,Qn=!1;if(Ce==-1||ee.test(te[Ce]))We&&be++,Zt=!0;else{if(n==2){ve=!0;break}if(K&&Q.test(te[Ce]+te[Ce+1]))We&&Ie++,Zt=!0;else if(n==1){let qr=ne[U+1],wn=re+je;if(qr.length>=Se){let Jt=0,xn=!1,Lc=new RegExp(J,"ig"+y),ja;for(;ja=Lc.exec(qr);){Jt=ja.index;let Na=wn+Jt,fs=Na-1;if(fs==-1||ee.test(te[fs])){be++,xn=!0;break}else if(Q.test(te[fs]+te[Na])){Ie++,xn=!0;break}}xn&&(Zt=!0,pe.push(re,je,Jt,Se),re+=le(ne,U,Jt,Se),V=J,je=Se,We=!0,$==0&&(Ae=re))}if(!Zt){ve=!0;break}}}if(At==te.length||ee.test(te[At]))We&&He++,Qn=!0;else{if(r==2){ve=!0;break}if(K&&Q.test(te[At-1]+te[At]))We&&b++,Qn=!0;else if(r==1){ve=!0;break}}We&&(E+=Se,Zt&&Qn&&S++)}if(je>Se&&(k+=je-Se),$>0&&(I+=ne[U-1].length),!t.intraFilt(J,V,re)){ve=!0;break}$<ye-1&&(re+=je+ne[U+1].length)}if(!ve){ce.idx[me]=x[de],ce.interLft2[me]=be,ce.interLft1[me]=Ie,ce.interRgt2[me]=He,ce.interRgt1[me]=b,ce.chars[me]=E,ce.terms[me]=S,ce.interIns[me]=I,ce.intraIns[me]=k,ce.start[me]=Ae;let $=te.match(se),U=$.index+$[1].length,V=pe.length,Z=V>0?0:1/0,J=V-4;for(let Ce=2;Ce<$.length;){let At=$[Ce].length;if(Z<=J&&pe[Z]==U){let Zt=pe[Z+1],Qn=pe[Z+2],qr=pe[Z+3],wn=Ce,Jt="";for(let xn=0;xn<Zt;wn++)Jt+=$[wn],xn+=$[wn].length;$.splice(Ce,wn-Ce,Jt),U+=le($,Ce,Qn,qr),Z+=4}else U+=At,Ce++}U=$.index+$[1].length;let Se=ce.ranges[me]=[],je=U,We=U;for(let Ce=2;Ce<$.length;Ce++){let At=$[Ce].length;U+=At,Ce%2==0?We=U:At>0&&(Se.push(je,We),je=We=U)}We>je&&Se.push(je,We),me++}}if(me<x.length)for(let de in ce)ce[de]=ce[de].slice(0,me);return ce},le=(x,P,j,G)=>{let X=x[P]+x[P+1].slice(0,j);return x[P-1]+=X,x[P]=x[P+1].slice(j,j+G),x[P+1]=x[P+1].slice(j+G),X.length},xe=5,ot=(x,P,j,G=1e3,X)=>{var de;j=j?j===!0?xe:j:0;let Y=null,se=null,ye=[];P=P.replace(w,te=>{let ne=te.trim().slice(1);return ne[0]==='"'&&(ne=qs(ne.slice(1,-1))),ye.push(ne),""});let Ye=N(P),he;if(ye.length>0){if(he=new RegExp(ye.join("|"),"i"+y),Ye.length==0){let te=[];for(let ne=0;ne<x.length;ne++)he.test(x[ne])||te.push(ne);return[te,null,null]}}else if(Ye.length==0)return[null,null,null];if(j>0){let te=N(P);if(te.length>1){let ne=te.slice().sort((re,ve)=>ve.length-re.length);for(let re=0;re<ne.length;re++){if((X==null?void 0:X.length)==0)return[[],null,null];X=D(x,ne[re],X)}if(te.length>j)return[X,null,null];Y=pl(te).map(re=>re.join(" ")),se=[];let Ae=new Set;for(let re=0;re<Y.length;re++)if(Ae.size<X.length){let ve=X.filter(Ie=>!Ae.has(Ie)),be=D(x,Y[re],ve);for(let Ie=0;Ie<be.length;Ie++)Ae.add(be[Ie]);se.push(be)}else se.push([])}}Y==null&&(Y=[P],se=[(X==null?void 0:X.length)>0?X:D(x,P)]);let ce=null,Oe=null;if(ye.length>0&&(se=se.map(te=>te.filter(ne=>!he.test(x[ne])))),se.reduce((te,ne)=>te+ne.length,0)<=G){ce={},Oe=[];for(let te=0;te<se.length;te++){let ne=se[te];if(ne==null||ne.length==0)continue;let Ae=Y[te],re=ae(ne,x,Ae),ve=t.sort(re,x,Ae);if(te>0)for(let be=0;be<ve.length;be++)ve[be]+=Oe.length;for(let be in re)ce[be]=((de=ce[be])!=null?de:[]).concat(re[be]);Oe=Oe.concat(ve)}}return[[].concat(...se),ce,Oe]};return{search:(...x)=>ot(...x),split:N,filter:D,info:ae,sort:t.sort}}var Mh=(()=>{let t={A:"\xC1\xC0\xC3\xC2\xC4\u0104",a:"\xE1\xE0\xE3\xE2\xE4\u0105",E:"\xC9\xC8\xCA\xCB\u0116",e:"\xE9\xE8\xEA\xEB\u0119",I:"\xCD\xCC\xCE\xCF\u012E",i:"\xED\xEC\xEE\xEF\u012F",O:"\xD3\xD2\xD4\xD5\xD6",o:"\xF3\xF2\xF4\xF5\xF6",U:"\xDA\xD9\xDB\xDC\u016A\u0172",u:"\xFA\xF9\xFB\xFC\u016B\u0173",C:"\xC7\u010C\u0106",c:"\xE7\u010D\u0107",L:"\u0141",l:"\u0142",N:"\xD1\u0143",n:"\xF1\u0144",S:"\u0160\u015A",s:"\u0161\u015B",Z:"\u017B\u0179",z:"\u017C\u017A"},e=new Map,n="";for(let s in t)t[s].split("").forEach(o=>{n+=o,e.set(o,s)});let r=new RegExp(`[${n}]`,"g"),i=s=>e.get(s);return s=>{if(typeof s=="string")return s.replace(r,i);let o=Array(s.length);for(let a=0;a<s.length;a++)o[a]=s[a].replace(r,i);return o}})();function pl(t){t=t.slice();let e=t.length,n=[t.slice()],r=new Array(e).fill(0),i=1,s,o;for(;i<e;)r[i]<i?(s=i%2&&r[i],o=t[i],t[i]=t[s],t[s]=o,++r[i],i=1,n.push(t.slice())):(r[i]=0,++i);return n}var kh=(t,e)=>e?`<mark>${t}</mark>`:t,Oh=(t,e)=>t+e;function Lh(t,e,n=kh,r="",i=Oh){var s,o,a,l;r=(s=i(r,n(t.substring(0,e[0]),!1)))!=null?s:r;for(let u=0;u<e.length;u+=2){let c=e[u],f=e[u+1];r=(o=i(r,n(t.substring(c,f),!0)))!=null?o:r,u<e.length-3&&(r=(a=i(r,n(t.substring(e[u+1],e[u+2]),!1)))!=null?a:r)}return r=(l=i(r,n(t.substring(e[e.length-1]),!1)))!=null?l:r,r}hi.latinize=Mh;hi.permute=t=>pl([...Array(t.length).keys()]).sort((n,r)=>{for(let i=0;i<n.length;i++)if(n[i]!=r[i])return n[i]-r[i];return 0}).map(n=>n.map(r=>t[r]));hi.highlight=Lh;ml.exports=hi});var Fm={};za(Fm,{default:()=>cs});module.exports=Gr(Fm);var Ue=require("obsidian");var Va;(function(t){(function(e){var n=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),r=i(t);typeof n.Reflect=="undefined"?n.Reflect=t:r=i(n.Reflect,r),e(r);function i(s,o){return function(a,l){typeof s[a]!="function"&&Object.defineProperty(s,a,{configurable:!0,writable:!0,value:l}),o&&o(a,l)}}})(function(e){var n=Object.prototype.hasOwnProperty,r=typeof Symbol=="function",i=r&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",s=r&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",a={__proto__:[]}instanceof Array,l=!o&&!a,u={create:o?function(){return He(Object.create(null))}:a?function(){return He({__proto__:null})}:function(){return He({})},has:l?function(b,E){return n.call(b,E)}:function(b,E){return E in b},get:l?function(b,E){return n.call(b,E)?b[E]:void 0}:function(b,E){return b[E]}},c=Object.getPrototypeOf(Function),f=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",h=!f&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ve(),d=!f&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:be(),p=!f&&typeof WeakMap=="function"?WeakMap:Ie(),m=new p;function y(b,E,S,I){if(ue(S)){if(!Ye(b))throw new TypeError;if(!ce(E))throw new TypeError;return N(b,E)}else{if(!Ye(b))throw new TypeError;if(!j(E))throw new TypeError;if(!j(I)&&!ue(I)&&!x(I))throw new TypeError;return x(I)&&(I=void 0),S=ye(S),L(b,E,S,I)}}e("decorate",y);function g(b,E){function S(I,k){if(!j(I))throw new TypeError;if(!ue(k)&&!Oe(k))throw new TypeError;ae(b,E,I,k)}return S}e("metadata",g);function v(b,E,S,I){if(!j(S))throw new TypeError;return ue(I)||(I=ye(I)),ae(b,E,S,I)}e("defineMetadata",v);function w(b,E,S){if(!j(E))throw new TypeError;return ue(S)||(S=ye(S)),D(b,E,S)}e("hasMetadata",w);function _(b,E,S){if(!j(E))throw new TypeError;return ue(S)||(S=ye(S)),K(b,E,S)}e("hasOwnMetadata",_);function A(b,E,S){if(!j(E))throw new TypeError;return ue(S)||(S=ye(S)),ee(b,E,S)}e("getMetadata",A);function T(b,E,S){if(!j(E))throw new TypeError;return ue(S)||(S=ye(S)),Q(b,E,S)}e("getOwnMetadata",T);function C(b,E){if(!j(b))throw new TypeError;return ue(E)||(E=ye(E)),le(b,E)}e("getMetadataKeys",C);function F(b,E){if(!j(b))throw new TypeError;return ue(E)||(E=ye(E)),xe(b,E)}e("getOwnMetadataKeys",F);function R(b,E,S){if(!j(E))throw new TypeError;ue(S)||(S=ye(S));var I=B(E,S,!1);if(ue(I)||!I.delete(b))return!1;if(I.size>0)return!0;var k=m.get(E);return k.delete(S),k.size>0||m.delete(E),!0}e("deleteMetadata",R);function N(b,E){for(var S=b.length-1;S>=0;--S){var I=b[S],k=I(E);if(!ue(k)&&!x(k)){if(!ce(k))throw new TypeError;E=k}}return E}function L(b,E,S,I){for(var k=b.length-1;k>=0;--k){var pe=b[k],$=pe(E,S,I);if(!ue($)&&!x($)){if(!j($))throw new TypeError;I=$}}return I}function B(b,E,S){var I=m.get(b);if(ue(I)){if(!S)return;I=new h,m.set(b,I)}var k=I.get(E);if(ue(k)){if(!S)return;k=new h,I.set(E,k)}return k}function D(b,E,S){var I=K(b,E,S);if(I)return!0;var k=re(E);return x(k)?!1:D(b,k,S)}function K(b,E,S){var I=B(E,S,!1);return ue(I)?!1:Y(I.has(b))}function ee(b,E,S){var I=K(b,E,S);if(I)return Q(b,E,S);var k=re(E);if(!x(k))return ee(b,k,S)}function Q(b,E,S){var I=B(E,S,!1);if(!ue(I))return I.get(b)}function ae(b,E,S,I){var k=B(S,I,!0);k.set(b,E)}function le(b,E){var S=xe(b,E),I=re(b);if(I===null)return S;var k=le(I,E);if(k.length<=0)return S;if(S.length<=0)return k;for(var pe=new d,$=[],U=0,V=S;U<V.length;U++){var Z=V[U],J=pe.has(Z);J||(pe.add(Z),$.push(Z))}for(var Se=0,je=k;Se<je.length;Se++){var Z=je[Se],J=pe.has(Z);J||(pe.add(Z),$.push(Z))}return $}function xe(b,E){var S=[],I=B(b,E,!1);if(ue(I))return S;for(var k=I.keys(),pe=de(k),$=0;;){var U=ne(pe);if(!U)return S.length=$,S;var V=te(U);try{S[$]=V}catch(Z){try{Ae(pe)}finally{throw Z}}$++}}function ot(b){if(b===null)return 1;switch(typeof b){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return b===null?1:6;default:return 6}}function ue(b){return b===void 0}function x(b){return b===null}function P(b){return typeof b=="symbol"}function j(b){return typeof b=="object"?b!==null:typeof b=="function"}function G(b,E){switch(ot(b)){case 0:return b;case 1:return b;case 2:return b;case 3:return b;case 4:return b;case 5:return b}var S=E===3?"string":E===5?"number":"default",I=me(b,i);if(I!==void 0){var k=I.call(b,S);if(j(k))throw new TypeError;return k}return X(b,S==="default"?"number":S)}function X(b,E){if(E==="string"){var S=b.toString;if(he(S)){var I=S.call(b);if(!j(I))return I}var k=b.valueOf;if(he(k)){var I=k.call(b);if(!j(I))return I}}else{var k=b.valueOf;if(he(k)){var I=k.call(b);if(!j(I))return I}var pe=b.toString;if(he(pe)){var I=pe.call(b);if(!j(I))return I}}throw new TypeError}function Y(b){return!!b}function se(b){return""+b}function ye(b){var E=G(b,3);return P(E)?E:se(E)}function Ye(b){return Array.isArray?Array.isArray(b):b instanceof Object?b instanceof Array:Object.prototype.toString.call(b)==="[object Array]"}function he(b){return typeof b=="function"}function ce(b){return typeof b=="function"}function Oe(b){switch(ot(b)){case 3:return!0;case 4:return!0;default:return!1}}function me(b,E){var S=b[E];if(S!=null){if(!he(S))throw new TypeError;return S}}function de(b){var E=me(b,s);if(!he(E))throw new TypeError;var S=E.call(b);if(!j(S))throw new TypeError;return S}function te(b){return b.value}function ne(b){var E=b.next();return E.done?!1:E}function Ae(b){var E=b.return;E&&E.call(b)}function re(b){var E=Object.getPrototypeOf(b);if(typeof b!="function"||b===c||E!==c)return E;var S=b.prototype,I=S&&Object.getPrototypeOf(S);if(I==null||I===Object.prototype)return E;var k=I.constructor;return typeof k!="function"||k===b?E:k}function ve(){var b={},E=[],S=function(){function $(U,V,Z){this._index=0,this._keys=U,this._values=V,this._selector=Z}return $.prototype["@@iterator"]=function(){return this},$.prototype[s]=function(){return this},$.prototype.next=function(){var U=this._index;if(U>=0&&U<this._keys.length){var V=this._selector(this._keys[U],this._values[U]);return U+1>=this._keys.length?(this._index=-1,this._keys=E,this._values=E):this._index++,{value:V,done:!1}}return{value:void 0,done:!0}},$.prototype.throw=function(U){throw this._index>=0&&(this._index=-1,this._keys=E,this._values=E),U},$.prototype.return=function(U){return this._index>=0&&(this._index=-1,this._keys=E,this._values=E),{value:U,done:!0}},$}();return function(){function $(){this._keys=[],this._values=[],this._cacheKey=b,this._cacheIndex=-2}return Object.defineProperty($.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),$.prototype.has=function(U){return this._find(U,!1)>=0},$.prototype.get=function(U){var V=this._find(U,!1);return V>=0?this._values[V]:void 0},$.prototype.set=function(U,V){var Z=this._find(U,!0);return this._values[Z]=V,this},$.prototype.delete=function(U){var V=this._find(U,!1);if(V>=0){for(var Z=this._keys.length,J=V+1;J<Z;J++)this._keys[J-1]=this._keys[J],this._values[J-1]=this._values[J];return this._keys.length--,this._values.length--,U===this._cacheKey&&(this._cacheKey=b,this._cacheIndex=-2),!0}return!1},$.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=b,this._cacheIndex=-2},$.prototype.keys=function(){return new S(this._keys,this._values,I)},$.prototype.values=function(){return new S(this._keys,this._values,k)},$.prototype.entries=function(){return new S(this._keys,this._values,pe)},$.prototype["@@iterator"]=function(){return this.entries()},$.prototype[s]=function(){return this.entries()},$.prototype._find=function(U,V){return this._cacheKey!==U&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=U)),this._cacheIndex<0&&V&&(this._cacheIndex=this._keys.length,this._keys.push(U),this._values.push(void 0)),this._cacheIndex},$}();function I($,U){return $}function k($,U){return U}function pe($,U){return[$,U]}}function be(){return function(){function b(){this._map=new h}return Object.defineProperty(b.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),b.prototype.has=function(E){return this._map.has(E)},b.prototype.add=function(E){return this._map.set(E,E),this},b.prototype.delete=function(E){return this._map.delete(E)},b.prototype.clear=function(){this._map.clear()},b.prototype.keys=function(){return this._map.keys()},b.prototype.values=function(){return this._map.values()},b.prototype.entries=function(){return this._map.entries()},b.prototype["@@iterator"]=function(){return this.keys()},b.prototype[s]=function(){return this.keys()},b}()}function Ie(){var b=16,E=u.create(),S=I();return function(){function V(){this._key=I()}return V.prototype.has=function(Z){var J=k(Z,!1);return J!==void 0?u.has(J,this._key):!1},V.prototype.get=function(Z){var J=k(Z,!1);return J!==void 0?u.get(J,this._key):void 0},V.prototype.set=function(Z,J){var Se=k(Z,!0);return Se[this._key]=J,this},V.prototype.delete=function(Z){var J=k(Z,!1);return J!==void 0?delete J[this._key]:!1},V.prototype.clear=function(){this._key=I()},V}();function I(){var V;do V="@@WeakMap@@"+U();while(u.has(E,V));return E[V]=!0,V}function k(V,Z){if(!n.call(V,S)){if(!Z)return;Object.defineProperty(V,S,{value:u.create()})}return V[S]}function pe(V,Z){for(var J=0;J<Z;++J)V[J]=Math.random()*255|0;return V}function $(V){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(V)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(V)):pe(new Uint8Array(V),V):pe(new Array(V),V)}function U(){var V=$(b);V[6]=V[6]&79|64,V[8]=V[8]&191|128;for(var Z="",J=0;J<b;++J){var Se=V[J];(J===4||J===6||J===8)&&(Z+="-"),Se<16&&(Z+="0"),Z+=Se.toString(16).toLowerCase()}return Z}}function He(b){return b.__=void 0,delete b.__,b}})})(Va||(Va={}));var us=Te(Fe());var kd=require("obsidian"),hu=Te(gl());var rr=(r=>(r.other="Other Language",r.en="English",r.zh="\u7B80\u4F53\u4E2D\u6587",r))(rr||{});var yl=Te(Fe());var ir={traceLog:!1,loadIndexFromDatabase:!0};var Ys=class{constructor(){this.logLevel="debug";this.levelWeights={trace:1,debug:2,info:3,warn:4,error:5,none:6}}getLevel(){return this.logLevel}setLevel(e){this.logLevel=e}trace(...e){this.shouldLog("trace")&&(ir.traceLog?(console.groupCollapsed(`%c[trace] ${this.getCallerName()}
`,"color: #5f6368;font-weight: 400;",...e),console.trace(),console.groupEnd()):console.log(`%c[trace] ${this.getCallerName()}
`,"color: #5f6368;",...e))}debug(...e){this.shouldLog("debug")&&(ir.traceLog?(console.groupCollapsed(`%c[debug] ${this.getCallerName()}
`,"color: #379237;font-weight: 400;",...e),console.trace(),console.groupEnd()):console.debug(`%c[debug] ${this.getCallerName()}
`,"color: #379237",...e))}info(...e){this.shouldLog("info")&&console.info(`%c[info] ${this.getCallerName()}
`,"color: blue;",...e)}warn(...e){this.shouldLog("warn")&&console.warn(`%c[warn] ${this.getCallerName()}
`,"color: orange;",...e)}error(...e){this.shouldLog("error")&&console.error(`%c[error] ${this.getCallerName()}
`,"color: red;",...e)}getCallerName(){var i;let e=(i=new Error().stack)==null?void 0:i.split(`
`),n=e==null?void 0:e.slice(3).find(s=>!s.includes("eval")&&!s.includes("Array.map"));if(n!=null&&n.startsWith("    at blob:"))return"child-thread";let r=n==null?void 0:n.match(/at (\S+)/);return r?`<${r[1]}> `:"failed to parse caller"}shouldLog(e){return this.levelWeights[e]>=this.levelWeights[this.logLevel]}},M=new Ys;var mt=!1,An="This branch hasn't been implemented",vl="this branch shouldn't be reached by design",_l=/Mac|iPod|iPhone|iPad/.test(navigator.userAgent)?"Mod":"Ctrl",sr=class{static extractDomainFromHttpsUrl(e){if(e.startsWith("http://"))return M.error("Only support https, current url starts with http"),"";let n=/^(https?:\/\/)?([\w.-]+)(?:\/|$)/,r=e.match(n);return r&&r[2]?r[2]:""}static append(e,n){for(let r of n)e.push(r);return e}static getCurrLanguage(){let e=window.localStorage.getItem("language")||"en";return e in rr?rr[e]:"Other Language"}static sleep(e){return new Promise(n=>setTimeout(n,e))}};function ze(t,e,n){let r=n.value;return n.value=function(...i){let s=Date.now(),o=r.apply(this,i),a=()=>{let l=Date.now();M.trace(`<${t.constructor.name}-${e}> Execution time: ${Dh(l-s)}`)};return o instanceof Promise?o.then(l=>(a(),l)):(a(),o)},n}function Dh(t){if(t<1e3)return`${t} ms`;if(t<6e4){let e=Math.floor(t/1e3),n=t%1e3;return`${e} s ${n} ms`}else{let e=Math.floor(t/6e4),n=Math.floor(t%6e4/1e3),r=t%1e3;return`${e} min ${n} s ${r} ms`}}function O(t){try{return yl.container.resolve(t)}catch(e){let n=`CleverSearch for developer:
There might be wrong usages for tsyringe:
1. Inject an instance for static field
2. Cycle dependencies without delay
3. Unknown error`;return M.warn(n),M.error(e),alert(n),-1}}var Re=class{},bl=window.localStorage.getItem("language")==="zh",wl={logLevel:mt?"trace":"info",enableStopWordsEn:!0,enableChinesePatch:!!bl,enableStopWordsZh:!!bl,apiProvider1:{domain:"",key:""},apiProvider2:{domain:"",key:""},excludeExtensions:[],ui:{openInNewPane:!0,maxItemResults:30,showedExtension:"except md",collapseDevSettingByDefault:!mt}},xl={search:{minTermLengthForPrefix:3,fuzzyProportion:.2,minTermLengthForPrefixSearch:2,weightFilename:3,weightFolder:2,weightTagText:1.15,weightHeading:1.27}};var $h={},$e,El=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});El.decode();var di=null;function gi(){return(di===null||di.buffer!==$e.memory.buffer)&&(di=new Uint8Array($e.memory.buffer)),di}function Qs(t,e){return El.decode(gi().subarray(t,t+e))}var Ct=new Array(32).fill(void 0);Ct.push(void 0,null,!0,!1);var lr=Ct.length;function or(t){lr===Ct.length&&Ct.push(Ct.length+1);let e=lr;return lr=Ct[e],Ct[e]=t,e}function yi(t){return Ct[t]}function Rh(t){t<36||(Ct[t]=lr,lr=t)}function ar(t){let e=yi(t);return Rh(t),e}function Zs(t){let e=typeof t;if(e=="number"||e=="boolean"||t==null)return`${t}`;if(e=="string")return`"${t}"`;if(e=="symbol"){let i=t.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){let i=t.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(t)){let i=t.length,s="[";i>0&&(s+=Zs(t[0]));for(let o=1;o<i;o++)s+=", "+Zs(t[o]);return s+="]",s}let n=/\[object ([^\]]+)\]/.exec(toString.call(t)),r;if(n.length>1)r=n[1];else return toString.call(t);if(r=="Object")try{return"Object("+JSON.stringify(t)+")"}catch(i){return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:r}var _i=0,vi=new TextEncoder("utf-8"),jh=typeof vi.encodeInto=="function"?function(t,e){return vi.encodeInto(t,e)}:function(t,e){let n=vi.encode(t);return e.set(n),{read:t.length,written:n.length}};function Al(t,e,n){if(n===void 0){let a=vi.encode(t),l=e(a.length);return gi().subarray(l,l+a.length).set(a),_i=a.length,l}let r=t.length,i=e(r),s=gi(),o=0;for(;o<r;o++){let a=t.charCodeAt(o);if(a>127)break;s[i+o]=a}if(o!==r){o!==0&&(t=t.slice(o)),i=n(i,r,r=o+t.length*3);let a=gi().subarray(i+o,i+r),l=jh(t,a);o+=l.written}return _i=o,i}var pi=null;function bi(){return(pi===null||pi.buffer!==$e.memory.buffer)&&(pi=new Int32Array($e.memory.buffer)),pi}var mi=null;function Nh(){return(mi===null||mi.buffer!==$e.memory.buffer)&&(mi=new Uint32Array($e.memory.buffer)),mi}function Bh(t,e){let r=Nh().subarray(t/4,t/4+e),i=[];for(let s=0;s<r.length;s++)i.push(ar(r[s]));return i}function Js(t,e){try{let a=$e.__wbindgen_add_to_stack_pointer(-16);var n=Al(t,$e.__wbindgen_malloc,$e.__wbindgen_realloc),r=_i;$e.cut_for_search(a,n,r,e);var i=bi()[a/4+0],s=bi()[a/4+1],o=Bh(i,s).slice();return $e.__wbindgen_free(i,s*4),o}finally{$e.__wbindgen_add_to_stack_pointer(16)}}async function zh(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(r){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{let n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}async function Sl(t){typeof t=="undefined"&&(t=new URL("jieba_rs_wasm_bg.wasm",$h.url));let e={};e.wbg={},e.wbg.__wbindgen_string_new=function(i,s){var o=Qs(i,s);return or(o)},e.wbg.__wbindgen_object_drop_ref=function(i){ar(i)},e.wbg.__wbg_new_68adb0d58759a4ed=function(){var i=new Object;return or(i)},e.wbg.__wbindgen_number_new=function(i){var s=i;return or(s)},e.wbg.__wbg_set_2e79e744454afade=function(i,s,o){yi(i)[ar(s)]=ar(o)},e.wbg.__wbindgen_object_clone_ref=function(i){var s=yi(i);return or(s)},e.wbg.__wbg_new_7031805939a80203=function(i,s){var o=new Error(Qs(i,s));return or(o)},e.wbg.__wbindgen_debug_string=function(i,s){var o=Zs(yi(s)),a=Al(o,$e.__wbindgen_malloc,$e.__wbindgen_realloc),l=_i;bi()[i/4+1]=l,bi()[i/4+0]=a},e.wbg.__wbindgen_throw=function(i,s){throw new Error(Qs(i,s))},e.wbg.__wbindgen_rethrow=function(i){throw ar(i)},(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));let{instance:n,module:r}=await zh(await t,e);return $e=n.exports,Sl.__wbindgen_wasm_module=r,$e}var Tl=Sl;var Pl=Te(Fe());var Vh=Te(require("fs")),Kh=Te(require("path")),Cl=Te(Fe());var Sn=Vh,at=Kh;var ie=class{static getFileType(e){let n=ie.fileTypeMap.get(ie.getExtension(e));return n===void 0?2:n}static getBasename(e){return at.basename(e,at.extname(e))}static getExtension(e){return at.extname(e).slice(1)}static getFolderPath(e){let n=at.dirname(e);return n==="."||n===at.sep||n==="/"?"./":n.replace(new RegExp("\\"+at.sep,"g"),"/")+"/"}static countFileByExtensions(e){let n=new Map;e.forEach(i=>{let s=i.extension||"no_extension";n.set(s,(n.get(s)||0)+1)});let r=Object.fromEntries(n);return M.trace(r),r}};ie.SPLIT_EOL=`
`,ie.JOIN_EOL=`
`,ie.fileTypeMap=new Map,(()=>{mt&&ie.fileTypeMap.set("",0),ie.fileTypeMap.set("md",0),ie.fileTypeMap.set("txt",0),ie.fileTypeMap.set("jpg",1),ie.fileTypeMap.set("png",1)})(),ie=W([(0,Cl.singleton)()],ie);var Fl=require("electron"),Uh=(Fl.app||Fl.remote.app).getPath("userData"),wi=at.join(Uh,"clever-search"),Hh="https://bitbucket.org/alexclifton37/obsidian-clever-search/raw/dev/assets/for-program/",Wh="https://raw.githubusercontent.com/yan42685/obsidian-clever-search/dev/assets/for-program/",qh="https://unpkg.com/",Pg=qh+"@dqbd/tiktoken@1.0.7/tiktoken_bg.wasm",Ig=at.join(wi,"tiktoken_bg.wasm"),Il=at.join(wi,"stop-words-en.txt"),eo="jieba_rs_wasm_bg.wasm",to="stop-words-en.txt",no="stop-words-zh.txt",Ze=class{constructor(){this.setting=O(Re);this._assets=Gh}get assets(){return this._assets}async initAsync(){M.trace("preparing assets..."),M.trace(`target dir: ${wi}`);try{await this.initHelper(Hh)}catch(e){try{await this.initHelper(Wh),M.info("download successfully")}catch(n){throw M.warn("failed to download assets"),n}}}async initHelper(e){this.setting.enableChinesePatch&&(await this.downloadFile(this.targetPath(eo),e+eo),await this.downloadFile(this.targetPath(no),e+no),this._assets.jiebaBinary=Sn.promises.readFile(this.targetPath(eo)),this._assets.stopWordsZh=await this.readLinesAsSet(this.targetPath(no))),await this.downloadFile(this.targetPath(to),e+to),this._assets.stopWordsEn=await this.readLinesAsSet(this.targetPath(to))}targetPath(e){return at.join(wi,e)}async readLinesAsSet(e){return new Set((await Sn.promises.readFile(e,{encoding:"utf-8"})).split(ie.SPLIT_EOL))}async downloadFile(e,n){try{await Sn.promises.access(e),M.trace("file exists:",e);return}catch(s){if(s.code!=="ENOENT")throw s}let r=at.dirname(e);await Sn.promises.mkdir(r,{recursive:!0}).catch(s=>{if(s.code!=="EEXIST")throw s});let i=await fetch(n);if(!i.ok)throw new Error(`unexpected response ${i.statusText}`);try{await Sn.promises.writeFile(e,Buffer.from(await i.arrayBuffer()),"utf-8"),M.info(`successfully download from ${n}`)}catch(s){throw M.error(`failed to download ${n}`),s}}};Ze=W([(0,Pl.singleton)()],Ze);var Gh={stopWordsZh:null,stopWordsEn:null,jiebaBinary:new Promise(()=>null)};var Ml=Te(Fe());var gt=class{constructor(){this.isReady=!1;this.reportedError=!1}async initAsync(){let e=O(Ze).assets.jiebaBinary;await Tl(e),Js("",!1),this.isReady=!0}cut(e,n){return!this.isReady&&!this.reportedError?(M.error("jieba segmenter isn't ready"),this.reportedError=!0,[e]):Js(e,n)}};gt=W([(0,Ml.singleton)()],gt);var cu=require("obsidian");var fu=Te(Fe());var Tn=class{constructor(e,n){this.text=e,this.row=n}},Bt=class{constructor(e,n){this.currPath=e,this.items=n}};var xi=class{},zt=class extends xi{constructor(n,r){super();this.line=n,this.context=r}},Cn=class extends xi{constructor(n,r,i,s,o,a){super();this.engineType=n,this.path=r,this.queryTerms=i,this.matchedTerms=s,this.subItems=o,this.previewContent=a}get fileType(){return ie.getFileType(this.path)}get basename(){return ie.getBasename(this.path)}get extension(){return ie.getExtension(this.path)}get folderPath(){return ie.getFolderPath(this.path)}};var ur=class{static minInSet(e){let n=Number.MAX_VALUE;for(let r of e)r<n&&(n=r);return n}},Ei=class{constructor(e,n,r){this.isFlushing=!1;this.pendingFlushRequested=!1;this.elementsMap=new Map,this.handler=e,this.identifier=n,this.autoFlushThreshold=r}add(e){let n=this.identifier(e);this.elementsMap.set(n,e),this.elementsMap.size>=this.autoFlushThreshold&&this.flush()}async flush(){if(this.isFlushing){this.pendingFlushRequested=!0;return}if(this.elementsMap.size===0)return;this.isFlushing=!0;let e=Array.from(this.elementsMap.values());this.elementsMap.clear();try{await this.handler(e),M.debug("flushed")}finally{this.isFlushing=!1,this.pendingFlushRequested&&(this.pendingFlushRequested=!1,this.flush())}}},Ai=class{constructor(e,n=Number.MAX_VALUE){this.heap=[],this.compare=e,this.capacity=n}values(){return this.heap}push(e){this.size()<this.capacity?(this.heap.push(e),this.heapifyUp()):this.compare(e,this.heap[0])>0&&(this.heap[0]=e,this.heapifyDown())}clear(){this.heap=[]}pop(){if(this.isEmpty())return;let e=this.heap[0];return this.heap[0]=this.heap[this.heap.length-1],this.heap.pop(),this.heapifyDown(),e}peek(){return this.heap[0]}isEmpty(){return this.heap.length===0}size(){return this.heap.length}getLeftChildIndex(e){return 2*e+1}getRightChildIndex(e){return 2*e+2}getParentIndex(e){return Math.floor((e-1)/2)}swap(e,n){[this.heap[e],this.heap[n]]=[this.heap[n],this.heap[e]]}heapifyUp(){let e=this.heap.length-1;for(;this.getParentIndex(e)>=0&&this.compare(this.heap[this.getParentIndex(e)],this.heap[e])>0;)this.swap(this.getParentIndex(e),e),e=this.getParentIndex(e)}heapifyDown(){let e=0;for(;this.getLeftChildIndex(e)<this.heap.length;){let n=this.getLeftChildIndex(e);if(this.getRightChildIndex(e)<this.heap.length&&this.compare(this.heap[this.getRightChildIndex(e)],this.heap[n])<0&&(n=this.getRightChildIndex(e)),this.compare(this.heap[e],this.heap[n])<0)break;this.swap(e,n),e=n}}};var ou=Te(Fe());var ao={216:"O",223:"s",248:"o",273:"d",295:"h",305:"i",320:"l",322:"l",359:"t",383:"s",384:"b",385:"B",387:"b",390:"O",392:"c",393:"D",394:"D",396:"d",398:"E",400:"E",402:"f",403:"G",407:"I",409:"k",410:"l",412:"M",413:"N",414:"n",415:"O",421:"p",427:"t",429:"t",430:"T",434:"V",436:"y",438:"z",477:"e",485:"g",544:"N",545:"d",549:"z",564:"l",565:"n",566:"t",567:"j",570:"A",571:"C",572:"c",573:"L",574:"T",575:"s",576:"z",579:"B",580:"U",581:"V",582:"E",583:"e",584:"J",585:"j",586:"Q",587:"q",588:"R",589:"r",590:"Y",591:"y",592:"a",593:"a",595:"b",596:"o",597:"c",598:"d",599:"d",600:"e",603:"e",604:"e",605:"e",606:"e",607:"j",608:"g",609:"g",610:"G",613:"h",614:"h",616:"i",618:"I",619:"l",620:"l",621:"l",623:"m",624:"m",625:"m",626:"n",627:"n",628:"N",629:"o",633:"r",634:"r",635:"r",636:"r",637:"r",638:"r",639:"r",640:"R",641:"R",642:"s",647:"t",648:"t",649:"u",651:"v",652:"v",653:"w",654:"y",655:"Y",656:"z",657:"z",663:"c",665:"B",666:"e",667:"G",668:"H",669:"j",670:"k",671:"L",672:"q",686:"h",867:"a",868:"e",869:"i",870:"o",871:"u",872:"c",873:"d",874:"h",875:"m",876:"r",877:"t",878:"v",879:"x",7424:"A",7427:"B",7428:"C",7429:"D",7431:"E",7432:"e",7433:"i",7434:"J",7435:"K",7436:"L",7437:"M",7438:"N",7439:"O",7440:"O",7441:"o",7442:"o",7443:"o",7446:"o",7447:"o",7448:"P",7449:"R",7450:"R",7451:"T",7452:"U",7453:"u",7454:"u",7455:"m",7456:"V",7457:"W",7458:"Z",7522:"i",7523:"r",7524:"u",7525:"v",7834:"a",7835:"s",8305:"i",8341:"h",8342:"k",8343:"l",8344:"m",8345:"n",8346:"p",8347:"s",8348:"t",8580:"c"};for(let t="\u0300".codePointAt(0);t<="\u036F".codePointAt(0);++t){let e=String.fromCodePoint(t);for(let n of"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"){let i=(n+e).normalize().codePointAt(0);i>126&&(ao[i]=n)}}var ro={a:[7844,7863],e:[7870,7879],o:[7888,7907],u:[7912,7921]};for(let t of Object.keys(ro)){let e=t.toUpperCase();for(let n=ro[t][0];n<=ro[t][1];++n)ao[n]=n%2===0?e:t}function mr(t){if(t<192||t>8580)return t;let e=ao[t];return e!==void 0?e.codePointAt(0):t}function $t(t,e){return t>e?t:e}var Ll=t=>t.split("").map(e=>e.codePointAt(0));var Xh=new Set(` \f
\r	\v\xA0\u1680\u2028\u2029\u202F\u205F\u3000\uFEFF`.split("").map(t=>t.codePointAt(0)));for(let t="\u2000".codePointAt(0);t<="\u200A".codePointAt(0);t++)Xh.add(t);var Pn="\x7F".codePointAt(0),fr="A".codePointAt(0),hr="Z".codePointAt(0),Dl="a".codePointAt(0),Rl="z".codePointAt(0),Yh="0".codePointAt(0),Qh="9".codePointAt(0);function Fn(t,e,n){return n?t:e-t-1}var dr=16,Si=-3,pr=-1,sn=dr/2,Zh=dr/2,Jh=sn+pr,jl=-(Si+pr),Nl=2;function io(t){return t?new Set:null}function cr(t,e,n){if(e!==null&&e.i16.length>t+n){let r=e.i16.subarray(t,t+n);return[t+n,r]}return[t,new Int16Array(n)]}function kl(t,e,n){if(e!==null&&e.i32.length>t+n){let r=e.i32.subarray(t,t+n);return[t+n,r]}return[t,new Int32Array(n)]}function Bl(t){return t>=Dl&&t<=Rl?1:t>=fr&&t<=hr?2:t>=Yh&&t<=Qh?4:0}function zl(t){let e=String.fromCodePoint(t);return e!==e.toUpperCase()?1:e!==e.toLowerCase()?2:e.match(/\p{Number}/gu)!==null?4:e.match(/\p{Letter}/gu)!==null?3:0}function Ti(t){return t<=Pn?Bl(t):zl(t)}function lo(t,e){return t===0&&e!==0?sn:t===1&&e===2||t!==4&&e===4?Jh:e===0?Zh:0}function ed(t,e){return e===0?sn:lo(Ti(t[e-1]),Ti(t[e]))}function td(t,e,n,r){let i=t.slice(r),s=i.indexOf(n);if(s===0)return r;if(!e&&n>=Dl&&n<=Rl){s>0&&(i=i.slice(0,s));let o=i.indexOf(n-32);o>=0&&(s=o)}return s<0?-1:r+s}function Ol(t){for(let e of t)if(e>=128)return!1;return!0}function uo(t,e,n){if(!Ol(t))return 0;if(!Ol(e))return-1;let r=0,i=0;for(let s=0;s<e.length;s++){if(i=td(t,n,e[s],i),i<0)return-1;s===0&&i>0&&(r=i-1),i++}return r}var nd=(t,e,n,r,i,s,o)=>{let a=i.length;if(a===0)return[{start:0,end:0,score:0},io(s)];let l=r.length;if(o!==null&&l*a>o.i16.length)return Vl(t,e,n,r,i,s);let u=uo(r,i,t);if(u<0)return[{start:-1,end:-1,score:0},null];let c=0,f=0,h=null,d=null,p=null,m=null;[c,h]=cr(c,o,l),[c,d]=cr(c,o,l),[c,p]=cr(c,o,l),[f,m]=kl(f,o,a);let[,y]=kl(f,o,l);for(let x=0;x<y.length;x++)y[x]=r[x];let g=0,v=0,w=0,_=0,A=i[0],T=i[0],C=0,F=0,R=!1,N=y.subarray(u),L=h.subarray(u).subarray(0,N.length),B=d.subarray(u).subarray(0,N.length),D=p.subarray(u).subarray(0,N.length);for(let[x,P]of N.entries()){let j=null;P<=Pn?(j=Bl(P),!t&&j===2&&(P+=32)):(j=zl(P),!t&&j===2&&(P=String.fromCodePoint(P).toLowerCase().codePointAt(0)),e&&(P=mr(P))),N[x]=P;let G=lo(F,j);if(D[x]=G,F=j,P===T&&(w<a&&(m[w]=u+x,w++,T=i[Math.min(w,a-1)]),_=u+x),P===A){let X=dr+G*Nl;if(L[x]=X,B[x]=1,a===1&&(n&&X>g||!n&&X>=g)&&(g=X,v=u+x,n&&G===sn))break;R=!1}else R?L[x]=$t(C+pr,0):L[x]=$t(C+Si,0),B[x]=0,R=!0;C=L[x]}if(w!==a)return[{start:-1,end:-1,score:0},null];if(a===1){let x={start:v,end:v+1,score:g};if(!s)return[x,null];let P=new Set;return P.add(v),[x,P]}let K=m[0],ee=_-K+1,Q=null;[c,Q]=cr(c,o,ee*a);{let x=h.subarray(K,_+1);for(let[P,j]of x.entries())Q[P]=j}let[,ae]=cr(c,o,ee*a);{let x=d.subarray(K,_+1);for(let[P,j]of x.entries())ae[P]=j}let le=m.subarray(1),xe=i.slice(1).slice(0,le.length);for(let[x,P]of le.entries()){let j=!1,G=xe[x],X=x+1,Y=X*ee,se=y.subarray(P,_+1),ye=p.subarray(P).subarray(0,se.length),Ye=ae.subarray(Y+P-K).subarray(0,se.length),he=ae.subarray(Y+P-K-1-ee).subarray(0,se.length),ce=Q.subarray(Y+P-K).subarray(0,se.length),Oe=Q.subarray(Y+P-K-1-ee).subarray(0,se.length),me=Q.subarray(Y+P-K-1).subarray(0,se.length);me[0]=0;for(let[de,te]of se.entries()){let ne=de+P,Ae=0,re=0,ve=0;if(j?re=me[de]+pr:re=me[de]+Si,G===te){Ae=Oe[de]+dr;let Ie=ye[de];ve=he[de]+1,Ie===sn?ve=1:ve>1&&(Ie=$t(Ie,$t(jl,p[ne-ve+1]))),Ae+Ie<re?(Ae+=ye[de],ve=0):Ae+=Ie}Ye[de]=ve,j=Ae<re;let be=$t($t(Ae,re),0);X===a-1&&(n&&be>g||!n&&be>=g)&&(g=be,v=ne),ce[de]=be}}let ot=io(s),ue=K;if(s&&ot!==null){let x=a-1;ue=v;let P=!0;for(;;){let j=x*ee,G=ue-K,X=Q[j+G],Y=0,se=0;if(x>0&&ue>=m[x]&&(Y=Q[j-ee+G-1]),ue>m[x]&&(se=Q[j+G-1]),X>Y&&(X>se||X===se&&P)){if(ot.add(ue),x===0)break;x--}P=ae[j+G]>1||j+ee+G+1<ae.length&&ae[j+ee+G+1]>0,ue--}}return[{start:ue,end:v+1,score:g},ot]};function $l(t,e,n,r,i,s,o){let a=0,l=0,u=!1,c=0,f=0,h=io(o),d=0;i>0&&(d=Ti(n[i-1]));for(let p=i;p<s;p++){let m=n[p],y=Ti(m);if(t||(m>=fr&&m<=hr?m+=32:m>Pn&&(m=String.fromCodePoint(m).toLowerCase().codePointAt(0))),e&&(m=mr(m)),m===r[a]){o&&h!==null&&h.add(p),l+=dr;let g=lo(d,y);c===0?f=g:(g===sn&&(f=g),g=$t($t(g,f),jl)),a===0?l+=g*Nl:l+=g,u=!1,c++,a++}else u?l+=pr:l+=Si,u=!0,c=0,f=0;d=y}return[l,h]}var Vl=(t,e,n,r,i,s,o)=>{if(i.length===0)return[{start:0,end:0,score:0},null];if(uo(r,i,t)<0)return[{start:-1,end:-1,score:0},null];let a=0,l=-1,u=-1,c=r.length,f=i.length;for(let h=0;h<c;h++){let d=r[Fn(h,c,n)];t||(d>=fr&&d<=hr?d+=32:d>Pn&&(d=String.fromCodePoint(d).toLowerCase().codePointAt(0))),e&&(d=mr(d));let p=i[Fn(a,f,n)];if(d===p&&(l<0&&(l=h),a++,a===f)){u=h+1;break}}if(l>=0&&u>=0){a--;for(let p=u-1;p>=l;p--){let m=Fn(p,c,n),y=r[m];t||(y>=fr&&y<=hr?y+=32:y>Pn&&(y=String.fromCodePoint(y).toLowerCase().codePointAt(0)));let g=Fn(a,f,n),v=i[g];if(y===v&&(a--,a<0)){l=p;break}}if(!n){let p=l;l=c-u,u=c-p}let[h,d]=$l(t,e,r,i,l,u,s);return[{start:l,end:u,score:h},d]}return[{start:-1,end:-1,score:0},null]},rd=(t,e,n,r,i,s,o)=>{if(i.length===0)return[{start:0,end:0,score:0},null];let a=r.length,l=i.length;if(a<l)return[{start:-1,end:-1,score:0},null];if(uo(r,i,t)<0)return[{start:-1,end:-1,score:0},null];let u=0,c=-1,f=0,h=-1;for(let d=0;d<a;d++){let p=Fn(d,a,n),m=r[p];t||(m>=fr&&m<=hr?m+=32:m>Pn&&(m=String.fromCodePoint(m).toLowerCase().codePointAt(0))),e&&(m=mr(m));let y=Fn(u,l,n);if(i[y]===m){if(y===0&&(f=ed(r,p)),u++,u===l){if(f>h&&(c=d,h=f),f===sn)break;d-=u-1,u=0,f=0}}else d-=u,u=0,f=0}if(c>=0){let d=0,p=0;n?(d=c-l+1,p=c+1):(d=a-(c+1),p=a-(c-l+1));let[m]=$l(t,e,r,i,d,p,!1);return[{start:d,end:p,score:m},null]}return[{start:-1,end:-1,score:0},null]};var id=100*1024,sd=2048;function od(t,e){return{i16:new Int16Array(t),i32:new Int32Array(e)}}var ad=od(id,sd);var Kl=(t,e,n)=>{let r=!1;switch(e){case"smart-case":t.toLowerCase()!==t&&(r=!0);break;case"case-sensitive":r=!0;break;case"case-insensitive":t=t.toLowerCase(),r=!1;break}let i=Ll(t);return n&&(i=i.map(mr)),{queryRunes:i,caseSensitive:r}};function Ul(t,e){let n=Object.keys(t).map(i=>parseInt(i,10)).sort((i,s)=>s-i),r=[];for(let i of n)if(r=r.concat(t[i]),r.length>=e)break;return r}function Hl(t,e,n){return r=>{let i=this.runesList[r];if(e.length>i.length)return;let[s,o]=this.algoFn(n,this.opts.normalize,this.opts.forward,i,e,!0,ad);if(s.start===-1)return;if(this.opts.fuzzy===!1){o=new Set;for(let l=s.start;l<s.end;++l)o.add(l)}let a=this.opts.sort?s.score:0;t[a]===void 0&&(t[a]=[]),t[a].push({item:this.items[r],...s,positions:o!=null?o:new Set})}}function ld(t){let{queryRunes:e,caseSensitive:n}=Kl(t,this.opts.casing,this.opts.normalize),r={},i=Hl.bind(this)(r,e,n);for(let s=0,o=this.runesList.length;s<o;++s)i(s);return Ul(r,this.opts.limit)}var ud=typeof require!="undefined"&&typeof window=="undefined";function cd(t,e,n,r){return new Promise((i,s)=>{let a=0,l=Math.min(1e3,e),u=()=>{if(t.cancelled)return s("search cancelled");for(;a<l;++a)n(a);l<e?(l=Math.min(l+1e3,e),ud?setImmediate(u):setTimeout(u)):i(r())};u()})}function fd(t,e){let{queryRunes:n,caseSensitive:r}=Kl(t,this.opts.casing,this.opts.normalize),i={};return cd(e,this.runesList.length,Hl.bind(this)(i,n,r),()=>Ul(i,this.opts.limit))}var co={limit:1/0,selector:t=>t,casing:"smart-case",normalize:!0,fuzzy:"v2",tiebreakers:[],sort:!0,forward:!0},so=class{constructor(e,...n){switch(this.opts={...co,...n[0]},this.items=e,this.runesList=e.map(r=>Ll(this.opts.selector(r).normalize())),this.algoFn=rd,this.opts.fuzzy){case"v2":this.algoFn=nd;break;case"v1":this.algoFn=Vl;break}}},Ug={...co,match:ld};var hd={...co,match:fd},oo=class extends so{constructor(e,...n){super(e,...n),this.opts={...hd,...n[0]},this.token={cancelled:!1}}async find(e){if(this.token.cancelled=!0,this.token={cancelled:!1},e.length===0||this.items.length===0)return this.items.slice(0,this.opts.limit).map(dd);e=e.normalize();let n=await this.opts.match.bind(this)(e,this.token);return pd(n,this.opts)}},dd=t=>({item:t,start:-1,end:-1,score:0,positions:new Set});function pd(t,e){if(e.sort){let{selector:n}=e;t.sort((r,i)=>{if(r.score===i.score)for(let s of e.tiebreakers){let o=s(r,i,n);if(o!==0)return o}return 0})}return Number.isFinite(e.limit)&&t.splice(e.limit),t}var Ci=class{constructor(e,...n){this.finder=new oo(e,...n),this.find=this.finder.find.bind(this.finder)}};var _e=function(){return _e=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},_e.apply(this,arguments)};function md(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(f){o(f)}}function l(c){try{u(r.throw(c))}catch(f){o(f)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((r=r.apply(t,e||[])).next())})}function gd(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(n=0)),n;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(c){u=[6,c],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function oe(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Pe(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}var yd="ENTRIES",Yl="KEYS",Ql="VALUES",Ne="",fo=function(){function t(e,n){var r=e._tree,i=Array.from(r.keys());this.set=e,this._type=n,this._path=i.length>0?[{node:r,keys:i}]:[]}return t.prototype.next=function(){var e=this.dive();return this.backtrack(),e},t.prototype.dive=function(){if(this._path.length===0)return{done:!0,value:void 0};var e=In(this._path),n=e.node,r=e.keys;if(In(r)===Ne)return{done:!1,value:this.result()};var i=n.get(In(r));return this._path.push({node:i,keys:Array.from(i.keys())}),this.dive()},t.prototype.backtrack=function(){if(this._path.length!==0){var e=In(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}},t.prototype.key=function(){return this.set._prefix+this._path.map(function(e){var n=e.keys;return In(n)}).filter(function(e){return e!==Ne}).join("")},t.prototype.value=function(){return In(this._path).node.get(Ne)},t.prototype.result=function(){switch(this._type){case Ql:return this.value();case Yl:return this.key();default:return[this.key(),this.value()]}},t.prototype[Symbol.iterator]=function(){return this},t}(),In=function(t){return t[t.length-1]},vd=function(t,e,n){var r=new Map;if(e===void 0)return r;for(var i=e.length+1,s=i+n,o=new Uint8Array(s*i).fill(n+1),a=0;a<i;++a)o[a]=a;for(var l=1;l<s;++l)o[l*i]=l;return Zl(t,e,n,r,o,1,i,""),r},Zl=function(t,e,n,r,i,s,o,a){var l,u,c=s*o;try{e:for(var f=oe(t.keys()),h=f.next();!h.done;h=f.next()){var d=h.value;if(d===Ne){var p=i[c-1];p<=n&&r.set(a,[t.get(d),p])}else{for(var m=s,y=0;y<d.length;++y,++m){for(var g=d[y],v=o*m,w=v-o,_=i[v],A=Math.max(0,m-n-1),T=Math.min(o-1,m+n),C=A;C<T;++C){var F=g!==e[C],R=i[w+C]+ +F,N=i[w+C+1]+1,L=i[v+C]+1,B=i[v+C+1]=Math.min(R,N,L);B<_&&(_=B)}if(_>n)continue e}Zl(t.get(d),e,n,r,i,m,o,a+d)}}}catch(D){l={error:D}}finally{try{h&&!h.done&&(u=f.return)&&u.call(f)}finally{if(l)throw l.error}}},ho=function(){function t(e,n){e===void 0&&(e=new Map),n===void 0&&(n=""),this._size=void 0,this._tree=e,this._prefix=n}return t.prototype.atPrefix=function(e){var n,r;if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");var i=Pe(Pi(this._tree,e.slice(this._prefix.length)),2),s=i[0],o=i[1];if(s===void 0){var a=Pe(wo(o),2),l=a[0],u=a[1];try{for(var c=oe(l.keys()),f=c.next();!f.done;f=c.next()){var h=f.value;if(h!==Ne&&h.startsWith(u)){var d=new Map;return d.set(h.slice(u.length),l.get(h)),new t(d,e)}}}catch(p){n={error:p}}finally{try{f&&!f.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}return new t(s,e)},t.prototype.clear=function(){this._size=void 0,this._tree.clear()},t.prototype.delete=function(e){return this._size=void 0,_d(this._tree,e)},t.prototype.entries=function(){return new fo(this,yd)},t.prototype.forEach=function(e){var n,r;try{for(var i=oe(this),s=i.next();!s.done;s=i.next()){var o=Pe(s.value,2),a=o[0],l=o[1];e(a,l,this)}}catch(u){n={error:u}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.fuzzyGet=function(e,n){return vd(this._tree,e,n)},t.prototype.get=function(e){var n=vo(this._tree,e);return n!==void 0?n.get(Ne):void 0},t.prototype.has=function(e){var n=vo(this._tree,e);return n!==void 0&&n.has(Ne)},t.prototype.keys=function(){return new fo(this,Yl)},t.prototype.set=function(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=po(this._tree,e);return r.set(Ne,n),this},Object.defineProperty(t.prototype,"size",{get:function(){if(this._size)return this._size;this._size=0;for(var e=this.entries();!e.next().done;)this._size+=1;return this._size},enumerable:!1,configurable:!0}),t.prototype.update=function(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=po(this._tree,e);return r.set(Ne,n(r.get(Ne))),this},t.prototype.fetch=function(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=po(this._tree,e),i=r.get(Ne);return i===void 0&&r.set(Ne,i=n()),i},t.prototype.values=function(){return new fo(this,Ql)},t.prototype[Symbol.iterator]=function(){return this.entries()},t.from=function(e){var n,r,i=new t;try{for(var s=oe(e),o=s.next();!o.done;o=s.next()){var a=Pe(o.value,2),l=a[0],u=a[1];i.set(l,u)}}catch(c){n={error:c}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i},t.fromObject=function(e){return t.from(Object.entries(e))},t}(),Pi=function(t,e,n){var r,i;if(n===void 0&&(n=[]),e.length===0||t==null)return[t,n];try{for(var s=oe(t.keys()),o=s.next();!o.done;o=s.next()){var a=o.value;if(a!==Ne&&e.startsWith(a))return n.push([t,a]),Pi(t.get(a),e.slice(a.length),n)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return n.push([t,e]),Pi(void 0,"",n)},vo=function(t,e){var n,r;if(e.length===0||t==null)return t;try{for(var i=oe(t.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;if(o!==Ne&&e.startsWith(o))return vo(t.get(o),e.slice(o.length))}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},po=function(t,e){var n,r,i=e.length;e:for(var s=0;t&&s<i;){try{for(var o=(n=void 0,oe(t.keys())),a=o.next();!a.done;a=o.next()){var l=a.value;if(l!==Ne&&e[s]===l[0]){for(var u=Math.min(i-s,l.length),c=1;c<u&&e[s+c]===l[c];)++c;var f=t.get(l);if(c===l.length)t=f;else{var h=new Map;h.set(l.slice(c),f),t.set(e.slice(s,s+c),h),t.delete(l),t=h}s+=c;continue e}}}catch(p){n={error:p}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}var d=new Map;return t.set(e.slice(s),d),d}return t},_d=function(t,e){var n=Pe(Pi(t,e),2),r=n[0],i=n[1];if(r!==void 0){if(r.delete(Ne),r.size===0)Jl(i);else if(r.size===1){var s=Pe(r.entries().next().value,2),o=s[0],a=s[1];eu(i,o,a)}}},Jl=function(t){if(t.length!==0){var e=Pe(wo(t),2),n=e[0],r=e[1];if(n.delete(r),n.size===0)Jl(t.slice(0,-1));else if(n.size===1){var i=Pe(n.entries().next().value,2),s=i[0],o=i[1];s!==Ne&&eu(t.slice(0,-1),s,o)}}},eu=function(t,e,n){if(t.length!==0){var r=Pe(wo(t),2),i=r[0],s=r[1];i.set(s+e,n),i.delete(s)}},wo=function(t){return t[t.length-1]},gr,xo="or",tu="and",bd="and_not",Ii=function(){function t(e){if((e==null?void 0:e.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');var n=e.autoVacuum==null||e.autoVacuum===!0?yo:e.autoVacuum;this._options=_e(_e(_e({},go),e),{autoVacuum:n,searchOptions:_e(_e({},Wl),e.searchOptions||{}),autoSuggestOptions:_e(_e({},Sd),e.autoSuggestOptions||{})}),this._index=new ho,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=bo,this.addFields(this._options.fields)}return t.prototype.add=function(e){var n,r,i,s,o,a,l=this._options,u=l.extractField,c=l.tokenize,f=l.processTerm,h=l.fields,d=l.idField,p=u(e,d);if(p==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));if(this._idToShortId.has(p))throw new Error("MiniSearch: duplicate ID ".concat(p));var m=this.addDocumentId(p);this.saveStoredFields(m,e);try{for(var y=oe(h),g=y.next();!g.done;g=y.next()){var v=g.value,w=u(e,v);if(w!=null){var _=c(w.toString(),v),A=this._fieldIds[v],T=new Set(_).size;this.addFieldLength(m,A,this._documentCount-1,T);try{for(var C=(i=void 0,oe(_)),F=C.next();!F.done;F=C.next()){var R=F.value,N=f(R,v);if(Array.isArray(N))try{for(var L=(o=void 0,oe(N)),B=L.next();!B.done;B=L.next()){var D=B.value;this.addTerm(A,m,D)}}catch(K){o={error:K}}finally{try{B&&!B.done&&(a=L.return)&&a.call(L)}finally{if(o)throw o.error}}else N&&this.addTerm(A,m,N)}}catch(K){i={error:K}}finally{try{F&&!F.done&&(s=C.return)&&s.call(C)}finally{if(i)throw i.error}}}}}catch(K){n={error:K}}finally{try{g&&!g.done&&(r=y.return)&&r.call(y)}finally{if(n)throw n.error}}},t.prototype.addAll=function(e){var n,r;try{for(var i=oe(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.add(o)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.addAllAsync=function(e,n){var r=this;n===void 0&&(n={});var i=n.chunkSize,s=i===void 0?10:i,o={chunk:[],promise:Promise.resolve()},a=e.reduce(function(c,f,h){var d=c.chunk,p=c.promise;return d.push(f),(h+1)%s===0?{chunk:[],promise:p.then(function(){return new Promise(function(m){return setTimeout(m,0)})}).then(function(){return r.addAll(d)})}:{chunk:d,promise:p}},o),l=a.chunk,u=a.promise;return u.then(function(){return r.addAll(l)})},t.prototype.remove=function(e){var n,r,i,s,o,a,l=this._options,u=l.tokenize,c=l.processTerm,f=l.extractField,h=l.fields,d=l.idField,p=f(e,d);if(p==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));var m=this._idToShortId.get(p);if(m==null)throw new Error("MiniSearch: cannot remove document with ID ".concat(p,": it is not in the index"));try{for(var y=oe(h),g=y.next();!g.done;g=y.next()){var v=g.value,w=f(e,v);if(w!=null){var _=u(w.toString(),v),A=this._fieldIds[v],T=new Set(_).size;this.removeFieldLength(m,A,this._documentCount,T);try{for(var C=(i=void 0,oe(_)),F=C.next();!F.done;F=C.next()){var R=F.value,N=c(R,v);if(Array.isArray(N))try{for(var L=(o=void 0,oe(N)),B=L.next();!B.done;B=L.next()){var D=B.value;this.removeTerm(A,m,D)}}catch(K){o={error:K}}finally{try{B&&!B.done&&(a=L.return)&&a.call(L)}finally{if(o)throw o.error}}else N&&this.removeTerm(A,m,N)}}catch(K){i={error:K}}finally{try{F&&!F.done&&(s=C.return)&&s.call(C)}finally{if(i)throw i.error}}}}}catch(K){n={error:K}}finally{try{g&&!g.done&&(r=y.return)&&r.call(y)}finally{if(n)throw n.error}}this._storedFields.delete(m),this._documentIds.delete(m),this._idToShortId.delete(p),this._fieldLength.delete(m),this._documentCount-=1},t.prototype.removeAll=function(e){var n,r;if(e)try{for(var i=oe(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.remove(o)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new ho,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}},t.prototype.discard=function(e){var n=this,r=this._idToShortId.get(e);if(r==null)throw new Error("MiniSearch: cannot discard document with ID ".concat(e,": it is not in the index"));this._idToShortId.delete(e),this._documentIds.delete(r),this._storedFields.delete(r),(this._fieldLength.get(r)||[]).forEach(function(i,s){n.removeFieldLength(r,s,n._documentCount,i)}),this._fieldLength.delete(r),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()},t.prototype.maybeAutoVacuum=function(){if(this._options.autoVacuum!==!1){var e=this._options.autoVacuum,n=e.minDirtFactor,r=e.minDirtCount,i=e.batchSize,s=e.batchWait;this.conditionalVacuum({batchSize:i,batchWait:s},{minDirtCount:r,minDirtFactor:n})}},t.prototype.discardAll=function(e){var n,r,i=this._options.autoVacuum;try{this._options.autoVacuum=!1;try{for(var s=oe(e),o=s.next();!o.done;o=s.next()){var a=o.value;this.discard(a)}}catch(l){n={error:l}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}finally{this._options.autoVacuum=i}this.maybeAutoVacuum()},t.prototype.replace=function(e){var n=this._options,r=n.idField,i=n.extractField,s=i(e,r);this.discard(s),this.add(e)},t.prototype.vacuum=function(e){return e===void 0&&(e={}),this.conditionalVacuum(e)},t.prototype.conditionalVacuum=function(e,n){var r=this;return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&n,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(function(){var i=r._enqueuedVacuumConditions;return r._enqueuedVacuumConditions=bo,r.performVacuuming(e,i)}),this._enqueuedVacuum)):this.vacuumConditionsMet(n)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)},t.prototype.performVacuuming=function(e,n){return md(this,void 0,void 0,function(){var r,i,s,o,a,l,u,c,f,h,d,p,m,y,g,v,w,_,A,T,C,F,R,N,L;return gd(this,function(B){switch(B.label){case 0:if(r=this._dirtCount,!this.vacuumConditionsMet(n))return[3,10];i=e.batchSize||_o.batchSize,s=e.batchWait||_o.batchWait,o=1,B.label=1;case 1:B.trys.push([1,7,8,9]),a=oe(this._index),l=a.next(),B.label=2;case 2:if(l.done)return[3,6];u=Pe(l.value,2),c=u[0],f=u[1];try{for(h=(F=void 0,oe(f)),d=h.next();!d.done;d=h.next()){p=Pe(d.value,2),m=p[0],y=p[1];try{for(g=(N=void 0,oe(y)),v=g.next();!v.done;v=g.next())w=Pe(v.value,1),_=w[0],!this._documentIds.has(_)&&(y.size<=1?f.delete(m):y.delete(_))}catch(D){N={error:D}}finally{try{v&&!v.done&&(L=g.return)&&L.call(g)}finally{if(N)throw N.error}}}}catch(D){F={error:D}}finally{try{d&&!d.done&&(R=h.return)&&R.call(h)}finally{if(F)throw F.error}}return this._index.get(c).size===0&&this._index.delete(c),o%i!==0?[3,4]:[4,new Promise(function(D){return setTimeout(D,s)})];case 3:B.sent(),B.label=4;case 4:o+=1,B.label=5;case 5:return l=a.next(),[3,2];case 6:return[3,9];case 7:return A=B.sent(),T={error:A},[3,9];case 8:try{l&&!l.done&&(C=a.return)&&C.call(a)}finally{if(T)throw T.error}return[7];case 9:this._dirtCount-=r,B.label=10;case 10:return[4,null];case 11:return B.sent(),this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null,[2]}})})},t.prototype.vacuumConditionsMet=function(e){if(e==null)return!0;var n=e.minDirtCount,r=e.minDirtFactor;return n=n||yo.minDirtCount,r=r||yo.minDirtFactor,this.dirtCount>=n&&this.dirtFactor>=r},Object.defineProperty(t.prototype,"isVacuuming",{get:function(){return this._currentVacuum!=null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dirtCount",{get:function(){return this._dirtCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dirtFactor",{get:function(){return this._dirtCount/(1+this._documentCount+this._dirtCount)},enumerable:!1,configurable:!0}),t.prototype.has=function(e){return this._idToShortId.has(e)},t.prototype.getStoredFields=function(e){var n=this._idToShortId.get(e);if(n!=null)return this._storedFields.get(n)},t.prototype.search=function(e,n){var r,i;n===void 0&&(n={});var s=this.executeQuery(e,n),o=[];try{for(var a=oe(s),l=a.next();!l.done;l=a.next()){var u=Pe(l.value,2),c=u[0],f=u[1],h=f.score,d=f.terms,p=f.match,m=d.length||1,y={id:this._documentIds.get(c),score:h*m,terms:Object.keys(p),queryTerms:d,match:p};Object.assign(y,this._storedFields.get(c)),(n.filter==null||n.filter(y))&&o.push(y)}}catch(g){r={error:g}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return e===t.wildcard&&n.boostDocument==null&&this._options.searchOptions.boostDocument==null||o.sort(Gl),o},t.prototype.autoSuggest=function(e,n){var r,i,s,o;n===void 0&&(n={}),n=_e(_e({},this._options.autoSuggestOptions),n);var a=new Map;try{for(var l=oe(this.search(e,n)),u=l.next();!u.done;u=l.next()){var c=u.value,f=c.score,h=c.terms,d=h.join(" "),p=a.get(d);p!=null?(p.score+=f,p.count+=1):a.set(d,{score:f,terms:h,count:1})}}catch(A){r={error:A}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}var m=[];try{for(var y=oe(a),g=y.next();!g.done;g=y.next()){var v=Pe(g.value,2),p=v[0],w=v[1],f=w.score,h=w.terms,_=w.count;m.push({suggestion:p,terms:h,score:f/_})}}catch(A){s={error:A}}finally{try{g&&!g.done&&(o=y.return)&&o.call(y)}finally{if(s)throw s.error}}return m.sort(Gl),m},Object.defineProperty(t.prototype,"documentCount",{get:function(){return this._documentCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"termCount",{get:function(){return this._index.size},enumerable:!1,configurable:!0}),t.loadJSON=function(e,n){if(n==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),n)},t.getDefault=function(e){if(go.hasOwnProperty(e))return mo(go,e);throw new Error('MiniSearch: unknown option "'.concat(e,'"'))},t.loadJS=function(e,n){var r,i,s,o,a,l,u=e.index,c=e.documentCount,f=e.nextId,h=e.documentIds,d=e.fieldIds,p=e.fieldLength,m=e.averageFieldLength,y=e.storedFields,g=e.dirtCount,v=e.serializationVersion;if(v!==1&&v!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");var w=new t(n);w._documentCount=c,w._nextId=f,w._documentIds=Fi(h),w._idToShortId=new Map,w._fieldIds=d,w._fieldLength=Fi(p),w._avgFieldLength=m,w._storedFields=Fi(y),w._dirtCount=g||0,w._index=new ho;try{for(var _=oe(w._documentIds),A=_.next();!A.done;A=_.next()){var T=Pe(A.value,2),C=T[0],F=T[1];w._idToShortId.set(F,C)}}catch(xe){r={error:xe}}finally{try{A&&!A.done&&(i=_.return)&&i.call(_)}finally{if(r)throw r.error}}try{for(var R=oe(u),N=R.next();!N.done;N=R.next()){var L=Pe(N.value,2),B=L[0],D=L[1],K=new Map;try{for(var ee=(a=void 0,oe(Object.keys(D))),Q=ee.next();!Q.done;Q=ee.next()){var ae=Q.value,le=D[ae];v===1&&(le=le.ds),K.set(parseInt(ae,10),Fi(le))}}catch(xe){a={error:xe}}finally{try{Q&&!Q.done&&(l=ee.return)&&l.call(ee)}finally{if(a)throw a.error}}w._index.set(B,K)}}catch(xe){s={error:xe}}finally{try{N&&!N.done&&(o=R.return)&&o.call(R)}finally{if(s)throw s.error}}return w},t.prototype.executeQuery=function(e,n){var r=this;if(n===void 0&&(n={}),e===t.wildcard)return this.executeWildcardQuery(n);if(typeof e!="string"){var i=_e(_e(_e({},n),e),{queries:void 0}),s=e.queries.map(function(y){return r.executeQuery(y,i)});return this.combineResults(s,i.combineWith)}var o=this._options,a=o.tokenize,l=o.processTerm,u=o.searchOptions,c=_e(_e({tokenize:a,processTerm:l},u),n),f=c.tokenize,h=c.processTerm,d=f(e).flatMap(function(y){return h(y)}).filter(function(y){return!!y}),p=d.map(Ad(c)),m=p.map(function(y){return r.executeQuerySpec(y,c)});return this.combineResults(m,c.combineWith)},t.prototype.executeQuerySpec=function(e,n){var r,i,s,o,a=_e(_e({},this._options.searchOptions),n),l=(a.fields||this._options.fields).reduce(function(ae,le){var xe;return _e(_e({},ae),(xe={},xe[le]=mo(a.boost,le)||1,xe))},{}),u=a.boostDocument,c=a.weights,f=a.maxFuzzy,h=a.bm25,d=_e(_e({},Wl.weights),c),p=d.fuzzy,m=d.prefix,y=this._index.get(e.term),g=this.termResults(e.term,e.term,1,y,l,u,h),v,w;if(e.prefix&&(v=this._index.atPrefix(e.term)),e.fuzzy){var _=e.fuzzy===!0?.2:e.fuzzy,A=_<1?Math.min(f,Math.round(e.term.length*_)):_;A&&(w=this._index.fuzzyGet(e.term,A))}if(v)try{for(var T=oe(v),C=T.next();!C.done;C=T.next()){var F=Pe(C.value,2),R=F[0],N=F[1],L=R.length-e.term.length;if(L){w==null||w.delete(R);var B=m*R.length/(R.length+.3*L);this.termResults(e.term,R,B,N,l,u,h,g)}}}catch(ae){r={error:ae}}finally{try{C&&!C.done&&(i=T.return)&&i.call(T)}finally{if(r)throw r.error}}if(w)try{for(var D=oe(w.keys()),K=D.next();!K.done;K=D.next()){var R=K.value,ee=Pe(w.get(R),2),Q=ee[0],L=ee[1];if(L){var B=p*R.length/(R.length+L);this.termResults(e.term,R,B,Q,l,u,h,g)}}}catch(ae){s={error:ae}}finally{try{K&&!K.done&&(o=D.return)&&o.call(D)}finally{if(s)throw s.error}}return g},t.prototype.executeWildcardQuery=function(e){var n,r,i=new Map,s=_e(_e({},this._options.searchOptions),e);try{for(var o=oe(this._documentIds),a=o.next();!a.done;a=o.next()){var l=Pe(a.value,2),u=l[0],c=l[1],f=s.boostDocument?s.boostDocument(c,"",this._storedFields.get(u)):1;i.set(u,{score:f,terms:[],match:{}})}}catch(h){n={error:h}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i},t.prototype.combineResults=function(e,n){if(n===void 0&&(n=xo),e.length===0)return new Map;var r=n.toLowerCase();return e.reduce(wd[r])||new Map},t.prototype.toJSON=function(){var e,n,r,i,s=[];try{for(var o=oe(this._index),a=o.next();!a.done;a=o.next()){var l=Pe(a.value,2),u=l[0],c=l[1],f={};try{for(var h=(r=void 0,oe(c)),d=h.next();!d.done;d=h.next()){var p=Pe(d.value,2),m=p[0],y=p[1];f[m]=Object.fromEntries(y)}}catch(g){r={error:g}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}s.push([u,f])}}catch(g){e={error:g}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:s,serializationVersion:2}},t.prototype.termResults=function(e,n,r,i,s,o,a,l){var u,c,f,h,d;if(l===void 0&&(l=new Map),i==null)return l;try{for(var p=oe(Object.keys(s)),m=p.next();!m.done;m=p.next()){var y=m.value,g=s[y],v=this._fieldIds[y],w=i.get(v);if(w!=null){var _=w.size,A=this._avgFieldLength[v];try{for(var T=(f=void 0,oe(w.keys())),C=T.next();!C.done;C=T.next()){var F=C.value;if(!this._documentIds.has(F)){this.removeTerm(v,F,n),_-=1;continue}var R=o?o(this._documentIds.get(F),n,this._storedFields.get(F)):1;if(R){var N=w.get(F),L=this._fieldLength.get(F)[v],B=Ed(N,_,this._documentCount,L,A,a),D=r*g*R*B,K=l.get(F);if(K){K.score+=D,Td(K.terms,e);var ee=mo(K.match,n);ee?ee.push(y):K.match[n]=[y]}else l.set(F,{score:D,terms:[e],match:(d={},d[n]=[y],d)})}}}catch(Q){f={error:Q}}finally{try{C&&!C.done&&(h=T.return)&&h.call(T)}finally{if(f)throw f.error}}}}}catch(Q){u={error:Q}}finally{try{m&&!m.done&&(c=p.return)&&c.call(p)}finally{if(u)throw u.error}}return l},t.prototype.addTerm=function(e,n,r){var i=this._index.fetch(r,Xl),s=i.get(e);if(s==null)s=new Map,s.set(n,1),i.set(e,s);else{var o=s.get(n);s.set(n,(o||0)+1)}},t.prototype.removeTerm=function(e,n,r){if(!this._index.has(r)){this.warnDocumentChanged(n,e,r);return}var i=this._index.fetch(r,Xl),s=i.get(e);s==null||s.get(n)==null?this.warnDocumentChanged(n,e,r):s.get(n)<=1?s.size<=1?i.delete(e):s.delete(n):s.set(n,s.get(n)-1),this._index.get(r).size===0&&this._index.delete(r)},t.prototype.warnDocumentChanged=function(e,n,r){var i,s;try{for(var o=oe(Object.keys(this._fieldIds)),a=o.next();!a.done;a=o.next()){var l=a.value;if(this._fieldIds[l]===n){this._options.logger("warn","MiniSearch: document with ID ".concat(this._documentIds.get(e),' has changed before removal: term "').concat(r,'" was not present in field "').concat(l,'". Removing a document after it has changed can corrupt the index!'),"version_conflict");return}}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype.addDocumentId=function(e){var n=this._nextId;return this._idToShortId.set(e,n),this._documentIds.set(n,e),this._documentCount+=1,this._nextId+=1,n},t.prototype.addFields=function(e){for(var n=0;n<e.length;n++)this._fieldIds[e[n]]=n},t.prototype.addFieldLength=function(e,n,r,i){var s=this._fieldLength.get(e);s==null&&this._fieldLength.set(e,s=[]),s[n]=i;var o=this._avgFieldLength[n]||0,a=o*r+i;this._avgFieldLength[n]=a/(r+1)},t.prototype.removeFieldLength=function(e,n,r,i){if(r===1){this._avgFieldLength[n]=0;return}var s=this._avgFieldLength[n]*r-i;this._avgFieldLength[n]=s/(r-1)},t.prototype.saveStoredFields=function(e,n){var r,i,s=this._options,o=s.storeFields,a=s.extractField;if(!(o==null||o.length===0)){var l=this._storedFields.get(e);l==null&&this._storedFields.set(e,l={});try{for(var u=oe(o),c=u.next();!c.done;c=u.next()){var f=c.value,h=a(n,f);h!==void 0&&(l[f]=h)}}catch(d){r={error:d}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}},t.wildcard=Symbol("*"),t}(),mo=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0},wd=(gr={},gr[xo]=function(t,e){var n,r;try{for(var i=oe(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value,a=t.get(o);if(a==null)t.set(o,e.get(o));else{var l=e.get(o),u=l.score,c=l.terms,f=l.match;a.score=a.score+u,a.match=Object.assign(a.match,f),ql(a.terms,c)}}}catch(h){n={error:h}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return t},gr[tu]=function(t,e){var n,r,i=new Map;try{for(var s=oe(e.keys()),o=s.next();!o.done;o=s.next()){var a=o.value,l=t.get(a);if(l!=null){var u=e.get(a),c=u.score,f=u.terms,h=u.match;ql(l.terms,f),i.set(a,{score:l.score+c,terms:l.terms,match:Object.assign(l.match,h)})}}}catch(d){n={error:d}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i},gr[bd]=function(t,e){var n,r;try{for(var i=oe(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;t.delete(o)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return t},gr),xd={k:1.2,b:.7,d:.5},Ed=function(t,e,n,r,i,s){var o=s.k,a=s.b,l=s.d,u=Math.log(1+(n-e+.5)/(e+.5));return u*(l+t*(o+1)/(t+o*(1-a+a*r/i)))},Ad=function(t){return function(e,n,r){var i=typeof t.fuzzy=="function"?t.fuzzy(e,n,r):t.fuzzy||!1,s=typeof t.prefix=="function"?t.prefix(e,n,r):t.prefix===!0;return{term:e,fuzzy:i,prefix:s}}},go={idField:"id",extractField:function(t,e){return t[e]},tokenize:function(t){return t.split(Cd)},processTerm:function(t){return t.toLowerCase()},fields:void 0,searchOptions:void 0,storeFields:[],logger:function(t,e){typeof(console==null?void 0:console[t])=="function"&&console[t](e)},autoVacuum:!0},Wl={combineWith:xo,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:xd},Sd={combineWith:tu,prefix:function(t,e,n){return e===n.length-1}},_o={batchSize:1e3,batchWait:10},bo={minDirtFactor:.1,minDirtCount:20},yo=_e(_e({},_o),bo),Td=function(t,e){t.includes(e)||t.push(e)},ql=function(t,e){var n,r;try{for(var i=oe(e),s=i.next();!s.done;s=i.next()){var o=s.value;t.includes(o)||t.push(o)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},Gl=function(t,e){var n=t.score,r=e.score;return r-n},Xl=function(){return new Map},Fi=function(t){var e,n,r=new Map;try{for(var i=oe(Object.keys(t)),s=i.next();!s.done;s=i.next()){var o=s.value;r.set(parseInt(o,10),t[o])}}catch(a){e={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},Cd=/[\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;var Ao=Te(Fe());var Mi=class{constructor(e){this.text=e}};var Fd=/[\u4e00-\u9fa5]/,nu=/[\u4e00-\u9fa5]/g,ru=/[\u4e00-\u9fa5]/,ki=class{static isLargeCharset(e){return(e.match(nu)||[]).length>=Math.ceil(e.length*.35)}static testWideChar(e){return Fd.test(e)}static wideCharProportion(e){return(e.match(nu)||[]).length/e.length}};function Eo(t,e,n){var r=n||{},i=r.noTrailing,s=i===void 0?!1:i,o=r.noLeading,a=o===void 0?!1:o,l=r.debounceMode,u=l===void 0?void 0:l,c,f=!1,h=0;function d(){c&&clearTimeout(c)}function p(y){var g=y||{},v=g.upcomingOnly,w=v===void 0?!1:v;d(),f=!w}function m(){for(var y=arguments.length,g=new Array(y),v=0;v<y;v++)g[v]=arguments[v];var w=this,_=Date.now()-h;if(f)return;function A(){h=Date.now(),e.apply(w,g)}function T(){c=void 0}!a&&u&&!c&&A(),d(),u===void 0&&_>t?a?(h=Date.now(),s||(c=setTimeout(u?T:A,t))):A():s!==!0&&(c=setTimeout(u?T:A,u===void 0?t-_:t))}return m.cancel=p,m}function iu(t,e,n){var r=n||{},i=r.atBegin,s=i===void 0?!1:i;return Eo(t,e,{debounceMode:s!==!1})}var su=Te(Fe());var Pd=/[\[\]{}()<>\s]+/u,Id=/[\^=#%\/\*,\.`:;\?@\s\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u,Md=/[-_]|([a-z](?=[A-Z]))/g,wt=class{constructor(){this.setting=O(Re);this.chsSegmenter=O(gt);this.logThrottled=Eo(300,e=>M.info(e));this.assetsProvider=O(Ze);this.stopWordsZh=this.assetsProvider.assets.stopWordsZh;this.stopWordsEn=this.assetsProvider.assets.stopWordsEn}tokenize(e,n){var s,o;let r=new Set,i=e.split(Pd);for(let a of i)if(a)if(this.setting.enableChinesePatch&&ru.test(a)){let l=this.chsSegmenter.cut(a,!0);for(let u of l){if(this.setting.enableStopWordsZh&&((s=this.stopWordsZh)!=null&&s.has(u))){n==="search"&&u.length>1&&M.debug(`excluded: ${u}`);continue}r.add(u)}}else{let l=a.split(Id);for(let u of l)if(!(u.length<2||this.setting.enableStopWordsEn&&((o=this.stopWordsEn)!=null&&o.has(u)))&&(r.add(u),u.length>3)){let c=u.replace(Md,"$1 ").split(" ");for(let f of c)f.length>1&&r.add(f)}}return Array.from(r)}};wt=W([(0,su.singleton)()],wt);var on=class{static forType(e,n){return n&&ki.testWideChar(n)?this.limitsByLanguage["\u7B80\u4F53\u4E2D\u6587"][e]:this.limitsByLanguage["English"][e]}},lt=on;lt.default={line:{maxPreLines:0,maxPostLines:0,maxPreChars:30,maxPostChars:230,boundaryLineMinChars:4},paragraph:{maxPreLines:4,maxPostLines:7,maxPreChars:220,maxPostChars:600,boundaryLineMinChars:4},subItem:{maxPreLines:3,maxPostLines:3,maxPreChars:180,maxPostChars:200,boundaryLineMinChars:4}},lt.limitsByLanguage={["Other Language"]:on.default,["English"]:on.default,["\u7B80\u4F53\u4E2D\u6587"]:{line:{...on.default.line,maxPreChars:30,maxPostChars:230},paragraph:{...on.default.paragraph,maxPreChars:220,maxPostChars:600},subItem:{...on.default.subItem,maxPreChars:60,maxPostChars:80}}};var Je=class{constructor(){this.option=O(yr);this.pluginSetting=O(Re);this.filesIndex=new Ii(this.option.fileIndexOption);this.linesIndex=new Ii(this.option.lineIndexOption);this.tokenizer=O(wt);this._isReady=!1}async reIndexAll(e){this._isReady=!1,this.filesIndex.removeAll(),Array.isArray(e)?(M.trace("Indexing all documents..."),await this.addDocuments(e)):(M.trace("Loading indexed data..."),this.filesIndex=Ii.loadJS(e,this.option.fileIndexOption)),this._isReady=!0,M.trace(this.filesIndex)}get isReady(){return this._isReady}async addDocuments(e){let n=e.filter(r=>!this.filesIndex.has(r.path));await this.filesIndex.addAllAsync(n,{chunkSize:this.option.documentChunkSize}),M.debug(`added ${n.length}`)}deleteDocuments(e){let n=e.filter(r=>this.filesIndex.has(r));this.filesIndex.discardAll(n),M.debug(`deleted ${n.length}`)}async fzfMatch(e,n){return(await new Ci(n,{selector:i=>i.text}).find(e)).slice(0,this.pluginSetting.ui.maxItemResults).map(i=>({text:i.item.text,row:i.item.row,positions:i.positions}))}async searchFiles(e){let n="and",r=new Mi(e),i=this.filesIndex.search(r.text,this.option.getFileSearchOption(n));return M.debug(`maxFileItems: ${this.pluginSetting.ui.maxItemResults}`),i.slice(0,this.pluginSetting.ui.maxItemResults).map(s=>({path:s.id,queryTerms:s.queryTerms,matchedTerms:s.terms}))}async searchLinesByFileItem(e,n,r,i,s){M.debug(i.queryTerms),M.debug(i.matchedTerms);let o=50;return M.debug(`max subItems: ${o}`),new vr(e,n,r,i.queryTerms,i.matchedTerms,s).parse()}async searchLinesForSmallCharset(e,n,r){this.linesIndex.removeAll(),this.linesIndex.addAll(e);let i=this.linesIndex.search(n,this.option.getLineSearchOption());return M.debug(`matched lines count: ${i.length}`),M.debug(`only parse top ${r} matched lines per file`),i.slice(0,r).map(s=>{let o=e[s.id].text;return{text:o,row:s.id,positions:this.findAllTermPositions(o,s.terms)}})}findAllTermPositions(e,n){let r=new RegExp(n.join("|"),"gi"),i=new Set,s,o=-1;for(;(s=r.exec(e))!==null;){if(s.index===o||s[0].length===0){r.lastIndex++;continue}for(let a=0;a<s[0].length;a++)i.add(s.index+a);o=s.index}return i}};W([ze],Je.prototype,"reIndexAll",1),W([ze],Je.prototype,"searchFiles",1),W([ze],Je.prototype,"searchLinesForSmallCharset",1),Je=W([(0,Ao.singleton)()],Je);var yr=class{constructor(){this.inSetting=xl.search;this.tokenizer=O(wt);this.tokenizeIndex=e=>this.tokenizer.tokenize(e,"index");this.tokenizeSearch=e=>this.tokenizer.tokenize(e,"search");this.fileIndexOption={tokenize:this.tokenizeIndex,idField:"path",fields:["basename","aliases","folder","headings","content"],storeFields:["tags"]};this.lineIndexOption={tokenize:this.tokenizeIndex,idField:"row",fields:["text"]}}getFileSearchOption(e){return{tokenize:this.tokenizeSearch,prefix:n=>n.length>=this.inSetting.minTermLengthForPrefixSearch,fuzzy:n=>n.length<=3?0:this.inSetting.fuzzyProportion,boost:{basename:this.inSetting.weightFilename,aliases:this.inSetting.weightFilename,folder:this.inSetting.weightFolder,tags:this.inSetting.weightTagText,headings:this.inSetting.weightHeading},combineWith:e}}getLineSearchOption(){return{prefix:e=>e.length>=this.inSetting.minTermLengthForPrefixSearch,fuzzy:e=>e.length<=3?0:this.inSetting.fuzzyProportion,combineWith:"or"}}};yr=W([(0,Ao.singleton)()],yr);var vr=class{constructor(e,n,r,i,s,o){this.lines=e,this.matchedTerms=this.filterMatchedTerms(i,s),this.maxParsedLines=o;let a=lt.forType(n,r);this.preChars=a.maxPreChars,this.postChars=a.maxPostChars,M.debug(`doc matchedTerms: ${this.matchedTerms.join(" ")}`)}parse(){return this.highlightLines(this.getTopRelevantLines(this.lines,this.maxParsedLines))}filterMatchedTerms(e,n){let r=e.filter(s=>!e.some(o=>o.length>s.length&&o.includes(s))&&n.includes(s)),i;if(r.length===0)i=n.filter(s=>!n.some(o=>o.length>s.length&&o.includes(s)));else{i=r;for(let s of n)!r.includes(s)&&!this.isSubstringOrSuperString(s,n)&&i.push(s)}return i}isSubstringOrSuperString(e,n){return n.some(r=>r.length>e.length&&r.includes(e)||e.length>r.length&&e.includes(r))}getTopRelevantLines(e,n){let r=new RegExp(this.matchedTerms.join("|"),"i"),i=this.matchedTerms.map(l=>new RegExp(l,"gi")),s=new Ai((l,u)=>l-u,n);s.push(0);let o=new Map,a=new Map;for(let l of e){if(!r.test(l.text))continue;a.clear();let u=0;for(let c of i){c.lastIndex=0;let f;for(;(f=c.exec(l.text))!==null;){let h=f[0],d=(a.get(h)||0)+1;a.set(h,d),u+=d===1?10*h.length:.1}}u>s.peek()&&(s.push(u),o.set(l,u))}return Array.from(o.entries()).sort((l,u)=>u[1]-l[1]).slice(0,n).map(l=>l[0])}highlightLines(e){let n=new Map;for(let r of this.matchedTerms)n.set(r,new RegExp(r,"gi"));return e.map(r=>{let i=new Set,s=-1,o=-1;for(let a=this.matchedTerms.length-1;a>=0;a--){let l=this.matchedTerms[a],u=r.text.search(n.get(l));if(u!==-1){s=Math.max(0,u-this.preChars),o=Math.min(r.text.length,u+l.length+this.postChars);break}}if(s!==-1&&o!==-1){let a=r.text.slice(s,o);for(let l of this.matchedTerms){let u=n.get(l),c;for(;(c=u.exec(a))!==null;){let f=c.index+s,h=f+c[0].length;for(let d=f;d<h;d++)i.add(d)}}}return{text:r.text,row:r.row,positions:i}})}};W([ze],vr.prototype,"getTopRelevantLines",1),W([ze],vr.prototype,"highlightLines",1);var Mn=class{constructor(){this.lexicalEngine=O(Je)}parseAll(e,n,r,i){return n.map(s=>{let o=ur.minInSet(s.positions),a=s.row,l=this.getTruncatedContext(e,a,o,r),u=l.matchedLineText,c=s.positions;s.row===l.lines[0].row&&(c=this.adjustPositionsByStartCol(c,l.firstLineStartCol));let f=this.highlightMatchedLine(u,c,i),h=l.lines.map(d=>d.row===a?f:d.text).join(ie.JOIN_EOL);return{row:s.row,col:o,text:h}})}parse(e,n,r,i){return this.parseAll(e,[n],r,i)[0]}async parseLineItems(e,n){let r=n.replace(/\s/g,""),i=[],s=await this.lexicalEngine.fzfMatch(r,e);for(let o of s){let a=o.row,l=ur.minInSet(o.positions),u=e[a].text,c=Math.max(l-30,0),f=Math.min(c+200,u.length),h=u.substring(c,f),d=this.adjustPositionsByStartCol(o.positions,c),p=this.highlightLineByCharPositions(h,d),m=await this.getLineHighlightedContext(e,a,l,n);i.push(new zt({text:p,row:a,col:l},m))}return i}highlightMatchedLine(e,n,r){return r?`<span class="matched-line highlight-bg">${this.highlightLineByCharPositions(e,n)}</span>`:`<span class="matched-line">${this.highlightLineByCharPositions(e,n)}</span>`}highlightContextLine(e,n){let r=new RegExp(n,"gi");return e.replace(r,i=>`<mark>${i}</mark>`)}highlightLineByCharPositions(e,n){return e.split("").map((r,i)=>n.has(i)?`<mark>${r}</mark>`:r).join("")}adjustPositionsByStartCol(e,n){let r=new Set;return e.forEach(i=>{i>=n&&r.add(i-n)}),r}getTruncatedContext(e,n,r,i){if(e.length===0)return{lines:[],firstLineStartCol:0,matchedLineText:""};let s=i,o,a=0,l=0,u=e[n].text;if(r<s.maxPreChars){let c=this.extendContextAbove(e,n-1,s.maxPreChars-r,s.maxPreLines,s.boundaryLineMinChars);o=c.lines,a=c.firstLineStartCol;let f=Math.min(u.length-1,r+s.maxPostChars);f<u.length-1?(u=u.substring(0,f+1),o.push({text:u,row:n})):o.push(e[n]),l+=f-r}else{let c=r-s.maxPreChars;a=c;let f=Math.min(u.length-1,r+s.maxPostChars);f<u.length-1?u=u.substring(c,f+1):u=u.substring(c),o=[{text:u,row:n}],l+=f-r}return sr.append(o,this.extendContextBelow(e,n+1,s.maxPostChars-l,s.maxPostLines,s.boundaryLineMinChars)),{lines:o,firstLineStartCol:a,matchedLineText:u}}extendContextAbove(e,n,r,i,s){let o=0,a=n,l=0,u=[];for(;a>=0&&n-a<i;){let c=e[a].text;if(l+c.length<r)u.unshift(e[a]),l+=c.length,--a;else if(l+c.length==r){u.unshift(e[a]);break}else{let f=l+c.length-r;o=f;let h=e[a].text.substring(f);u.unshift({text:h,row:a});break}}return u.length>0&&u[0].text.length<s&&(o=0,u.shift()),{lines:u,firstLineStartCol:o}}extendContextBelow(e,n,r,i,s){let o=n,a=0,l=[];for(;o<=e.length-1&&o-n<i;){let u=e[o].text;if(a+u.length<r)l.push(e[o]),a+=u.length,++o;else if(a+u.length==r){l.push(e[o]);break}else{let c=u.length-(a+u.length-r)-1,f=e[o].text.substring(0,c+1);l.push({text:f,row:o});break}}return l.length>0&&l[0].text.length<s&&l.pop(),l}async getLineHighlightedContext(e,n,r,i){let s=sr.getCurrLanguage(),o=this.getTruncatedContext(e,n,r,lt.forType("paragraph")),a=o.lines;return(await Promise.all(a.map(async(u,c)=>{if(u.row===n){let f=await this.lexicalEngine.fzfMatch(i,[u]);try{let d=f[0].positions;return c===0&&(d=this.adjustPositionsByStartCol(d,o.firstLineStartCol)),this.highlightMatchedLine(u.text,d,!0)}catch(h){M.warn("There might be inconsistency with previous search step, which lead to a missed match to target line"),M.error(h)}}else return this.highlightContextLine(u.text,i)}))).join(ie.JOIN_EOL)}};Mn=W([(0,ou.singleton)()],Mn);var Vt=require("obsidian");var uu=Te(Fe());var au=require("obsidian");var an="CleverSearch",So='"\u25B6"',To='"\u25BC"';var Co="&nbsp;&nbsp;&nbsp;&nbsp;";var lu=Te(Fe());var ut=class{constructor(){this.app=O(au.App);this.plugin=O(an)}getFileBacklinks(e){this.app.metadataCache.getBacklinksForFile(e)}getAppId(){return this.app.appId}executeCommandById(e){this.app.commands.executeCommandById(e)}isNotExcludedPath(e){return!(this.app.metadataCache.isUserIgnored&&this.app.metadataCache.isUserIgnored(e))}};ut=W([(0,lu.singleton)()],ut);var et=class{constructor(){this.tokenizer=O(wt);this.vault=O(Vt.Vault);this.app=O(Vt.App);this.supportedExtensions=new Set(["md"]);this.privateApi=O(ut);this.obsidianFs=this.vault.adapter}async generateAllIndexedDocuments(e){return Promise.all(e.map(async n=>{if(this.isContentIndexable(n)){let r=this.app.metadataCache.getFileCache(n);if(ie.getFileType(n.path)===0)return{path:n.path,basename:n.basename,folder:ie.getFolderPath(n.path),aliases:this.parseAliases(r),tags:this.parseTags(r),headings:this.parseHeadings(r),content:await this.readPlainText(n)};throw new Error(An)}else return{path:n.path,basename:n.basename,folder:ie.getFolderPath(n.path)}}))}allFilesToBeIndexed(){let e=this.vault.getFiles();M.debug(`all files: ${e.length}`),ie.countFileByExtensions(e);let n=e.filter(r=>this.isIndexable(r));return M.debug(`indexable files: ${n.length}`),ie.countFileByExtensions(n),n}isIndexable(e){if(e instanceof Vt.TFolder)return!1;let n;return typeof e=="string"?n=e:n=e.path,this.supportedExtensions.has(ie.getExtension(n))&&this.privateApi.isNotExcludedPath(n)}async readPlainText(e){let n=typeof e=="string"?this.vault.getAbstractFileByPath(e):e;if(ie.getFileType(n.path)===0)return this.vault.cachedRead(n);throw Error(`unsupported file extension as plain text to read, path: ${n.path}`)}async readPlainTextLines(e){return(await this.readPlainText(e)).split(ie.SPLIT_EOL)}parseAliases(e){return((0,Vt.parseFrontMatterAliases)(e==null?void 0:e.frontmatter)||[]).join(" ")}parseTags(e){var n;return((n=e==null?void 0:e.tags)==null?void 0:n.map(r=>r.tag.slice(1)).join(" "))||""}parseHeadings(e){var n;return((n=e==null?void 0:e.headings)==null?void 0:n.map(r=>r.heading).join(" "))||""}isContentIndexable(e){return et.contentIndexableFileTypes.has(ie.getFileType(e.path))}};et.contentIndexableFileTypes=new Set([0,1]),et=W([(0,uu.singleton)()],et);var yt=class{constructor(){this.app=O(cu.App);this.dataProvider=O(et);this.lexicalEngine=O(Je);this.lineHighlighter=O(Mn)}async searchInVault(e){let n=new Bt("no result",[]);if(e.length===0)return n;let r=await this.lexicalEngine.searchFiles(e),i=[];return r.length!==0?{currPath:An,items:r.map(s=>new Cn(0,s.path,s.queryTerms,s.matchedTerms,[],"nothing"))}:(M.trace("lexical matched files count is 0"),n)}async getFileSubItems(e,n){let r=n.path;if(ie.getFileType(r)!==0)return M.warn(`file type for path "${r}" is not supported for sub-items.`),[];let s=(await this.dataProvider.readPlainText(r)).split(ie.SPLIT_EOL).map((l,u)=>new Tn(l,u));M.debug("target file lines count: ",s.length);let o=await this.lexicalEngine.searchLinesByFileItem(s,"subItem",e,n,30);return this.lineHighlighter.parseAll(s,o,lt.forType("subItem",e),!1).map(l=>({text:l.text,row:l.row,col:l.col}))}async searchInFile(e){let n=new Bt("",[]),r=this.app.workspace.getActiveFile();if(!e||!r)return n;if(ie.getFileType(r.path)!==0)return M.trace("Current file isn't PLAINT_TEXT"),n;let i=(await this.dataProvider.readPlainTextLines(r.path)).map((l,u)=>new Tn(l,u)),s=e.replace(/\s/g,""),a=(await this.lexicalEngine.fzfMatch(s,i)).map(l=>{let u=this.lineHighlighter.parse(i,l,lt.forType("line"),!1),c=this.lineHighlighter.parse(i,l,lt.forType("paragraph"),!0);return new zt(u,c.text)});return{currPath:r.path,items:a}}async deprecatedSearchInFile(e){let n=new Bt("",[]),r=this.app.workspace.getActiveFile();if(!e||!r||ie.getFileType(r.path)!==0)return n;let i=r.path,s=(await this.dataProvider.readPlainTextLines(i)).map((a,l)=>new Tn(a,l)),o=await this.lineHighlighter.parseLineItems(s,e);return{currPath:i,items:o}}};W([ze],yt.prototype,"searchInVault",1),W([ze],yt.prototype,"getFileSubItems",1),W([ze],yt.prototype,"searchInFile",1),W([ze],yt.prototype,"deprecatedSearchInFile",1),yt=W([(0,fu.singleton)()],yt);async function du(){let t=O(Re);Od()}function Od(){let t=["foo","bar","cowbaz","distant","disney","\u8FD9\u91CC\u6709\u4E00\u53E5\u9ED1\u8272\u7684\u673A\u7532"],e="\u9ED1\u8272 \u673A\u7532",n={unicode:!0,interSplit:"[^\\p{L}\\d']+",intraSplit:"\\p{Ll}\\p{Lu}",intraBound:"\\p{L}\\d|\\d\\p{L}|\\p{Ll}\\p{Lu}",intraChars:"[\\p{L}\\d']",intraContr:"'\\p{L}{1,2}\\b"},i=new hu.default(n).search(t,e);M.info(i[0]),M.info(i[1]),M.info(i[2])}var we=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,Me=Object.keys,Ke=Array.isArray;typeof Promise!="undefined"&&!we.Promise&&(we.Promise=Promise);function Xe(t,e){return typeof e!="object"||Me(e).forEach(function(n){t[n]=e[n]}),t}var Ar=Object.getPrototypeOf,Ld={}.hasOwnProperty;function nt(t,e){return Ld.call(t,e)}function Rn(t,e){typeof e=="function"&&(e=e(Ar(t))),(typeof Reflect=="undefined"?Me:Reflect.ownKeys)(e).forEach(n=>{Ot(t,n,e[n])})}var Tu=Object.defineProperty;function Ot(t,e,n,r){Tu(t,e,Xe(n&&nt(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function jn(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Ot(t.prototype,"constructor",t),{extend:Rn.bind(null,t.prototype)}}}}var Dd=Object.getOwnPropertyDescriptor;function ua(t,e){let n=Dd(t,e),r;return n||(r=Ar(t))&&ua(r,e)}var Rd=[].slice;function es(t,e,n){return Rd.call(t,e,n)}function Cu(t,e){return e(t)}function _r(t){if(!t)throw new Error("Assertion Failed")}function Fu(t){we.setImmediate?setImmediate(t):setTimeout(t,0)}function Pu(t,e){return t.reduce((n,r,i)=>{var s=e(r,i);return s&&(n[s[0]]=s[1]),n},{})}function jd(t,e,n){try{t.apply(null,n)}catch(r){e&&e(r)}}function kt(t,e){if(nt(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,i=e.length;r<i;++r){var s=kt(t,e[r]);n.push(s)}return n}var o=e.indexOf(".");if(o!==-1){var a=t[e.substr(0,o)];return a===void 0?void 0:kt(a,e.substr(o+1))}}function vt(t,e,n){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){_r(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)vt(t,e[r],n[r])}else{var s=e.indexOf(".");if(s!==-1){var o=e.substr(0,s),a=e.substr(s+1);if(a==="")n===void 0?Ke(t)&&!isNaN(parseInt(o))?t.splice(o,1):delete t[o]:t[o]=n;else{var l=t[o];(!l||!nt(t,o))&&(l=t[o]={}),vt(l,a,n)}}else n===void 0?Ke(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function Nd(t,e){typeof e=="string"?vt(t,e,void 0):"length"in e&&[].map.call(e,function(n){vt(t,n,void 0)})}function Iu(t){var e={};for(var n in t)nt(t,n)&&(e[n]=t[n]);return e}var Bd=[].concat;function Mu(t){return Bd.apply([],t)}var ku="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Mu([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>we[t]),zd=ku.map(t=>we[t]);Pu(ku,t=>[t,!0]);var Ut=null;function Mr(t){Ut=typeof WeakMap!="undefined"&&new WeakMap;let e=Do(t);return Ut=null,e}function Do(t){if(!t||typeof t!="object")return t;let e=Ut&&Ut.get(t);if(e)return e;if(Ke(t)){e=[],Ut&&Ut.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(Do(t[n]))}else if(zd.indexOf(t.constructor)>=0)e=t;else{let s=Ar(t);e=s===Object.prototype?{}:Object.create(s),Ut&&Ut.set(t,e);for(var i in t)nt(t,i)&&(e[i]=Do(t[i]))}return e}var{toString:$d}={};function Ro(t){return $d.call(t).slice(8,-1)}var jo=typeof Symbol!="undefined"?Symbol.iterator:"@@iterator",Vd=typeof jo=="symbol"?function(t){var e;return t!=null&&(e=t[jo])&&e.apply(t)}:function(){return null},Ln={};function It(t){var e,n,r,i;if(arguments.length===1){if(Ke(t))return t.slice();if(this===Ln&&typeof t=="string")return[t];if(i=Vd(t)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var ca=typeof Symbol!="undefined"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1,Et=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ou(t,e){Et=t,Lu=e}var Lu=()=>!0,Kd=!new Error("").stack;function pn(){if(Kd)try{throw pn.arguments,new Error}catch(t){return t}return new Error}function No(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(Lu).map(r=>`
`+r).join("")):""}var Ud=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Du=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],fa=Ud.concat(Du),Hd={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Nn(t,e){this._e=pn(),this.name=t,this.message=e}jn(Nn).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+No(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Ru(t,e){return t+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,r,i)=>i.indexOf(n)===r).join(`
`)}function Ui(t,e,n,r){this._e=pn(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=Ru(t,e)}jn(Ui).from(Nn);function wr(t,e){this._e=pn(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=Ru(t,e)}jn(wr).from(Nn);var ha=fa.reduce((t,e)=>(t[e]=e+"Error",t),{}),Wd=Nn,q=fa.reduce((t,e)=>{var n=e+"Error";function r(i,s){this._e=pn(),this.name=n,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=Hd[e]||n,this.inner=null)}return jn(r).from(Wd),t[e]=r,t},{});q.Syntax=SyntaxError;q.Type=TypeError;q.Range=RangeError;var pu=Du.reduce((t,e)=>(t[e+"Error"]=q[e],t),{});function qd(t,e){if(!t||t instanceof Nn||t instanceof TypeError||t instanceof SyntaxError||!t.name||!pu[t.name])return t;var n=new pu[t.name](e||t.message,t);return"stack"in t&&Ot(n,"stack",{get:function(){return this.inner.stack}}),n}var ts=fa.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=q[e]),t),{});ts.ModifyError=Ui;ts.DexieError=Nn;ts.BulkError=wr;function ge(){}function kr(t){return t}function Gd(t,e){return t==null||t===kr?e:function(n){return e(t(n))}}function hn(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Xd(t,e){return t===ge?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?hn(r,this.onsuccess):r),i&&(this.onerror=this.onerror?hn(i,this.onerror):i),s!==void 0?s:n}}function Yd(t,e){return t===ge?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?hn(n,this.onsuccess):n),r&&(this.onerror=this.onerror?hn(r,this.onerror):r)}}function Qd(t,e){return t===ge?e:function(n){var r=t.apply(this,arguments);Xe(n,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?hn(i,this.onsuccess):i),s&&(this.onerror=this.onerror?hn(s,this.onerror):s),r===void 0?o===void 0?void 0:o:Xe(r,o)}}function Zd(t,e){return t===ge?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function da(t,e){return t===ge?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}var Sr={},Jd=100,ep=20,ju=100,[Bo,Hi,zo]=typeof Promise=="undefined"?[]:(()=>{let t=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[t,Ar(t),t];let e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Ar(e),t]})(),Nu=Hi&&Hi.then,Ni=Bo&&Bo.constructor,pa=!!zo,$o=!1,tp=zo?()=>{zo.then(Oi)}:we.setImmediate?setImmediate.bind(null,Oi):we.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{Oi(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(Oi,0)},Tr=function(t,e){br.push([t,e]),Wi&&(tp(),Wi=!1)},Vo=!0,Wi=!0,cn=[],Bi=[],Ko=null,Uo=kr,Dn={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:yu,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{yu(t[0],t[1])}catch(e){}})}},H=Dn,br=[],fn=0,zi=[];function z(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ge,this._lib=!1;var e=this._PSD=H;if(Et&&(this._stackHolder=pn(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Sr)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Wo(this,this._value);return}this._state=null,this._value=null,++e.ref,zu(this,t)}var Ho={get:function(){var t=H,e=qi;function n(r,i){var s=!t.global&&(t!==H||e!==qi);let o=s&&!Lt();var a=new z((l,u)=>{ma(this,new Bu(Xi(r,t,s,o),Xi(i,t,s,o),l,u,t))});return Et&&Ku(a,this),a}return n.prototype=Sr,n},set:function(t){Ot(this,"then",t&&t.prototype===Sr?Ho:{get:function(){return t},set:Ho.set})}};Rn(z.prototype,{then:Ho,_then:function(t,e){ma(this,new Bu(null,null,t,e,H))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?n(r):$i(r)):this.then(null,r=>r&&r.name===e?n(r):$i(r))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),$i(e)))},stack:{get:function(){if(this._stack)return this._stack;try{$o=!0;var t=Vu(this,[],ep),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{$o=!1}}},timeout:function(t,e){return t<1/0?new z((n,r)=>{var i=setTimeout(()=>r(new q.Timeout(e)),t);this.then(n,r).finally(clearTimeout.bind(null,i))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&Ot(z.prototype,Symbol.toStringTag,"Dexie.Promise");Dn.env=Uu();function Bu(t,e,n,r,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=i}Rn(z,{all:function(){var t=It.apply(null,arguments).map(Gi);return new z(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach((i,s)=>z.resolve(i).then(o=>{t[s]=o,--r||e(t)},n))})},resolve:t=>{if(t instanceof z)return t;if(t&&typeof t.then=="function")return new z((n,r)=>{t.then(n,r)});var e=new z(Sr,!0,t);return Ku(e,Ko),e},reject:$i,race:function(){var t=It.apply(null,arguments).map(Gi);return new z((e,n)=>{t.map(r=>z.resolve(r).then(e,n))})},PSD:{get:()=>H,set:t=>H=t},totalEchoes:{get:()=>qi},newPSD:Wt,usePSD:zn,scheduler:{get:()=>Tr,set:t=>{Tr=t}},rejectionMapper:{get:()=>Uo,set:t=>{Uo=t}},follow:(t,e)=>new z((n,r)=>Wt((i,s)=>{var o=H;o.unhandleds=[],o.onunhandled=s,o.finalize=hn(function(){rp(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),t()},e,n,r))});Ni&&(Ni.allSettled&&Ot(z,"allSettled",function(){let t=It.apply(null,arguments).map(Gi);return new z(e=>{t.length===0&&e([]);let n=t.length,r=new Array(n);t.forEach((i,s)=>z.resolve(i).then(o=>r[s]={status:"fulfilled",value:o},o=>r[s]={status:"rejected",reason:o}).then(()=>--n||e(r)))})}),Ni.any&&typeof AggregateError!="undefined"&&Ot(z,"any",function(){let t=It.apply(null,arguments).map(Gi);return new z((e,n)=>{t.length===0&&n(new AggregateError([]));let r=t.length,i=new Array(r);t.forEach((s,o)=>z.resolve(s).then(a=>e(a),a=>{i[o]=a,--r||n(new AggregateError(i))}))})}));function zu(t,e){try{e(n=>{if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&Or();n&&typeof n.then=="function"?zu(t,(i,s)=>{n instanceof z?n._then(i,s):n.then(i,s)}):(t._state=!0,t._value=n,$u(t)),r&&Lr()}},Wo.bind(null,t))}catch(n){Wo(t,n)}}function Wo(t,e){if(Bi.push(e),t._state===null){var n=t._lib&&Or();e=Uo(e),t._state=!1,t._value=e,Et&&e!==null&&typeof e=="object"&&!e._promise&&jd(()=>{var r=ua(e,"stack");e._promise=t,Ot(e,"stack",{get:()=>$o?r&&(r.get?r.get.apply(e):r.value):t.stack})}),ip(t),$u(t),n&&Lr()}}function $u(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)ma(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),fn===0&&(++fn,Tr(()=>{--fn===0&&ga()},[]))}function ma(t,e){if(t._state===null){t._listeners.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++fn,Tr(np,[n,t,e])}function np(t,e,n){try{Ko=e;var r,i=e._value;e._state?r=t(i):(Bi.length&&(Bi=[]),r=t(i),Bi.indexOf(i)===-1&&sp(e)),n.resolve(r)}catch(s){n.reject(s)}finally{Ko=null,--fn===0&&ga(),--n.psd.ref||n.psd.finalize()}}function Vu(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var i=t._value,s,o;i!=null?(s=i.name||"Error",o=i.message||i,r=No(i,0)):(s=i,o=""),e.push(s+(o?": "+o:"")+r)}return Et&&(r=No(t._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),t._prev&&Vu(t._prev,e,n)),e}function Ku(t,e){var n=e?e._numPrev+1:0;n<Jd&&(t._prev=e,t._numPrev=n)}function Oi(){Or()&&Lr()}function Or(){var t=Vo;return Vo=!1,Wi=!1,t}function Lr(){var t,e,n;do for(;br.length>0;)for(t=br,br=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(br.length>0);Vo=!0,Wi=!0}function ga(){var t=cn;cn=[],t.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=zi.slice(0),n=e.length;n;)e[--n]()}function rp(t){function e(){t(),zi.splice(zi.indexOf(e),1)}zi.push(e),++fn,Tr(()=>{--fn===0&&ga()},[])}function ip(t){cn.some(e=>e._value===t._value)||cn.push(t)}function sp(t){for(var e=cn.length;e;)if(cn[--e]._value===t._value){cn.splice(e,1);return}}function $i(t){return new z(Sr,!1,t)}function Ee(t,e){var n=H;return function(){var r=Or(),i=H;try{return qt(n,!0),t.apply(this,arguments)}catch(s){e&&e(s)}finally{qt(i,!1),r&&Lr()}}}var Ve={awaits:0,echoes:0,id:0},op=0,Vi=[],Po=0,qi=0,ap=0;function Wt(t,e,n,r){var i=H,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++ap;var o=Dn.env;s.env=pa?{Promise:z,PromiseProp:{value:z,configurable:!0,writable:!0},all:z.all,race:z.race,allSettled:z.allSettled,any:z.any,resolve:z.resolve,reject:z.reject,nthen:mu(o.nthen,s),gthen:mu(o.gthen,s)}:{},e&&Xe(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=zn(s,t,n,r);return s.ref===0&&s.finalize(),a}function Bn(){return Ve.id||(Ve.id=++op),++Ve.awaits,Ve.echoes+=ju,Ve.id}function Lt(){return Ve.awaits?(--Ve.awaits===0&&(Ve.id=0),Ve.echoes=Ve.awaits*ju,!0):!1}(""+Nu).indexOf("[native code]")===-1&&(Bn=Lt=ge);function Gi(t){return Ve.echoes&&t&&t.constructor===Ni?(Bn(),t.then(e=>(Lt(),e),e=>(Lt(),Le(e)))):t}function lp(t){++qi,(!Ve.echoes||--Ve.echoes===0)&&(Ve.echoes=Ve.id=0),Vi.push(H),qt(t,!0)}function up(){var t=Vi[Vi.length-1];Vi.pop(),qt(t,!1)}function qt(t,e){var n=H;if((e?Ve.echoes&&(!Po++||t!==H):Po&&(!--Po||t!==H))&&Hu(e?lp.bind(null,t):up),t!==H&&(H=t,n===Dn&&(Dn.env=Uu()),pa)){var r=Dn.env.Promise,i=t.env;Hi.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(we,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Uu(){var t=we.Promise;return pa?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(we,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:Hi.then,gthen:t.prototype.then}:{}}function zn(t,e,n,r,i){var s=H;try{return qt(t,!0),e(n,r,i)}finally{qt(s,!1)}}function Hu(t){Nu.call(Bo,t)}function Xi(t,e,n,r){return typeof t!="function"?t:function(){var i=H;n&&Bn(),qt(e,!0);try{return t.apply(this,arguments)}finally{qt(i,!1),r&&Hu(Lt)}}}function mu(t,e){return function(n,r){return t.call(this,Xi(n,e),Xi(r,e))}}var gu="unhandledrejection";function yu(t,e){var n;try{n=e.onuncatched(t)}catch(s){}if(n!==!1)try{var r,i={promise:e,reason:t};if(we.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(gu,!0,!0),Xe(r,i)):we.CustomEvent&&(r=new CustomEvent(gu,{detail:i}),Xe(r,i)),r&&we.dispatchEvent&&(dispatchEvent(r),!we.PromiseRejectionEvent&&we.onunhandledrejection))try{we.onunhandledrejection(r)}catch(s){}Et&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch(s){}}var Le=z.reject;function qo(t,e,n,r){if(!t.idbdb||!t._state.openComplete&&!H.letThrough&&!t._vip){if(t._state.openComplete)return Le(new q.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return Le(new q.DatabaseClosed);t.open().catch(ge)}return t._state.dbReadyPromise.then(()=>qo(t,e,n,r))}else{var i=t._createTransaction(e,n,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(s){return s.name===ha.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>qo(t,e,n,r))):Le(s)}return i._promise(e,(s,o)=>Wt(()=>(H.trans=i,r(s,o,i)))).then(s=>i._completion.then(()=>s))}}var vu="3.2.4",un=String.fromCharCode(65535),Go=-1/0,Ft="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Wu="String expected.",xr=[],ns=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),cp=ns,fp=ns,qu=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),rs="__dbnames",Io="readonly",Mo="readwrite";function dn(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var Gu={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Li(t){return typeof t=="string"&&!/\./.test(t)?e=>(e[t]===void 0&&t in e&&(e=Mr(e),delete e[t]),e):e=>e}var Xo=class{_trans(e,n,r){let i=this._tx||H.trans,s=this.name;function o(l,u,c){if(!c.schema[s])throw new q.NotFound("Table "+s+" not part of transaction");return n(c.idbtrans,c)}let a=Or();try{return i&&i.db===this.db?i===H.trans?i._promise(e,o,r):Wt(()=>i._promise(e,o,r),{trans:i,transless:H.transless||H}):qo(this.db,e,[this.name],o)}finally{a&&Lr()}}get(e,n){return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(i=>this.hook.reading.fire(i))).then(n)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Ke(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);let n=Me(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);let r=this.schema.indexes.concat(this.schema.primKey).filter(u=>u.compound&&n.every(c=>u.keyPath.indexOf(c)>=0)&&u.keyPath.every(c=>n.indexOf(c)>=0))[0];if(r&&this.db._maxKey!==un)return this.where(r.name).equals(r.keyPath.map(u=>e[u]));!r&&Et&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);let{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(u,c){try{return s.cmp(u,c)===0}catch(f){return!1}}let[a,l]=n.reduce(([u,c],f)=>{let h=i[f],d=e[f];return[u||h,u||!h?dn(c,h&&h.multi?p=>{let m=kt(p,f);return Ke(m)&&m.some(y=>o(d,y))}:p=>o(d,kt(p,f))):c]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(l):r?this.filter(l):this.where(n).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Ke(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;let n=r=>{if(!r)return r;let i=Object.create(e.prototype);for(var s in r)if(nt(r,s))try{i[s]=r[s]}catch(o){}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e}defineClass(){function e(n){Xe(this,n)}return this.mapToClass(e)}add(e,n){let{auto:r,keyPath:i}=this.schema.primKey,s=e;return i&&r&&(s=Li(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:n!=null?[n]:null,values:[s]})).then(o=>o.numFailures?z.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{vt(e,i,o)}catch(a){}return o})}update(e,n){if(typeof e=="object"&&!Ke(e)){let r=kt(e,this.schema.primKey.keyPath);if(r===void 0)return Le(new q.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?Me(n).forEach(i=>{vt(e,i,n[i])}):n(e,{value:e,primKey:r})}catch(i){}return this.where(":id").equals(r).modify(n)}else return this.where(":id").equals(e).modify(n)}put(e,n){let{auto:r,keyPath:i}=this.schema.primKey,s=e;return i&&r&&(s=Li(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:n!=null?[n]:null})).then(o=>o.numFailures?z.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{vt(e,i,o)}catch(a){}return o})}delete(e){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[e]})).then(n=>n.numFailures?z.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Gu})).then(e=>e.numFailures?z.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",n=>this.core.getMany({keys:e,trans:n}).then(r=>r.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,n,r){let i=Array.isArray(n)?n:void 0;r=r||(i?void 0:n);let s=r?r.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new q.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new q.InvalidArgument("Arguments objects and keys must have the same length");let u=e.length,c=l&&a?e.map(Li(l)):e;return this.core.mutate({trans:o,type:"add",keys:i,values:c,wantResults:s}).then(({numFailures:f,results:h,lastResult:d,failures:p})=>{let m=s?h:d;if(f===0)return m;throw new wr(`${this.name}.bulkAdd(): ${f} of ${u} operations failed`,p)})})}bulkPut(e,n,r){let i=Array.isArray(n)?n:void 0;r=r||(i?void 0:n);let s=r?r.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new q.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new q.InvalidArgument("Arguments objects and keys must have the same length");let u=e.length,c=l&&a?e.map(Li(l)):e;return this.core.mutate({trans:o,type:"put",keys:i,values:c,wantResults:s}).then(({numFailures:f,results:h,lastResult:d,failures:p})=>{let m=s?h:d;if(f===0)return m;throw new wr(`${this.name}.bulkPut(): ${f} of ${u} operations failed`,p)})})}bulkDelete(e){let n=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:i,failures:s})=>{if(r===0)return i;throw new wr(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,s)})}};function Dr(t){var e={},n=function(a,l){if(l){for(var u=arguments.length,c=new Array(u-1);--u;)c[u-1]=arguments[u];return e[a].subscribe.apply(null,c),t}else if(typeof a=="string")return e[a]};n.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return n;function s(a,l,u){if(typeof a=="object")return o(a);l||(l=Zd),u||(u=ge);var c={subscribers:[],fire:u,subscribe:function(f){c.subscribers.indexOf(f)===-1&&(c.subscribers.push(f),c.fire=l(c.fire,f))},unsubscribe:function(f){c.subscribers=c.subscribers.filter(function(h){return h!==f}),c.fire=c.subscribers.reduce(l,u)}};return e[a]=n[a]=c,c}function o(a){Me(a).forEach(function(l){var u=a[l];if(Ke(u))s(l,a[l][0],a[l][1]);else if(u==="asap")var c=s(l,kr,function(){for(var h=arguments.length,d=new Array(h);h--;)d[h]=arguments[h];c.subscribers.forEach(function(p){Fu(function(){p.apply(null,d)})})});else throw new q.InvalidArgument("Invalid event config")})}}function Rr(t,e){return jn(e).from({prototype:t}),e}function hp(t){return Rr(Xo.prototype,function(n,r,i){this.db=t,this._tx=i,this.name=n,this.schema=r,this.hook=t._allTables[n]?t._allTables[n].hook:Dr(null,{creating:[Xd,ge],reading:[Gd,kr],updating:[Qd,ge],deleting:[Yd,ge]})})}function kn(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function ko(t,e){t.filter=dn(t.filter,e)}function Oo(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>dn(r(),e()):e,t.justLimit=n&&!r}function dp(t,e){t.isMatch=dn(t.isMatch,e)}function Ki(t,e){if(t.isPrimKey)return e.primaryKey;let n=e.getIndexByKeyPath(t.index);if(!n)throw new q.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function _u(t,e,n){let r=Ki(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function Di(t,e,n,r){let i=t.replayFilter?dn(t.filter,t.replayFilter()):t.filter;if(t.or){let s={},o=(a,l,u)=>{if(!i||i(l,u,h=>l.stop(h),h=>l.fail(h))){var c=l.primaryKey,f=""+c;f==="[object ArrayBuffer]"&&(f=""+new Uint8Array(c)),nt(s,f)||(s[f]=!0,e(a,l,u))}};return Promise.all([t.or._iterate(o,n),bu(_u(t,r,n),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}else return bu(_u(t,r,n),dn(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function bu(t,e,n,r){var i=r?(o,a,l)=>n(r(o),a,l):n,s=Ee(i);return t.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();(!e||e(o,l=>a=l,l=>{o.stop(l),a=ge},l=>{o.fail(l),a=ge}))&&s(o.value,o,l=>a=l),a()})})}function Ge(t,e){try{let n=wu(t),r=wu(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return mp(xu(t),xu(e));case"Array":return pp(t,e)}}catch(n){}return NaN}function pp(t,e){let n=t.length,r=e.length,i=n<r?n:r;for(let s=0;s<i;++s){let o=Ge(t[s],e[s]);if(o!==0)return o}return n===r?0:n<r?-1:1}function mp(t,e){let n=t.length,r=e.length,i=n<r?n:r;for(let s=0;s<i;++s)if(t[s]!==e[s])return t[s]<e[s]?-1:1;return n===r?0:n<r?-1:1}function wu(t){let e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";let n=Ro(t);return n==="ArrayBuffer"?"binary":n}function xu(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var Yo=class{_read(e,n){var r=this._ctx;return r.error?r.table._trans(null,Le.bind(null,r.error)):r.table._trans("readonly",e).then(n)}_write(e){var n=this._ctx;return n.error?n.table._trans(null,Le.bind(null,n.error)):n.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var n=this._ctx;n.algorithm=dn(n.algorithm,e)}_iterate(e,n){return Di(this._ctx,e,n,this._ctx.table.core)}clone(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&Xe(r,e),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(e){var n=this._ctx;return this._read(r=>Di(n,e,r,n.table.core))}count(e){return this._read(n=>{let r=this._ctx,i=r.table.core;if(kn(r,!0))return i.count({trans:n,query:{index:Ki(r,i.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var s=0;return Di(r,()=>(++s,!1),n,i).then(()=>s)}).then(e)}sortBy(e,n){let r=e.split(".").reverse(),i=r[0],s=r.length-1;function o(u,c){return c?o(u[r[c]],c-1):u[i]}var a=this._ctx.dir==="next"?1:-1;function l(u,c){var f=o(u,s),h=o(c,s);return f<h?-a:f>h?a:0}return this.toArray(function(u){return u.sort(l)}).then(n)}toArray(e){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&kn(r,!0)&&r.limit>0){let{valueMapper:i}=r,s=Ki(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:s,range:r.range}}).then(({result:o})=>i?o.map(i):o)}else{let i=[];return Di(r,s=>i.push(s),n,r.table.core).then(()=>i)}},e)}offset(e){var n=this._ctx;return e<=0?this:(n.offset+=e,kn(n)?Oo(n,()=>{var r=e;return(i,s)=>r===0?!0:r===1?(--r,!1):(s(()=>{i.advance(r),r=0}),!1)}):Oo(n,()=>{var r=e;return()=>--r<0}),this)}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Oo(this._ctx,()=>{var n=e;return function(r,i,s){return--n<=0&&i(s),n>=0}},!0),this}until(e,n){return ko(this._ctx,function(r,i,s){return e(r.value)?(i(s),n):!0}),this}first(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){return ko(this._ctx,function(n){return e(n.value)}),dp(this._ctx,e),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})}keys(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,s){r.push(s.key)}).then(function(){return r}).then(e)}primaryKeys(e){var n=this._ctx;if(n.dir==="next"&&kn(n,!0)&&n.limit>0)return this._read(i=>{var s=Ki(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:s,range:n.range}})}).then(({result:i})=>i).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,s){r.push(s.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(n){return n[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return ko(this._ctx,function(i){var s=i.primaryKey.toString(),o=nt(r,s);return r[s]=!0,!o}),this}modify(e){var n=this._ctx;return this._write(r=>{var i;if(typeof e=="function")i=e;else{var s=Me(e),o=s.length;i=function(m){for(var y=!1,g=0;g<o;++g){var v=s[g],w=e[v];kt(m,v)!==w&&(vt(m,v,w),y=!0)}return y}}let a=n.table.core,{outbound:l,extractKey:u}=a.schema.primaryKey,c=this.db._options.modifyChunkSize||200,f=[],h=0,d=[],p=(m,y)=>{let{failures:g,numFailures:v}=y;h+=m-v;for(let w of Me(g))f.push(g[w])};return this.clone().primaryKeys().then(m=>{let y=g=>{let v=Math.min(c,m.length-g);return a.getMany({trans:r,keys:m.slice(g,g+v),cache:"immutable"}).then(w=>{let _=[],A=[],T=l?[]:null,C=[];for(let R=0;R<v;++R){let N=w[R],L={value:Mr(N),primKey:m[g+R]};i.call(L,L.value,L)!==!1&&(L.value==null?C.push(m[g+R]):!l&&Ge(u(N),u(L.value))!==0?(C.push(m[g+R]),_.push(L.value)):(A.push(L.value),l&&T.push(m[g+R])))}let F=kn(n)&&n.limit===1/0&&(typeof e!="function"||e===Lo)&&{index:n.index,range:n.range};return Promise.resolve(_.length>0&&a.mutate({trans:r,type:"add",values:_}).then(R=>{for(let N in R.failures)C.splice(parseInt(N),1);p(_.length,R)})).then(()=>(A.length>0||F&&typeof e=="object")&&a.mutate({trans:r,type:"put",keys:T,values:A,criteria:F,changeSpec:typeof e!="function"&&e}).then(R=>p(A.length,R))).then(()=>(C.length>0||F&&e===Lo)&&a.mutate({trans:r,type:"delete",keys:C,criteria:F}).then(R=>p(C.length,R))).then(()=>m.length>g+v&&y(g+c))})};return y(0).then(()=>{if(f.length>0)throw new Ui("Error modifying one or more objects",f,h,d);return m.length})})})}delete(){var e=this._ctx,n=e.range;return kn(e)&&(e.isPrimKey&&!fp||n.type===3)?this._write(r=>{let{primaryKey:i}=e.table.core.schema,s=n;return e.table.core.count({trans:r,query:{index:i,range:s}}).then(o=>e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(({failures:a,lastResult:l,results:u,numFailures:c})=>{if(c)throw new Ui("Could not delete some values",Object.keys(a).map(f=>a[f]),o-c);return o-c}))}):this.modify(Lo)}},Lo=(t,e)=>e.value=null;function gp(t){return Rr(Yo.prototype,function(n,r){this.db=t;let i=Gu,s=null;if(r)try{i=r()}catch(u){s=u}let o=n._ctx,a=o.table,l=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:s,or:o.or,valueMapper:l!==kr?l:null}})}function yp(t,e){return t<e?-1:t===e?0:1}function vp(t,e){return t>e?-1:t===e?0:1}function tt(t,e,n){var r=t instanceof Yi?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function On(t){return new t.Collection(t,()=>Xu("")).limit(0)}function _p(t){return t==="next"?e=>e.toUpperCase():e=>e.toLowerCase()}function bp(t){return t==="next"?e=>e.toLowerCase():e=>e.toUpperCase()}function wp(t,e,n,r,i,s){for(var o=Math.min(t.length,r.length),a=-1,l=0;l<o;++l){var u=e[l];if(u!==r[l])return i(t[l],n[l])<0?t.substr(0,l)+n[l]+n.substr(l+1):i(t[l],r[l])<0?t.substr(0,l)+r[l]+n.substr(l+1):a>=0?t.substr(0,a)+e[a]+n.substr(a+1):null;i(t[l],u)<0&&(a=l)}return o<r.length&&s==="next"?t+n.substr(t.length):o<t.length&&s==="prev"?t.substr(0,n.length):a<0?null:t.substr(0,a)+r[a]+n.substr(a+1)}function Ri(t,e,n,r){var i,s,o,a,l,u,c,f=n.length;if(!n.every(m=>typeof m=="string"))return tt(t,Wu);function h(m){i=_p(m),s=bp(m),o=m==="next"?yp:vp;var y=n.map(function(g){return{lower:s(g),upper:i(g)}}).sort(function(g,v){return o(g.lower,v.lower)});a=y.map(function(g){return g.upper}),l=y.map(function(g){return g.lower}),u=m,c=m==="next"?"":r}h("next");var d=new t.Collection(t,()=>Kt(a[0],l[f-1]+r));d._ondirectionchange=function(m){h(m)};var p=0;return d._addAlgorithm(function(m,y,g){var v=m.key;if(typeof v!="string")return!1;var w=s(v);if(e(w,l,p))return!0;for(var _=null,A=p;A<f;++A){var T=wp(v,w,a[A],l[A],o,u);T===null&&_===null?p=A+1:(_===null||o(_,T)>0)&&(_=T)}return y(_!==null?function(){m.continue(_+c)}:g),!1}),d}function Kt(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Xu(t){return{type:1,lower:t,upper:t}}var Yi=class{get Collection(){return this._ctx.table.db.Collection}between(e,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||i)&&!(r&&i)?On(this):new this.Collection(this,()=>Kt(e,n,!r,!i))}catch(s){return tt(this,Ft)}}equals(e){return e==null?tt(this,Ft):new this.Collection(this,()=>Xu(e))}above(e){return e==null?tt(this,Ft):new this.Collection(this,()=>Kt(e,void 0,!0))}aboveOrEqual(e){return e==null?tt(this,Ft):new this.Collection(this,()=>Kt(e,void 0,!1))}below(e){return e==null?tt(this,Ft):new this.Collection(this,()=>Kt(void 0,e,!1,!0))}belowOrEqual(e){return e==null?tt(this,Ft):new this.Collection(this,()=>Kt(void 0,e))}startsWith(e){return typeof e!="string"?tt(this,Wu):this.between(e,e+un,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):Ri(this,(n,r)=>n.indexOf(r[0])===0,[e],un)}equalsIgnoreCase(e){return Ri(this,(n,r)=>n===r[0],[e],"")}anyOfIgnoreCase(){var e=It.apply(Ln,arguments);return e.length===0?On(this):Ri(this,(n,r)=>r.indexOf(n)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=It.apply(Ln,arguments);return e.length===0?On(this):Ri(this,(n,r)=>r.some(i=>n.indexOf(i)===0),e,un)}anyOf(){let e=It.apply(Ln,arguments),n=this._cmp;try{e.sort(n)}catch(s){return tt(this,Ft)}if(e.length===0)return On(this);let r=new this.Collection(this,()=>Kt(e[0],e[e.length-1]));r._ondirectionchange=s=>{n=s==="next"?this._ascending:this._descending,e.sort(n)};let i=0;return r._addAlgorithm((s,o,a)=>{let l=s.key;for(;n(l,e[i])>0;)if(++i,i===e.length)return o(a),!1;return n(l,e[i])===0?!0:(o(()=>{s.continue(e[i])}),!1)}),r}notEqual(e){return this.inAnyRange([[Go,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let e=It.apply(Ln,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch(r){return tt(this,Ft)}let n=e.reduce((r,i)=>r?r.concat([[r[r.length-1][1],i]]):[[Go,i]],null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,n){let r=this._cmp,i=this._ascending,s=this._descending,o=this._min,a=this._max;if(e.length===0)return On(this);if(!e.every(_=>_[0]!==void 0&&_[1]!==void 0&&i(_[0],_[1])<=0))return tt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",q.InvalidArgument);let l=!n||n.includeLowers!==!1,u=n&&n.includeUppers===!0;function c(_,A){let T=0,C=_.length;for(;T<C;++T){let F=_[T];if(r(A[0],F[1])<0&&r(A[1],F[0])>0){F[0]=o(F[0],A[0]),F[1]=a(F[1],A[1]);break}}return T===C&&_.push(A),_}let f=i;function h(_,A){return f(_[0],A[0])}let d;try{d=e.reduce(c,[]),d.sort(h)}catch(_){return tt(this,Ft)}let p=0,m=u?_=>i(_,d[p][1])>0:_=>i(_,d[p][1])>=0,y=l?_=>s(_,d[p][0])>0:_=>s(_,d[p][0])>=0;function g(_){return!m(_)&&!y(_)}let v=m,w=new this.Collection(this,()=>Kt(d[0][0],d[d.length-1][1],!l,!u));return w._ondirectionchange=_=>{_==="next"?(v=m,f=i):(v=y,f=s),d.sort(h)},w._addAlgorithm((_,A,T)=>{for(var C=_.key;v(C);)if(++p,p===d.length)return A(T),!1;return g(C)?!0:(this._cmp(C,d[p][1])===0||this._cmp(C,d[p][0])===0||A(()=>{f===i?_.continue(d[p][0]):_.continue(d[p][1])}),!1)}),w}startsWithAnyOf(){let e=It.apply(Ln,arguments);return e.every(n=>typeof n=="string")?e.length===0?On(this):this.inAnyRange(e.map(n=>[n,n+un])):tt(this,"startsWithAnyOf() only works with strings")}};function xp(t){return Rr(Yi.prototype,function(n,r,i){this.db=t,this._ctx={table:n,index:r===":id"?null:r,or:i};let s=t._deps.indexedDB;if(!s)throw new q.MissingAPI;this._cmp=this._ascending=s.cmp.bind(s),this._descending=(o,a)=>s.cmp(a,o),this._max=(o,a)=>s.cmp(o,a)>0?o:a,this._min=(o,a)=>s.cmp(o,a)<0?o:a,this._IDBKeyRange=t._deps.IDBKeyRange})}function xt(t){return Ee(function(e){return Cr(e),t(e.target.error),!1})}function Cr(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Fr="storagemutated",Ht="x-storagemutated-1",Gt=Dr(null,Fr),Qo=class{_lock(){return _r(!H.global),++this._reculock,this._reculock===1&&!H.global&&(H.lockOwnerFor=this),this}_unlock(){if(_r(!H.global),--this._reculock===0)for(H.global||(H.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{zn(e[1],e[0])}catch(n){}}return this}_locked(){return this._reculock&&H.lockOwnerFor!==this}create(e){if(!this.mode)return this;let n=this.db.idbdb,r=this.db._state.dbOpenError;if(_r(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new q.DatabaseClosed(r);case"MissingAPIError":throw new q.MissingAPI(r.message,r);default:throw new q.OpenFailed(r)}if(!this.active)throw new q.TransactionInactive;return _r(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=Ee(i=>{Cr(i),this._reject(e.error)}),e.onabort=Ee(i=>{Cr(i),this.active&&this._reject(new q.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=Ee(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Gt.storagemutated.fire(e.mutatedParts)}),this}_promise(e,n,r){if(e==="readwrite"&&this.mode!=="readwrite")return Le(new q.ReadOnly("Transaction is readonly"));if(!this.active)return Le(new q.TransactionInactive);if(this._locked())return new z((s,o)=>{this._blockedFuncs.push([()=>{this._promise(e,n,r).then(s,o)},H])});if(r)return Wt(()=>{var s=new z((o,a)=>{this._lock();let l=n(o,a,this);l&&l.then&&l.then(o,a)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new z((s,o)=>{var a=n(s,o,this);a&&a.then&&a.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var n=this._root();let r=z.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=n._waitingFor;return new z((o,a)=>{r.then(l=>n._waitingQueue.push(Ee(o.bind(null,l))),l=>n._waitingQueue.push(Ee(a.bind(null,l)))).finally(()=>{n._waitingFor===s&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new q.Abort))}table(e){let n=this._memoizedTables||(this._memoizedTables={});if(nt(n,e))return n[e];let r=this.schema[e];if(!r)throw new q.NotFound("Table "+e+" not part of transaction");let i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),n[e]=i,i}};function Ep(t){return Rr(Qo.prototype,function(n,r,i,s,o){this.db=t,this.mode=n,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=s,this.idbtrans=null,this.on=Dr(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new z((a,l)=>{this._resolve=a,this._reject=l}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var l=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):l&&this.idbtrans&&this.idbtrans.abort(),Le(a)})})}function Zo(t,e,n,r,i,s,o){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:s,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+Yu(e)}}function Yu(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Qu(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:Pu(n,r=>[r.name,r])}}function Ap(t){return t.length===1?t[0]:t}var Pr=t=>{try{return t.only([[]]),Pr=()=>[[]],[[]]}catch(e){return Pr=()=>un,un}};function Jo(t){return t==null?()=>{}:typeof t=="string"?Sp(t):e=>kt(e,t)}function Sp(t){return t.split(".").length===1?n=>n[t]:n=>kt(n,t)}function Eu(t){return[].slice.call(t)}var Tp=0;function Er(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function Cp(t,e,n){function r(c,f){let h=Eu(c.objectStoreNames);return{schema:{name:c.name,tables:h.map(d=>f.objectStore(d)).map(d=>{let{keyPath:p,autoIncrement:m}=d,y=Ke(p),g=p==null,v={},w={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:g,compound:y,keyPath:p,autoIncrement:m,unique:!0,extractKey:Jo(p)},indexes:Eu(d.indexNames).map(_=>d.index(_)).map(_=>{let{name:A,unique:T,multiEntry:C,keyPath:F}=_,R=Ke(F),N={name:A,compound:R,keyPath:F,unique:T,multiEntry:C,extractKey:Jo(F)};return v[Er(F)]=N,N}),getIndexByKeyPath:_=>v[Er(_)]};return v[":id"]=w.primaryKey,p!=null&&(v[Er(p)]=w.primaryKey),w})},hasGetAll:h.length>0&&"getAll"in f.objectStore(h[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(c){if(c.type===3)return null;if(c.type===4)throw new Error("Cannot convert never type to IDBKeyRange");let{lower:f,upper:h,lowerOpen:d,upperOpen:p}=c;return f===void 0?h===void 0?null:e.upperBound(h,!!p):h===void 0?e.lowerBound(f,!!d):e.bound(f,h,!!d,!!p)}function s(c){let f=c.name;function h({trans:m,type:y,keys:g,values:v,range:w}){return new Promise((_,A)=>{_=Ee(_);let T=m.objectStore(f),C=T.keyPath==null,F=y==="put"||y==="add";if(!F&&y!=="delete"&&y!=="deleteRange")throw new Error("Invalid operation type: "+y);let{length:R}=g||v||{length:1};if(g&&v&&g.length!==v.length)throw new Error("Given keys array must have same length as given values array.");if(R===0)return _({numFailures:0,failures:{},results:[],lastResult:void 0});let N,L=[],B=[],D=0,K=Q=>{++D,Cr(Q)};if(y==="deleteRange"){if(w.type===4)return _({numFailures:D,failures:B,results:[],lastResult:void 0});w.type===3?L.push(N=T.clear()):L.push(N=T.delete(i(w)))}else{let[Q,ae]=F?C?[v,g]:[v,null]:[g,null];if(F)for(let le=0;le<R;++le)L.push(N=ae&&ae[le]!==void 0?T[y](Q[le],ae[le]):T[y](Q[le])),N.onerror=K;else for(let le=0;le<R;++le)L.push(N=T[y](Q[le])),N.onerror=K}let ee=Q=>{let ae=Q.target.result;L.forEach((le,xe)=>le.error!=null&&(B[xe]=le.error)),_({numFailures:D,failures:B,results:y==="delete"?g:L.map(le=>le.result),lastResult:ae})};N.onerror=Q=>{K(Q),ee(Q)},N.onsuccess=ee})}function d({trans:m,values:y,query:g,reverse:v,unique:w}){return new Promise((_,A)=>{_=Ee(_);let{index:T,range:C}=g,F=m.objectStore(f),R=T.isPrimaryKey?F:F.index(T.name),N=v?w?"prevunique":"prev":w?"nextunique":"next",L=y||!("openKeyCursor"in R)?R.openCursor(i(C),N):R.openKeyCursor(i(C),N);L.onerror=xt(A),L.onsuccess=Ee(B=>{let D=L.result;if(!D){_(null);return}D.___id=++Tp,D.done=!1;let K=D.continue.bind(D),ee=D.continuePrimaryKey;ee&&(ee=ee.bind(D));let Q=D.advance.bind(D),ae=()=>{throw new Error("Cursor not started")},le=()=>{throw new Error("Cursor not stopped")};D.trans=m,D.stop=D.continue=D.continuePrimaryKey=D.advance=ae,D.fail=Ee(A),D.next=function(){let xe=1;return this.start(()=>xe--?this.continue():this.stop()).then(()=>this)},D.start=xe=>{let ot=new Promise((x,P)=>{x=Ee(x),L.onerror=xt(P),D.fail=P,D.stop=j=>{D.stop=D.continue=D.continuePrimaryKey=D.advance=le,x(j)}}),ue=()=>{if(L.result)try{xe()}catch(x){D.fail(x)}else D.done=!0,D.start=()=>{throw new Error("Cursor behind last entry")},D.stop()};return L.onsuccess=Ee(x=>{L.onsuccess=ue,ue()}),D.continue=K,D.continuePrimaryKey=ee,D.advance=Q,ue(),ot},_(D)},A)})}function p(m){return y=>new Promise((g,v)=>{g=Ee(g);let{trans:w,values:_,limit:A,query:T}=y,C=A===1/0?void 0:A,{index:F,range:R}=T,N=w.objectStore(f),L=F.isPrimaryKey?N:N.index(F.name),B=i(R);if(A===0)return g({result:[]});if(m){let D=_?L.getAll(B,C):L.getAllKeys(B,C);D.onsuccess=K=>g({result:K.target.result}),D.onerror=xt(v)}else{let D=0,K=_||!("openKeyCursor"in L)?L.openCursor(B):L.openKeyCursor(B),ee=[];K.onsuccess=Q=>{let ae=K.result;if(!ae)return g({result:ee});if(ee.push(_?ae.value:ae.primaryKey),++D===A)return g({result:ee});ae.continue()},K.onerror=xt(v)}})}return{name:f,schema:c,mutate:h,getMany({trans:m,keys:y}){return new Promise((g,v)=>{g=Ee(g);let w=m.objectStore(f),_=y.length,A=new Array(_),T=0,C=0,F,R=L=>{let B=L.target;(A[B._pos]=B.result)!=null,++C===T&&g(A)},N=xt(v);for(let L=0;L<_;++L)y[L]!=null&&(F=w.get(y[L]),F._pos=L,F.onsuccess=R,F.onerror=N,++T);T===0&&g(A)})},get({trans:m,key:y}){return new Promise((g,v)=>{g=Ee(g);let _=m.objectStore(f).get(y);_.onsuccess=A=>g(A.target.result),_.onerror=xt(v)})},query:p(a),openCursor:d,count({query:m,trans:y}){let{index:g,range:v}=m;return new Promise((w,_)=>{let A=y.objectStore(f),T=g.isPrimaryKey?A:A.index(g.name),C=i(v),F=C?T.count(C):T.count();F.onsuccess=Ee(R=>w(R.target.result)),F.onerror=xt(_)})}}}let{schema:o,hasGetAll:a}=r(t,n),l=o.tables.map(c=>s(c)),u={};return l.forEach(c=>u[c.name]=c),{stack:"dbcore",transaction:t.transaction.bind(t),table(c){if(!u[c])throw new Error(`Table '${c}' not found`);return u[c]},MIN_KEY:-1/0,MAX_KEY:Pr(e),schema:o}}function Fp(t,e){return e.reduce((n,{create:r})=>({...n,...r(n)}),t)}function Pp(t,e,{IDBKeyRange:n,indexedDB:r},i){return{dbcore:Fp(Cp(e,n,i),t.dbcore)}}function ya({_novip:t},e){let n=e.db,r=Pp(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(i=>{let s=i.name;t.core.schema.tables.some(o=>o.name===s)&&(i.core=t.core.table(s),t[s]instanceof t.Table&&(t[s].core=i.core))})}function Qi({_novip:t},e,n,r){n.forEach(i=>{let s=r[i];e.forEach(o=>{let a=ua(o,i);(!a||"value"in a&&a.value===void 0)&&(o===t.Transaction.prototype||o instanceof t.Transaction?Ot(o,i,{get(){return this.table(i)},set(l){Tu(this,i,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new t.Table(i,s))})})}function ea({_novip:t},e){e.forEach(n=>{for(let r in n)n[r]instanceof t.Table&&delete n[r]})}function Ip(t,e){return t._cfg.version-e._cfg.version}function Mp(t,e,n,r){let i=t._dbSchema,s=t._createTransaction("readwrite",t._storeNames,i);s.create(n),s._completion.catch(r);let o=s._reject.bind(s),a=H.transless||H;Wt(()=>{H.trans=s,H.transless=a,e===0?(Me(i).forEach(l=>{va(n,l,i[l].primKey,i[l].indexes)}),ya(t,n),z.follow(()=>t.on.populate.fire(s)).catch(o)):kp(t,e,s,n).catch(o)})}function kp({_novip:t},e,n,r){let i=[],s=t._versions,o=t._dbSchema=_a(t,t.idbdb,r),a=!1;s.filter(c=>c._cfg.version>=e).forEach(c=>{i.push(()=>{let f=o,h=c._cfg.dbschema;na(t,f,r),na(t,h,r),o=t._dbSchema=h;let d=Zu(f,h);d.add.forEach(m=>{va(r,m[0],m[1].primKey,m[1].indexes)}),d.change.forEach(m=>{if(m.recreate)throw new q.Upgrade("Not yet support for changing primary key");{let y=r.objectStore(m.name);m.add.forEach(g=>ta(y,g)),m.change.forEach(g=>{y.deleteIndex(g.name),ta(y,g)}),m.del.forEach(g=>y.deleteIndex(g))}});let p=c._cfg.contentUpgrade;if(p&&c._cfg.version>e){ya(t,r),n._memoizedTables={},a=!0;let m=Iu(h);d.del.forEach(w=>{m[w]=f[w]}),ea(t,[t.Transaction.prototype]),Qi(t,[t.Transaction.prototype],Me(m),m),n.schema=m;let y=ca(p);y&&Bn();let g,v=z.follow(()=>{if(g=p(n),g&&y){var w=Lt.bind(null,null);g.then(w,w)}});return g&&typeof g.then=="function"?z.resolve(g):v.then(()=>g)}}),i.push(f=>{if(!a||!cp){let h=c._cfg.dbschema;Lp(h,f)}ea(t,[t.Transaction.prototype]),Qi(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),n.schema=t._dbSchema})});function u(){return i.length?z.resolve(i.shift()(n.idbtrans)).then(u):z.resolve()}return u().then(()=>{Op(o,r)})}function Zu(t,e){let n={del:[],add:[],change:[]},r;for(r in t)e[r]||n.del.push(r);for(r in e){let i=t[r],s=e[r];if(!i)n.add.push([r,s]);else{let o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!ns)o.recreate=!0,n.change.push(o);else{let a=i.idxByName,l=s.idxByName,u;for(u in a)l[u]||o.del.push(u);for(u in l){let c=a[u],f=l[u];c?c.src!==f.src&&o.change.push(f):o.add.push(f)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}}return n}function va(t,e,n,r){let i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(s=>ta(i,s)),i}function Op(t,e){Me(t).forEach(n=>{e.db.objectStoreNames.contains(n)||va(e,n,t[n].primKey,t[n].indexes)})}function Lp(t,e){[].slice.call(e.db.objectStoreNames).forEach(n=>t[n]==null&&e.db.deleteObjectStore(n))}function ta(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function _a(t,e,n){let r={};return es(e.objectStoreNames,0).forEach(s=>{let o=n.objectStore(s),a=o.keyPath,l=Zo(Yu(a),a||"",!1,!1,!!o.autoIncrement,a&&typeof a!="string",!0),u=[];for(let f=0;f<o.indexNames.length;++f){let h=o.index(o.indexNames[f]);a=h.keyPath;var c=Zo(h.name,a,!!h.unique,!!h.multiEntry,!1,a&&typeof a!="string",!1);u.push(c)}r[s]=Qu(s,l,u)}),r}function Dp({_novip:t},e,n){t.verno=e.version/10;let r=t._dbSchema=_a(t,e,n);t._storeNames=es(e.objectStoreNames,0),Qi(t,[t._allTables],Me(r),r)}function Rp(t,e){let n=_a(t,t.idbdb,e),r=Zu(n,t._dbSchema);return!(r.add.length||r.change.some(i=>i.add.length||i.change.length))}function na({_novip:t},e,n){let r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){let s=r[i],o=n.objectStore(s);t._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){let l=o.indexNames[a],u=o.index(l).keyPath,c=typeof u=="string"?u:"["+es(u).join("+")+"]";if(e[s]){let f=e[s].idxByName[c];f&&(f.name=l,delete e[s].idxByName[c],e[s].idxByName[l]=f)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&we.WorkerGlobalScope&&we instanceof we.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function jp(t){return t.split(",").map((e,n)=>{e=e.trim();let r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return Zo(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Ke(i),n===0)})}var ra=class{_parseStoresSpec(e,n){Me(e).forEach(r=>{if(e[r]!==null){var i=jp(e[r]),s=i.shift();if(s.multi)throw new q.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new q.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new q.Schema("Index must have a name and cannot be an empty string")}),n[r]=Qu(r,s,i)}})}stores(e){let n=this.db;this._cfg.storesSource=this._cfg.storesSource?Xe(this._cfg.storesSource,e):e;let r=n._versions,i={},s={};return r.forEach(o=>{Xe(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),n._dbSchema=s,ea(n,[n._allTables,n,n.Transaction.prototype]),Qi(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],Me(s),s),n._storeNames=Me(s),this}upgrade(e){return this._cfg.contentUpgrade=da(this._cfg.contentUpgrade||ge,e),this}};function Np(t){return Rr(ra.prototype,function(n){this.db=t,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function ba(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new ct(rs,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function wa(t){return t&&typeof t.databases=="function"}function Bp({indexedDB:t,IDBKeyRange:e}){return wa(t)?Promise.resolve(t.databases()).then(n=>n.map(r=>r.name).filter(r=>r!==rs)):ba(t,e).toCollection().primaryKeys()}function zp({indexedDB:t,IDBKeyRange:e},n){!wa(t)&&n!==rs&&ba(t,e).put({name:n}).catch(ge)}function $p({indexedDB:t,IDBKeyRange:e},n){!wa(t)&&n!==rs&&ba(t,e).delete(n).catch(ge)}function ia(t){return Wt(function(){return H.letThrough=!0,t()})}function Vp(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function Kp(t){let e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?Le(e.dbOpenError):t);Et&&(e.openCanceller._stackHolder=pn()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;let r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new q.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,o=null,a=!1;return z.race([r,(typeof navigator=="undefined"?z.resolve():Vp()).then(()=>new z((l,u)=>{if(i(),!n)throw new q.MissingAPI;let c=t.name,f=e.autoSchema?n.open(c):n.open(c,Math.round(t.verno*10));if(!f)throw new q.MissingAPI;f.onerror=xt(u),f.onblocked=Ee(t._fireOnBlocked),f.onupgradeneeded=Ee(h=>{if(o=f.transaction,e.autoSchema&&!t._options.allowEmptyDB){f.onerror=Cr,o.abort(),f.result.close();let p=n.deleteDatabase(c);p.onsuccess=p.onerror=Ee(()=>{u(new q.NoSuchDatabase(`Database ${c} doesnt exist`))})}else{o.onerror=xt(u);var d=h.oldVersion>Math.pow(2,62)?0:h.oldVersion;a=d<1,t._novip.idbdb=f.result,Mp(t,d/10,o,u)}},u),f.onsuccess=Ee(()=>{o=null;let h=t._novip.idbdb=f.result,d=es(h.objectStoreNames);if(d.length>0)try{let p=h.transaction(Ap(d),"readonly");e.autoSchema?Dp(t,h,p):(na(t,t._dbSchema,p),Rp(t,p)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),ya(t,p)}catch(p){}xr.push(t),h.onversionchange=Ee(p=>{e.vcFired=!0,t.on("versionchange").fire(p)}),h.onclose=Ee(p=>{t.on("close").fire(p)}),a&&zp(t._deps,c),l()},u)}))]).then(()=>(i(),e.onReadyBeingFired=[],z.resolve(ia(()=>t.on.ready.fire(t.vip))).then(function l(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce(da,ge);return e.onReadyBeingFired=[],z.resolve(ia(()=>u(t.vip))).then(l)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(l=>{e.dbOpenError=l;try{o&&o.abort()}catch(u){}return r===e.openCanceller&&t._close(),Le(l)}).finally(()=>{e.openComplete=!0,s()})}function sa(t){var e=o=>t.next(o),n=o=>t.throw(o),r=s(e),i=s(n);function s(o){return a=>{var l=o(a),u=l.value;return l.done?u:!u||typeof u.then!="function"?Ke(u)?Promise.all(u).then(r,i):r(u):u.then(r,i)}}return s(e)()}function Up(t,e,n){var r=arguments.length;if(r<2)throw new q.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var s=Mu(i);return[t,s,n]}function Ju(t,e,n,r,i){return z.resolve().then(()=>{let s=H.transless||H,o=t._createTransaction(e,n,t._dbSchema,r),a={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(f){return f.name===ha.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Ju(t,e,n,null,i))):Le(f)}let l=ca(i);l&&Bn();let u,c=z.follow(()=>{if(u=i.call(o,o),u)if(l){var f=Lt.bind(null,null);u.then(f,f)}else typeof u.next=="function"&&typeof u.throw=="function"&&(u=sa(u))},a);return(u&&typeof u.then=="function"?z.resolve(u).then(f=>o.active?f:Le(new q.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):c.then(()=>u)).then(f=>(r&&o._resolve(),o._completion.then(()=>f))).catch(f=>(o._reject(f),Le(f)))})}function ji(t,e,n){let r=Ke(t)?t.slice():[t];for(let i=0;i<n;++i)r.push(e);return r}function Hp(t){return{...t,table(e){let n=t.table(e),{schema:r}=n,i={},s=[];function o(h,d,p){let m=Er(h),y=i[m]=i[m]||[],g=h==null?0:typeof h=="string"?1:h.length,v=d>0,w={...p,isVirtual:v,keyTail:d,keyLength:g,extractKey:Jo(h),unique:!v&&p.unique};if(y.push(w),w.isPrimaryKey||s.push(w),g>1){let _=g===2?h[0]:h.slice(0,g-1);o(_,d+1,p)}return y.sort((_,A)=>_.keyTail-A.keyTail),w}let a=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(let h of r.indexes)o(h.keyPath,0,h);function l(h){let d=i[Er(h)];return d&&d[0]}function u(h,d){return{type:h.type===1?2:h.type,lower:ji(h.lower,h.lowerOpen?t.MAX_KEY:t.MIN_KEY,d),lowerOpen:!0,upper:ji(h.upper,h.upperOpen?t.MIN_KEY:t.MAX_KEY,d),upperOpen:!0}}function c(h){let d=h.query.index;return d.isVirtual?{...h,query:{index:d,range:u(h.query.range,d.keyTail)}}:h}return{...n,schema:{...r,primaryKey:a,indexes:s,getIndexByKeyPath:l},count(h){return n.count(c(h))},query(h){return n.query(c(h))},openCursor(h){let{keyTail:d,isVirtual:p,keyLength:m}=h.query.index;if(!p)return n.openCursor(h);function y(g){function v(_){_!=null?g.continue(ji(_,h.reverse?t.MAX_KEY:t.MIN_KEY,d)):h.unique?g.continue(g.key.slice(0,m).concat(h.reverse?t.MIN_KEY:t.MAX_KEY,d)):g.continue()}return Object.create(g,{continue:{value:v},continuePrimaryKey:{value(_,A){g.continuePrimaryKey(ji(_,t.MAX_KEY,d),A)}},primaryKey:{get(){return g.primaryKey}},key:{get(){let _=g.key;return m===1?_[0]:_.slice(0,m)}},value:{get(){return g.value}}})}return n.openCursor(c(h)).then(g=>g&&y(g))}}}}}var Wp={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Hp};function xa(t,e,n,r){return n=n||{},r=r||"",Me(t).forEach(i=>{if(!nt(e,i))n[r+i]=void 0;else{var s=t[i],o=e[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){let a=Ro(s),l=Ro(o);a!==l?n[r+i]=e[i]:a==="Object"?xa(s,o,n,r+i+"."):s!==o&&(n[r+i]=e[i])}else s!==o&&(n[r+i]=e[i])}}),Me(e).forEach(i=>{nt(t,i)||(n[r+i]=e[i])}),n}function qp(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Gp={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){let n=t.table(e),{primaryKey:r}=n.schema;return{...n,mutate(s){let o=H.trans,{deleting:a,creating:l,updating:u}=o.table(e).hook;switch(s.type){case"add":if(l.fire===ge)break;return o._promise("readwrite",()=>c(s),!0);case"put":if(l.fire===ge&&u.fire===ge)break;return o._promise("readwrite",()=>c(s),!0);case"delete":if(a.fire===ge)break;return o._promise("readwrite",()=>c(s),!0);case"deleteRange":if(a.fire===ge)break;return o._promise("readwrite",()=>f(s),!0)}return n.mutate(s);function c(d){let p=H.trans,m=d.keys||qp(r,d);if(!m)throw new Error("Keys missing");return d=d.type==="add"||d.type==="put"?{...d,keys:m}:{...d},d.type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),Xp(n,d,m).then(y=>{let g=m.map((v,w)=>{let _=y[w],A={onerror:null,onsuccess:null};if(d.type==="delete")a.fire.call(A,v,_,p);else if(d.type==="add"||_===void 0){let T=l.fire.call(A,v,d.values[w],p);v==null&&T!=null&&(v=T,d.keys[w]=v,r.outbound||vt(d.values[w],r.keyPath,v))}else{let T=xa(_,d.values[w]),C=u.fire.call(A,T,v,_,p);if(C){let F=d.values[w];Object.keys(C).forEach(R=>{nt(F,R)?F[R]=C[R]:vt(F,R,C[R])})}}return A});return n.mutate(d).then(({failures:v,results:w,numFailures:_,lastResult:A})=>{for(let T=0;T<m.length;++T){let C=w?w[T]:m[T],F=g[T];C==null?F.onerror&&F.onerror(v[T]):F.onsuccess&&F.onsuccess(d.type==="put"&&y[T]?d.values[T]:C)}return{failures:v,results:w,numFailures:_,lastResult:A}}).catch(v=>(g.forEach(w=>w.onerror&&w.onerror(v)),Promise.reject(v)))})}function f(d){return h(d.trans,d.range,1e4)}function h(d,p,m){return n.query({trans:d,values:!1,query:{index:r,range:p},limit:m}).then(({result:y})=>c({type:"delete",keys:y,trans:d}).then(g=>g.numFailures>0?Promise.reject(g.failures[0]):y.length<m?{failures:[],numFailures:0,lastResult:void 0}:h(d,{...p,lower:y[y.length-1],lowerOpen:!0},m)))}}}}})};function Xp(t,e,n){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:n,cache:"immutable"})}function ec(t,e,n){try{if(!e||e.keys.length<t.length)return null;let r=[];for(let i=0,s=0;i<e.keys.length&&s<t.length;++i)Ge(e.keys[i],t[s])===0&&(r.push(n?Mr(e.values[i]):e.values[i]),++s);return r.length===t.length?r:null}catch(r){return null}}var Yp={stack:"dbcore",level:-1,create:t=>({table:e=>{let n=t.table(e);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);let i=ec(r.keys,r.trans._cache,r.cache==="clone");return i?z.resolve(i):n.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?Mr(s):s},s))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function Ea(t){return!("from"in t)}var Pt=function(t,e){if(this)Xe(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{let n=new Pt;return t&&"d"in t&&Xe(n,t),n}};Rn(Pt.prototype,{add(t){return Zi(this,t),this},addKey(t){return Ir(this,t,t),this},addKeys(t){return t.forEach(e=>Ir(this,e,e)),this},[jo](){return oa(this)}});function Ir(t,e,n){let r=Ge(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Ea(t))return Xe(t,{from:e,to:n,d:1});let i=t.l,s=t.r;if(Ge(n,t.from)<0)return i?Ir(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Au(t);if(Ge(e,t.to)>0)return s?Ir(s,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Au(t);Ge(e,t.from)<0&&(t.from=e,t.l=null,t.d=s?s.d+1:1),Ge(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);let o=!t.r;i&&!t.l&&Zi(t,i),s&&o&&Zi(t,s)}function Zi(t,e){function n(r,{from:i,to:s,l:o,r:a}){Ir(r,i,s),o&&n(r,o),a&&n(r,a)}Ea(e)||n(t,e)}function Qp(t,e){let n=oa(e),r=n.next();if(r.done)return!1;let i=r.value,s=oa(t),o=s.next(i.from),a=o.value;for(;!r.done&&!o.done;){if(Ge(a.from,i.to)<=0&&Ge(a.to,i.from)>=0)return!0;Ge(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}function oa(t){let e=Ea(t)?null:{s:0,n:t};return{next(n){let r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&Ge(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||Ge(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Au(t){var e,n;let r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){let s=i==="r"?"l":"r",o={...t},a=t[i];t.from=a.from,t.to=a.to,t[i]=a[i],o[i]=a[s],t[s]=o,o.d=Su(o)}t.d=Su(t)}function Su({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}var Zp={stack:"dbcore",level:0,create:t=>{let e=t.schema.name,n=new Pt(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{let i=t.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:l}=o,u={...i,mutate:h=>{let d=h.trans,p=d.mutatedParts||(d.mutatedParts={}),m=T=>{let C=`idb://${e}/${r}/${T}`;return p[C]||(p[C]=new Pt)},y=m(""),g=m(":dels"),{type:v}=h,[w,_]=h.type==="deleteRange"?[h.range]:h.type==="delete"?[h.keys]:h.values.length<50?[[],h.values]:[],A=h.trans._cache;return i.mutate(h).then(T=>{if(Ke(w)){v!=="delete"&&(w=T.results),y.addKeys(w);let C=ec(w,A);!C&&v!=="add"&&g.addKeys(w),(C||_)&&Jp(m,s,C,_)}else if(w){let C={from:w.lower,to:w.upper};g.add(C),y.add(C)}else y.add(n),g.add(n),s.indexes.forEach(C=>m(C.name).add(n));return T})}},c=({query:{index:h,range:d}})=>{var p,m;return[h,new Pt((p=d.lower)!==null&&p!==void 0?p:t.MIN_KEY,(m=d.upper)!==null&&m!==void 0?m:t.MAX_KEY)]},f={get:h=>[o,new Pt(h.key)],getMany:h=>[o,new Pt().addKeys(h.keys)],count:c,query:c,openCursor:c};return Me(f).forEach(h=>{u[h]=function(d){let{subscr:p}=H;if(p){let m=_=>{let A=`idb://${e}/${r}/${_}`;return p[A]||(p[A]=new Pt)},y=m(""),g=m(":dels"),[v,w]=f[h](d);if(m(v.name||"").add(w),!v.isPrimaryKey)if(h==="count")g.add(n);else{let _=h==="query"&&l&&d.values&&i.query({...d,values:!1});return i[h].apply(this,arguments).then(A=>{if(h==="query"){if(l&&d.values)return _.then(({result:C})=>(y.addKeys(C),A));let T=d.values?A.result.map(a):A.result;d.values?y.addKeys(T):g.addKeys(T)}else if(h==="openCursor"){let T=A,C=d.values;return T&&Object.create(T,{key:{get(){return g.addKey(T.primaryKey),T.key}},primaryKey:{get(){let F=T.primaryKey;return g.addKey(F),F}},value:{get(){return C&&y.addKey(T.primaryKey),T.value}}})}return A})}}return i[h].apply(this,arguments)}}),u}}}};function Jp(t,e,n,r){function i(s){let o=t(s.name||"");function a(u){return u!=null?s.extractKey(u):null}let l=u=>s.multiEntry&&Ke(u)?u.forEach(c=>o.addKey(c)):o.addKey(u);(n||r).forEach((u,c)=>{let f=n&&a(n[c]),h=r&&a(r[c]);Ge(f,h)!==0&&(f!=null&&l(f),h!=null&&l(h))})}e.indexes.forEach(i)}var ct=class{constructor(e,n){this._middlewares={},this.verno=0;let r=ct.dependencies;this._options=n={addons:ct.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};let{addons:i}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ge,dbReadyPromise:null,cancelOpen:ge,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};s.dbReadyPromise=new z(o=>{s.dbReadyResolve=o}),s.openCanceller=new z((o,a)=>{s.cancelOpen=a}),this._state=s,this.name=e,this.on=Dr(this,"populate","blocked","versionchange","close",{ready:[da,ge]}),this.on.ready.subscribe=Cu(this.on.ready.subscribe,o=>(a,l)=>{ct.vip(()=>{let u=this._state;if(u.openComplete)u.dbOpenError||z.resolve().then(a),l&&o(a);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(a),l&&o(a);else{o(a);let c=this;l||o(function f(){c.on.ready.unsubscribe(a),c.on.ready.unsubscribe(f)})}})}),this.Collection=gp(this),this.Table=hp(this),this.Transaction=Ep(this),this.Version=Np(this),this.WhereClause=xp(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=Pr(n.IDBKeyRange),this._createTransaction=(o,a,l,u)=>new this.Transaction(o,a,l,this._options.chromeTransactionDurability,u),this._fireOnBlocked=o=>{this.on("blocked").fire(o),xr.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(o))},this.use(Wp),this.use(Gp),this.use(Zp),this.use(Yp),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(o=>o(this))}version(e){if(isNaN(e)||e<.1)throw new q.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new q.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);let n=this._versions;var r=n.filter(i=>i._cfg.version===e)[0];return r||(r=new this.Version(e),n.push(r),n.sort(Ip),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||H.letThrough||this._vip)?e():new z((n,r)=>{if(this._state.openComplete)return r(new q.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen){r(new q.DatabaseClosed);return}this.open().catch(ge)}this._state.dbReadyPromise.then(n,r)}).then(e)}use({stack:e,create:n,level:r,name:i}){i&&this.unuse({stack:e,name:i});let s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:n,level:r==null?10:r,name:i}),s.sort((o,a)=>o.level-a.level),this}unuse({stack:e,name:n,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>r?i.create!==r:n?i.name!==n:!1)),this}open(){return Kp(this)}_close(){let e=this._state,n=xr.indexOf(this);if(n>=0&&xr.splice(n,1),this.idbdb){try{this.idbdb.close()}catch(r){}this._novip.idbdb=null}e.dbReadyPromise=new z(r=>{e.dbReadyResolve=r}),e.openCanceller=new z((r,i)=>{e.cancelOpen=i})}close(){this._close();let e=this._state;this._options.autoOpen=!1,e.dbOpenError=new q.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){let e=arguments.length>0,n=this._state;return new z((r,i)=>{let s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=Ee(()=>{$p(this._deps,this.name),r()}),o.onerror=xt(i),o.onblocked=this._fireOnBlocked};if(e)throw new q.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){let e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Me(this._allTables).map(e=>this._allTables[e])}transaction(){let e=Up.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,r){let i=H.trans;(!i||i.db!==this||e.indexOf("!")!==-1)&&(i=null);let s=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");let o,a;try{if(a=n.map(u=>{var c=u instanceof this.Table?u.name:u;if(typeof c!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return c}),e=="r"||e===Io)o=Io;else if(e=="rw"||e==Mo)o=Mo;else throw new q.InvalidArgument("Invalid transaction mode: "+e);if(i){if(i.mode===Io&&o===Mo)if(s)i=null;else throw new q.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i&&a.forEach(u=>{if(i&&i.storeNames.indexOf(u)===-1)if(s)i=null;else throw new q.SubTransaction("Table "+u+" not included in parent transaction.")}),s&&i&&!i.active&&(i=null)}}catch(u){return i?i._promise(null,(c,f)=>{f(u)}):Le(u)}let l=Ju.bind(null,this,o,a,i,r);return i?i._promise(o,l,"lock"):H.trans?zn(H.transless,()=>this._whenReady(l)):this._whenReady(l)}table(e){if(!nt(this._allTables,e))throw new q.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}},em=typeof Symbol!="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",aa=class{constructor(e){this._subscribe=e}subscribe(e,n,r){return this._subscribe(!e||typeof e=="function"?{next:e,error:n,complete:r}:e)}[em](){return this}};function tc(t,e){return Me(e).forEach(n=>{let r=t[n]||(t[n]=new Pt);Zi(r,e[n])}),t}function tm(t){let e=!1,n,r=new aa(i=>{let s=ca(t);function o(y){s&&Bn();let g=()=>Wt(t,{subscr:y,trans:null}),v=H.trans?zn(H.transless,g):g();return s&&v.then(Lt,Lt),v}let a=!1,l={},u={},c={get closed(){return a},unsubscribe:()=>{a=!0,Gt.storagemutated.unsubscribe(p)}};i.start&&i.start(c);let f=!1,h=!1;function d(){return Me(u).some(y=>l[y]&&Qp(l[y],u[y]))}let p=y=>{tc(l,y),d()&&m()},m=()=>{if(f||a)return;l={};let y={},g=o(y);h||(Gt(Fr,p),h=!0),f=!0,Promise.resolve(g).then(v=>{e=!0,n=v,f=!1,!a&&(d()?m():(l={},u=y,i.next&&i.next(v)))},v=>{f=!1,e=!1,i.error&&i.error(v),c.unsubscribe()})};return m(),c});return r.hasValue=()=>e,r.getValue=()=>n,r}var la;try{la={indexedDB:we.indexedDB||we.mozIndexedDB||we.webkitIndexedDB||we.msIndexedDB,IDBKeyRange:we.IDBKeyRange||we.webkitIDBKeyRange}}catch(t){la={indexedDB:null,IDBKeyRange:null}}var ln=ct;Rn(ln,{...ts,delete(t){return new ln(t,{addons:[]}).delete()},exists(t){return new ln(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1)},getDatabaseNames(t){try{return Bp(ln.dependencies).then(t)}catch(e){return Le(new q.MissingAPI)}},defineClass(){function t(e){Xe(this,e)}return t},ignoreTransaction(t){return H.trans?zn(H.transless,t):t()},vip:ia,async:function(t){return function(){try{var e=sa(t.apply(this,arguments));return!e||typeof e.then!="function"?z.resolve(e):e}catch(n){return Le(n)}}},spawn:function(t,e,n){try{var r=sa(t.apply(n,e||[]));return!r||typeof r.then!="function"?z.resolve(r):r}catch(i){return Le(i)}},currentTransaction:{get:()=>H.trans||null},waitFor:function(t,e){let n=z.resolve(typeof t=="function"?ln.ignoreTransaction(t):t).timeout(e||6e4);return H.trans?H.trans.waitFor(n):n},Promise:z,debug:{get:()=>Et,set:t=>{Ou(t,t==="dexie"?()=>!0:qu)}},derive:jn,extend:Xe,props:Rn,override:Cu,Events:Dr,on:Gt,liveQuery:tm,extendObservabilitySet:tc,getByKeyPath:kt,setByKeyPath:vt,delByKeyPath:Nd,shallowClone:Iu,deepClone:Mr,getObjectDiff:xa,cmp:Ge,asap:Fu,minKey:Go,addons:[],connections:xr,errnames:ha,dependencies:la,semVer:vu,version:vu.split(".").map(t=>parseInt(t)).reduce((t,e,n)=>t+e/Math.pow(10,n*2))});ln.maxKey=Pr(ln.dependencies.IDBKeyRange);typeof dispatchEvent!="undefined"&&typeof addEventListener!="undefined"&&(Gt(Fr,t=>{if(!Mt){let e;ns?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Ht,!0,!0,t)):e=new CustomEvent(Ht,{detail:t}),Mt=!0,dispatchEvent(e),Mt=!1}}),addEventListener(Ht,({detail:t})=>{Mt||Ji(t)}));function Ji(t){let e=Mt;try{Mt=!0,Gt.storagemutated.fire(t)}finally{Mt=e}}var Mt=!1;if(typeof BroadcastChannel!="undefined"){let t=new BroadcastChannel(Ht);typeof t.unref=="function"&&t.unref(),Gt(Fr,e=>{Mt||t.postMessage(e)}),t.onmessage=e=>{e.data&&Ji(e.data)}}else if(typeof self!="undefined"&&typeof navigator!="undefined"){Gt(Fr,e=>{try{Mt||(typeof localStorage!="undefined"&&localStorage.setItem(Ht,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:Ht,changedParts:e})))}catch(n){}}),typeof addEventListener!="undefined"&&addEventListener("storage",e=>{if(e.key===Ht){let n=JSON.parse(e.newValue);n&&Ji(n.changedParts)}});let t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",nm)}function nm({data:t}){t&&t.type===Ht&&Ji(t.changedParts)}z.rejectionMapper=qd;Ou(Et,qu);var jr=require("obsidian");var nc=Te(Fe());var _t=class{constructor(){this.app=O(jr.App);this.privateApi=O(ut)}async initAsync(){if(this.app.plugins.plugins.omnisearch){let e="omnisearch/cache/"+this.privateApi.getAppId(),n=new ct(e);n.version(_t.DB_VERSION).stores({searchHistory:"++id",minisearch:"date"}),this.db=n}}async getLastQuery(){let e="";if(this.checkOmnisearchStatus()){let n=await this.db.searchHistory.toArray();e=n.length!==0?n[n.length-1].query:""}return e}checkOmnisearchStatus(){let e=this.app.plugins.plugins.omnisearch,n=!0;return e?e._loaded||(new jr.Notice("Omnisearch is installed but not enabled"),n=!1):(new jr.Notice("Omnisearch isn't installed"),n=!1),n}};_t.DB_VERSION=8,_t=W([(0,nc.singleton)()],_t);var rc=Te(Fe());var $n=class{constructor(){this.privacyModeEnabled=!1}togglePrivacyMode(){this.privacyModeEnabled=!this.privacyModeEnabled,this.privacyModeEnabled?document.body.classList.add("cs-privacy-blur"):document.body.classList.remove("cs-privacy-blur")}};$n=W([(0,rc.singleton)()],$n);var ic=Te(Fe());var Vn=class{async createChildThreads(){if(mt)M.warn("web worker only enabled on dev environment now");else return;M.debug("init child threads...");let e=O(et).obsidianFs,n=".obsidian/plugins/clever-search/cs-search-worker.js";try{let r=await e.readBinary(n);M.debug(`worker script size (6x bigger than in production build): ${(r.byteLength/1e3).toFixed(2)} KB`);let i=new Blob([r],{type:"text/javascript"}),s=URL.createObjectURL(i);this.worker=new Worker(s),this.worker.addEventListener("message",o=>{console.log(`Received from worker:
`,o.data)})}catch(r){console.error("Error initializing worker:",r)}}async testTickToken(){var e;(e=this.worker)==null||e.postMessage("tikToken")}};Vn=W([(0,ic.singleton)()],Vn);var cc=Te(Fe());var it=require("obsidian");var vn=Te(Fe());var Nr=Te(Fe());var Xt=class{constructor(){this.db=O(ft)}async setMiniSearchData(e){this.db.transaction("rw",this.db.minisearch,async()=>{await this.db.minisearch.clear(),await this.db.minisearch.add({data:e}),M.trace("minisearch data saved")})}async getMiniSearchData(){var e;return((e=(await this.db.minisearch.toArray())[0])==null?void 0:e.data)||null}async setDocumentRefs(e){this.db.transaction("rw",this.db.documentRefs,async()=>{await this.db.documentRefs.clear(),await this.db.documentRefs.bulkAdd(e)})}async getDocumentRefs(){return await this.db.documentRefs.toArray()||null}async setPluginSetting(e){try{return await this.db.transaction("rw",this.db.pluginSetting,()=>{this.db.pluginSetting.clear(),this.db.pluginSetting.add({data:e})}),M.trace("settings have been saved to database"),!0}catch(n){return M.trace(`settings failed to be saved: ${n}`),!1}}async deleteOldDatabases(){let e=(await indexedDB.databases()).filter(n=>n.name===this.db.dbName&&n.version!==this.db.dbVersion*10);if(e.length){M.trace("Those IndexedDb databases will be deleted:");for(let n of e)n.name&&indexedDB.deleteDatabase(n.name)}}};W([ze],Xt.prototype,"getMiniSearchData",1),W([ze],Xt.prototype,"getDocumentRefs",1),Xt=W([(0,Nr.singleton)()],Xt);var ft=class extends ct{constructor(n){super(ft.dbNamePrefix+n.getAppId());this.privateApi=n,this.version(ft._dbVersion).stores({pluginSetting:"++id",minisearch:"++id",documentRefs:"++id"})}get dbVersion(){return ft._dbVersion}get dbName(){return ft.dbNamePrefix+this.privateApi.getAppId()}};ft._dbVersion=1,ft.dbNamePrefix="clever-search/",ft=W([(0,Nr.singleton)(),Xr(0,(0,Nr.inject)(ut))],ft);var Aa=class{constructor(){this.listeners=new Map}on(e,n){var r;this.listeners.has(e)||this.listeners.set(e,[]),(r=this.listeners.get(e))==null||r.push(n)}off(e,n){let r=this.listeners.get(e);if(r){let i=r.indexOf(n);i>-1&&r.splice(i,1)}}emit(e,...n){var r;(r=this.listeners.get(e))==null||r.forEach(i=>{i(...n)})}},Dt=new Aa;var uc=Te(Fe());var sc=require("obsidian"),Kn=class extends sc.Notice{constructor(e,n=0){super(e+`
(clever-search)`,n)}},Sa=class{},Iv=new Sa;var oc=require("obsidian");var ac=Te(Fe());var mn=class{constructor(){this.dataManager=O(rt);this.app=O(oc.App);this.onCreate=e=>{M.debug(`created: ${e.path}`),this.dataManager.receiveDocOperation(new gn(e))};this.onDelete=e=>{M.debug(`deleted: ${e.path}`),this.dataManager.receiveDocOperation(new yn(e.path))};this.onRename=(e,n)=>{M.debug(`renamed: ${n} => ${e.path}`),this.dataManager.receiveDocOperation(new yn(n)),this.dataManager.receiveDocOperation(new gn(e))};this.onModify=e=>{M.debug(`modified: ${e.path}`),this.dataManager.receiveDocOperation(new yn(e.path)),this.dataManager.receiveDocOperation(new gn(e))}}start(){this.stop(),this.app.vault.on("create",this.onCreate),this.app.vault.on("delete",this.onDelete),this.app.vault.on("rename",this.onRename),this.app.vault.on("modify",this.onModify),M.trace("FileWatcher started")}stop(){this.app.vault.off("create",this.onCreate),this.app.vault.off("delete",this.onDelete),this.app.vault.off("rename",this.onRename),this.app.vault.off("modify",this.onModify)}};mn=W([(0,ac.singleton)()],mn);var rt=class{constructor(){this.database=O(Xt);this.dataProvider=O(et);this.lexicalEngine=O(Je);this.shouldForceRefresh=!1;this.isLexicalEngineUpToDate=!1;this.docOperationsHandler=async e=>{e.sort((n,r)=>n.time-r.time);for(let n of e)if(n instanceof gn)await this.addDocuments([n.file]);else if(n instanceof yn)await this.deleteDocuments([n.path]);else throw Error(vl)};this.docOperationsBuffer=new Ei(this.docOperationsHandler,e=>e.path+e.type,3)}async initAsync(){await this.initLexicalEngines(),await this.updateDocRefsByMtime(),this.shouldForceRefresh||(Dt.on(7,()=>this.docOperationsBuffer.flush()),O(mn).start()),await this.database.setMiniSearchData(this.lexicalEngine.filesIndex.toJSON())}onunload(){O(mn).stop()}receiveDocOperation(e){this.docOperationsBuffer.add(e)}async forceRefreshAll(){let e=new Kn("Reindexing...");this.shouldForceRefresh=!0,await this.initAsync(),e.hide(),new Kn("Indexing finished",5e3),this.shouldForceRefresh=!1}async addDocuments(e){let n=await this.dataProvider.generateAllIndexedDocuments(e.filter(r=>this.dataProvider.isIndexable(r)));await this.lexicalEngine.addDocuments(n)}async deleteDocuments(e){this.lexicalEngine.deleteDocuments(e.filter(n=>this.dataProvider.isIndexable(n)))}async initLexicalEngines(){M.trace("Init lexical engine...");let e;if(!ir.loadIndexFromDatabase||this.shouldForceRefresh?e=null:e=await this.database.getMiniSearchData(),e)M.trace("Previous minisearch data is found."),await this.lexicalEngine.reIndexAll(e);else{M.trace("Indexing the whole vault...");let n=this.dataProvider.allFilesToBeIndexed(),r=0;for(let s of n)r+=s.stat.size;if(r/=1024,r>2e3){let s=(r/1024).toFixed(2)+" MB";new Kn(`${s} files needs to be indexed. Obsidian may freeze for a while`,7e3)}let i=await this.dataProvider.generateAllIndexedDocuments(n);await this.lexicalEngine.reIndexAll(i),this.isLexicalEngineUpToDate=!0}M.trace("Lexical engine is ready")}async updateDocRefsByMtime(){var e;if(!this.isLexicalEngineUpToDate){let n=new Map(this.dataProvider.allFilesToBeIndexed().map(a=>[a.path,a])),r=new Map((e=await this.database.getDocumentRefs())==null?void 0:e.map(a=>[a.path,a])),i=[],s=[];for(let[a,l]of n){let u=r.get(a);u?l.stat.mtime>u.lexicalMtime&&(s.push(l.path),i.push(l)):i.push(l)}for(let a of r.keys())n.has(a)||s.push(a);M.trace(`docs to delete: ${s.length}`),M.trace(`docs to add: ${i.length}`),await this.deleteDocuments(s),await this.addDocuments(i);let o=Array.from(n.values()).map(a=>({path:a.path,lexicalMtime:a.stat.mtime,embeddingMtime:a.stat.mtime}));this.database.setDocumentRefs(o),M.trace(`${o.length} doc refs updated`),this.isLexicalEngineUpToDate=!0}}};W([ze],rt.prototype,"initAsync",1),rt=W([(0,uc.singleton)()],rt);var is=class{constructor(e,n){this.time=performance.now();this.type=e,typeof n=="string"?this.path=n:this.path=n.path}},gn=class extends is{constructor(n){super("add",n);this.file=n}},yn=class extends is{constructor(e){super("delete",e)}};var Yt=class{constructor(){this.plugin=O(an)}async initAsync(){await this.loadSettings(),vn.container.register(Re,{useValue:this.setting}),this.plugin.addSettingTab(O(Br))}async loadSettings(){this.setting=Object.assign({},wl,await this.plugin.loadData()),M.setLevel(this.setting.logLevel)}async saveSettings(){await this.plugin.saveData(this.setting)}};Yt=W([(0,vn.singleton)()],Yt);var Br=class extends it.PluginSettingTab{constructor(n){super(n.app,n);this.settingManager=O(Yt);this.setting=O(Re);this.shouldDownloadAndRefreshIndex=!1}hide(){this.shouldDownloadAndRefreshIndex?(this.shouldDownloadAndRefreshIndex=!1,this.saveSettingDownloadRefresh()):this.settingManager.saveSettings()}display(){let{containerEl:n}=this;n.empty(),new it.Setting(n).setName("Max item results").setDesc("Due to renderer's limited capabilities, this plugin can find thousands of results, but cannot display them all at once").addSlider(a=>a.setLimits(1,300,1).setValue(this.setting.ui.maxItemResults).setDynamicTooltip().onChange(async l=>{this.setting.ui.maxItemResults=l,await this.settingManager.saveSettings()})),new it.Setting(n).setName("English word blacklist").setDesc(`Exclude some meaningless English words like "do", "and", "them" from indexing, enhancing search and indexing speed. Modify the file at ${Il} to tailor the list to your needs.`).addToggle(a=>a.setValue(this.setting.enableStopWordsEn).onChange(async l=>{this.setting.enableStopWordsEn=l,this.shouldDownloadAndRefreshIndex=!0})),new it.Setting(n).setName("Chinese Patch").setDesc("Better search result for Chinese").addToggle(a=>a.setValue(this.setting.enableChinesePatch).onChange(async l=>{this.setting.enableChinesePatch=l,M.info(`enable chinese: ${O(Re).enableChinesePatch}`),this.shouldDownloadAndRefreshIndex=!0})),new it.Setting(n).setName("Chinese word blacklist").setDesc(`Activates only if the Chinese Patch is enabled. This excludes some meaningless Chinese words like "\u7684", "\u6240\u4EE5", "\u5C3D\u7BA1" listed in 'stop-words-zh.txt', improving search efficiency and speed. More details are listed in 'English word blacklist' option`).addToggle(a=>a.setValue(this.setting.enableStopWordsZh).onChange(async l=>{this.setting.enableStopWordsZh=l,this.shouldDownloadAndRefreshIndex=!0}));let r=n.createDiv("cs-dev-setting-group"),i=r.createDiv({cls:"cs-setting-group-dev-title",text:"For Development"}),s=r.createDiv({cls:"cs-setting-group-dev-content"}),o=this.setting.ui.collapseDevSettingByDefault;s.style.display=o?"none":"block",i.style.setProperty("--cs-dev-collapse-icon",o?So:To),i.onclick=()=>{let a=s.style.display==="none";s.style.display=a?"block":"none",i.style.setProperty("--cs-dev-collapse-icon",a?To:So)},new it.Setting(s).setName("Collapse development setting by default").addToggle(a=>a.setValue(this.setting.ui.collapseDevSettingByDefault).onChange(async l=>{this.setting.ui.collapseDevSettingByDefault=l})),new it.Setting(s).setName("Support the Project").setDesc("Enjoying this plugin? Show your support with a star on GitHub!").addButton(a=>{a.setButtonText("Visit GitHub").onClick(()=>{window.open("https://github.com/yan42685/obsidian-clever-search","_blank")})}),new it.Setting(s).setName("API provider1").setDesc("domain and key").addText(a=>a.setPlaceholder("api.openai.com").setValue(this.setting.apiProvider1.domain).onChange(l=>{this.setting.apiProvider1.domain=l,this.settingManager.saveSettings()})).addText(a=>a.setPlaceholder("API key").setValue(this.setting.apiProvider1.key).onChange(l=>{this.setting.apiProvider1.key=l,this.settingManager.saveSettings()})),new it.Setting(s).setName("API provider2").setDesc("description").addText(a=>a.setPlaceholder("api.openai.com").setValue(this.setting.apiProvider2.domain).onChange(l=>{this.setting.apiProvider2.domain=l,this.settingManager.saveSettings()})).addText(a=>a.setPlaceholder("API key").setValue(this.setting.apiProvider2.key).onChange(l=>{this.setting.apiProvider2.key=l,this.settingManager.saveSettings()})),new it.Setting(s).setName("Force Refresh Index").setDesc("Reindex your vault").addButton(a=>{a.setButtonText("Force Refresh").onClick(async()=>{await O(rt).forceRefreshAll()})}),new it.Setting(s).setName("Log level").setDesc("Select the log level.").addDropdown(a=>a.addOptions({trace:"trace",debug:"debug",info:"info",warn:"warn",error:"error",none:"none"}).setValue(this.setting.logLevel.toLowerCase()).onChange(async l=>{let u=l;M.setLevel(u),this.setting.logLevel=u,await this.settingManager.saveSettings()}))}async saveSettingDownloadRefresh(){await O(Yt).saveSettings(),await O(Ze).initAsync(),this.setting.enableChinesePatch&&await O(gt).initAsync(),await O(rt).forceRefreshAll()}};Br=W([(0,vn.singleton)(),Xr(0,(0,vn.inject)(an))],Br);var _n=class{async onload(){await O(Yt).initAsync();let e=O(Re);await O(Ze).initAsync(),e.enableChinesePatch&&await O(gt).initAsync(),await O(Vn).createChildThreads()}async onLayoutReady(){await O(rt).initAsync(),await O(_t).initAsync()}onunload(){O(rt).onunload()}};_n=W([(0,cc.singleton)()],_n);var Oc=require("obsidian");function Rt(){}function Pa(t){return t()}function fc(){return Object.create(null)}function jt(t){t.forEach(Pa)}function ss(t){return typeof t=="function"}function dc(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function pc(t){return Object.keys(t).length===0}var mc=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global,$r=class{constructor(e){this.options=e,this._listeners="WeakMap"in mc?new WeakMap:void 0}observe(e,n){return this._listeners.set(e,n),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!==null&&e!==void 0?e:this._observer=new ResizeObserver(n=>{var r;for(let i of n)$r.entries.set(i.target,i),(r=this._listeners.get(i.target))===null||r===void 0||r(i)})}};$r.entries="WeakMap"in mc?new WeakMap:void 0;var gc=!1;function rm(){gc=!0}function im(){gc=!1}function Be(t,e){t.appendChild(e)}function yc(t,e,n){let r=sm(t);if(!r.getElementById(e)){let i=ke("style");i.id=e,i.textContent=n,om(r,i)}}function sm(t){if(!t)return document;let e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function om(t,e){return Be(t.head||t,e),e.sheet}function ht(t,e,n){t.insertBefore(e,n||null)}function st(t){t.parentNode&&t.parentNode.removeChild(t)}function Ia(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function ke(t){return document.createElement(t)}function am(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function ls(t){return document.createTextNode(t)}function Gn(){return ls(" ")}function Ma(){return ls("")}function Qt(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function De(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function lm(t){return Array.from(t.childNodes)}function vc(t,e){e=""+e,t.data!==e&&(t.data=e)}function ka(t,e){t.value=e==null?"":e}function Kr(t,e,n){t.classList[n?"add":"remove"](e)}var os=class{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,n,r=null){this.e||(this.is_svg?this.e=am(n.nodeName):this.e=ke(n.nodeType===11?"TEMPLATE":n.nodeName),this.t=n.tagName!=="TEMPLATE"?n:n.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)ht(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(st)}};var Vr;function zr(t){Vr=t}function um(){if(!Vr)throw new Error("Function called outside component initialization");return Vr}function Oa(t){um().$$.on_destroy.push(t)}var Hn=[];var qn=[],Wn=[],hc=[],_c=Promise.resolve(),Ca=!1;function bc(){Ca||(Ca=!0,_c.then(wc))}function Ur(){return bc(),_c}function Fa(t){Wn.push(t)}var Ta=new Set,Un=0;function wc(){if(Un!==0)return;let t=Vr;do{try{for(;Un<Hn.length;){let e=Hn[Un];Un++,zr(e),cm(e.$$)}}catch(e){throw Hn.length=0,Un=0,e}for(zr(null),Hn.length=0,Un=0;qn.length;)qn.pop()();for(let e=0;e<Wn.length;e+=1){let n=Wn[e];Ta.has(n)||(Ta.add(n),n())}Wn.length=0}while(Hn.length);for(;hc.length;)hc.pop()();Ca=!1,Ta.clear(),zr(t)}function cm(t){if(t.fragment!==null){t.update(),jt(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Fa)}}function fm(t){let e=[],n=[];Wn.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Wn=e}var hm=new Set;function dm(t,e){t&&t.i&&(hm.delete(t),t.i(e))}var pm=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],g_=new Set([...pm]);function mm(t,e,n,r){let{fragment:i,after_update:s}=t.$$;i&&i.m(e,n),r||Fa(()=>{let o=t.$$.on_mount.map(Pa).filter(ss);t.$$.on_destroy?t.$$.on_destroy.push(...o):jt(o),t.$$.on_mount=[]}),s.forEach(Fa)}function xc(t,e){let n=t.$$;n.fragment!==null&&(fm(n.after_update),jt(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function gm(t,e){t.$$.dirty[0]===-1&&(Hn.push(t),bc(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ec(t,e,n,r,i,s,o,a=[-1]){let l=Vr;zr(t);let u=t.$$={fragment:null,ctx:[],props:s,update:Rt,not_equal:i,bound:fc(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:fc(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(u.root);let c=!1;if(u.ctx=n?n(t,e.props||{},(f,h,...d)=>{let p=d.length?d[0]:h;return u.ctx&&i(u.ctx[f],u.ctx[f]=p)&&(!u.skip_bound&&u.bound[f]&&u.bound[f](p),c&&gm(t,f)),h}):[],u.update(),c=!0,jt(u.before_update),u.fragment=r?r(u.ctx):!1,e.target){if(e.hydrate){rm();let f=lm(e.target);u.fragment&&u.fragment.l(f),f.forEach(st)}else u.fragment&&u.fragment.c();e.intro&&dm(t.$$.fragment),mm(t,e.target,e.anchor,e.customElement),im(),wc()}zr(l)}var ym;typeof HTMLElement=="function"&&(ym=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){let{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(Pa).filter(ss);for(let e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){jt(this.$$.on_disconnect)}$destroy(){xc(this,1),this.$destroy=Rt}$on(t,e){if(!ss(e))return Rt;let n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{let r=n.indexOf(e);r!==-1&&n.splice(r,1)}}$set(t){this.$$set&&!pc(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});var as=class{$destroy(){xc(this,1),this.$destroy=Rt}$on(e,n){if(!ss(n))return Rt;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{let i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!pc(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};function bn(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(f){o(f)}}function l(c){try{u(r.throw(c))}catch(f){o(f)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((r=r.apply(t,e||[])).next())})}var Hr=require("obsidian");var Sc=Te(Fe());var Xn=class{constructor(){this.app=O(Hr.App);this.privateApi=O(ut);this.setting=O(Re)}updateSubItemIndex(e,n,r){let i=e[n],s=e.length-1;return this.scrollTo("center",i,"auto"),r==="next"?n<s?n+1:n:n>0?n-1:n}async handleConfirmAsync(e,n,r,i){if(e.close(),r)if(n===1){let s=r;this.jumpInFile(s.line.row,s.line.col)}else if(n===2){let s=r,o=s.fileType;if(i!==-1){let a=s.subItems[i];if(o===0)await this.jumpInVaultAsync(s.path,a.row,a.col);else throw Error("unsupported filetype to jump")}}else throw Error(`unsupported search type to jump ${n}`)}scrollTo(e,n,r){n&&n.element&&n.element.scrollIntoView({behavior:r,block:e})}jumpInFile(e,n){this.scrollIntoViewForExistingView(e,n)}async jumpInVaultAsync(e,n,r){let i=!1;this.app.workspace.iterateAllLeaves(s=>{var o;((o=s.getViewState().state)==null?void 0:o.file)===e&&(this.app.workspace.setActiveLeaf(s,{focus:!0}),i=!0)}),i?this.scrollIntoViewForExistingView(n,r):(await this.app.workspace.openLinkText(e,"",this.setting.ui.openInNewPane),this.scrollIntoViewForExistingView(n,r))}scrollIntoViewForExistingView(e,n){this.privateApi.executeCommandById("editor:focus");let r=this.app.workspace.getActiveViewOfType(Hr.MarkdownView),i={line:e,ch:n};r?(r.editor.setCursor(i),r.editor.scrollIntoView({from:i,to:i},!0)):M.info("No view to jump")}scrollIntoViewForNewTab(e,n){let r=this.app.workspace.getActiveViewOfType(Hr.MarkdownView);r&&(r.editor.setCursor({line:e,ch:n}),r.editor.scrollIntoView({from:{line:e-10,ch:0},to:{line:e+10,ch:0}}))}};Xn=W([(0,Sc.singleton)()],Xn);function vm(t){yc(t,"svelte-dvs2du",`.search-container.svelte-dvs2du.svelte-dvs2du.svelte-dvs2du{display:flex;white-space:pre-wrap;overflow-wrap:break-word}.search-container mark{background-color:var(--cs-highlight-bgc, rgba(219, 204, 149, 0.9));color:var(--cs-highlight-char-color, #111)}.left-pane.svelte-dvs2du.svelte-dvs2du.svelte-dvs2du{display:flex;flex-direction:column;align-items:left;width:40%}.search-bar.svelte-dvs2du.svelte-dvs2du.svelte-dvs2du{position:sticky;top:-0.2em;left:0;width:97%;height:30px}.search-bar.svelte-dvs2du.svelte-dvs2du.svelte-dvs2du::after{content:attr(data-match-count);position:absolute;right:0.6em;top:1.4em;font-size:0.8em;transform:translateY(-50%);color:var(--cs-hint-char-color, grey)}.search-bar.svelte-dvs2du input.svelte-dvs2du.svelte-dvs2du{width:100%;padding:8px 12px;border:none;border-radius:10px;background-color:var(--cs-search-bar-bgc, #20202066);box-shadow:0 2px 4px rgba(0, 0, 0, 0.18),\r
			0 2px 3px rgba(0, 0, 0, 0.26)}.result-items.svelte-dvs2du.svelte-dvs2du.svelte-dvs2du{display:flex;flex-direction:column;height:70vh;margin-top:0.15em}.result-items.svelte-dvs2du ul.svelte-dvs2du.svelte-dvs2du{padding:0 0.5em 0 0;margin-bottom:0;width:97%;overflow-x:hidden}.result-items.svelte-dvs2du ul.svelte-dvs2du button.svelte-dvs2du{align-items:center;justify-content:left;padding:0.65em;margin:0.5em 0 0 0.15em;width:25.35vw;height:fit-content;text-align:left;background-color:var(--cs-pane-bgc, #20202066);border-radius:4px;cursor:pointer}.result-items.svelte-dvs2du ul.svelte-dvs2du button.svelte-dvs2du:hover,.result-items.svelte-dvs2du ul.svelte-dvs2du button.selected.svelte-dvs2du{background-color:var(--cs-item-selected-color, rgba(85, 85, 85, 0.35))}.result-items.svelte-dvs2du ul button .line-item.svelte-dvs2du.svelte-dvs2du,.result-items.svelte-dvs2du ul button .file-item.svelte-dvs2du.svelte-dvs2du{text-wrap:wrap;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}.result-items.svelte-dvs2du ul button .file-item.svelte-dvs2du.svelte-dvs2du{-webkit-line-clamp:6}.result-items.svelte-dvs2du ul button .file-item span.filename.svelte-dvs2du.svelte-dvs2du{margin-top:-0.2em;display:block}.result-items.svelte-dvs2du ul button .file-item span.file-folder-path.svelte-dvs2du.svelte-dvs2du{color:var(--cs-secondary-font-color, #a29c9c);display:block}.right-pane.svelte-dvs2du.svelte-dvs2du.svelte-dvs2du{background-color:var(--cs-pane-bgc, #20202066);border-radius:6px;height:73.97vh;width:60%}.right-pane.svelte-dvs2du .preview-container.svelte-dvs2du.svelte-dvs2du{margin:0.7em 0 0 0.7em;height:72.5vh;overflow-y:auto}.right-pane.svelte-dvs2du .preview-container p.svelte-dvs2du.svelte-dvs2du,.right-pane.svelte-dvs2du .preview-container ul.svelte-dvs2du.svelte-dvs2du{margin:0;padding:0;overflow-x:hidden}.right-pane.svelte-dvs2du .preview-container p.svelte-dvs2du.svelte-dvs2du{width:39.7vw}.right-pane.svelte-dvs2du .preview-container ul button.file-sub-item.svelte-dvs2du.svelte-dvs2du{text-wrap:wrap;display:block;text-overflow:ellipsis;justify-content:left;margin-bottom:1em;height:fit-content;width:39.2vw;text-align:left;background-color:var(--cs-pane-bgc, #20202066);border-radius:4px;font-size:medium}.right-pane.svelte-dvs2du .preview-container ul button.file-sub-item.selected.svelte-dvs2du.svelte-dvs2du{background-color:var(--cs-item-selected-color, rgba(85, 85, 85, 0.35))}.right-pane.svelte-dvs2du .preview-container.svelte-dvs2du span.matched-line{display:inline-block;width:100%}.right-pane.svelte-dvs2du .preview-container.svelte-dvs2du span.matched-line.highlight-bg{background-color:var(--cs-hint-char-color, #468eeb33)}`)}function Tc(t,e,n){let r=t.slice();return r[35]=e[n],r[36]=e,r[37]=n,r}function Cc(t,e,n){let r=t.slice();return r[38]=e[n],r[39]=e,r[37]=n,r}function _m(t){let e,n,r=t[38].basename+Co+(t[38].extension==="md"?"":t[38].extension)+"",i,s,o=t[38].folderPath+"",a;return{c(){e=ke("span"),n=ke("span"),i=Gn(),s=ke("span"),a=ls(o),De(n,"class","filename svelte-dvs2du"),De(s,"class","file-folder-path svelte-dvs2du"),De(e,"class","file-item svelte-dvs2du")},m(l,u){ht(l,e,u),Be(e,n),n.innerHTML=r,Be(e,i),Be(e,s),Be(s,a)},p(l,u){u[0]&4&&r!==(r=l[38].basename+Co+(l[38].extension==="md"?"":l[38].extension)+"")&&(n.innerHTML=r),u[0]&4&&o!==(o=l[38].folderPath+"")&&vc(a,o)},d(l){l&&st(e)}}}function bm(t){let e,n=t[38].line.text+"";return{c(){e=ke("span"),De(e,"class","line-item svelte-dvs2du")},m(r,i){ht(r,e,i),e.innerHTML=n},p(r,i){i[0]&4&&n!==(n=r[38].line.text+"")&&(e.innerHTML=n)},d(r){r&&st(e)}}}function Fc(t){let e,n,r=t[39],i=t[37],s,o;function a(p,m){if(p[38]instanceof zt)return bm;if(p[38]instanceof Cn)return _m}let l=a(t,[-1,-1]),u=l&&l(t),c=()=>t[18](e,r,i),f=()=>t[18](null,r,i);function h(...p){return t[19](t[37],...p)}function d(...p){return t[20](t[37],...p)}return{c(){e=ke("button"),u&&u.c(),n=Gn(),De(e,"class","svelte-dvs2du"),Kr(e,"selected",t[37]===t[3])},m(p,m){ht(p,e,m),u&&u.m(e,null),Be(e,n),c(),s||(o=[Qt(e,"click",h),Qt(e,"contextmenu",d)],s=!0)},p(p,m){t=p,l===(l=a(t,m))&&u?u.p(t,m):(u&&u.d(1),u=l&&l(t),u&&(u.c(),u.m(e,n))),(r!==t[39]||i!==t[37])&&(f(),r=t[39],i=t[37],c()),m[0]&8&&Kr(e,"selected",t[37]===t[3])},d(p){p&&st(e),u&&u.d(),f(),s=!1,jt(o)}}}function wm(t){let e;function n(s,o){return s[5]&&s[5].fileType===0?Am:Em}let r=n(t,[-1,-1]),i=r(t);return{c(){i.c(),e=Ma()},m(s,o){i.m(s,o),ht(s,e,o)},p(s,o){r===(r=n(s,o))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(e.parentNode,e)))},d(s){i.d(s),s&&st(e)}}}function xm(t){let e,n=t[4]&&Ic(t);return{c(){n&&n.c(),e=Ma()},m(r,i){n&&n.m(r,i),ht(r,e,i)},p(r,i){r[4]?n?n.p(r,i):(n=Ic(r),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(r){n&&n.d(r),r&&st(e)}}}function Em(t){let e;return{c(){e=ke("span"),e.textContent=`${mt?"no result or to be impl":"no matched content"}`},m(n,r){ht(n,e,r)},p:Rt,d(n){n&&st(e)}}}function Am(t){let e,n=t[6],r=[];for(let i=0;i<n.length;i+=1)r[i]=Pc(Tc(t,n,i));return{c(){e=ke("ul");for(let i=0;i<r.length;i+=1)r[i].c();De(e,"class","svelte-dvs2du")},m(i,s){ht(i,e,s);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(e,null)},p(i,s){if(s[0]&12480){n=i[6];let o;for(o=0;o<n.length;o+=1){let a=Tc(i,n,o);r[o]?r[o].p(a,s):(r[o]=Pc(a),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d(i){i&&st(e),Ia(r,i)}}}function Pc(t){let e,n,r=t[35].text+"",i,s=t[36],o=t[37],a,l;function u(...d){return t[21](t[37],...d)}function c(...d){return t[22](t[37],...d)}let f=()=>t[23](e,s,o),h=()=>t[23](null,s,o);return{c(){e=ke("button"),n=new os(!1),i=Gn(),n.a=i,De(e,"class","file-sub-item svelte-dvs2du"),Kr(e,"selected",t[37]===t[7])},m(d,p){ht(d,e,p),n.m(r,e),Be(e,i),f(),a||(l=[Qt(e,"click",u),Qt(e,"contextmenu",c)],a=!0)},p(d,p){t=d,p[0]&64&&r!==(r=t[35].text+"")&&n.p(r),(s!==t[36]||o!==t[37])&&(h(),s=t[36],o=t[37],f()),p[0]&128&&Kr(e,"selected",t[37]===t[7])},d(d){d&&st(e),h(),a=!1,jt(l)}}}function Ic(t){let e;return{c(){e=ke("p"),De(e,"class","svelte-dvs2du")},m(n,r){ht(n,e,r),e.innerHTML=t[4]},p(n,r){r[0]&16&&(e.innerHTML=n[4])},d(n){n&&st(e)}}}function Sm(t){let e,n,r,i,s,o,a,l,u,c,f,h,d=t[2].items,p=[];for(let v=0;v<d.length;v+=1)p[v]=Fc(Cc(t,d,v));function m(v,w){if(v[1]===1)return xm;if(v[1]===2)return wm}let y=m(t,[-1,-1]),g=y&&y(t);return{c(){e=ke("div"),n=ke("div"),r=ke("div"),i=ke("input"),s=Gn(),o=ke("div"),a=ke("ul");for(let v=0;v<p.length;v+=1)p[v].c();l=Gn(),u=ke("div"),c=ke("div"),g&&g.c(),De(i,"class","svelte-dvs2du"),De(r,"class","search-bar svelte-dvs2du"),De(r,"data-match-count",t[9]),De(a,"class","svelte-dvs2du"),De(o,"class","result-items svelte-dvs2du"),De(n,"class","left-pane svelte-dvs2du"),De(c,"class","preview-container svelte-dvs2du"),De(u,"class","right-pane svelte-dvs2du"),De(e,"class","search-container svelte-dvs2du")},m(v,w){ht(v,e,w),Be(e,n),Be(n,r),Be(r,i),ka(i,t[0]),t[16](i),Be(n,s),Be(n,o),Be(o,a);for(let _=0;_<p.length;_+=1)p[_]&&p[_].m(a,null);Be(e,l),Be(e,u),Be(u,c),g&&g.m(c,null),f||(h=[Qt(i,"input",t[15]),Qt(i,"input",t[10]),Qt(i,"blur",t[17])],f=!0)},p(v,w){if(w[0]&1&&i.value!==v[0]&&ka(i,v[0]),w[0]&512&&De(r,"data-match-count",v[9]),w[0]&10252){d=v[2].items;let _;for(_=0;_<d.length;_+=1){let A=Cc(v,d,_);p[_]?p[_].p(A,w):(p[_]=Fc(A),p[_].c(),p[_].m(a,null))}for(;_<p.length;_+=1)p[_].d(1);p.length=d.length}y===(y=m(v,w))&&g?g.p(v,w):(g&&g.d(1),g=y&&y(v),g&&(g.c(),g.m(c,null)))},i:Rt,o:Rt,d(v){v&&st(e),t[16](null),Ia(p,v),g&&g.d(),f=!1,jt(h)}}}function Tm(t,e,n){let r,i=O(yt),s=O(Xn),{modal:o}=e,{searchType:a}=e,{queryText:l}=e,u=new Map,c=new Bt("",[]),f=-1,h="",d=null,p=[],m,y=-1,g;function v(x){return bn(this,void 0,void 0,function*(){yield Ur();let P=c.items;if(x>=0&&x<P.length){if(n(3,f=x),a===1){let j=P[x];n(4,h=j.context)}else if(a===2)n(5,d=P[x]),n(5,d.subItems=yield i.getFileSubItems(l,d),d),n(6,p=d.subItems),n(7,y=0),yield Ur(),s.scrollTo("start",p[y],"instant");else throw Error(`unsupported search type: ${a}`);yield Ur(),s.scrollTo("center",P[x],"smooth")}else n(4,h=""),n(5,d=null),n(6,p=[]),n(3,f=-1)})}let w=iu(100,()=>_());function _(){return bn(this,void 0,void 0,function*(){if(u.has(l)){n(2,c=u.get(l)),yield v(0);return}if(a===1)n(2,c=yield i.searchInFile(l));else if(a===2)n(2,c=yield i.searchInVault(l));else throw Error(An);u.set(l,c),yield v(0)})}function A(x){return bn(this,void 0,void 0,function*(){yield v(x)})}function T(){return bn(this,void 0,void 0,function*(){yield v(Math.min(f+1,c.items.length-1))})}function C(){return bn(this,void 0,void 0,function*(){yield v(Math.max(f-1,0))})}function F(x){n(7,y=x)}function R(){n(7,y=s.updateSubItemIndex(p,y,"next"))}function N(){n(7,y=s.updateSubItemIndex(p,y,"prev"))}function L(){return bn(this,void 0,void 0,function*(){let x=c.items[f];yield s.handleConfirmAsync(o,a,x,y)})}function B(x,P){Dt.on(x,P),Oa(()=>Dt.off(x,P))}B(2,T),B(4,C),B(3,R),B(5,N),B(6,L),_();function D(){l=this.value,n(0,l)}function K(x){qn[x?"unshift":"push"](()=>{g=x,n(8,g)})}let ee=()=>setTimeout(()=>g==null?void 0:g.focus(),1);function Q(x,P,j){qn[x?"unshift":"push"](()=>{P[j].element=x,n(2,c)})}let ae=(x,P)=>{A(x)},le=async(x,P)=>{P.preventDefault(),await A(x),await L()},xe=(x,P)=>F(x),ot=(x,P)=>{P.preventDefault(),n(7,y=x),L()};function ue(x,P,j){qn[x?"unshift":"push"](()=>{P[j].element=x,n(6,p)})}return t.$$set=x=>{"modal"in x&&n(14,o=x.modal),"searchType"in x&&n(1,a=x.searchType),"queryText"in x&&n(0,l=x.queryText)},t.$$.update=()=>{if(t.$$.dirty[0]&12){e:n(9,r=`${f+1} / ${c.items.length}`)}},[l,a,c,f,h,d,p,y,g,r,w,A,F,L,o,D,K,ee,Q,ae,le,xe,ot,ue]}var La=class extends as{constructor(e){super(),Ec(this,e,Tm,Sm,dc,{modal:14,searchType:1,queryText:0},vm,[-1,-1])}},Mc=La;var Yn=class extends Oc.Modal{constructor(n,r,i){var a;super(n);Dt.emit(7);let s=((a=window.getSelection())==null?void 0:a.toString())||"",o=i||s;this.modalEl.replaceChildren(),this.modalEl.addClass("cs-modal"),this.mountedElement=new Mc({target:this.modalEl,props:{modal:this,searchType:r,queryText:o||""}}),this.registerHotkeys()}onOpen(){}onClose(){this.modalEl.removeEventListener("contextmenu",kc),this.mountedElement.$destroy(),M.trace("mounted element has been destroyed.")}registerHotkeys(){let n=_l;this.newHotKey([n],"J",2),this.newHotKey([],"ArrowDown",2),this.newHotKey([n],"K",4),this.newHotKey([],"ArrowUp",4),this.newHotKey([n],"N",3),this.newHotKey([n],"P",5),this.newHotKey([],"Enter",6),this.modalEl.addEventListener("contextmenu",kc)}newHotKey(n,r,i){this.scope.register(n,r,Cm(i))}};function Cm(t){return e=>{e.preventDefault(),Dt.emit(t),console.log("emit...")}}function kc(t){t.preventDefault(),Dt.emit(6),console.log("Right-click on button, confirm item event emitted.")}var cs=class extends Ue.Plugin{async onload(){us.container.register(an,{useValue:this}),us.container.register(Ue.App,{useValue:this.app}),us.container.register(Ue.Vault,{useValue:this.app.vault});let e=O(_n);await e.onload(),this.app.workspace.onLayoutReady(()=>{e.onLayoutReady()}),this.registerCommands(),this.addCommand({id:"clever-search-in-vault",name:"Search in Vault",callback:()=>new Yn(this.app,2).open()}),mt&&(this.addCommand({id:"clever-search-triggerTest",name:"clever-search-triggerTest",callback:async()=>await du()}),this.addCommand({id:"cs-open-test-modal",name:"Open test modal",callback:()=>this.openTestModal()}))}onunload(){document.body.classList.remove("cs-privacy-blur"),O(_n).onunload()}openTestModal(){let e=this.app.workspace.getActiveViewOfType(Ue.MarkdownView);if(e){let n="",r=e.contentEl.querySelector(".markdown-source-view");if(r){let s=document.createElement("div");s.appendChild(r.cloneNode(!0)),n=s.innerHTML}new Ra(this.app,n).open()}else throw Error("no active MarkdownView")}registerCommands(){this.addCommand({id:"clever-search-in-file",name:"Search in file",callback:()=>new Yn(this.app,1).open()}),this.addCommand({id:"cs-toggle-privacy-mode",name:"Toggle privacy mode",callback:()=>O($n).togglePrivacyMode()}),this.addCommand({id:"cs-in-file-search-with-omnisearch-query",name:"Search in file with last Omnisearch query",callback:async()=>{new Yn(this.app,1,await O(_t).getLastQuery()).open()}})}exampleCode(){this.addRibbonIcon("dice","Sample Plugin",r=>{new Ue.Notice("This is a notice!")}).addClass("my-plugin-ribbon-class"),this.addStatusBarItem().setText("Status Bar Text"),this.addCommand({id:"open-sample-modal-simple",name:"Open sample modal (simple)",callback:()=>{new Da(this.app).open()}}),this.addCommand({id:"sample-editor-command",name:"Sample editor command",editorCallback:r=>{console.log(r.getSelection()),r.replaceSelection("Sample Editor Command")}}),this.registerDomEvent(document,"click",r=>{console.log("click",r)}),this.registerInterval(window.setInterval(()=>console.log("setInterval"),5*60*1e3))}},Da=class extends Ue.Modal{constructor(e){super(e)}onOpen(){let{contentEl:e}=this;e.setText("Woah!")}onClose(){let{contentEl:e}=this;e.empty()}},Ra=class extends Ue.Modal{constructor(n,r){super(n);this.contentHTML=r}onOpen(){Ue.MarkdownView,Ue.HoverPopover,console.log(this.contentHTML),this.containerEl.style.backgroundColor="black",this.containerEl.innerHTML=this.contentHTML}onClose(){let{contentEl:n}=this;n.empty()}};0&&(module.exports={});
/*! Bundled license information:

tslib/tslib.es6.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

fzf/dist/fzf.es.js:
  (** @license
   * fzf v0.5.2
   * Copyright (c) 2021 Ajit
   * Licensed under BSD 3-Clause
   *)
*/
