/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Ze=Object.create;var D=Object.defineProperty;var Ke=Object.getOwnPropertyDescriptor;var et=Object.getOwnPropertyNames;var tt=Object.getPrototypeOf,rt=Object.prototype.hasOwnProperty;var u=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),nt=(e,r)=>{for(var t in r)D(e,t,{get:r[t],enumerable:!0})},X=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of et(r))!rt.call(e,i)&&i!==t&&D(e,i,{get:()=>r[i],enumerable:!(n=Ke(r,i))||n.enumerable});return e};var it=(e,r,t)=>(t=e!=null?Ze(tt(e)):{},X(r||!e||!e.__esModule?D(t,"default",{value:e,enumerable:!0}):t,e)),ot=e=>X(D({},"__esModule",{value:!0}),e);var C=u((Lr,Q)=>{function st(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}Q.exports=st});var Y=u((kr,J)=>{var at=typeof global=="object"&&global&&global.Object===Object&&global;J.exports=at});var P=u((Er,Z)=>{var ct=Y(),lt=typeof self=="object"&&self&&self.Object===Object&&self,pt=ct||lt||Function("return this")();Z.exports=pt});var ee=u((Or,K)=>{var dt=P(),ut=function(){return dt.Date.now()};K.exports=ut});var re=u((Rr,te)=>{var ft=/\s/;function mt(e){for(var r=e.length;r--&&ft.test(e.charAt(r)););return r}te.exports=mt});var ie=u((jr,ne)=>{var gt=re(),ht=/^\s+/;function vt(e){return e&&e.slice(0,gt(e)+1).replace(ht,"")}ne.exports=vt});var H=u((Dr,oe)=>{var xt=P(),yt=xt.Symbol;oe.exports=yt});var le=u((Ir,ce)=>{var se=H(),ae=Object.prototype,bt=ae.hasOwnProperty,wt=ae.toString,k=se?se.toStringTag:void 0;function Tt(e){var r=bt.call(e,k),t=e[k];try{e[k]=void 0;var n=!0}catch(o){}var i=wt.call(e);return n&&(r?e[k]=t:delete e[k]),i}ce.exports=Tt});var de=u((Mr,pe)=>{var St=Object.prototype,Lt=St.toString;function kt(e){return Lt.call(e)}pe.exports=kt});var ge=u((Fr,me)=>{var ue=H(),Et=le(),Ot=de(),Rt="[object Null]",jt="[object Undefined]",fe=ue?ue.toStringTag:void 0;function Dt(e){return e==null?e===void 0?jt:Rt:fe&&fe in Object(e)?Et(e):Ot(e)}me.exports=Dt});var ve=u((Ar,he)=>{function It(e){return e!=null&&typeof e=="object"}he.exports=It});var ye=u((Cr,xe)=>{var Mt=ge(),Ft=ve(),At="[object Symbol]";function Ct(e){return typeof e=="symbol"||Ft(e)&&Mt(e)==At}xe.exports=Ct});var Se=u((Pr,Te)=>{var Pt=ie(),be=C(),Ht=ye(),we=NaN,qt=/^[-+]0x[0-9a-f]+$/i,Wt=/^0b[01]+$/i,_t=/^0o[0-7]+$/i,zt=parseInt;function Bt(e){if(typeof e=="number")return e;if(Ht(e))return we;if(be(e)){var r=typeof e.valueOf=="function"?e.valueOf():e;e=be(r)?r+"":r}if(typeof e!="string")return e===0?e:+e;e=Pt(e);var t=Wt.test(e);return t||_t.test(e)?zt(e.slice(2),t?2:8):qt.test(e)?we:+e}Te.exports=Bt});var Ee=u((Hr,ke)=>{var Nt=C(),q=ee(),Le=Se(),Vt="Expected a function",Gt=Math.max,$t=Math.min;function Ut(e,r,t){var n,i,o,s,a,c,p=0,w=!1,d=!1,x=!0;if(typeof e!="function")throw new TypeError(Vt);r=Le(r)||0,Nt(t)&&(w=!!t.leading,d="maxWait"in t,o=d?Gt(Le(t.maxWait)||0,r):o,x="trailing"in t?!!t.trailing:x);function O(l){var v=n,L=i;return n=i=void 0,p=l,s=e.apply(L,v),s}function g(l){return p=l,a=setTimeout(h,r),w?O(l):s}function f(l){var v=l-c,L=l-p,U=r-v;return d?$t(U,o-L):U}function R(l){var v=l-c,L=l-p;return c===void 0||v>=r||v<0||d&&L>=o}function h(){var l=q();if(R(l))return y(l);a=setTimeout(h,f(l))}function y(l){return a=void 0,x&&n?O(l):(n=i=void 0,s)}function T(){a!==void 0&&clearTimeout(a),p=0,n=c=i=a=void 0}function j(){return a===void 0?s:y(q())}function A(){var l=q(),v=R(l);if(n=arguments,i=this,c=l,v){if(a===void 0)return g(c);if(d)return clearTimeout(a),a=setTimeout(h,r),O(c)}return a===void 0&&(a=setTimeout(h,r)),s}return A.cancel=T,A.flush=j,A}ke.exports=Ut});var Tr={};nt(Tr,{default:()=>wr});module.exports=ot(Tr);var Ye=it(Ee()),m=require("obsidian");var Oe={max:0,mode:"default"};var Xt=e=>Object.fromEntries(Object.entries(e).map(([r,t])=>r!=="i"&&t&&t!="0"&&[r,t]).filter(Boolean)),Qt=e=>Object.fromEntries(Object.keys(e).map(r=>{let t=e[r];return[r,Array.isArray(t)?t.map(n=>n==null?void 0:n.trim()):t===!!t?t:t==null?void 0:t.trim()]})),Jt=e=>{let[r="",...t]=e.split("|"),[n="",i]=r.split(":"),[o,s]=n.split("?");return{k:o,i,n:s==="",f:t}},je=e=>!!(e.o||e.r),Yt=(e,r)=>{let[t,n]=e.split(":");n||(n=t,t=r);let i=n.split("|"),[o,s,a,c,p,w]=i,d=i.filter(x=>x!==void 0).length;return d===1?{k:t,r:o}:d===2?{k:t,o,r:s}:d===3?{k:t,z:o,o:s,r:a}:{k:t,z:o,o:s,t:a,f:c,m:p,r:w}},De=/^\{.*\}$/,Ie=e=>Object.fromEntries(W(e).split(",").map(r=>r.split(":")).reduce((r,t)=>t.length===2?[...r,t.map(n=>n.trim())]:(r[r.length-1][1]+=","+t[0],r),[])),Re=/(\{(?:[^{}]+|\{(?:[^{}]+)*\})*\})/g,W=e=>e.substring(1,e.length-1),Me=(e,r=!0,t="",n="")=>e.split(Re).map(i=>{if(!i.match(Re))return i;let o=W(i);if(o.startsWith("{"))return Yt(W(o),n);let s=Jt(o);return n=s.k||n,!t&&(t=n),s}).map(i=>{if(typeof i=="string")return i;i.k||(i.k=t||"0");let o=Qt(i);return r?Xt(o):o});var Zt=(e,r,t)=>r.reduce((n,i)=>{var o,s;return(s=i.match(De)?(a=>{var c;return(c=a[n])!==null&&c!==void 0?c:a["*"]})(Ie(i)):(o=e[i])===null||o===void 0?void 0:o.call(e,n))!==null&&s!==void 0?s:n},t),Kt=(e,{z:r,o:t,t:n,f:i,m:o,r:s},a)=>{switch(r&&a==0?"zero":e.select(a)){case"zero":return r;case"one":return t;case"two":return n;case"few":return i!=null?i:s;case"many":return o!=null?o:s;default:return s}},er=/\?\?/g,tr=(e,r,t,n)=>e.map(i=>{if(typeof i=="string")return i;let{k:o="0",f:s=[]}=i,a=n[o];if(je(i))return((typeof a=="boolean"?a?i.o:i.r:Kt(r,i,a))||"").replace(er,a);let c=s.length?Zt(t,s,a):a;return(""+(c!=null?c:"")).trim()}).join(""),_=(e,r,t,n)=>{let i=n[0],o=i&&typeof i=="object"&&i.constructor===Object,s=n.length===1&&o?i:n;return tr(e,r,t,s)};var Fe=(e,r)=>e[r]||(e[r]=Me(r));var rr=(e,r)=>{let t={},n=new Intl.PluralRules(e);return(i,...o)=>_(Fe(t,i),n,r,o)};function I(e,r,t={}){return Ce(r,rr(e,t))}var Ae=(e={},r)=>typeof e=="string"?r.bind(null,e):Object.assign(Object.defineProperty(()=>"","name",{writable:!0}),e),Ce=(e,r)=>new Proxy(Ae(e,r),{get:(t,n)=>n===Symbol.iterator?[][Symbol.iterator].bind(Object.values(t).map(i=>Ae(i,r))):Ce(t[n],r)});var z=(e,r)=>{let t={};return new Proxy({},{get:(n,i)=>t[i]||(t[i]=I(i,e[i],r[i]))})};var ir=(e,r)=>{var n;let t=(n=e==null?void 0:e.split(";").map(i=>i.trim()).find(i=>i.startsWith(r)))==null?void 0:n.split("=")[1];return t?[t]:[]},Pe=(e="lang")=>()=>ir(document==null?void 0:document.cookie,e),or=Pe();var sr=e=>!!e,He=(e="lang")=>()=>{var r;return[(r=window==null?void 0:window.localStorage)==null?void 0:r.getItem(e)].filter(sr)},ar=He();var qe=(e="lang")=>()=>{var t,n;let r=(n=(t=location==null?void 0:location.search)==null?void 0:t.slice(1).split("&").find(i=>i.startsWith(e)))==null?void 0:n.split("=")[1];return r?[r]:[]},cr=qe();var lr=e=>!!e,We=(e="lang")=>()=>{var r;return[(r=window==null?void 0:window.sessionStorage)==null?void 0:r.getItem(e)].filter(lr)},pr=We();var ur=ze;function ze(){var e=[].slice.call(arguments),r=!1;typeof e[0]=="boolean"&&(r=e.shift());var t=e[0];if(_e(t))throw new Error("extendee must be an object");for(var n=e.slice(1),i=n.length,o=0;o<i;o++){var s=n[o];for(var a in s)if(Object.prototype.hasOwnProperty.call(s,a)){var c=s[a];if(r&&fr(c)){var p=Array.isArray(c)?[]:{};t[a]=ze(!0,Object.prototype.hasOwnProperty.call(t,a)&&!_e(t[a])?t[a]:p,c)}else t[a]=c}}return t}function fr(e){return Array.isArray(e)||{}.toString.call(e)=="[object Object]"}function _e(e){return!e||typeof e!="object"&&typeof e!="function"}var B=()=>(e,r)=>ur({},e,r),Fn=B();var Be=["en","zh"];var M={},N={},qn=B();var Ne=()=>z(M,N);var Ve=e=>({});var mr={setting:{mode:{title:"Mode",description:"By default, display the current heading, the parent heading, and the siblings of the parent heading. In concise mode, only display the current heading and the parent heading.",default:"Default",concise:"Concise"},max:{title:"Display quantity limit",description:"Maximum number of headings that can be displayed. 0 indicates no limit."}}},Ge=mr;var gr={setting:{mode:{title:"\u6A21\u5F0F",description:"\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u663E\u793A\u5F53\u524D\u6807\u9898\u3001\u7236\u6807\u9898\u548C\u7236\u6807\u9898\u7684\u5144\u5F1F\u6807\u9898\u3002\u7B80\u6D01\u6A21\u5F0F\u4E0B\uFF0C\u4EC5\u663E\u793A\u5F53\u524D\u6807\u9898\u548C\u7236\u6807\u9898\u3002",default:"\u9ED8\u8BA4",concise:"\u7B80\u6D01"},max:{title:"\u663E\u793A\u6570\u91CF\u9650\u5236",description:"\u6700\u5927\u663E\u793A\u6807\u9898\u6570\u91CF\uFF0C0 \u8868\u793A\u4E0D\u9650\u5236\u3002"}}},$e=gr;var hr={en:Ge,zh:$e},vr=e=>{M[e]||(M[e]=hr[e],xr(e))},Ue=()=>Be.forEach(vr),xr=e=>void(N[e]=Ve(e));Ue();var Xe="en";try{Xe=(window.i18next.language||"").startsWith("zh")?"zh":"en"}catch(e){}var yr=Ne()[Xe],b=yr;var S=require("obsidian");function F(e){return e instanceof S.TFile?["md","markdown"].includes(e.extension):!1}function Qe(e,r){var t,n;return(n=(t=r.metadataCache.getFileCache(e))==null?void 0:t.headings)!=null?n:[]}function Je(e,r){let t=document.createElement("div"),n=r.workspace.getActiveViewOfType(S.MarkdownView);return n?S.MarkdownRenderer.render(r,e,t,"",n).then(()=>t.innerText):(console.warn("No active markdown view is available."),Promise.resolve(e))}function V(e,r,t){if(!e.length)return r;let n=e.reduce((o,s)=>Math.min(o,s.level),6),i=e.reduce((o,s,a)=>(s.level===n&&o.push(a),o),[]);if(t==="concise")i.length>=1&&r.push(e[i[i.length-1]]);else for(let o of i)r.push(e[o]);V(e.slice(i[i.length-1]+1),r,t)}function br(e,r,t){let n=-1;for(let i=r;i>=0;i--)if(t(e[i])){n=i;break}return n}function G(e){let r=[];if(!e.length)return r;let t=e.reduce((n,i,o)=>i.level<e[n].level?o:n,0);return r.push(...G(e.slice(0,t)).map(n=>n+1)),e.slice(t).forEach((n,i,o)=>{if(i===0){r.push(0);return}let s=br(o,i-1,a=>a.level<n.level);s===-1?r.push(0):r.push(r[s+t]+1)}),r}var E=class extends m.Plugin{constructor(){super(...arguments);this.fileResolveMap={};this.markdownCache={};this.detectPosition=(0,Ye.default)(t=>{let n=t.target;if((n==null?void 0:n.classList.contains("cm-scroller"))||(n==null?void 0:n.classList.contains("markdown-preview-view"))){let o=n==null?void 0:n.closest(".view-content");if(o){let s=Object.keys(this.fileResolveMap).filter(a=>this.fileResolveMap[a].container===o);this.updateHeadings(s)}}},20,{leading:!0,trailing:!0})}async onload(){await this.loadSettings(),this.registerEvent(this.app.workspace.on("file-open",t=>{if(t&&F(t)){let n=this.app.workspace.getActiveViewOfType(m.MarkdownView),i=n==null?void 0:n.leaf.id;i&&(i in this.fileResolveMap||(n.onResize=this.makeResize(i)),this.fileResolveMap[i]={resolve:!0,file:t,container:n.contentEl,view:n,lastHeight:0},this.checkFileResolveMap(),this.updateHeadings([i]))}})),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.checkFileResolveMap(),this.updateHeadings(Object.keys(this.fileResolveMap))})),this.registerEvent(this.app.workspace.on("window-open",t=>{this.registerDomEvent(t.doc,"scroll",this.detectPosition,!0)})),this.registerEvent(this.app.workspace.on("active-leaf-change",t=>{t!=null&&t.id&&t.view instanceof m.MarkdownView&&(this.checkFileResolveMap(),this.updateHeadings([t.id]))})),this.registerEvent(this.app.workspace.on("editor-change",(t,n)=>{let{file:i}=n;i&&F(i)&&Object.values(this.fileResolveMap).forEach(o=>{o.file.path===i.path&&(o.resolve=!1)})})),this.registerEvent(this.app.metadataCache.on("resolve",t=>{if(F(t)){let n=[];Object.keys(this.fileResolveMap).forEach(i=>{let o=this.fileResolveMap[i];o.file.path===t.path&&!o.resolve&&(o.resolve=!0,n.push(i))}),n.length>0&&(this.checkFileResolveMap(),this.updateHeadings(n))}})),this.registerDomEvent(document,"scroll",this.detectPosition,!0),this.addSettingTab(new $(this.app,this))}checkFileResolveMap(){let t=[];this.app.workspace.iterateAllLeaves(n=>{if(console.log(n),n.id&&(t.push(n.id),!(n.id in this.fileResolveMap)&&n.view instanceof m.MarkdownView)){let i=n.view.getFile();i&&(this.fileResolveMap[n.id]={resolve:!0,file:i,container:n.view.contentEl,view:n.view,lastHeight:0})}}),Object.keys(this.fileResolveMap).forEach(n=>{t.includes(n)||delete this.fileResolveMap[n]})}makeResize(t){return()=>{this.updateHeadings([t])}}rerenderAll(){this.updateHeadings(Object.keys(this.fileResolveMap))}updateHeadings(t){t.forEach(n=>{let i=this.fileResolveMap[n];if(i){let{file:o,view:s,container:a}=i,c=Qe(o,this.app),p=s.currentMode.getScroll();this.renderHeadings(c,a,p,s,n)}})}async renderHeadings(t=[],n,i,o,s){let a=t.filter(g=>g.position.end.line+1<=i),c=[];a.length&&V(a,c,this.settings.mode);let p=n.querySelector(".sticky-headings-container");if(!p){let g=createDiv({cls:"sticky-headings-root"});p=g.createDiv({cls:"sticky-headings-container"}),n.prepend(g)}p.empty(),this.settings.max&&(c=c.slice(-this.settings.max));let w=G(c);for(let[g,f]of c.entries()){let R=`sticky-headings-item sticky-headings-level-${f.level}`,h=f.heading,y;h in this.markdownCache?y=this.markdownCache[h]:(y=await Je(f.heading,this.app),this.markdownCache[h]=y);let T=createDiv({cls:R,text:y}),j=createDiv({cls:"sticky-headings-icon"});(0,m.setIcon)(j,`heading-${f.level}`),T.prepend(j),T.setAttribute("data-indent-level",`${w[g]}`),p.append(T),T.addEventListener("click",()=>{o.currentMode.applyScroll(f.position.start.line,{highlight:!0}),setTimeout(()=>{o.currentMode.applyScroll(f.position.start.line,{highlight:!0})},20)})}let d=p.scrollHeight,x=d-this.fileResolveMap[s].lastHeight;p.parentElement.style.height=d+"px",n.querySelectorAll(".markdown-source-view, .markdown-reading-view").forEach(g=>{let f=g.querySelector(".cm-scroller, .markdown-preview-view");g.style.paddingTop=d+"px",f==null||f.scrollTo({top:f.scrollTop+x,behavior:"instant"})}),this.fileResolveMap[s].lastHeight=d}onunload(){}async loadSettings(){this.settings={...Oe,...await this.loadData()}}async saveSettings(){await this.saveData(this.settings)}},$=class extends m.PluginSettingTab{constructor(r,t){super(r,t),this.plugin=t}update(r){this.plugin.settings=r,this.plugin.saveSettings(),this.plugin.rerenderAll()}display(){let{containerEl:r}=this;r.empty(),new m.Setting(r).setName(b.setting.mode.title()).setDesc(b.setting.mode.description()).addDropdown(t=>{t.addOption("default",b.setting.mode.default()),t.addOption("concise",b.setting.mode.concise()),t.setValue(this.plugin.settings.mode),t.onChange(n=>{this.update({...this.plugin.settings,mode:n})})}),new m.Setting(r).setName(b.setting.max.title()).setDesc(b.setting.max.description()).addText(t=>{t.setValue(this.plugin.settings.max.toString()),t.onChange(n=>{this.update({...this.plugin.settings,max:parseInt(n,10)||0})})})}};var wr=E;
