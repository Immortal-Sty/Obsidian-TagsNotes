/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var zc=Object.create;var Jn=Object.defineProperty;var $a=Object.getOwnPropertyDescriptor;var $c=Object.getOwnPropertyNames;var Vc=Object.getPrototypeOf,Kc=Object.prototype.hasOwnProperty;var Uc=(t,e)=>()=>(t&&(e=t(t=0)),e);var fe=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Va=(t,e)=>{for(var n in e)Jn(t,n,{get:e[n],enumerable:!0})},Ka=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of $c(e))!Kc.call(t,i)&&i!==n&&Jn(t,i,{get:()=>e[i],enumerable:!(r=$a(e,i))||r.enumerable});return t};var Ce=(t,e,n)=>(n=t!=null?zc(Vc(t)):{},Ka(e||!t||!t.__esModule?Jn(n,"default",{value:t,enumerable:!0}):n,t)),Xr=t=>Ka(Jn({},"__esModule",{value:!0}),t),W=(t,e,n,r)=>{for(var i=r>1?void 0:r?$a(e,n):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=(r?o(e,n,i):o(i))||i);return r&&i&&Jn(e,n,i),i},Yr=(t,e)=>(n,r)=>e(n,r,t);var Qr={};Va(Qr,{__assign:()=>ms,__asyncDelegator:()=>rf,__asyncGenerator:()=>nf,__asyncValues:()=>sf,__await:()=>er,__awaiter:()=>Yc,__classPrivateFieldGet:()=>uf,__classPrivateFieldSet:()=>cf,__createBinding:()=>Zc,__decorate:()=>qc,__exportStar:()=>Jc,__extends:()=>Hc,__generator:()=>Qc,__importDefault:()=>lf,__importStar:()=>af,__makeTemplateObject:()=>of,__metadata:()=>Xc,__param:()=>Gc,__read:()=>Ha,__rest:()=>Wc,__spread:()=>ef,__spreadArrays:()=>tf,__values:()=>gs});function Hc(t,e){ps(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function Wc(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function qc(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function Gc(t,e){return function(n,r){e(n,r,t)}}function Xc(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Yc(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(f){o(f)}}function l(c){try{u(r.throw(c))}catch(f){o(f)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((r=r.apply(t,e||[])).next())})}function Qc(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(c){u=[6,c],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Zc(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]}function Jc(t,e){for(var n in t)n!=="default"&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function gs(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ha(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function ef(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Ha(arguments[e]));return t}function tf(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function er(t){return this instanceof er?(this.v=t,this):new er(t)}function nf(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){r[h]&&(i[h]=function(d){return new Promise(function(p,m){s.push([h,d,p,m])>1||a(h,d)})})}function a(h,d){try{l(r[h](d))}catch(p){f(s[0][3],p)}}function l(h){h.value instanceof er?Promise.resolve(h.value.v).then(u,c):f(s[0][2],h)}function u(h){a("next",h)}function c(h){a("throw",h)}function f(h,d){h(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}function rf(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:er(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function sf(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof gs=="function"?gs(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(u){s({value:u,done:a})},o)}}function of(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function af(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function lf(t){return t&&t.__esModule?t:{default:t}}function uf(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function cf(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}var ps,ms,Zr=Uc(()=>{ps=function(t,e){return ps=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},ps(t,e)};ms=function(){return ms=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ms.apply(this,arguments)}});var _s=fe(vs=>{"use strict";Object.defineProperty(vs,"__esModule",{value:!0});var ys;(function(t){t[t.Transient=0]="Transient",t[t.Singleton=1]="Singleton",t[t.ResolutionScoped=2]="ResolutionScoped",t[t.ContainerScoped=3]="ContainerScoped"})(ys||(ys={}));vs.default=ys});var Wa=fe(bs=>{"use strict";Object.defineProperty(bs,"__esModule",{value:!0});var ff=_s();Object.defineProperty(bs,"Lifecycle",{enumerable:!0,get:function(){return ff.default}})});var nn=fe(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.defineInjectionTokenMetadata=pt.getParamInfo=pt.INJECTION_TOKEN_METADATA_KEY=void 0;pt.INJECTION_TOKEN_METADATA_KEY="injectionTokens";function hf(t){let e=Reflect.getMetadata("design:paramtypes",t)||[],n=Reflect.getOwnMetadata(pt.INJECTION_TOKEN_METADATA_KEY,t)||{};return Object.keys(n).forEach(r=>{e[+r]=n[r]}),e}pt.getParamInfo=hf;function df(t,e){return function(n,r,i){let s=Reflect.getOwnMetadata(pt.INJECTION_TOKEN_METADATA_KEY,n)||{};s[i]=e?{token:t,transform:e.transformToken,transformArgs:e.args||[]}:t,Reflect.defineMetadata(pt.INJECTION_TOKEN_METADATA_KEY,s,n)}}pt.defineInjectionTokenMetadata=df});var ws=fe(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});Jr.isClassProvider=void 0;function pf(t){return!!t.useClass}Jr.isClassProvider=pf});var xs=fe(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.isFactoryProvider=void 0;function mf(t){return!!t.useFactory}ei.isFactoryProvider=mf});var ni=fe(An=>{"use strict";Object.defineProperty(An,"__esModule",{value:!0});An.delay=An.DelayedConstructor=void 0;var ti=class{constructor(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}createProxy(e){let n={},r=!1,i,s=()=>(r||(i=e(this.wrap()),r=!0),i);return new Proxy(n,this.createHandler(s))}createHandler(e){let n={},r=i=>{n[i]=(...s)=>{s[0]=e();let o=Reflect[i];return o(...s)}};return this.reflectMethods.forEach(r),n}};An.DelayedConstructor=ti;function gf(t){if(typeof t=="undefined")throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new ti(t)}An.delay=gf});var ri=fe(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.isConstructorToken=wt.isTransformDescriptor=wt.isTokenDescriptor=wt.isNormalToken=void 0;var yf=ni();function vf(t){return typeof t=="string"||typeof t=="symbol"}wt.isNormalToken=vf;function _f(t){return typeof t=="object"&&"token"in t&&"multiple"in t}wt.isTokenDescriptor=_f;function bf(t){return typeof t=="object"&&"token"in t&&"transform"in t}wt.isTransformDescriptor=bf;function wf(t){return typeof t=="function"||t instanceof yf.DelayedConstructor}wt.isConstructorToken=wf});var Es=fe(ii=>{"use strict";Object.defineProperty(ii,"__esModule",{value:!0});ii.isTokenProvider=void 0;function xf(t){return!!t.useToken}ii.isTokenProvider=xf});var Ss=fe(si=>{"use strict";Object.defineProperty(si,"__esModule",{value:!0});si.isValueProvider=void 0;function Ef(t){return t.useValue!=null}si.isValueProvider=Ef});var As=fe(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});var Sf=ws();Object.defineProperty(rn,"isClassProvider",{enumerable:!0,get:function(){return Sf.isClassProvider}});var Af=xs();Object.defineProperty(rn,"isFactoryProvider",{enumerable:!0,get:function(){return Af.isFactoryProvider}});var Tf=ri();Object.defineProperty(rn,"isNormalToken",{enumerable:!0,get:function(){return Tf.isNormalToken}});var Cf=Es();Object.defineProperty(rn,"isTokenProvider",{enumerable:!0,get:function(){return Cf.isTokenProvider}});var Ff=Ss();Object.defineProperty(rn,"isValueProvider",{enumerable:!0,get:function(){return Ff.isValueProvider}})});var qa=fe(oi=>{"use strict";Object.defineProperty(oi,"__esModule",{value:!0});oi.isProvider=void 0;var Pf=ws(),If=Ss(),Mf=Es(),kf=xs();function Of(t){return Pf.isClassProvider(t)||If.isValueProvider(t)||Mf.isTokenProvider(t)||kf.isFactoryProvider(t)}oi.isProvider=Of});var Fs=fe(Cs=>{"use strict";Object.defineProperty(Cs,"__esModule",{value:!0});var Ts=class{constructor(){this._registryMap=new Map}entries(){return this._registryMap.entries()}getAll(e){return this.ensure(e),this._registryMap.get(e)}get(e){this.ensure(e);let n=this._registryMap.get(e);return n[n.length-1]||null}set(e,n){this.ensure(e),this._registryMap.get(e).push(n)}setAll(e,n){this._registryMap.set(e,n)}has(e){return this.ensure(e),this._registryMap.get(e).length>0}clear(){this._registryMap.clear()}ensure(e){this._registryMap.has(e)||this._registryMap.set(e,[])}};Cs.default=Ts});var Ga=fe(Is=>{"use strict";Object.defineProperty(Is,"__esModule",{value:!0});var Df=Fs(),Ps=class extends Df.default{};Is.default=Ps});var Xa=fe(ks=>{"use strict";Object.defineProperty(ks,"__esModule",{value:!0});var Ms=class{constructor(){this.scopedResolutions=new Map}};ks.default=Ms});var Os=fe(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});ai.formatErrorCtor=void 0;function Lf(t,e){return t===null?`at position #${e}`:`"${t.split(",")[e].trim()}" at position #${e}`}function Rf(t,e,n="    "){return[t,...e.message.split(`
`).map(r=>n+r)].join(`
`)}function jf(t,e,n){let[,r=null]=t.toString().match(/constructor\(([\w, ]+)\)/)||[],i=Lf(r,e);return Rf(`Cannot inject the dependency ${i} of "${t.name}" constructor. Reason:`,n)}ai.formatErrorCtor=jf});var Ya=fe(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.isDisposable=void 0;function Nf(t){return!(typeof t.dispose!="function"||t.dispose.length>0)}li.isDisposable=Nf});var Za=fe(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});sn.PostResolutionInterceptors=sn.PreResolutionInterceptors=void 0;var Qa=Fs(),ui=class extends Qa.default{};sn.PreResolutionInterceptors=ui;var ci=class extends Qa.default{};sn.PostResolutionInterceptors=ci;var Ds=class{constructor(){this.preResolution=new ui,this.postResolution=new ci}};sn.default=Ds});var on=fe(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.instance=Tt.typeInfo=void 0;var Bf=(Zr(),Xr(Qr)),Ge=As(),zf=qa(),fi=ri(),$f=Ga(),Ze=_s(),Ja=Xa(),Vf=Os(),Kf=ni(),Uf=Ya(),Hf=Za();Tt.typeInfo=new Map;var tr=class{constructor(e){this.parent=e,this._registry=new $f.default,this.interceptors=new Hf.default,this.disposed=!1,this.disposables=new Set}register(e,n,r={lifecycle:Ze.default.Transient}){this.ensureNotDisposed();let i;if(zf.isProvider(n)?i=n:i={useClass:n},Ge.isTokenProvider(i)){let s=[e],o=i;for(;o!=null;){let a=o.useToken;if(s.includes(a))throw new Error(`Token registration cycle detected! ${[...s,a].join(" -> ")}`);s.push(a);let l=this._registry.get(a);l&&Ge.isTokenProvider(l.provider)?o=l.provider:o=null}}if((r.lifecycle===Ze.default.Singleton||r.lifecycle==Ze.default.ContainerScoped||r.lifecycle==Ze.default.ResolutionScoped)&&(Ge.isValueProvider(i)||Ge.isFactoryProvider(i)))throw new Error(`Cannot use lifecycle "${Ze.default[r.lifecycle]}" with ValueProviders or FactoryProviders`);return this._registry.set(e,{provider:i,options:r}),this}registerType(e,n){return this.ensureNotDisposed(),Ge.isNormalToken(n)?this.register(e,{useToken:n}):this.register(e,{useClass:n})}registerInstance(e,n){return this.ensureNotDisposed(),this.register(e,{useValue:n})}registerSingleton(e,n){if(this.ensureNotDisposed(),Ge.isNormalToken(e)){if(Ge.isNormalToken(n))return this.register(e,{useToken:n},{lifecycle:Ze.default.Singleton});if(n)return this.register(e,{useClass:n},{lifecycle:Ze.default.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}let r=e;return n&&!Ge.isNormalToken(n)&&(r=n),this.register(e,{useClass:r},{lifecycle:Ze.default.Singleton})}resolve(e,n=new Ja.default){this.ensureNotDisposed();let r=this.getRegistration(e);if(!r&&Ge.isNormalToken(e))throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`);if(this.executePreResolutionInterceptor(e,"Single"),r){let i=this.resolveRegistration(r,n);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(fi.isConstructorToken(e)){let i=this.construct(e,n);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")}executePreResolutionInterceptor(e,n){if(this.interceptors.preResolution.has(e)){let r=[];for(let i of this.interceptors.preResolution.getAll(e))i.options.frequency!="Once"&&r.push(i),i.callback(e,n);this.interceptors.preResolution.setAll(e,r)}}executePostResolutionInterceptor(e,n,r){if(this.interceptors.postResolution.has(e)){let i=[];for(let s of this.interceptors.postResolution.getAll(e))s.options.frequency!="Once"&&i.push(s),s.callback(e,n,r);this.interceptors.postResolution.setAll(e,i)}}resolveRegistration(e,n){if(this.ensureNotDisposed(),e.options.lifecycle===Ze.default.ResolutionScoped&&n.scopedResolutions.has(e))return n.scopedResolutions.get(e);let r=e.options.lifecycle===Ze.default.Singleton,i=e.options.lifecycle===Ze.default.ContainerScoped,s=r||i,o;return Ge.isValueProvider(e.provider)?o=e.provider.useValue:Ge.isTokenProvider(e.provider)?o=s?e.instance||(e.instance=this.resolve(e.provider.useToken,n)):this.resolve(e.provider.useToken,n):Ge.isClassProvider(e.provider)?o=s?e.instance||(e.instance=this.construct(e.provider.useClass,n)):this.construct(e.provider.useClass,n):Ge.isFactoryProvider(e.provider)?o=e.provider.useFactory(this):o=this.construct(e.provider,n),e.options.lifecycle===Ze.default.ResolutionScoped&&n.scopedResolutions.set(e,o),o}resolveAll(e,n=new Ja.default){this.ensureNotDisposed();let r=this.getAllRegistrations(e);if(!r&&Ge.isNormalToken(e))throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`);if(this.executePreResolutionInterceptor(e,"All"),r){let s=r.map(o=>this.resolveRegistration(o,n));return this.executePostResolutionInterceptor(e,s,"All"),s}let i=[this.construct(e,n)];return this.executePostResolutionInterceptor(e,i,"All"),i}isRegistered(e,n=!1){return this.ensureNotDisposed(),this._registry.has(e)||n&&(this.parent||!1)&&this.parent.isRegistered(e,!0)}reset(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()}clearInstances(){this.ensureNotDisposed();for(let[e,n]of this._registry.entries())this._registry.setAll(e,n.filter(r=>!Ge.isValueProvider(r.provider)).map(r=>(r.instance=void 0,r)))}createChildContainer(){this.ensureNotDisposed();let e=new tr(this);for(let[n,r]of this._registry.entries())r.some(({options:i})=>i.lifecycle===Ze.default.ContainerScoped)&&e._registry.setAll(n,r.map(i=>i.options.lifecycle===Ze.default.ContainerScoped?{provider:i.provider,options:i.options}:i));return e}beforeResolution(e,n,r={frequency:"Always"}){this.interceptors.preResolution.set(e,{callback:n,options:r})}afterResolution(e,n,r={frequency:"Always"}){this.interceptors.postResolution.set(e,{callback:n,options:r})}dispose(){return Bf.__awaiter(this,void 0,void 0,function*(){this.disposed=!0;let e=[];this.disposables.forEach(n=>{let r=n.dispose();r&&e.push(r)}),yield Promise.all(e)})}getRegistration(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null}getAllRegistrations(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null}construct(e,n){if(e instanceof Kf.DelayedConstructor)return e.createProxy(i=>this.resolve(i,n));let r=(()=>{let i=Tt.typeInfo.get(e);if(!i||i.length===0){if(e.length===0)return new e;throw new Error(`TypeInfo not known for "${e.name}"`)}let s=i.map(this.resolveParams(n,e));return new e(...s)})();return Uf.isDisposable(r)&&this.disposables.add(r),r}resolveParams(e,n){return(r,i)=>{try{return fi.isTokenDescriptor(r)?fi.isTransformDescriptor(r)?r.multiple?this.resolve(r.transform).transform(this.resolveAll(r.token),...r.transformArgs):this.resolve(r.transform).transform(this.resolve(r.token,e),...r.transformArgs):r.multiple?this.resolveAll(r.token):this.resolve(r.token,e):fi.isTransformDescriptor(r)?this.resolve(r.transform,e).transform(this.resolve(r.token,e),...r.transformArgs):this.resolve(r,e)}catch(s){throw new Error(Vf.formatErrorCtor(n,i,s))}}}ensureNotDisposed(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")}};Tt.instance=new tr;Tt.default=Tt.instance});var el=fe(Rs=>{"use strict";Object.defineProperty(Rs,"__esModule",{value:!0});var Wf=nn(),Ct=on(),Ls=ri(),qf=Os();function Gf(){return function(t){let e=Wf.getParamInfo(t);return class extends t{constructor(...n){super(...n.concat(e.slice(n.length).map((r,i)=>{try{return Ls.isTokenDescriptor(r)?Ls.isTransformDescriptor(r)?r.multiple?Ct.instance.resolve(r.transform).transform(Ct.instance.resolveAll(r.token),...r.transformArgs):Ct.instance.resolve(r.transform).transform(Ct.instance.resolve(r.token),...r.transformArgs):r.multiple?Ct.instance.resolveAll(r.token):Ct.instance.resolve(r.token):Ls.isTransformDescriptor(r)?Ct.instance.resolve(r.transform).transform(Ct.instance.resolve(r.token),...r.transformArgs):Ct.instance.resolve(r)}catch(s){let o=i+n.length;throw new Error(qf.formatErrorCtor(t,o,s))}})))}}}}Rs.default=Gf});var tl=fe(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0});var Xf=nn();function Yf(t){return Xf.defineInjectionTokenMetadata(t)}js.default=Yf});var hi=fe(Ns=>{"use strict";Object.defineProperty(Ns,"__esModule",{value:!0});var Qf=nn(),Zf=on();function Jf(){return function(t){Zf.typeInfo.set(t,Qf.getParamInfo(t))}}Ns.default=Jf});var nl=fe(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0});var eh=(Zr(),Xr(Qr)),th=on();function nh(t=[]){return function(e){return t.forEach(n=>{var{token:r,options:i}=n,s=eh.__rest(n,["token","options"]);return th.instance.register(r,s,i)}),e}}Bs.default=nh});var rl=fe(zs=>{"use strict";Object.defineProperty(zs,"__esModule",{value:!0});var rh=hi(),ih=on();function sh(){return function(t){rh.default()(t),ih.instance.registerSingleton(t)}}zs.default=sh});var il=fe($s=>{"use strict";Object.defineProperty($s,"__esModule",{value:!0});var oh=nn();function ah(t){let e={token:t,multiple:!0};return oh.defineInjectionTokenMetadata(e)}$s.default=ah});var sl=fe(Vs=>{"use strict";Object.defineProperty(Vs,"__esModule",{value:!0});var lh=nn();function uh(t,e,...n){let r={token:t,multiple:!0,transform:e,transformArgs:n};return lh.defineInjectionTokenMetadata(r)}Vs.default=uh});var ol=fe(Ks=>{"use strict";Object.defineProperty(Ks,"__esModule",{value:!0});var ch=nn();function fh(t,e,...n){return ch.defineInjectionTokenMetadata(t,{transformToken:e,args:n})}Ks.default=fh});var al=fe(Us=>{"use strict";Object.defineProperty(Us,"__esModule",{value:!0});var hh=hi(),dh=on();function ph(t,e){return function(n){hh.default()(n),dh.instance.register(e||n,n,{lifecycle:t})}}Us.default=ph});var ll=fe(mt=>{"use strict";Object.defineProperty(mt,"__esModule",{value:!0});var mh=el();Object.defineProperty(mt,"autoInjectable",{enumerable:!0,get:function(){return mh.default}});var gh=tl();Object.defineProperty(mt,"inject",{enumerable:!0,get:function(){return gh.default}});var yh=hi();Object.defineProperty(mt,"injectable",{enumerable:!0,get:function(){return yh.default}});var vh=nl();Object.defineProperty(mt,"registry",{enumerable:!0,get:function(){return vh.default}});var _h=rl();Object.defineProperty(mt,"singleton",{enumerable:!0,get:function(){return _h.default}});var bh=il();Object.defineProperty(mt,"injectAll",{enumerable:!0,get:function(){return bh.default}});var wh=sl();Object.defineProperty(mt,"injectAllWithTransform",{enumerable:!0,get:function(){return wh.default}});var xh=ol();Object.defineProperty(mt,"injectWithTransform",{enumerable:!0,get:function(){return xh.default}});var Eh=al();Object.defineProperty(mt,"scoped",{enumerable:!0,get:function(){return Eh.default}})});var ul=fe(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});function Sh(t){let e;return n=>(e==null&&(e=t(n)),e)}Hs.default=Sh});var cl=fe(Ws=>{"use strict";Object.defineProperty(Ws,"__esModule",{value:!0});function Ah(t){let e=new WeakMap;return n=>{let r=e.get(n);return r==null&&(r=t(n),e.set(n,r)),r}}Ws.default=Ah});var fl=fe(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});function Th(t,e,n,r=!0){let i,s;return o=>{let a=t(o);return(!r||s!==a)&&((s=a)?i=o.resolve(e):i=o.resolve(n)),i}}qs.default=Th});var hl=fe(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});var Ch=ul();Object.defineProperty(nr,"instanceCachingFactory",{enumerable:!0,get:function(){return Ch.default}});var Fh=cl();Object.defineProperty(nr,"instancePerContainerCachingFactory",{enumerable:!0,get:function(){return Fh.default}});var Ph=fl();Object.defineProperty(nr,"predicateAwareClassFactory",{enumerable:!0,get:function(){return Ph.default}})});var Pe=fe(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});var Gs=(Zr(),Xr(Qr));if(typeof Reflect=="undefined"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var Ih=Wa();Object.defineProperty(zt,"Lifecycle",{enumerable:!0,get:function(){return Ih.Lifecycle}});Gs.__exportStar(ll(),zt);Gs.__exportStar(hl(),zt);Gs.__exportStar(As(),zt);var Mh=ni();Object.defineProperty(zt,"delay",{enumerable:!0,get:function(){return Mh.delay}});var kh=on();Object.defineProperty(zt,"container",{enumerable:!0,get:function(){return kh.instance}})});var vl=fe((gg,yl)=>{"use strict";var Oh=new Intl.Collator("en",{numeric:!0,sensitivity:"base"}).compare,Qs=1/0,Xs=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),dl="eexxaacctt",Dh="A-Z",Lh="a-z",rr=(t,e,n)=>t.replace(Dh,e).replace(Lh,n),pl={unicode:!1,alpha:null,interSplit:"[^A-Za-z\\d']+",intraSplit:"[a-z][A-Z]",intraBound:"[A-Za-z]\\d|\\d[A-Za-z]|[a-z][A-Z]",interLft:0,interRgt:0,interChars:".",interIns:Qs,intraChars:"[a-z\\d']",intraIns:null,intraContr:"'[a-z]{1,2}\\b",intraMode:0,intraSlice:[1,Qs],intraSub:null,intraTrn:null,intraDel:null,intraFilt:(t,e,n)=>!0,sort:(t,e,n)=>{let{idx:r,chars:i,terms:s,interLft2:o,interLft1:a,start:l,intraIns:u,interIns:c}=t;return r.map((f,h)=>h).sort((f,h)=>i[h]-i[f]||u[f]-u[h]||s[h]+o[h]+.5*a[h]-(s[f]+o[f]+.5*a[f])||c[f]-c[h]||l[f]-l[h]||Oh(e[r[f]],e[r[h]]))}},Ys=(t,e)=>e==0?"":e==1?t+"??":e==Qs?t+"*?":t+`{0,${e}}?`,ml="(?:\\b|_)";function di(t){var ue;t=Object.assign({},pl,t);let{unicode:e,interLft:n,interRgt:r,intraMode:i,intraSlice:s,intraIns:o,intraSub:a,intraTrn:l,intraDel:u,intraContr:c,intraSplit:f,interSplit:h,intraBound:d,intraChars:p}=t;o!=null||(o=i),a!=null||(a=i),l!=null||(l=i),u!=null||(u=i);let m=(ue=t.letters)!=null?ue:t.alpha;if(m!=null){let x=m.toLocaleUpperCase(),P=m.toLocaleLowerCase();h=rr(h,x,P),f=rr(f,x,P),d=rr(d,x,P),p=rr(p,x,P),c=rr(c,x,P)}let y=e?"u":"",g='".+?"',v=new RegExp(g,"gi"+y),w=new RegExp(`(?:\\s+|^)-(?:${p}+|${g})`,"gi"+y),{intraRules:_}=t;_==null&&(_=x=>{let P=pl.intraSlice,j=0,G=0,X=0,Y=0;if(/[^\d]/.test(x)){let se=x.length;se<=4?se>=3&&(X=Math.min(l,1),se==4&&(j=Math.min(o,1))):(P=s,j=o,G=a,X=l,Y=u)}return{intraSlice:P,intraIns:j,intraSub:G,intraTrn:X,intraDel:Y}});let S=!!f,T=new RegExp(f,"g"+y),C=new RegExp(h,"g"+y),F=new RegExp("^"+h+"|"+h+"$","g"+y),R=new RegExp(c,"gi"+y),N=x=>{let P=[];x=x.replace(v,G=>(P.push(G),dl)),x=x.replace(F,"").toLocaleLowerCase(),S&&(x=x.replace(T,G=>G[0]+" "+G[1]));let j=0;return x.split(C).filter(G=>G!="").map(G=>G===dl?P[j++]:G)},D=/[^\d]+|\d+/g,B=(x,P=0,j=!1)=>{let G=N(x);if(G.length==0)return[];let X=Array(G.length).fill("");G=G.map((he,ce)=>he.replace(R,De=>(X[ce]=De,"")));let Y;if(i==1)Y=G.map((he,ce)=>{if(he[0]==='"')return Xs(he.slice(1,-1));let De="";for(let me of he.matchAll(D)){let de=me[0],{intraSlice:te,intraIns:ne,intraSub:Ae,intraTrn:re,intraDel:ve}=_(de);if(ne+Ae+re+ve==0)De+=de+X[ce];else{let[be,Me]=te,We=de.slice(0,be),b=de.slice(Me),E=de.slice(be,Me);ne==1&&We.length==1&&We!=E[0]&&(We+="(?!"+We+")");let A=E.length,I=[de];if(Ae)for(let k=0;k<A;k++)I.push(We+E.slice(0,k)+p+E.slice(k+1)+b);if(re)for(let k=0;k<A-1;k++)E[k]!=E[k+1]&&I.push(We+E.slice(0,k)+E[k+1]+E[k]+E.slice(k+2)+b);if(ve)for(let k=0;k<A;k++)I.push(We+E.slice(0,k+1)+"?"+E.slice(k+1)+b);if(ne){let k=Ys(p,1);for(let pe=0;pe<A;pe++)I.push(We+E.slice(0,pe)+k+E.slice(pe)+b)}De+="(?:"+I.join("|")+")"+X[ce]}}return De});else{let he=Ys(p,o);P==2&&o>0&&(he=")("+he+")("),Y=G.map((ce,De)=>ce[0]==='"'?Xs(ce.slice(1,-1)):ce.split("").map((me,de,te)=>(o==1&&de==0&&te.length>1&&me!=te[de+1]&&(me+="(?!"+me+")"),me)).join(he)+X[De])}let se=n==2?ml:"",ye=r==2?ml:"",Qe=ye+Ys(t.interChars,t.interIns)+se;return P>0?j?Y=se+"("+Y.join(")"+ye+"|"+se+"(")+")"+ye:(Y="("+Y.join(")("+Qe+")(")+")",Y="(.??"+se+")"+Y+"("+ye+".*)"):(Y=Y.join(Qe),Y=se+Y+ye),[new RegExp(Y,"i"+y),G,X]},L=(x,P,j)=>{let[G]=B(P);if(G==null)return null;let X=[];if(j!=null)for(let Y=0;Y<j.length;Y++){let se=j[Y];G.test(x[se])&&X.push(se)}else for(let Y=0;Y<x.length;Y++)G.test(x[Y])&&X.push(Y);return X},K=!!d,ee=new RegExp(h,y),Q=new RegExp(d,y),ae=(x,P,j)=>{let[G,X,Y]=B(j,1),[se]=B(j,2),ye=X.length,Qe=x.length,he=Array(Qe).fill(0),ce={idx:Array(Qe),start:he.slice(),chars:he.slice(),terms:he.slice(),interIns:he.slice(),intraIns:he.slice(),interLft2:he.slice(),interRgt2:he.slice(),interLft1:he.slice(),interRgt1:he.slice(),ranges:Array(Qe)},De=n==1||r==1,me=0;for(let de=0;de<x.length;de++){let te=P[x[de]],ne=te.match(G),Ae=ne.index+ne[1].length,re=Ae,ve=!1,be=0,Me=0,We=0,b=0,E=0,A=0,I=0,k=0,pe=[];for(let $=0,U=2;$<ye;$++,U+=2){let V=ne[U].toLocaleLowerCase(),Z=X[$],J=Z[0]=='"'?Z.slice(1,-1):Z+Y[$],Te=J.length,Ne=V.length,qe=V==J;if(!qe&&ne[U+1].length>=Te){let Fe=ne[U+1].toLocaleLowerCase().indexOf(J);Fe>-1&&(pe.push(re,Ne,Fe,Te),re+=le(ne,U,Fe,Te),V=J,Ne=Te,qe=!0,$==0&&(Ae=re))}if(De||qe){let Fe=re-1,At=re+Ne,en=!1,Zn=!1;if(Fe==-1||ee.test(te[Fe]))qe&&be++,en=!0;else{if(n==2){ve=!0;break}if(K&&Q.test(te[Fe]+te[Fe+1]))qe&&Me++,en=!0;else if(n==1){let Gr=ne[U+1],En=re+Ne;if(Gr.length>=Te){let tn=0,Sn=!1,Bc=new RegExp(J,"ig"+y),Ba;for(;Ba=Bc.exec(Gr);){tn=Ba.index;let za=En+tn,ds=za-1;if(ds==-1||ee.test(te[ds])){be++,Sn=!0;break}else if(Q.test(te[ds]+te[za])){Me++,Sn=!0;break}}Sn&&(en=!0,pe.push(re,Ne,tn,Te),re+=le(ne,U,tn,Te),V=J,Ne=Te,qe=!0,$==0&&(Ae=re))}if(!en){ve=!0;break}}}if(At==te.length||ee.test(te[At]))qe&&We++,Zn=!0;else{if(r==2){ve=!0;break}if(K&&Q.test(te[At-1]+te[At]))qe&&b++,Zn=!0;else if(r==1){ve=!0;break}}qe&&(E+=Te,en&&Zn&&A++)}if(Ne>Te&&(k+=Ne-Te),$>0&&(I+=ne[U-1].length),!t.intraFilt(J,V,re)){ve=!0;break}$<ye-1&&(re+=Ne+ne[U+1].length)}if(!ve){ce.idx[me]=x[de],ce.interLft2[me]=be,ce.interLft1[me]=Me,ce.interRgt2[me]=We,ce.interRgt1[me]=b,ce.chars[me]=E,ce.terms[me]=A,ce.interIns[me]=I,ce.intraIns[me]=k,ce.start[me]=Ae;let $=te.match(se),U=$.index+$[1].length,V=pe.length,Z=V>0?0:1/0,J=V-4;for(let Fe=2;Fe<$.length;){let At=$[Fe].length;if(Z<=J&&pe[Z]==U){let en=pe[Z+1],Zn=pe[Z+2],Gr=pe[Z+3],En=Fe,tn="";for(let Sn=0;Sn<en;En++)tn+=$[En],Sn+=$[En].length;$.splice(Fe,En-Fe,tn),U+=le($,Fe,Zn,Gr),Z+=4}else U+=At,Fe++}U=$.index+$[1].length;let Te=ce.ranges[me]=[],Ne=U,qe=U;for(let Fe=2;Fe<$.length;Fe++){let At=$[Fe].length;U+=At,Fe%2==0?qe=U:At>0&&(Te.push(Ne,qe),Ne=qe=U)}qe>Ne&&Te.push(Ne,qe),me++}}if(me<x.length)for(let de in ce)ce[de]=ce[de].slice(0,me);return ce},le=(x,P,j,G)=>{let X=x[P]+x[P+1].slice(0,j);return x[P-1]+=X,x[P]=x[P+1].slice(j,j+G),x[P+1]=x[P+1].slice(j+G),X.length},xe=5,at=(x,P,j,G=1e3,X)=>{var de;j=j?j===!0?xe:j:0;let Y=null,se=null,ye=[];P=P.replace(w,te=>{let ne=te.trim().slice(1);return ne[0]==='"'&&(ne=Xs(ne.slice(1,-1))),ye.push(ne),""});let Qe=N(P),he;if(ye.length>0){if(he=new RegExp(ye.join("|"),"i"+y),Qe.length==0){let te=[];for(let ne=0;ne<x.length;ne++)he.test(x[ne])||te.push(ne);return[te,null,null]}}else if(Qe.length==0)return[null,null,null];if(j>0){let te=N(P);if(te.length>1){let ne=te.slice().sort((re,ve)=>ve.length-re.length);for(let re=0;re<ne.length;re++){if((X==null?void 0:X.length)==0)return[[],null,null];X=L(x,ne[re],X)}if(te.length>j)return[X,null,null];Y=gl(te).map(re=>re.join(" ")),se=[];let Ae=new Set;for(let re=0;re<Y.length;re++)if(Ae.size<X.length){let ve=X.filter(Me=>!Ae.has(Me)),be=L(x,Y[re],ve);for(let Me=0;Me<be.length;Me++)Ae.add(be[Me]);se.push(be)}else se.push([])}}Y==null&&(Y=[P],se=[(X==null?void 0:X.length)>0?X:L(x,P)]);let ce=null,De=null;if(ye.length>0&&(se=se.map(te=>te.filter(ne=>!he.test(x[ne])))),se.reduce((te,ne)=>te+ne.length,0)<=G){ce={},De=[];for(let te=0;te<se.length;te++){let ne=se[te];if(ne==null||ne.length==0)continue;let Ae=Y[te],re=ae(ne,x,Ae),ve=t.sort(re,x,Ae);if(te>0)for(let be=0;be<ve.length;be++)ve[be]+=De.length;for(let be in re)ce[be]=((de=ce[be])!=null?de:[]).concat(re[be]);De=De.concat(ve)}}return[[].concat(...se),ce,De]};return{search:(...x)=>at(...x),split:N,filter:L,info:ae,sort:t.sort}}var Rh=(()=>{let t={A:"\xC1\xC0\xC3\xC2\xC4\u0104",a:"\xE1\xE0\xE3\xE2\xE4\u0105",E:"\xC9\xC8\xCA\xCB\u0116",e:"\xE9\xE8\xEA\xEB\u0119",I:"\xCD\xCC\xCE\xCF\u012E",i:"\xED\xEC\xEE\xEF\u012F",O:"\xD3\xD2\xD4\xD5\xD6",o:"\xF3\xF2\xF4\xF5\xF6",U:"\xDA\xD9\xDB\xDC\u016A\u0172",u:"\xFA\xF9\xFB\xFC\u016B\u0173",C:"\xC7\u010C\u0106",c:"\xE7\u010D\u0107",L:"\u0141",l:"\u0142",N:"\xD1\u0143",n:"\xF1\u0144",S:"\u0160\u015A",s:"\u0161\u015B",Z:"\u017B\u0179",z:"\u017C\u017A"},e=new Map,n="";for(let s in t)t[s].split("").forEach(o=>{n+=o,e.set(o,s)});let r=new RegExp(`[${n}]`,"g"),i=s=>e.get(s);return s=>{if(typeof s=="string")return s.replace(r,i);let o=Array(s.length);for(let a=0;a<s.length;a++)o[a]=s[a].replace(r,i);return o}})();function gl(t){t=t.slice();let e=t.length,n=[t.slice()],r=new Array(e).fill(0),i=1,s,o;for(;i<e;)r[i]<i?(s=i%2&&r[i],o=t[i],t[i]=t[s],t[s]=o,++r[i],i=1,n.push(t.slice())):(r[i]=0,++i);return n}var jh=(t,e)=>e?`<mark>${t}</mark>`:t,Nh=(t,e)=>t+e;function Bh(t,e,n=jh,r="",i=Nh){var s,o,a,l;r=(s=i(r,n(t.substring(0,e[0]),!1)))!=null?s:r;for(let u=0;u<e.length;u+=2){let c=e[u],f=e[u+1];r=(o=i(r,n(t.substring(c,f),!0)))!=null?o:r,u<e.length-3&&(r=(a=i(r,n(t.substring(e[u+1],e[u+2]),!1)))!=null?a:r)}return r=(l=i(r,n(t.substring(e[e.length-1]),!1)))!=null?l:r,r}di.latinize=Rh;di.permute=t=>gl([...Array(t.length).keys()]).sort((n,r)=>{for(let i=0;i<n.length;i++)if(n[i]!=r[i])return n[i]-r[i];return 0}).map(n=>n.map(r=>t[r]));di.highlight=Bh;yl.exports=di});var Dm={};Va(Dm,{default:()=>hs});module.exports=Xr(Dm);var He=require("obsidian");var Ua;(function(t){(function(e){var n=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),r=i(t);typeof n.Reflect=="undefined"?n.Reflect=t:r=i(n.Reflect,r),e(r);function i(s,o){return function(a,l){typeof s[a]!="function"&&Object.defineProperty(s,a,{configurable:!0,writable:!0,value:l}),o&&o(a,l)}}})(function(e){var n=Object.prototype.hasOwnProperty,r=typeof Symbol=="function",i=r&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",s=r&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",a={__proto__:[]}instanceof Array,l=!o&&!a,u={create:o?function(){return We(Object.create(null))}:a?function(){return We({__proto__:null})}:function(){return We({})},has:l?function(b,E){return n.call(b,E)}:function(b,E){return E in b},get:l?function(b,E){return n.call(b,E)?b[E]:void 0}:function(b,E){return b[E]}},c=Object.getPrototypeOf(Function),f=typeof process=="object"&&process["env"]&&process["env"].REFLECT_METADATA_USE_MAP_POLYFILL==="true",h=!f&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ve(),d=!f&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:be(),p=!f&&typeof WeakMap=="function"?WeakMap:Me(),m=new p;function y(b,E,A,I){if(ue(A)){if(!Qe(b))throw new TypeError;if(!ce(E))throw new TypeError;return N(b,E)}else{if(!Qe(b))throw new TypeError;if(!j(E))throw new TypeError;if(!j(I)&&!ue(I)&&!x(I))throw new TypeError;return x(I)&&(I=void 0),A=ye(A),D(b,E,A,I)}}e("decorate",y);function g(b,E){function A(I,k){if(!j(I))throw new TypeError;if(!ue(k)&&!De(k))throw new TypeError;ae(b,E,I,k)}return A}e("metadata",g);function v(b,E,A,I){if(!j(A))throw new TypeError;return ue(I)||(I=ye(I)),ae(b,E,A,I)}e("defineMetadata",v);function w(b,E,A){if(!j(E))throw new TypeError;return ue(A)||(A=ye(A)),L(b,E,A)}e("hasMetadata",w);function _(b,E,A){if(!j(E))throw new TypeError;return ue(A)||(A=ye(A)),K(b,E,A)}e("hasOwnMetadata",_);function S(b,E,A){if(!j(E))throw new TypeError;return ue(A)||(A=ye(A)),ee(b,E,A)}e("getMetadata",S);function T(b,E,A){if(!j(E))throw new TypeError;return ue(A)||(A=ye(A)),Q(b,E,A)}e("getOwnMetadata",T);function C(b,E){if(!j(b))throw new TypeError;return ue(E)||(E=ye(E)),le(b,E)}e("getMetadataKeys",C);function F(b,E){if(!j(b))throw new TypeError;return ue(E)||(E=ye(E)),xe(b,E)}e("getOwnMetadataKeys",F);function R(b,E,A){if(!j(E))throw new TypeError;ue(A)||(A=ye(A));var I=B(E,A,!1);if(ue(I)||!I.delete(b))return!1;if(I.size>0)return!0;var k=m.get(E);return k.delete(A),k.size>0||m.delete(E),!0}e("deleteMetadata",R);function N(b,E){for(var A=b.length-1;A>=0;--A){var I=b[A],k=I(E);if(!ue(k)&&!x(k)){if(!ce(k))throw new TypeError;E=k}}return E}function D(b,E,A,I){for(var k=b.length-1;k>=0;--k){var pe=b[k],$=pe(E,A,I);if(!ue($)&&!x($)){if(!j($))throw new TypeError;I=$}}return I}function B(b,E,A){var I=m.get(b);if(ue(I)){if(!A)return;I=new h,m.set(b,I)}var k=I.get(E);if(ue(k)){if(!A)return;k=new h,I.set(E,k)}return k}function L(b,E,A){var I=K(b,E,A);if(I)return!0;var k=re(E);return x(k)?!1:L(b,k,A)}function K(b,E,A){var I=B(E,A,!1);return ue(I)?!1:Y(I.has(b))}function ee(b,E,A){var I=K(b,E,A);if(I)return Q(b,E,A);var k=re(E);if(!x(k))return ee(b,k,A)}function Q(b,E,A){var I=B(E,A,!1);if(!ue(I))return I.get(b)}function ae(b,E,A,I){var k=B(A,I,!0);k.set(b,E)}function le(b,E){var A=xe(b,E),I=re(b);if(I===null)return A;var k=le(I,E);if(k.length<=0)return A;if(A.length<=0)return k;for(var pe=new d,$=[],U=0,V=A;U<V.length;U++){var Z=V[U],J=pe.has(Z);J||(pe.add(Z),$.push(Z))}for(var Te=0,Ne=k;Te<Ne.length;Te++){var Z=Ne[Te],J=pe.has(Z);J||(pe.add(Z),$.push(Z))}return $}function xe(b,E){var A=[],I=B(b,E,!1);if(ue(I))return A;for(var k=I.keys(),pe=de(k),$=0;;){var U=ne(pe);if(!U)return A.length=$,A;var V=te(U);try{A[$]=V}catch(Z){try{Ae(pe)}finally{throw Z}}$++}}function at(b){if(b===null)return 1;switch(typeof b){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return b===null?1:6;default:return 6}}function ue(b){return b===void 0}function x(b){return b===null}function P(b){return typeof b=="symbol"}function j(b){return typeof b=="object"?b!==null:typeof b=="function"}function G(b,E){switch(at(b)){case 0:return b;case 1:return b;case 2:return b;case 3:return b;case 4:return b;case 5:return b}var A=E===3?"string":E===5?"number":"default",I=me(b,i);if(I!==void 0){var k=I.call(b,A);if(j(k))throw new TypeError;return k}return X(b,A==="default"?"number":A)}function X(b,E){if(E==="string"){var A=b.toString;if(he(A)){var I=A.call(b);if(!j(I))return I}var k=b.valueOf;if(he(k)){var I=k.call(b);if(!j(I))return I}}else{var k=b.valueOf;if(he(k)){var I=k.call(b);if(!j(I))return I}var pe=b.toString;if(he(pe)){var I=pe.call(b);if(!j(I))return I}}throw new TypeError}function Y(b){return!!b}function se(b){return""+b}function ye(b){var E=G(b,3);return P(E)?E:se(E)}function Qe(b){return Array.isArray?Array.isArray(b):b instanceof Object?b instanceof Array:Object.prototype.toString.call(b)==="[object Array]"}function he(b){return typeof b=="function"}function ce(b){return typeof b=="function"}function De(b){switch(at(b)){case 3:return!0;case 4:return!0;default:return!1}}function me(b,E){var A=b[E];if(A!=null){if(!he(A))throw new TypeError;return A}}function de(b){var E=me(b,s);if(!he(E))throw new TypeError;var A=E.call(b);if(!j(A))throw new TypeError;return A}function te(b){return b.value}function ne(b){var E=b.next();return E.done?!1:E}function Ae(b){var E=b.return;E&&E.call(b)}function re(b){var E=Object.getPrototypeOf(b);if(typeof b!="function"||b===c||E!==c)return E;var A=b.prototype,I=A&&Object.getPrototypeOf(A);if(I==null||I===Object.prototype)return E;var k=I.constructor;return typeof k!="function"||k===b?E:k}function ve(){var b={},E=[],A=function(){function $(U,V,Z){this._index=0,this._keys=U,this._values=V,this._selector=Z}return $.prototype["@@iterator"]=function(){return this},$.prototype[s]=function(){return this},$.prototype.next=function(){var U=this._index;if(U>=0&&U<this._keys.length){var V=this._selector(this._keys[U],this._values[U]);return U+1>=this._keys.length?(this._index=-1,this._keys=E,this._values=E):this._index++,{value:V,done:!1}}return{value:void 0,done:!0}},$.prototype.throw=function(U){throw this._index>=0&&(this._index=-1,this._keys=E,this._values=E),U},$.prototype.return=function(U){return this._index>=0&&(this._index=-1,this._keys=E,this._values=E),{value:U,done:!0}},$}();return function(){function $(){this._keys=[],this._values=[],this._cacheKey=b,this._cacheIndex=-2}return Object.defineProperty($.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),$.prototype.has=function(U){return this._find(U,!1)>=0},$.prototype.get=function(U){var V=this._find(U,!1);return V>=0?this._values[V]:void 0},$.prototype.set=function(U,V){var Z=this._find(U,!0);return this._values[Z]=V,this},$.prototype.delete=function(U){var V=this._find(U,!1);if(V>=0){for(var Z=this._keys.length,J=V+1;J<Z;J++)this._keys[J-1]=this._keys[J],this._values[J-1]=this._values[J];return this._keys.length--,this._values.length--,U===this._cacheKey&&(this._cacheKey=b,this._cacheIndex=-2),!0}return!1},$.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=b,this._cacheIndex=-2},$.prototype.keys=function(){return new A(this._keys,this._values,I)},$.prototype.values=function(){return new A(this._keys,this._values,k)},$.prototype.entries=function(){return new A(this._keys,this._values,pe)},$.prototype["@@iterator"]=function(){return this.entries()},$.prototype[s]=function(){return this.entries()},$.prototype._find=function(U,V){return this._cacheKey!==U&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=U)),this._cacheIndex<0&&V&&(this._cacheIndex=this._keys.length,this._keys.push(U),this._values.push(void 0)),this._cacheIndex},$}();function I($,U){return $}function k($,U){return U}function pe($,U){return[$,U]}}function be(){return function(){function b(){this._map=new h}return Object.defineProperty(b.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),b.prototype.has=function(E){return this._map.has(E)},b.prototype.add=function(E){return this._map.set(E,E),this},b.prototype.delete=function(E){return this._map.delete(E)},b.prototype.clear=function(){this._map.clear()},b.prototype.keys=function(){return this._map.keys()},b.prototype.values=function(){return this._map.values()},b.prototype.entries=function(){return this._map.entries()},b.prototype["@@iterator"]=function(){return this.keys()},b.prototype[s]=function(){return this.keys()},b}()}function Me(){var b=16,E=u.create(),A=I();return function(){function V(){this._key=I()}return V.prototype.has=function(Z){var J=k(Z,!1);return J!==void 0?u.has(J,this._key):!1},V.prototype.get=function(Z){var J=k(Z,!1);return J!==void 0?u.get(J,this._key):void 0},V.prototype.set=function(Z,J){var Te=k(Z,!0);return Te[this._key]=J,this},V.prototype.delete=function(Z){var J=k(Z,!1);return J!==void 0?delete J[this._key]:!1},V.prototype.clear=function(){this._key=I()},V}();function I(){var V;do V="@@WeakMap@@"+U();while(u.has(E,V));return E[V]=!0,V}function k(V,Z){if(!n.call(V,A)){if(!Z)return;Object.defineProperty(V,A,{value:u.create()})}return V[A]}function pe(V,Z){for(var J=0;J<Z;++J)V[J]=Math.random()*255|0;return V}function $(V){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(V)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(V)):pe(new Uint8Array(V),V):pe(new Array(V),V)}function U(){var V=$(b);V[6]=V[6]&79|64,V[8]=V[8]&191|128;for(var Z="",J=0;J<b;++J){var Te=V[J];(J===4||J===6||J===8)&&(Z+="-"),Te<16&&(Z+="0"),Z+=Te.toString(16).toLowerCase()}return Z}}function We(b){return b.__=void 0,delete b.__,b}})})(Ua||(Ua={}));var fs=Ce(Pe());var jd=require("obsidian"),du=Ce(vl());var ir=(r=>(r.other="Other Language",r.en="English",r.zh="\u7B80\u4F53\u4E2D\u6587",r))(ir||{});var _l=Ce(Pe());var sr={traceLog:!1,loadIndexFromDatabase:!0};var Zs=class{constructor(){this.logLevel="debug";this.levelWeights={trace:1,debug:2,info:3,warn:4,error:5,none:6}}getLevel(){return this.logLevel}setLevel(e){this.logLevel=e}trace(...e){this.shouldLog("trace")&&(sr.traceLog?(console.groupCollapsed(`%c[trace] ${this.getCallerName()}
`,"color: #5f6368;font-weight: 400;",...e),console.trace(),console.groupEnd()):console.log(`%c[trace] ${this.getCallerName()}
`,"color: #5f6368;",...e))}debug(...e){this.shouldLog("debug")&&(sr.traceLog?(console.groupCollapsed(`%c[debug] ${this.getCallerName()}
`,"color: #379237;font-weight: 400;",...e),console.trace(),console.groupEnd()):console.debug(`%c[debug] ${this.getCallerName()}
`,"color: #379237",...e))}info(...e){this.shouldLog("info")&&console.info(`%c[info] ${this.getCallerName()}
`,"color: blue;",...e)}warn(...e){this.shouldLog("warn")&&console.warn(`%c[warn] ${this.getCallerName()}
`,"color: orange;",...e)}error(...e){this.shouldLog("error")&&console.error(`%c[error] ${this.getCallerName()}
`,"color: red;",...e)}getCallerName(){var i;let e=(i=new Error().stack)==null?void 0:i.split(`
`),n=e==null?void 0:e.slice(3).find(s=>!s.includes("eval")&&!s.includes("Array.map"));if(n!=null&&n.startsWith("    at blob:"))return"child-thread";let r=n==null?void 0:n.match(/at (\S+)/);return r?`<${r[1]}> `:"failed to parse caller"}shouldLog(e){return this.levelWeights[e]>=this.levelWeights[this.logLevel]}},M=new Zs;var gt=!1,Tn="This branch hasn't been implemented",bl="this branch shouldn't be reached by design",wl=/Mac|iPod|iPhone|iPad/.test(navigator.userAgent)?"Mod":"Ctrl",or=class{static extractDomainFromHttpsUrl(e){if(e.startsWith("http://"))return M.error("Only support https, current url starts with http"),"";let n=/^(https?:\/\/)?([\w.-]+)(?:\/|$)/,r=e.match(n);return r&&r[2]?r[2]:""}static append(e,n){for(let r of n)e.push(r);return e}static getCurrLanguage(){let e=window.localStorage.getItem("language")||"en";return e in ir?ir[e]:"Other Language"}static sleep(e){return new Promise(n=>setTimeout(n,e))}};function $e(t,e,n){let r=n.value;return n.value=function(...i){let s=Date.now(),o=r.apply(this,i),a=()=>{let l=Date.now();M.trace(`<${t.constructor.name}-${e}> Execution time: ${zh(l-s)}`)};return o instanceof Promise?o.then(l=>(a(),l)):(a(),o)},n}function zh(t){if(t<1e3)return`${t} ms`;if(t<6e4){let e=Math.floor(t/1e3),n=t%1e3;return`${e} s ${n} ms`}else{let e=Math.floor(t/6e4),n=Math.floor(t%6e4/1e3),r=t%1e3;return`${e} min ${n} s ${r} ms`}}function O(t){try{return _l.container.resolve(t)}catch(e){let n=`CleverSearch for developer:
There might be wrong usages for tsyringe:
1. Inject an instance for static field
2. Cycle dependencies without delay
3. Unknown error`;return M.warn(n),M.error(e),alert(n),-1}}var je=class{},xl=window.localStorage.getItem("language")==="zh",El={logLevel:gt?"trace":"info",enableStopWordsEn:!0,enableChinesePatch:!!xl,enableStopWordsZh:!!xl,apiProvider1:{domain:"",key:""},apiProvider2:{domain:"",key:""},excludeExtensions:[],ui:{openInNewPane:!0,maxItemResults:30,showedExtension:"except md",collapseDevSettingByDefault:!gt}},Sl={search:{minTermLengthForPrefix:3,fuzzyProportion:.2,minTermLengthForPrefixSearch:2,weightFilename:3,weightFolder:2,weightTagText:1.15,weightHeading:1.27}};var Wh={},Ve,Al=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Al.decode();var pi=null;function yi(){return(pi===null||pi.buffer!==Ve.memory.buffer)&&(pi=new Uint8Array(Ve.memory.buffer)),pi}function Js(t,e){return Al.decode(yi().subarray(t,t+e))}var Ft=new Array(32).fill(void 0);Ft.push(void 0,null,!0,!1);var ur=Ft.length;function ar(t){ur===Ft.length&&Ft.push(Ft.length+1);let e=ur;return ur=Ft[e],Ft[e]=t,e}function vi(t){return Ft[t]}function $h(t){t<36||(Ft[t]=ur,ur=t)}function lr(t){let e=vi(t);return $h(t),e}function eo(t){let e=typeof t;if(e=="number"||e=="boolean"||t==null)return`${t}`;if(e=="string")return`"${t}"`;if(e=="symbol"){let i=t.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){let i=t.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(t)){let i=t.length,s="[";i>0&&(s+=eo(t[0]));for(let o=1;o<i;o++)s+=", "+eo(t[o]);return s+="]",s}let n=/\[object ([^\]]+)\]/.exec(toString.call(t)),r;if(n.length>1)r=n[1];else return toString.call(t);if(r=="Object")try{return"Object("+JSON.stringify(t)+")"}catch(i){return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:r}var bi=0,_i=new TextEncoder("utf-8"),Vh=typeof _i.encodeInto=="function"?function(t,e){return _i.encodeInto(t,e)}:function(t,e){let n=_i.encode(t);return e.set(n),{read:t.length,written:n.length}};function Tl(t,e,n){if(n===void 0){let a=_i.encode(t),l=e(a.length);return yi().subarray(l,l+a.length).set(a),bi=a.length,l}let r=t.length,i=e(r),s=yi(),o=0;for(;o<r;o++){let a=t.charCodeAt(o);if(a>127)break;s[i+o]=a}if(o!==r){o!==0&&(t=t.slice(o)),i=n(i,r,r=o+t.length*3);let a=yi().subarray(i+o,i+r),l=Vh(t,a);o+=l.written}return bi=o,i}var mi=null;function wi(){return(mi===null||mi.buffer!==Ve.memory.buffer)&&(mi=new Int32Array(Ve.memory.buffer)),mi}var gi=null;function Kh(){return(gi===null||gi.buffer!==Ve.memory.buffer)&&(gi=new Uint32Array(Ve.memory.buffer)),gi}function Uh(t,e){let r=Kh().subarray(t/4,t/4+e),i=[];for(let s=0;s<r.length;s++)i.push(lr(r[s]));return i}function to(t,e){try{let a=Ve.__wbindgen_add_to_stack_pointer(-16);var n=Tl(t,Ve.__wbindgen_malloc,Ve.__wbindgen_realloc),r=bi;Ve.cut_for_search(a,n,r,e);var i=wi()[a/4+0],s=wi()[a/4+1],o=Uh(i,s).slice();return Ve.__wbindgen_free(i,s*4),o}finally{Ve.__wbindgen_add_to_stack_pointer(16)}}async function Hh(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(r){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{let n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}async function Cl(t){typeof t=="undefined"&&(t=new URL("jieba_rs_wasm_bg.wasm",Wh.url));let e={};e.wbg={},e.wbg.__wbindgen_string_new=function(i,s){var o=Js(i,s);return ar(o)},e.wbg.__wbindgen_object_drop_ref=function(i){lr(i)},e.wbg.__wbg_new_68adb0d58759a4ed=function(){var i=new Object;return ar(i)},e.wbg.__wbindgen_number_new=function(i){var s=i;return ar(s)},e.wbg.__wbg_set_2e79e744454afade=function(i,s,o){vi(i)[lr(s)]=lr(o)},e.wbg.__wbindgen_object_clone_ref=function(i){var s=vi(i);return ar(s)},e.wbg.__wbg_new_7031805939a80203=function(i,s){var o=new Error(Js(i,s));return ar(o)},e.wbg.__wbindgen_debug_string=function(i,s){var o=eo(vi(s)),a=Tl(o,Ve.__wbindgen_malloc,Ve.__wbindgen_realloc),l=bi;wi()[i/4+1]=l,wi()[i/4+0]=a},e.wbg.__wbindgen_throw=function(i,s){throw new Error(Js(i,s))},e.wbg.__wbindgen_rethrow=function(i){throw lr(i)},(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));let{instance:n,module:r}=await Hh(await t,e);return Ve=n.exports,Cl.__wbindgen_wasm_module=r,Ve}var Fl=Cl;var Ml=Ce(Pe());var qh=Ce(require("fs")),Gh=Ce(require("path")),Pl=Ce(Pe());var Cn=qh,lt=Gh;var ie=class{static getFileType(e){let n=ie.fileTypeMap.get(ie.getExtension(e));return n===void 0?2:n}static getBasename(e){return lt.basename(e,lt.extname(e))}static getExtension(e){return lt.extname(e).slice(1)}static getFolderPath(e){let n=lt.dirname(e);return n==="."||n===lt.sep||n==="/"?"./":n.replace(new RegExp("\\"+lt.sep,"g"),"/")+"/"}static countFileByExtensions(e){let n=new Map;e.forEach(i=>{let s=i.extension||"no_extension";n.set(s,(n.get(s)||0)+1)});let r=Object.fromEntries(n);return M.trace(r),r}};ie.SPLIT_EOL=`
`,ie.JOIN_EOL=`
`,ie.fileTypeMap=new Map,(()=>{gt&&ie.fileTypeMap.set("",0),ie.fileTypeMap.set("md",0),ie.fileTypeMap.set("txt",0),ie.fileTypeMap.set("jpg",1),ie.fileTypeMap.set("png",1)})(),ie=W([(0,Pl.singleton)()],ie);var Il=require("electron"),Xh=(Il.app||Il.remote.app).getPath("userData"),xi=lt.join(Xh,"clever-search"),Yh="https://bitbucket.org/alexclifton37/obsidian-clever-search/raw/dev/assets/for-program/",Qh="https://raw.githubusercontent.com/yan42685/obsidian-clever-search/dev/assets/for-program/",Zh="https://unpkg.com/",Lg=Zh+"@dqbd/tiktoken@1.0.7/tiktoken_bg.wasm",Rg=lt.join(xi,"tiktoken_bg.wasm"),Ei=lt.join(xi,"stop-words-en.txt"),no="jieba_rs_wasm_bg.wasm",ro="stop-words-en.txt",io="stop-words-zh.txt",Je=class{constructor(){this.setting=O(je);this._assets=Jh}get assets(){return this._assets}async initAsync(){M.trace("preparing assets..."),M.trace(`target dir: ${xi}`);try{await this.initHelper(Yh)}catch(e){try{await this.initHelper(Qh),M.info("download successfully")}catch(n){throw M.warn("failed to download assets"),n}}}async initHelper(e){this.setting.enableChinesePatch&&(await this.downloadFile(this.targetPath(no),e+no),await this.downloadFile(this.targetPath(io),e+io),this._assets.jiebaBinary=Cn.promises.readFile(this.targetPath(no)),this._assets.stopWordsZh=await this.readLinesAsSet(this.targetPath(io))),await this.downloadFile(this.targetPath(ro),e+ro),this._assets.stopWordsEn=await this.readLinesAsSet(this.targetPath(ro))}targetPath(e){return lt.join(xi,e)}async readLinesAsSet(e){return new Set((await Cn.promises.readFile(e,{encoding:"utf-8"})).split(ie.SPLIT_EOL))}async downloadFile(e,n){try{await Cn.promises.access(e),M.trace("file exists:",e);return}catch(s){if(s.code!=="ENOENT")throw s}let r=lt.dirname(e);await Cn.promises.mkdir(r,{recursive:!0}).catch(s=>{if(s.code!=="EEXIST")throw s});let i=await fetch(n);if(!i.ok)throw new Error(`unexpected response ${i.statusText}`);try{await Cn.promises.writeFile(e,Buffer.from(await i.arrayBuffer()),"utf-8"),M.info(`successfully download from ${n}`)}catch(s){throw M.error(`failed to download ${n}`),s}}};Je=W([(0,Ml.singleton)()],Je);var Jh={stopWordsZh:null,stopWordsEn:null,jiebaBinary:new Promise(()=>null)};var kl=Ce(Pe());var yt=class{constructor(){this.isReady=!1;this.reportedError=!1}async initAsync(){let e=O(Je).assets.jiebaBinary;await Fl(e),to("",!1),this.isReady=!0}cut(e,n){return!this.isReady&&!this.reportedError?(M.error("jieba segmenter isn't ready"),this.reportedError=!0,[e]):to(e,n)}};yt=W([(0,kl.singleton)()],yt);var fu=require("obsidian");var hu=Ce(Pe());var Fn=class{constructor(e,n){this.text=e,this.row=n}},$t=class{constructor(e,n){this.currPath=e,this.items=n}};var Si=class{},Vt=class extends Si{constructor(n,r){super();this.line=n,this.context=r}},Pn=class extends Si{constructor(n,r,i,s,o,a){super();this.engineType=n,this.path=r,this.queryTerms=i,this.matchedTerms=s,this.subItems=o,this.previewContent=a}get fileType(){return ie.getFileType(this.path)}get basename(){return ie.getBasename(this.path)}get extension(){return ie.getExtension(this.path)}get folderPath(){return ie.getFolderPath(this.path)}};function cr(t,e,n){var r=n||{},i=r.noTrailing,s=i===void 0?!1:i,o=r.noLeading,a=o===void 0?!1:o,l=r.debounceMode,u=l===void 0?void 0:l,c,f=!1,h=0;function d(){c&&clearTimeout(c)}function p(y){var g=y||{},v=g.upcomingOnly,w=v===void 0?!1:v;d(),f=!w}function m(){for(var y=arguments.length,g=new Array(y),v=0;v<y;v++)g[v]=arguments[v];var w=this,_=Date.now()-h;if(f)return;function S(){h=Date.now(),e.apply(w,g)}function T(){c=void 0}!a&&u&&!c&&S(),d(),u===void 0&&_>t?a?(h=Date.now(),s||(c=setTimeout(u?T:S,t))):S():s!==!0&&(c=setTimeout(u?T:S,u===void 0?t-_:t))}return m.cancel=p,m}function Ol(t,e,n){var r=n||{},i=r.atBegin,s=i===void 0?!1:i;return cr(t,e,{debounceMode:s!==!1})}var fr=class{static minInSet(e){let n=Number.MAX_VALUE;for(let r of e)r<n&&(n=r);return n}},Ai=class{constructor(e,n,r){this.flushThrottled=cr(1e4,()=>this.forceFlush());this.elementsMap=new Map,this.handler=e,this.identifier=n,this.autoFlushThreshold=r}add(e){let n=this.identifier(e);this.elementsMap.set(n,e),this.elementsMap.size>=this.autoFlushThreshold&&this.flushThrottled()}async forceFlush(){if(this.elementsMap.size===0)return;let e=Array.from(this.elementsMap.values());this.elementsMap.clear(),await this.handler(e),M.debug("flushed")}},Ti=class{constructor(e,n=Number.MAX_VALUE){this.heap=[],this.compare=e,this.capacity=n}values(){return this.heap}push(e){this.size()<this.capacity?(this.heap.push(e),this.heapifyUp()):this.compare(e,this.heap[0])>0&&(this.heap[0]=e,this.heapifyDown())}clear(){this.heap=[]}pop(){if(this.isEmpty())return;let e=this.heap[0];return this.heap[0]=this.heap[this.heap.length-1],this.heap.pop(),this.heapifyDown(),e}peek(){return this.heap[0]}isEmpty(){return this.heap.length===0}size(){return this.heap.length}getLeftChildIndex(e){return 2*e+1}getRightChildIndex(e){return 2*e+2}getParentIndex(e){return Math.floor((e-1)/2)}swap(e,n){[this.heap[e],this.heap[n]]=[this.heap[n],this.heap[e]]}heapifyUp(){let e=this.heap.length-1;for(;this.getParentIndex(e)>=0&&this.compare(this.heap[this.getParentIndex(e)],this.heap[e])>0;)this.swap(this.getParentIndex(e),e),e=this.getParentIndex(e)}heapifyDown(){let e=0;for(;this.getLeftChildIndex(e)<this.heap.length;){let n=this.getLeftChildIndex(e);if(this.getRightChildIndex(e)<this.heap.length&&this.compare(this.heap[this.getRightChildIndex(e)],this.heap[n])<0&&(n=this.getRightChildIndex(e)),this.compare(this.heap[e],this.heap[n])<0)break;this.swap(e,n),e=n}}};var au=Ce(Pe());var uo={216:"O",223:"s",248:"o",273:"d",295:"h",305:"i",320:"l",322:"l",359:"t",383:"s",384:"b",385:"B",387:"b",390:"O",392:"c",393:"D",394:"D",396:"d",398:"E",400:"E",402:"f",403:"G",407:"I",409:"k",410:"l",412:"M",413:"N",414:"n",415:"O",421:"p",427:"t",429:"t",430:"T",434:"V",436:"y",438:"z",477:"e",485:"g",544:"N",545:"d",549:"z",564:"l",565:"n",566:"t",567:"j",570:"A",571:"C",572:"c",573:"L",574:"T",575:"s",576:"z",579:"B",580:"U",581:"V",582:"E",583:"e",584:"J",585:"j",586:"Q",587:"q",588:"R",589:"r",590:"Y",591:"y",592:"a",593:"a",595:"b",596:"o",597:"c",598:"d",599:"d",600:"e",603:"e",604:"e",605:"e",606:"e",607:"j",608:"g",609:"g",610:"G",613:"h",614:"h",616:"i",618:"I",619:"l",620:"l",621:"l",623:"m",624:"m",625:"m",626:"n",627:"n",628:"N",629:"o",633:"r",634:"r",635:"r",636:"r",637:"r",638:"r",639:"r",640:"R",641:"R",642:"s",647:"t",648:"t",649:"u",651:"v",652:"v",653:"w",654:"y",655:"Y",656:"z",657:"z",663:"c",665:"B",666:"e",667:"G",668:"H",669:"j",670:"k",671:"L",672:"q",686:"h",867:"a",868:"e",869:"i",870:"o",871:"u",872:"c",873:"d",874:"h",875:"m",876:"r",877:"t",878:"v",879:"x",7424:"A",7427:"B",7428:"C",7429:"D",7431:"E",7432:"e",7433:"i",7434:"J",7435:"K",7436:"L",7437:"M",7438:"N",7439:"O",7440:"O",7441:"o",7442:"o",7443:"o",7446:"o",7447:"o",7448:"P",7449:"R",7450:"R",7451:"T",7452:"U",7453:"u",7454:"u",7455:"m",7456:"V",7457:"W",7458:"Z",7522:"i",7523:"r",7524:"u",7525:"v",7834:"a",7835:"s",8305:"i",8341:"h",8342:"k",8343:"l",8344:"m",8345:"n",8346:"p",8347:"s",8348:"t",8580:"c"};for(let t="\u0300".codePointAt(0);t<="\u036F".codePointAt(0);++t){let e=String.fromCodePoint(t);for(let n of"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"){let i=(n+e).normalize().codePointAt(0);i>126&&(uo[i]=n)}}var so={a:[7844,7863],e:[7870,7879],o:[7888,7907],u:[7912,7921]};for(let t of Object.keys(so)){let e=t.toUpperCase();for(let n=so[t][0];n<=so[t][1];++n)uo[n]=n%2===0?e:t}function yr(t){if(t<192||t>8580)return t;let e=uo[t];return e!==void 0?e.codePointAt(0):t}function Kt(t,e){return t>e?t:e}var Rl=t=>t.split("").map(e=>e.codePointAt(0));var ed=new Set(` \f
\r	\v\xA0\u1680\u2028\u2029\u202F\u205F\u3000\uFEFF`.split("").map(t=>t.codePointAt(0)));for(let t="\u2000".codePointAt(0);t<="\u200A".codePointAt(0);t++)ed.add(t);var Mn="\x7F".codePointAt(0),dr="A".codePointAt(0),pr="Z".codePointAt(0),jl="a".codePointAt(0),Nl="z".codePointAt(0),td="0".codePointAt(0),nd="9".codePointAt(0);function In(t,e,n){return n?t:e-t-1}var mr=16,Ci=-3,gr=-1,an=mr/2,rd=mr/2,id=an+gr,Bl=-(Ci+gr),zl=2;function oo(t){return t?new Set:null}function hr(t,e,n){if(e!==null&&e.i16.length>t+n){let r=e.i16.subarray(t,t+n);return[t+n,r]}return[t,new Int16Array(n)]}function Dl(t,e,n){if(e!==null&&e.i32.length>t+n){let r=e.i32.subarray(t,t+n);return[t+n,r]}return[t,new Int32Array(n)]}function $l(t){return t>=jl&&t<=Nl?1:t>=dr&&t<=pr?2:t>=td&&t<=nd?4:0}function Vl(t){let e=String.fromCodePoint(t);return e!==e.toUpperCase()?1:e!==e.toLowerCase()?2:e.match(/\p{Number}/gu)!==null?4:e.match(/\p{Letter}/gu)!==null?3:0}function Fi(t){return t<=Mn?$l(t):Vl(t)}function co(t,e){return t===0&&e!==0?an:t===1&&e===2||t!==4&&e===4?id:e===0?rd:0}function sd(t,e){return e===0?an:co(Fi(t[e-1]),Fi(t[e]))}function od(t,e,n,r){let i=t.slice(r),s=i.indexOf(n);if(s===0)return r;if(!e&&n>=jl&&n<=Nl){s>0&&(i=i.slice(0,s));let o=i.indexOf(n-32);o>=0&&(s=o)}return s<0?-1:r+s}function Ll(t){for(let e of t)if(e>=128)return!1;return!0}function fo(t,e,n){if(!Ll(t))return 0;if(!Ll(e))return-1;let r=0,i=0;for(let s=0;s<e.length;s++){if(i=od(t,n,e[s],i),i<0)return-1;s===0&&i>0&&(r=i-1),i++}return r}var ad=(t,e,n,r,i,s,o)=>{let a=i.length;if(a===0)return[{start:0,end:0,score:0},oo(s)];let l=r.length;if(o!==null&&l*a>o.i16.length)return Ul(t,e,n,r,i,s);let u=fo(r,i,t);if(u<0)return[{start:-1,end:-1,score:0},null];let c=0,f=0,h=null,d=null,p=null,m=null;[c,h]=hr(c,o,l),[c,d]=hr(c,o,l),[c,p]=hr(c,o,l),[f,m]=Dl(f,o,a);let[,y]=Dl(f,o,l);for(let x=0;x<y.length;x++)y[x]=r[x];let g=0,v=0,w=0,_=0,S=i[0],T=i[0],C=0,F=0,R=!1,N=y.subarray(u),D=h.subarray(u).subarray(0,N.length),B=d.subarray(u).subarray(0,N.length),L=p.subarray(u).subarray(0,N.length);for(let[x,P]of N.entries()){let j=null;P<=Mn?(j=$l(P),!t&&j===2&&(P+=32)):(j=Vl(P),!t&&j===2&&(P=String.fromCodePoint(P).toLowerCase().codePointAt(0)),e&&(P=yr(P))),N[x]=P;let G=co(F,j);if(L[x]=G,F=j,P===T&&(w<a&&(m[w]=u+x,w++,T=i[Math.min(w,a-1)]),_=u+x),P===S){let X=mr+G*zl;if(D[x]=X,B[x]=1,a===1&&(n&&X>g||!n&&X>=g)&&(g=X,v=u+x,n&&G===an))break;R=!1}else R?D[x]=Kt(C+gr,0):D[x]=Kt(C+Ci,0),B[x]=0,R=!0;C=D[x]}if(w!==a)return[{start:-1,end:-1,score:0},null];if(a===1){let x={start:v,end:v+1,score:g};if(!s)return[x,null];let P=new Set;return P.add(v),[x,P]}let K=m[0],ee=_-K+1,Q=null;[c,Q]=hr(c,o,ee*a);{let x=h.subarray(K,_+1);for(let[P,j]of x.entries())Q[P]=j}let[,ae]=hr(c,o,ee*a);{let x=d.subarray(K,_+1);for(let[P,j]of x.entries())ae[P]=j}let le=m.subarray(1),xe=i.slice(1).slice(0,le.length);for(let[x,P]of le.entries()){let j=!1,G=xe[x],X=x+1,Y=X*ee,se=y.subarray(P,_+1),ye=p.subarray(P).subarray(0,se.length),Qe=ae.subarray(Y+P-K).subarray(0,se.length),he=ae.subarray(Y+P-K-1-ee).subarray(0,se.length),ce=Q.subarray(Y+P-K).subarray(0,se.length),De=Q.subarray(Y+P-K-1-ee).subarray(0,se.length),me=Q.subarray(Y+P-K-1).subarray(0,se.length);me[0]=0;for(let[de,te]of se.entries()){let ne=de+P,Ae=0,re=0,ve=0;if(j?re=me[de]+gr:re=me[de]+Ci,G===te){Ae=De[de]+mr;let Me=ye[de];ve=he[de]+1,Me===an?ve=1:ve>1&&(Me=Kt(Me,Kt(Bl,p[ne-ve+1]))),Ae+Me<re?(Ae+=ye[de],ve=0):Ae+=Me}Qe[de]=ve,j=Ae<re;let be=Kt(Kt(Ae,re),0);X===a-1&&(n&&be>g||!n&&be>=g)&&(g=be,v=ne),ce[de]=be}}let at=oo(s),ue=K;if(s&&at!==null){let x=a-1;ue=v;let P=!0;for(;;){let j=x*ee,G=ue-K,X=Q[j+G],Y=0,se=0;if(x>0&&ue>=m[x]&&(Y=Q[j-ee+G-1]),ue>m[x]&&(se=Q[j+G-1]),X>Y&&(X>se||X===se&&P)){if(at.add(ue),x===0)break;x--}P=ae[j+G]>1||j+ee+G+1<ae.length&&ae[j+ee+G+1]>0,ue--}}return[{start:ue,end:v+1,score:g},at]};function Kl(t,e,n,r,i,s,o){let a=0,l=0,u=!1,c=0,f=0,h=oo(o),d=0;i>0&&(d=Fi(n[i-1]));for(let p=i;p<s;p++){let m=n[p],y=Fi(m);if(t||(m>=dr&&m<=pr?m+=32:m>Mn&&(m=String.fromCodePoint(m).toLowerCase().codePointAt(0))),e&&(m=yr(m)),m===r[a]){o&&h!==null&&h.add(p),l+=mr;let g=co(d,y);c===0?f=g:(g===an&&(f=g),g=Kt(Kt(g,f),Bl)),a===0?l+=g*zl:l+=g,u=!1,c++,a++}else u?l+=gr:l+=Ci,u=!0,c=0,f=0;d=y}return[l,h]}var Ul=(t,e,n,r,i,s,o)=>{if(i.length===0)return[{start:0,end:0,score:0},null];if(fo(r,i,t)<0)return[{start:-1,end:-1,score:0},null];let a=0,l=-1,u=-1,c=r.length,f=i.length;for(let h=0;h<c;h++){let d=r[In(h,c,n)];t||(d>=dr&&d<=pr?d+=32:d>Mn&&(d=String.fromCodePoint(d).toLowerCase().codePointAt(0))),e&&(d=yr(d));let p=i[In(a,f,n)];if(d===p&&(l<0&&(l=h),a++,a===f)){u=h+1;break}}if(l>=0&&u>=0){a--;for(let p=u-1;p>=l;p--){let m=In(p,c,n),y=r[m];t||(y>=dr&&y<=pr?y+=32:y>Mn&&(y=String.fromCodePoint(y).toLowerCase().codePointAt(0)));let g=In(a,f,n),v=i[g];if(y===v&&(a--,a<0)){l=p;break}}if(!n){let p=l;l=c-u,u=c-p}let[h,d]=Kl(t,e,r,i,l,u,s);return[{start:l,end:u,score:h},d]}return[{start:-1,end:-1,score:0},null]},ld=(t,e,n,r,i,s,o)=>{if(i.length===0)return[{start:0,end:0,score:0},null];let a=r.length,l=i.length;if(a<l)return[{start:-1,end:-1,score:0},null];if(fo(r,i,t)<0)return[{start:-1,end:-1,score:0},null];let u=0,c=-1,f=0,h=-1;for(let d=0;d<a;d++){let p=In(d,a,n),m=r[p];t||(m>=dr&&m<=pr?m+=32:m>Mn&&(m=String.fromCodePoint(m).toLowerCase().codePointAt(0))),e&&(m=yr(m));let y=In(u,l,n);if(i[y]===m){if(y===0&&(f=sd(r,p)),u++,u===l){if(f>h&&(c=d,h=f),f===an)break;d-=u-1,u=0,f=0}}else d-=u,u=0,f=0}if(c>=0){let d=0,p=0;n?(d=c-l+1,p=c+1):(d=a-(c+1),p=a-(c-l+1));let[m]=Kl(t,e,r,i,d,p,!1);return[{start:d,end:p,score:m},null]}return[{start:-1,end:-1,score:0},null]};var ud=100*1024,cd=2048;function fd(t,e){return{i16:new Int16Array(t),i32:new Int32Array(e)}}var hd=fd(ud,cd);var Hl=(t,e,n)=>{let r=!1;switch(e){case"smart-case":t.toLowerCase()!==t&&(r=!0);break;case"case-sensitive":r=!0;break;case"case-insensitive":t=t.toLowerCase(),r=!1;break}let i=Rl(t);return n&&(i=i.map(yr)),{queryRunes:i,caseSensitive:r}};function Wl(t,e){let n=Object.keys(t).map(i=>parseInt(i,10)).sort((i,s)=>s-i),r=[];for(let i of n)if(r=r.concat(t[i]),r.length>=e)break;return r}function ql(t,e,n){return r=>{let i=this.runesList[r];if(e.length>i.length)return;let[s,o]=this.algoFn(n,this.opts.normalize,this.opts.forward,i,e,!0,hd);if(s.start===-1)return;if(this.opts.fuzzy===!1){o=new Set;for(let l=s.start;l<s.end;++l)o.add(l)}let a=this.opts.sort?s.score:0;t[a]===void 0&&(t[a]=[]),t[a].push({item:this.items[r],...s,positions:o!=null?o:new Set})}}function dd(t){let{queryRunes:e,caseSensitive:n}=Hl(t,this.opts.casing,this.opts.normalize),r={},i=ql.bind(this)(r,e,n);for(let s=0,o=this.runesList.length;s<o;++s)i(s);return Wl(r,this.opts.limit)}var pd=typeof require!="undefined"&&typeof window=="undefined";function md(t,e,n,r){return new Promise((i,s)=>{let a=0,l=Math.min(1e3,e),u=()=>{if(t.cancelled)return s("search cancelled");for(;a<l;++a)n(a);l<e?(l=Math.min(l+1e3,e),pd?setImmediate(u):setTimeout(u)):i(r())};u()})}function gd(t,e){let{queryRunes:n,caseSensitive:r}=Hl(t,this.opts.casing,this.opts.normalize),i={};return md(e,this.runesList.length,ql.bind(this)(i,n,r),()=>Wl(i,this.opts.limit))}var ho={limit:1/0,selector:t=>t,casing:"smart-case",normalize:!0,fuzzy:"v2",tiebreakers:[],sort:!0,forward:!0},ao=class{constructor(e,...n){switch(this.opts={...ho,...n[0]},this.items=e,this.runesList=e.map(r=>Rl(this.opts.selector(r).normalize())),this.algoFn=ld,this.opts.fuzzy){case"v2":this.algoFn=ad;break;case"v1":this.algoFn=Ul;break}}},Zg={...ho,match:dd};var yd={...ho,match:gd},lo=class extends ao{constructor(e,...n){super(e,...n),this.opts={...yd,...n[0]},this.token={cancelled:!1}}async find(e){if(this.token.cancelled=!0,this.token={cancelled:!1},e.length===0||this.items.length===0)return this.items.slice(0,this.opts.limit).map(vd);e=e.normalize();let n=await this.opts.match.bind(this)(e,this.token);return _d(n,this.opts)}},vd=t=>({item:t,start:-1,end:-1,score:0,positions:new Set});function _d(t,e){if(e.sort){let{selector:n}=e;t.sort((r,i)=>{if(r.score===i.score)for(let s of e.tiebreakers){let o=s(r,i,n);if(o!==0)return o}return 0})}return Number.isFinite(e.limit)&&t.splice(e.limit),t}var Pi=class{constructor(e,...n){this.finder=new lo(e,...n),this.find=this.finder.find.bind(this.finder)}};var _e=function(){return _e=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},_e.apply(this,arguments)};function bd(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(f){o(f)}}function l(c){try{u(r.throw(c))}catch(f){o(f)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((r=r.apply(t,e||[])).next())})}function wd(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(c){return l([u,c])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(n=0)),n;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(c){u=[6,c],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function oe(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ie(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}var xd="ENTRIES",Zl="KEYS",Jl="VALUES",Be="",po=function(){function t(e,n){var r=e._tree,i=Array.from(r.keys());this.set=e,this._type=n,this._path=i.length>0?[{node:r,keys:i}]:[]}return t.prototype.next=function(){var e=this.dive();return this.backtrack(),e},t.prototype.dive=function(){if(this._path.length===0)return{done:!0,value:void 0};var e=kn(this._path),n=e.node,r=e.keys;if(kn(r)===Be)return{done:!1,value:this.result()};var i=n.get(kn(r));return this._path.push({node:i,keys:Array.from(i.keys())}),this.dive()},t.prototype.backtrack=function(){if(this._path.length!==0){var e=kn(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}},t.prototype.key=function(){return this.set._prefix+this._path.map(function(e){var n=e.keys;return kn(n)}).filter(function(e){return e!==Be}).join("")},t.prototype.value=function(){return kn(this._path).node.get(Be)},t.prototype.result=function(){switch(this._type){case Jl:return this.value();case Zl:return this.key();default:return[this.key(),this.value()]}},t.prototype[Symbol.iterator]=function(){return this},t}(),kn=function(t){return t[t.length-1]},Ed=function(t,e,n){var r=new Map;if(e===void 0)return r;for(var i=e.length+1,s=i+n,o=new Uint8Array(s*i).fill(n+1),a=0;a<i;++a)o[a]=a;for(var l=1;l<s;++l)o[l*i]=l;return eu(t,e,n,r,o,1,i,""),r},eu=function(t,e,n,r,i,s,o,a){var l,u,c=s*o;try{e:for(var f=oe(t.keys()),h=f.next();!h.done;h=f.next()){var d=h.value;if(d===Be){var p=i[c-1];p<=n&&r.set(a,[t.get(d),p])}else{for(var m=s,y=0;y<d.length;++y,++m){for(var g=d[y],v=o*m,w=v-o,_=i[v],S=Math.max(0,m-n-1),T=Math.min(o-1,m+n),C=S;C<T;++C){var F=g!==e[C],R=i[w+C]+ +F,N=i[w+C+1]+1,D=i[v+C]+1,B=i[v+C+1]=Math.min(R,N,D);B<_&&(_=B)}if(_>n)continue e}eu(t.get(d),e,n,r,i,m,o,a+d)}}}catch(L){l={error:L}}finally{try{h&&!h.done&&(u=f.return)&&u.call(f)}finally{if(l)throw l.error}}},mo=function(){function t(e,n){e===void 0&&(e=new Map),n===void 0&&(n=""),this._size=void 0,this._tree=e,this._prefix=n}return t.prototype.atPrefix=function(e){var n,r;if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");var i=Ie(Mi(this._tree,e.slice(this._prefix.length)),2),s=i[0],o=i[1];if(s===void 0){var a=Ie(Eo(o),2),l=a[0],u=a[1];try{for(var c=oe(l.keys()),f=c.next();!f.done;f=c.next()){var h=f.value;if(h!==Be&&h.startsWith(u)){var d=new Map;return d.set(h.slice(u.length),l.get(h)),new t(d,e)}}}catch(p){n={error:p}}finally{try{f&&!f.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}return new t(s,e)},t.prototype.clear=function(){this._size=void 0,this._tree.clear()},t.prototype.delete=function(e){return this._size=void 0,Sd(this._tree,e)},t.prototype.entries=function(){return new po(this,xd)},t.prototype.forEach=function(e){var n,r;try{for(var i=oe(this),s=i.next();!s.done;s=i.next()){var o=Ie(s.value,2),a=o[0],l=o[1];e(a,l,this)}}catch(u){n={error:u}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.fuzzyGet=function(e,n){return Ed(this._tree,e,n)},t.prototype.get=function(e){var n=bo(this._tree,e);return n!==void 0?n.get(Be):void 0},t.prototype.has=function(e){var n=bo(this._tree,e);return n!==void 0&&n.has(Be)},t.prototype.keys=function(){return new po(this,Zl)},t.prototype.set=function(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=go(this._tree,e);return r.set(Be,n),this},Object.defineProperty(t.prototype,"size",{get:function(){if(this._size)return this._size;this._size=0;for(var e=this.entries();!e.next().done;)this._size+=1;return this._size},enumerable:!1,configurable:!0}),t.prototype.update=function(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=go(this._tree,e);return r.set(Be,n(r.get(Be))),this},t.prototype.fetch=function(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=go(this._tree,e),i=r.get(Be);return i===void 0&&r.set(Be,i=n()),i},t.prototype.values=function(){return new po(this,Jl)},t.prototype[Symbol.iterator]=function(){return this.entries()},t.from=function(e){var n,r,i=new t;try{for(var s=oe(e),o=s.next();!o.done;o=s.next()){var a=Ie(o.value,2),l=a[0],u=a[1];i.set(l,u)}}catch(c){n={error:c}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i},t.fromObject=function(e){return t.from(Object.entries(e))},t}(),Mi=function(t,e,n){var r,i;if(n===void 0&&(n=[]),e.length===0||t==null)return[t,n];try{for(var s=oe(t.keys()),o=s.next();!o.done;o=s.next()){var a=o.value;if(a!==Be&&e.startsWith(a))return n.push([t,a]),Mi(t.get(a),e.slice(a.length),n)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return n.push([t,e]),Mi(void 0,"",n)},bo=function(t,e){var n,r;if(e.length===0||t==null)return t;try{for(var i=oe(t.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;if(o!==Be&&e.startsWith(o))return bo(t.get(o),e.slice(o.length))}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},go=function(t,e){var n,r,i=e.length;e:for(var s=0;t&&s<i;){try{for(var o=(n=void 0,oe(t.keys())),a=o.next();!a.done;a=o.next()){var l=a.value;if(l!==Be&&e[s]===l[0]){for(var u=Math.min(i-s,l.length),c=1;c<u&&e[s+c]===l[c];)++c;var f=t.get(l);if(c===l.length)t=f;else{var h=new Map;h.set(l.slice(c),f),t.set(e.slice(s,s+c),h),t.delete(l),t=h}s+=c;continue e}}}catch(p){n={error:p}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}var d=new Map;return t.set(e.slice(s),d),d}return t},Sd=function(t,e){var n=Ie(Mi(t,e),2),r=n[0],i=n[1];if(r!==void 0){if(r.delete(Be),r.size===0)tu(i);else if(r.size===1){var s=Ie(r.entries().next().value,2),o=s[0],a=s[1];nu(i,o,a)}}},tu=function(t){if(t.length!==0){var e=Ie(Eo(t),2),n=e[0],r=e[1];if(n.delete(r),n.size===0)tu(t.slice(0,-1));else if(n.size===1){var i=Ie(n.entries().next().value,2),s=i[0],o=i[1];s!==Be&&nu(t.slice(0,-1),s,o)}}},nu=function(t,e,n){if(t.length!==0){var r=Ie(Eo(t),2),i=r[0],s=r[1];i.set(s+e,n),i.delete(s)}},Eo=function(t){return t[t.length-1]},vr,So="or",ru="and",Ad="and_not",ki=function(){function t(e){if((e==null?void 0:e.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');var n=e.autoVacuum==null||e.autoVacuum===!0?_o:e.autoVacuum;this._options=_e(_e(_e({},vo),e),{autoVacuum:n,searchOptions:_e(_e({},Gl),e.searchOptions||{}),autoSuggestOptions:_e(_e({},Id),e.autoSuggestOptions||{})}),this._index=new mo,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=xo,this.addFields(this._options.fields)}return t.prototype.add=function(e){var n,r,i,s,o,a,l=this._options,u=l.extractField,c=l.tokenize,f=l.processTerm,h=l.fields,d=l.idField,p=u(e,d);if(p==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));if(this._idToShortId.has(p))throw new Error("MiniSearch: duplicate ID ".concat(p));var m=this.addDocumentId(p);this.saveStoredFields(m,e);try{for(var y=oe(h),g=y.next();!g.done;g=y.next()){var v=g.value,w=u(e,v);if(w!=null){var _=c(w.toString(),v),S=this._fieldIds[v],T=new Set(_).size;this.addFieldLength(m,S,this._documentCount-1,T);try{for(var C=(i=void 0,oe(_)),F=C.next();!F.done;F=C.next()){var R=F.value,N=f(R,v);if(Array.isArray(N))try{for(var D=(o=void 0,oe(N)),B=D.next();!B.done;B=D.next()){var L=B.value;this.addTerm(S,m,L)}}catch(K){o={error:K}}finally{try{B&&!B.done&&(a=D.return)&&a.call(D)}finally{if(o)throw o.error}}else N&&this.addTerm(S,m,N)}}catch(K){i={error:K}}finally{try{F&&!F.done&&(s=C.return)&&s.call(C)}finally{if(i)throw i.error}}}}}catch(K){n={error:K}}finally{try{g&&!g.done&&(r=y.return)&&r.call(y)}finally{if(n)throw n.error}}},t.prototype.addAll=function(e){var n,r;try{for(var i=oe(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.add(o)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.addAllAsync=function(e,n){var r=this;n===void 0&&(n={});var i=n.chunkSize,s=i===void 0?10:i,o={chunk:[],promise:Promise.resolve()},a=e.reduce(function(c,f,h){var d=c.chunk,p=c.promise;return d.push(f),(h+1)%s===0?{chunk:[],promise:p.then(function(){return new Promise(function(m){return setTimeout(m,0)})}).then(function(){return r.addAll(d)})}:{chunk:d,promise:p}},o),l=a.chunk,u=a.promise;return u.then(function(){return r.addAll(l)})},t.prototype.remove=function(e){var n,r,i,s,o,a,l=this._options,u=l.tokenize,c=l.processTerm,f=l.extractField,h=l.fields,d=l.idField,p=f(e,d);if(p==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));var m=this._idToShortId.get(p);if(m==null)throw new Error("MiniSearch: cannot remove document with ID ".concat(p,": it is not in the index"));try{for(var y=oe(h),g=y.next();!g.done;g=y.next()){var v=g.value,w=f(e,v);if(w!=null){var _=u(w.toString(),v),S=this._fieldIds[v],T=new Set(_).size;this.removeFieldLength(m,S,this._documentCount,T);try{for(var C=(i=void 0,oe(_)),F=C.next();!F.done;F=C.next()){var R=F.value,N=c(R,v);if(Array.isArray(N))try{for(var D=(o=void 0,oe(N)),B=D.next();!B.done;B=D.next()){var L=B.value;this.removeTerm(S,m,L)}}catch(K){o={error:K}}finally{try{B&&!B.done&&(a=D.return)&&a.call(D)}finally{if(o)throw o.error}}else N&&this.removeTerm(S,m,N)}}catch(K){i={error:K}}finally{try{F&&!F.done&&(s=C.return)&&s.call(C)}finally{if(i)throw i.error}}}}}catch(K){n={error:K}}finally{try{g&&!g.done&&(r=y.return)&&r.call(y)}finally{if(n)throw n.error}}this._storedFields.delete(m),this._documentIds.delete(m),this._idToShortId.delete(p),this._fieldLength.delete(m),this._documentCount-=1},t.prototype.removeAll=function(e){var n,r;if(e)try{for(var i=oe(e),s=i.next();!s.done;s=i.next()){var o=s.value;this.remove(o)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new mo,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}},t.prototype.discard=function(e){var n=this,r=this._idToShortId.get(e);if(r==null)throw new Error("MiniSearch: cannot discard document with ID ".concat(e,": it is not in the index"));this._idToShortId.delete(e),this._documentIds.delete(r),this._storedFields.delete(r),(this._fieldLength.get(r)||[]).forEach(function(i,s){n.removeFieldLength(r,s,n._documentCount,i)}),this._fieldLength.delete(r),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()},t.prototype.maybeAutoVacuum=function(){if(this._options.autoVacuum!==!1){var e=this._options.autoVacuum,n=e.minDirtFactor,r=e.minDirtCount,i=e.batchSize,s=e.batchWait;this.conditionalVacuum({batchSize:i,batchWait:s},{minDirtCount:r,minDirtFactor:n})}},t.prototype.discardAll=function(e){var n,r,i=this._options.autoVacuum;try{this._options.autoVacuum=!1;try{for(var s=oe(e),o=s.next();!o.done;o=s.next()){var a=o.value;this.discard(a)}}catch(l){n={error:l}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}finally{this._options.autoVacuum=i}this.maybeAutoVacuum()},t.prototype.replace=function(e){var n=this._options,r=n.idField,i=n.extractField,s=i(e,r);this.discard(s),this.add(e)},t.prototype.vacuum=function(e){return e===void 0&&(e={}),this.conditionalVacuum(e)},t.prototype.conditionalVacuum=function(e,n){var r=this;return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&n,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(function(){var i=r._enqueuedVacuumConditions;return r._enqueuedVacuumConditions=xo,r.performVacuuming(e,i)}),this._enqueuedVacuum)):this.vacuumConditionsMet(n)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)},t.prototype.performVacuuming=function(e,n){return bd(this,void 0,void 0,function(){var r,i,s,o,a,l,u,c,f,h,d,p,m,y,g,v,w,_,S,T,C,F,R,N,D;return wd(this,function(B){switch(B.label){case 0:if(r=this._dirtCount,!this.vacuumConditionsMet(n))return[3,10];i=e.batchSize||wo.batchSize,s=e.batchWait||wo.batchWait,o=1,B.label=1;case 1:B.trys.push([1,7,8,9]),a=oe(this._index),l=a.next(),B.label=2;case 2:if(l.done)return[3,6];u=Ie(l.value,2),c=u[0],f=u[1];try{for(h=(F=void 0,oe(f)),d=h.next();!d.done;d=h.next()){p=Ie(d.value,2),m=p[0],y=p[1];try{for(g=(N=void 0,oe(y)),v=g.next();!v.done;v=g.next())w=Ie(v.value,1),_=w[0],!this._documentIds.has(_)&&(y.size<=1?f.delete(m):y.delete(_))}catch(L){N={error:L}}finally{try{v&&!v.done&&(D=g.return)&&D.call(g)}finally{if(N)throw N.error}}}}catch(L){F={error:L}}finally{try{d&&!d.done&&(R=h.return)&&R.call(h)}finally{if(F)throw F.error}}return this._index.get(c).size===0&&this._index.delete(c),o%i!==0?[3,4]:[4,new Promise(function(L){return setTimeout(L,s)})];case 3:B.sent(),B.label=4;case 4:o+=1,B.label=5;case 5:return l=a.next(),[3,2];case 6:return[3,9];case 7:return S=B.sent(),T={error:S},[3,9];case 8:try{l&&!l.done&&(C=a.return)&&C.call(a)}finally{if(T)throw T.error}return[7];case 9:this._dirtCount-=r,B.label=10;case 10:return[4,null];case 11:return B.sent(),this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null,[2]}})})},t.prototype.vacuumConditionsMet=function(e){if(e==null)return!0;var n=e.minDirtCount,r=e.minDirtFactor;return n=n||_o.minDirtCount,r=r||_o.minDirtFactor,this.dirtCount>=n&&this.dirtFactor>=r},Object.defineProperty(t.prototype,"isVacuuming",{get:function(){return this._currentVacuum!=null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dirtCount",{get:function(){return this._dirtCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dirtFactor",{get:function(){return this._dirtCount/(1+this._documentCount+this._dirtCount)},enumerable:!1,configurable:!0}),t.prototype.has=function(e){return this._idToShortId.has(e)},t.prototype.getStoredFields=function(e){var n=this._idToShortId.get(e);if(n!=null)return this._storedFields.get(n)},t.prototype.search=function(e,n){var r,i;n===void 0&&(n={});var s=this.executeQuery(e,n),o=[];try{for(var a=oe(s),l=a.next();!l.done;l=a.next()){var u=Ie(l.value,2),c=u[0],f=u[1],h=f.score,d=f.terms,p=f.match,m=d.length||1,y={id:this._documentIds.get(c),score:h*m,terms:Object.keys(p),queryTerms:d,match:p};Object.assign(y,this._storedFields.get(c)),(n.filter==null||n.filter(y))&&o.push(y)}}catch(g){r={error:g}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return e===t.wildcard&&n.boostDocument==null&&this._options.searchOptions.boostDocument==null||o.sort(Yl),o},t.prototype.autoSuggest=function(e,n){var r,i,s,o;n===void 0&&(n={}),n=_e(_e({},this._options.autoSuggestOptions),n);var a=new Map;try{for(var l=oe(this.search(e,n)),u=l.next();!u.done;u=l.next()){var c=u.value,f=c.score,h=c.terms,d=h.join(" "),p=a.get(d);p!=null?(p.score+=f,p.count+=1):a.set(d,{score:f,terms:h,count:1})}}catch(S){r={error:S}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}var m=[];try{for(var y=oe(a),g=y.next();!g.done;g=y.next()){var v=Ie(g.value,2),p=v[0],w=v[1],f=w.score,h=w.terms,_=w.count;m.push({suggestion:p,terms:h,score:f/_})}}catch(S){s={error:S}}finally{try{g&&!g.done&&(o=y.return)&&o.call(y)}finally{if(s)throw s.error}}return m.sort(Yl),m},Object.defineProperty(t.prototype,"documentCount",{get:function(){return this._documentCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"termCount",{get:function(){return this._index.size},enumerable:!1,configurable:!0}),t.loadJSON=function(e,n){if(n==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),n)},t.getDefault=function(e){if(vo.hasOwnProperty(e))return yo(vo,e);throw new Error('MiniSearch: unknown option "'.concat(e,'"'))},t.loadJS=function(e,n){var r,i,s,o,a,l,u=e.index,c=e.documentCount,f=e.nextId,h=e.documentIds,d=e.fieldIds,p=e.fieldLength,m=e.averageFieldLength,y=e.storedFields,g=e.dirtCount,v=e.serializationVersion;if(v!==1&&v!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");var w=new t(n);w._documentCount=c,w._nextId=f,w._documentIds=Ii(h),w._idToShortId=new Map,w._fieldIds=d,w._fieldLength=Ii(p),w._avgFieldLength=m,w._storedFields=Ii(y),w._dirtCount=g||0,w._index=new mo;try{for(var _=oe(w._documentIds),S=_.next();!S.done;S=_.next()){var T=Ie(S.value,2),C=T[0],F=T[1];w._idToShortId.set(F,C)}}catch(xe){r={error:xe}}finally{try{S&&!S.done&&(i=_.return)&&i.call(_)}finally{if(r)throw r.error}}try{for(var R=oe(u),N=R.next();!N.done;N=R.next()){var D=Ie(N.value,2),B=D[0],L=D[1],K=new Map;try{for(var ee=(a=void 0,oe(Object.keys(L))),Q=ee.next();!Q.done;Q=ee.next()){var ae=Q.value,le=L[ae];v===1&&(le=le.ds),K.set(parseInt(ae,10),Ii(le))}}catch(xe){a={error:xe}}finally{try{Q&&!Q.done&&(l=ee.return)&&l.call(ee)}finally{if(a)throw a.error}}w._index.set(B,K)}}catch(xe){s={error:xe}}finally{try{N&&!N.done&&(o=R.return)&&o.call(R)}finally{if(s)throw s.error}}return w},t.prototype.executeQuery=function(e,n){var r=this;if(n===void 0&&(n={}),e===t.wildcard)return this.executeWildcardQuery(n);if(typeof e!="string"){var i=_e(_e(_e({},n),e),{queries:void 0}),s=e.queries.map(function(y){return r.executeQuery(y,i)});return this.combineResults(s,i.combineWith)}var o=this._options,a=o.tokenize,l=o.processTerm,u=o.searchOptions,c=_e(_e({tokenize:a,processTerm:l},u),n),f=c.tokenize,h=c.processTerm,d=f(e).flatMap(function(y){return h(y)}).filter(function(y){return!!y}),p=d.map(Pd(c)),m=p.map(function(y){return r.executeQuerySpec(y,c)});return this.combineResults(m,c.combineWith)},t.prototype.executeQuerySpec=function(e,n){var r,i,s,o,a=_e(_e({},this._options.searchOptions),n),l=(a.fields||this._options.fields).reduce(function(ae,le){var xe;return _e(_e({},ae),(xe={},xe[le]=yo(a.boost,le)||1,xe))},{}),u=a.boostDocument,c=a.weights,f=a.maxFuzzy,h=a.bm25,d=_e(_e({},Gl.weights),c),p=d.fuzzy,m=d.prefix,y=this._index.get(e.term),g=this.termResults(e.term,e.term,1,y,l,u,h),v,w;if(e.prefix&&(v=this._index.atPrefix(e.term)),e.fuzzy){var _=e.fuzzy===!0?.2:e.fuzzy,S=_<1?Math.min(f,Math.round(e.term.length*_)):_;S&&(w=this._index.fuzzyGet(e.term,S))}if(v)try{for(var T=oe(v),C=T.next();!C.done;C=T.next()){var F=Ie(C.value,2),R=F[0],N=F[1],D=R.length-e.term.length;if(D){w==null||w.delete(R);var B=m*R.length/(R.length+.3*D);this.termResults(e.term,R,B,N,l,u,h,g)}}}catch(ae){r={error:ae}}finally{try{C&&!C.done&&(i=T.return)&&i.call(T)}finally{if(r)throw r.error}}if(w)try{for(var L=oe(w.keys()),K=L.next();!K.done;K=L.next()){var R=K.value,ee=Ie(w.get(R),2),Q=ee[0],D=ee[1];if(D){var B=p*R.length/(R.length+D);this.termResults(e.term,R,B,Q,l,u,h,g)}}}catch(ae){s={error:ae}}finally{try{K&&!K.done&&(o=L.return)&&o.call(L)}finally{if(s)throw s.error}}return g},t.prototype.executeWildcardQuery=function(e){var n,r,i=new Map,s=_e(_e({},this._options.searchOptions),e);try{for(var o=oe(this._documentIds),a=o.next();!a.done;a=o.next()){var l=Ie(a.value,2),u=l[0],c=l[1],f=s.boostDocument?s.boostDocument(c,"",this._storedFields.get(u)):1;i.set(u,{score:f,terms:[],match:{}})}}catch(h){n={error:h}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i},t.prototype.combineResults=function(e,n){if(n===void 0&&(n=So),e.length===0)return new Map;var r=n.toLowerCase();return e.reduce(Td[r])||new Map},t.prototype.toJSON=function(){var e,n,r,i,s=[];try{for(var o=oe(this._index),a=o.next();!a.done;a=o.next()){var l=Ie(a.value,2),u=l[0],c=l[1],f={};try{for(var h=(r=void 0,oe(c)),d=h.next();!d.done;d=h.next()){var p=Ie(d.value,2),m=p[0],y=p[1];f[m]=Object.fromEntries(y)}}catch(g){r={error:g}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}s.push([u,f])}}catch(g){e={error:g}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:s,serializationVersion:2}},t.prototype.termResults=function(e,n,r,i,s,o,a,l){var u,c,f,h,d;if(l===void 0&&(l=new Map),i==null)return l;try{for(var p=oe(Object.keys(s)),m=p.next();!m.done;m=p.next()){var y=m.value,g=s[y],v=this._fieldIds[y],w=i.get(v);if(w!=null){var _=w.size,S=this._avgFieldLength[v];try{for(var T=(f=void 0,oe(w.keys())),C=T.next();!C.done;C=T.next()){var F=C.value;if(!this._documentIds.has(F)){this.removeTerm(v,F,n),_-=1;continue}var R=o?o(this._documentIds.get(F),n,this._storedFields.get(F)):1;if(R){var N=w.get(F),D=this._fieldLength.get(F)[v],B=Fd(N,_,this._documentCount,D,S,a),L=r*g*R*B,K=l.get(F);if(K){K.score+=L,Md(K.terms,e);var ee=yo(K.match,n);ee?ee.push(y):K.match[n]=[y]}else l.set(F,{score:L,terms:[e],match:(d={},d[n]=[y],d)})}}}catch(Q){f={error:Q}}finally{try{C&&!C.done&&(h=T.return)&&h.call(T)}finally{if(f)throw f.error}}}}}catch(Q){u={error:Q}}finally{try{m&&!m.done&&(c=p.return)&&c.call(p)}finally{if(u)throw u.error}}return l},t.prototype.addTerm=function(e,n,r){var i=this._index.fetch(r,Ql),s=i.get(e);if(s==null)s=new Map,s.set(n,1),i.set(e,s);else{var o=s.get(n);s.set(n,(o||0)+1)}},t.prototype.removeTerm=function(e,n,r){if(!this._index.has(r)){this.warnDocumentChanged(n,e,r);return}var i=this._index.fetch(r,Ql),s=i.get(e);s==null||s.get(n)==null?this.warnDocumentChanged(n,e,r):s.get(n)<=1?s.size<=1?i.delete(e):s.delete(n):s.set(n,s.get(n)-1),this._index.get(r).size===0&&this._index.delete(r)},t.prototype.warnDocumentChanged=function(e,n,r){var i,s;try{for(var o=oe(Object.keys(this._fieldIds)),a=o.next();!a.done;a=o.next()){var l=a.value;if(this._fieldIds[l]===n){this._options.logger("warn","MiniSearch: document with ID ".concat(this._documentIds.get(e),' has changed before removal: term "').concat(r,'" was not present in field "').concat(l,'". Removing a document after it has changed can corrupt the index!'),"version_conflict");return}}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype.addDocumentId=function(e){var n=this._nextId;return this._idToShortId.set(e,n),this._documentIds.set(n,e),this._documentCount+=1,this._nextId+=1,n},t.prototype.addFields=function(e){for(var n=0;n<e.length;n++)this._fieldIds[e[n]]=n},t.prototype.addFieldLength=function(e,n,r,i){var s=this._fieldLength.get(e);s==null&&this._fieldLength.set(e,s=[]),s[n]=i;var o=this._avgFieldLength[n]||0,a=o*r+i;this._avgFieldLength[n]=a/(r+1)},t.prototype.removeFieldLength=function(e,n,r,i){if(r===1){this._avgFieldLength[n]=0;return}var s=this._avgFieldLength[n]*r-i;this._avgFieldLength[n]=s/(r-1)},t.prototype.saveStoredFields=function(e,n){var r,i,s=this._options,o=s.storeFields,a=s.extractField;if(!(o==null||o.length===0)){var l=this._storedFields.get(e);l==null&&this._storedFields.set(e,l={});try{for(var u=oe(o),c=u.next();!c.done;c=u.next()){var f=c.value,h=a(n,f);h!==void 0&&(l[f]=h)}}catch(d){r={error:d}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}},t.wildcard=Symbol("*"),t}(),yo=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0},Td=(vr={},vr[So]=function(t,e){var n,r;try{for(var i=oe(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value,a=t.get(o);if(a==null)t.set(o,e.get(o));else{var l=e.get(o),u=l.score,c=l.terms,f=l.match;a.score=a.score+u,a.match=Object.assign(a.match,f),Xl(a.terms,c)}}}catch(h){n={error:h}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return t},vr[ru]=function(t,e){var n,r,i=new Map;try{for(var s=oe(e.keys()),o=s.next();!o.done;o=s.next()){var a=o.value,l=t.get(a);if(l!=null){var u=e.get(a),c=u.score,f=u.terms,h=u.match;Xl(l.terms,f),i.set(a,{score:l.score+c,terms:l.terms,match:Object.assign(l.match,h)})}}}catch(d){n={error:d}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i},vr[Ad]=function(t,e){var n,r;try{for(var i=oe(e.keys()),s=i.next();!s.done;s=i.next()){var o=s.value;t.delete(o)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return t},vr),Cd={k:1.2,b:.7,d:.5},Fd=function(t,e,n,r,i,s){var o=s.k,a=s.b,l=s.d,u=Math.log(1+(n-e+.5)/(e+.5));return u*(l+t*(o+1)/(t+o*(1-a+a*r/i)))},Pd=function(t){return function(e,n,r){var i=typeof t.fuzzy=="function"?t.fuzzy(e,n,r):t.fuzzy||!1,s=typeof t.prefix=="function"?t.prefix(e,n,r):t.prefix===!0;return{term:e,fuzzy:i,prefix:s}}},vo={idField:"id",extractField:function(t,e){return t[e]},tokenize:function(t){return t.split(kd)},processTerm:function(t){return t.toLowerCase()},fields:void 0,searchOptions:void 0,storeFields:[],logger:function(t,e){typeof(console==null?void 0:console[t])=="function"&&console[t](e)},autoVacuum:!0},Gl={combineWith:So,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:Cd},Id={combineWith:ru,prefix:function(t,e,n){return e===n.length-1}},wo={batchSize:1e3,batchWait:10},xo={minDirtFactor:.1,minDirtCount:20},_o=_e(_e({},wo),xo),Md=function(t,e){t.includes(e)||t.push(e)},Xl=function(t,e){var n,r;try{for(var i=oe(e),s=i.next();!s.done;s=i.next()){var o=s.value;t.includes(o)||t.push(o)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},Yl=function(t,e){var n=t.score,r=e.score;return r-n},Ql=function(){return new Map},Ii=function(t){var e,n,r=new Map;try{for(var i=oe(Object.keys(t)),s=i.next();!s.done;s=i.next()){var o=s.value;r.set(parseInt(o,10),t[o])}}catch(a){e={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},kd=/[\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;var Ao=Ce(Pe());var Oi=class{constructor(e){this.text=e}};var Od=/[\u4e00-\u9fa5]/,iu=/[\u4e00-\u9fa5]/g,su=/[\u4e00-\u9fa5]/,Di=class{static isLargeCharset(e){return(e.match(iu)||[]).length>=Math.ceil(e.length*.35)}static testWideChar(e){return Od.test(e)}static wideCharProportion(e){return(e.match(iu)||[]).length/e.length}};var ou=Ce(Pe());var Dd=/[\[\]{}()<>\s]+/u,Ld=/[\^=#%\/\*,\.`:;\?@\s\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u,Rd=/[-_]|([a-z](?=[A-Z]))/g,xt=class{constructor(){this.setting=O(je);this.chsSegmenter=O(yt);this.logThrottled=cr(300,e=>M.info(e));this.assetsProvider=O(Je);this.stopWordsZh=this.assetsProvider.assets.stopWordsZh;this.stopWordsEn=this.assetsProvider.assets.stopWordsEn}tokenize(e,n){var s,o;let r=new Set,i=e.split(Dd);for(let a of i)if(a)if(this.setting.enableChinesePatch&&su.test(a)){let l=this.chsSegmenter.cut(a,!0);for(let u of l){if(this.setting.enableStopWordsZh&&((s=this.stopWordsZh)!=null&&s.has(u))){n==="search"&&u.length>1&&M.debug(`excluded: ${u}`);continue}r.add(u)}}else{let l=a.split(Ld);for(let u of l)if(!(u.length<2||this.setting.enableStopWordsEn&&((o=this.stopWordsEn)!=null&&o.has(u)))&&(r.add(u),u.length>3)){let c=u.replace(Rd,"$1 ").split(" ");for(let f of c)f.length>1&&r.add(f)}}return Array.from(r)}};xt=W([(0,ou.singleton)()],xt);var ln=class{static forType(e,n){return n&&Di.testWideChar(n)?this.limitsByLanguage["\u7B80\u4F53\u4E2D\u6587"][e]:this.limitsByLanguage["English"][e]}},ut=ln;ut.default={line:{maxPreLines:0,maxPostLines:0,maxPreChars:30,maxPostChars:230,boundaryLineMinChars:4},paragraph:{maxPreLines:4,maxPostLines:7,maxPreChars:220,maxPostChars:600,boundaryLineMinChars:4},subItem:{maxPreLines:3,maxPostLines:3,maxPreChars:180,maxPostChars:200,boundaryLineMinChars:4}},ut.limitsByLanguage={["Other Language"]:ln.default,["English"]:ln.default,["\u7B80\u4F53\u4E2D\u6587"]:{line:{...ln.default.line,maxPreChars:30,maxPostChars:230},paragraph:{...ln.default.paragraph,maxPreChars:220,maxPostChars:600},subItem:{...ln.default.subItem,maxPreChars:60,maxPostChars:80}}};var et=class{constructor(){this.option=O(_r);this.pluginSetting=O(je);this.filesIndex=new ki(this.option.fileIndexOption);this.linesIndex=new ki(this.option.lineIndexOption);this.tokenizer=O(xt);this._isReady=!1}async reIndexAll(e){this._isReady=!1,this.filesIndex.removeAll(),Array.isArray(e)?(M.trace("Indexing all documents..."),await this.addDocuments(e)):(M.trace("Loading indexed data..."),this.filesIndex=ki.loadJS(e,this.option.fileIndexOption)),this._isReady=!0,M.trace(this.filesIndex)}get isReady(){return this._isReady}async addDocuments(e){let n=e.filter(r=>!this.filesIndex.has(r.path));await this.filesIndex.addAllAsync(n,{chunkSize:this.option.documentChunkSize}),M.debug(`added ${n.length}`)}deleteDocuments(e){let n=e.filter(r=>this.filesIndex.has(r));this.filesIndex.discardAll(n),M.debug(`deleted ${n.length}`)}async fzfMatch(e,n){return(await new Pi(n,{selector:i=>i.text}).find(e)).slice(0,this.pluginSetting.ui.maxItemResults).map(i=>({text:i.item.text,row:i.item.row,positions:i.positions}))}async searchFiles(e){let n="and",r=new Oi(e),i=this.filesIndex.search(r.text,this.option.getFileSearchOption(n));return M.debug(`maxFileItems: ${this.pluginSetting.ui.maxItemResults}`),i.slice(0,this.pluginSetting.ui.maxItemResults).map(s=>({path:s.id,queryTerms:s.queryTerms,matchedTerms:s.terms}))}async searchLinesByFileItem(e,n,r,i,s){M.debug(i.queryTerms),M.debug(i.matchedTerms);let o=50;return M.debug(`max subItems: ${o}`),new br(e,n,r,i.queryTerms,i.matchedTerms,s).parse()}async searchLinesForSmallCharset(e,n,r){this.linesIndex.removeAll(),this.linesIndex.addAll(e);let i=this.linesIndex.search(n,this.option.getLineSearchOption());return M.debug(`matched lines count: ${i.length}`),M.debug(`only parse top ${r} matched lines per file`),i.slice(0,r).map(s=>{let o=e[s.id].text;return{text:o,row:s.id,positions:this.findAllTermPositions(o,s.terms)}})}findAllTermPositions(e,n){let r=new RegExp(n.join("|"),"gi"),i=new Set,s,o=-1;for(;(s=r.exec(e))!==null;){if(s.index===o||s[0].length===0){r.lastIndex++;continue}for(let a=0;a<s[0].length;a++)i.add(s.index+a);o=s.index}return i}};W([$e],et.prototype,"reIndexAll",1),W([$e],et.prototype,"searchFiles",1),W([$e],et.prototype,"searchLinesForSmallCharset",1),et=W([(0,Ao.singleton)()],et);var _r=class{constructor(){this.inSetting=Sl.search;this.tokenizer=O(xt);this.tokenizeIndex=e=>this.tokenizer.tokenize(e,"index");this.tokenizeSearch=e=>this.tokenizer.tokenize(e,"search");this.fileIndexOption={tokenize:this.tokenizeIndex,idField:"path",fields:["basename","aliases","folder","headings","content"],storeFields:["tags"]};this.lineIndexOption={tokenize:this.tokenizeIndex,idField:"row",fields:["text"]}}getFileSearchOption(e){return{tokenize:this.tokenizeSearch,prefix:n=>n.length>=this.inSetting.minTermLengthForPrefixSearch,fuzzy:n=>n.length<=3?0:this.inSetting.fuzzyProportion,boost:{basename:this.inSetting.weightFilename,aliases:this.inSetting.weightFilename,folder:this.inSetting.weightFolder,tags:this.inSetting.weightTagText,headings:this.inSetting.weightHeading},combineWith:e}}getLineSearchOption(){return{prefix:e=>e.length>=this.inSetting.minTermLengthForPrefixSearch,fuzzy:e=>e.length<=3?0:this.inSetting.fuzzyProportion,combineWith:"or"}}};_r=W([(0,Ao.singleton)()],_r);var br=class{constructor(e,n,r,i,s,o){this.lines=e,this.matchedTerms=this.filterMatchedTerms(i,s),this.maxParsedLines=o;let a=ut.forType(n,r);this.preChars=a.maxPreChars,this.postChars=a.maxPostChars,M.debug(`doc matchedTerms: ${this.matchedTerms.join(" ")}`)}parse(){return this.highlightLines(this.getTopRelevantLines(this.lines,this.maxParsedLines))}filterMatchedTerms(e,n){let r=e.filter(s=>!e.some(o=>o.length>s.length&&o.includes(s))&&n.includes(s)),i;if(r.length===0)i=n.filter(s=>!n.some(o=>o.length>s.length&&o.includes(s)));else{i=r;for(let s of n)!r.includes(s)&&!this.isSubstringOrSuperString(s,n)&&i.push(s)}return i}isSubstringOrSuperString(e,n){return n.some(r=>r.length>e.length&&r.includes(e)||e.length>r.length&&e.includes(r))}getTopRelevantLines(e,n){let r=new RegExp(this.matchedTerms.join("|"),"i"),i=this.matchedTerms.map(l=>new RegExp(l,"gi")),s=new Ti((l,u)=>l-u,n);s.push(0);let o=new Map,a=new Map;for(let l of e){if(!r.test(l.text))continue;a.clear();let u=0;for(let c of i){c.lastIndex=0;let f;for(;(f=c.exec(l.text))!==null;){let h=f[0],d=(a.get(h)||0)+1;a.set(h,d),u+=d===1?10*h.length:.1}}u>s.peek()&&(s.push(u),o.set(l,u))}return Array.from(o.entries()).sort((l,u)=>u[1]-l[1]).slice(0,n).map(l=>l[0])}highlightLines(e){let n=new Map;for(let r of this.matchedTerms)n.set(r,new RegExp(r,"gi"));return e.map(r=>{let i=new Set,s=-1,o=-1;for(let a=this.matchedTerms.length-1;a>=0;a--){let l=this.matchedTerms[a],u=r.text.search(n.get(l));if(u!==-1){s=Math.max(0,u-this.preChars),o=Math.min(r.text.length,u+l.length+this.postChars);break}}if(s!==-1&&o!==-1){let a=r.text.slice(s,o);for(let l of this.matchedTerms){let u=n.get(l),c;for(;(c=u.exec(a))!==null;){let f=c.index+s,h=f+c[0].length;for(let d=f;d<h;d++)i.add(d)}}}return{text:r.text,row:r.row,positions:i}})}};W([$e],br.prototype,"getTopRelevantLines",1),W([$e],br.prototype,"highlightLines",1);var On=class{constructor(){this.lexicalEngine=O(et)}parseAll(e,n,r,i){return n.map(s=>{let o=fr.minInSet(s.positions),a=s.row,l=this.getTruncatedContext(e,a,o,r),u=l.matchedLineText,c=s.positions;s.row===l.lines[0].row&&(c=this.adjustPositionsByStartCol(c,l.firstLineStartCol));let f=this.highlightMatchedLine(u,c,i),h=l.lines.map(d=>d.row===a?f:d.text).join(ie.JOIN_EOL);return{row:s.row,col:o,text:h}})}parse(e,n,r,i){return this.parseAll(e,[n],r,i)[0]}async parseLineItems(e,n){let r=n.replace(/\s/g,""),i=[],s=await this.lexicalEngine.fzfMatch(r,e);for(let o of s){let a=o.row,l=fr.minInSet(o.positions),u=e[a].text,c=Math.max(l-30,0),f=Math.min(c+200,u.length),h=u.substring(c,f),d=this.adjustPositionsByStartCol(o.positions,c),p=this.highlightLineByCharPositions(h,d),m=await this.getLineHighlightedContext(e,a,l,n);i.push(new Vt({text:p,row:a,col:l},m))}return i}highlightMatchedLine(e,n,r){return r?`<span class="matched-line highlight-bg">${this.highlightLineByCharPositions(e,n)}</span>`:`<span class="matched-line">${this.highlightLineByCharPositions(e,n)}</span>`}highlightContextLine(e,n){let r=new RegExp(n,"gi");return e.replace(r,i=>`<mark>${i}</mark>`)}highlightLineByCharPositions(e,n){return e.split("").map((r,i)=>n.has(i)?`<mark>${r}</mark>`:r).join("")}adjustPositionsByStartCol(e,n){let r=new Set;return e.forEach(i=>{i>=n&&r.add(i-n)}),r}getTruncatedContext(e,n,r,i){if(e.length===0)return{lines:[],firstLineStartCol:0,matchedLineText:""};let s=i,o,a=0,l=0,u=e[n].text;if(r<s.maxPreChars){let c=this.extendContextAbove(e,n-1,s.maxPreChars-r,s.maxPreLines,s.boundaryLineMinChars);o=c.lines,a=c.firstLineStartCol;let f=Math.min(u.length-1,r+s.maxPostChars);f<u.length-1?(u=u.substring(0,f+1),o.push({text:u,row:n})):o.push(e[n]),l+=f-r}else{let c=r-s.maxPreChars;a=c;let f=Math.min(u.length-1,r+s.maxPostChars);f<u.length-1?u=u.substring(c,f+1):u=u.substring(c),o=[{text:u,row:n}],l+=f-r}return or.append(o,this.extendContextBelow(e,n+1,s.maxPostChars-l,s.maxPostLines,s.boundaryLineMinChars)),{lines:o,firstLineStartCol:a,matchedLineText:u}}extendContextAbove(e,n,r,i,s){let o=0,a=n,l=0,u=[];for(;a>=0&&n-a<i;){let c=e[a].text;if(l+c.length<r)u.unshift(e[a]),l+=c.length,--a;else if(l+c.length==r){u.unshift(e[a]);break}else{let f=l+c.length-r;o=f;let h=e[a].text.substring(f);u.unshift({text:h,row:a});break}}return u.length>0&&u[0].text.length<s&&(o=0,u.shift()),{lines:u,firstLineStartCol:o}}extendContextBelow(e,n,r,i,s){let o=n,a=0,l=[];for(;o<=e.length-1&&o-n<i;){let u=e[o].text;if(a+u.length<r)l.push(e[o]),a+=u.length,++o;else if(a+u.length==r){l.push(e[o]);break}else{let c=u.length-(a+u.length-r)-1,f=e[o].text.substring(0,c+1);l.push({text:f,row:o});break}}return l.length>0&&l[0].text.length<s&&l.pop(),l}async getLineHighlightedContext(e,n,r,i){let s=or.getCurrLanguage(),o=this.getTruncatedContext(e,n,r,ut.forType("paragraph")),a=o.lines;return(await Promise.all(a.map(async(u,c)=>{if(u.row===n){let f=await this.lexicalEngine.fzfMatch(i,[u]);try{let d=f[0].positions;return c===0&&(d=this.adjustPositionsByStartCol(d,o.firstLineStartCol)),this.highlightMatchedLine(u.text,d,!0)}catch(h){M.warn("There might be inconsistency with previous search step, which lead to a missed match to target line"),M.error(h)}}else return this.highlightContextLine(u.text,i)}))).join(ie.JOIN_EOL)}};On=W([(0,au.singleton)()],On);var Ut=require("obsidian");var cu=Ce(Pe());var lu=require("obsidian");var un="CleverSearch",To='"\u25B6"',Co='"\u25BC"';var Fo="&nbsp;&nbsp;&nbsp;&nbsp;";var uu=Ce(Pe());var ct=class{constructor(){this.app=O(lu.App);this.plugin=O(un)}getFileBacklinks(e){this.app.metadataCache.getBacklinksForFile(e)}getAppId(){return this.app.appId}executeCommandById(e){this.app.commands.executeCommandById(e)}isNotExcludedPath(e){return!(this.app.metadataCache.isUserIgnored&&this.app.metadataCache.isUserIgnored(e))}};ct=W([(0,uu.singleton)()],ct);var tt=class{constructor(){this.tokenizer=O(xt);this.vault=O(Ut.Vault);this.app=O(Ut.App);this.supportedExtensions=new Set(["md"]);this.privateApi=O(ct);this.obsidianFs=this.vault.adapter}async generateAllIndexedDocuments(e){return Promise.all(e.map(async n=>{if(this.isContentIndexable(n)){let r=this.app.metadataCache.getFileCache(n);if(ie.getFileType(n.path)===0)return{path:n.path,basename:n.basename,folder:ie.getFolderPath(n.path),aliases:this.parseAliases(r),tags:this.parseTags(r),headings:this.parseHeadings(r),content:await this.readPlainText(n)};throw new Error(Tn)}else return{path:n.path,basename:n.basename,folder:ie.getFolderPath(n.path)}}))}allFilesToBeIndexed(){let e=this.vault.getFiles();M.debug(`all files: ${e.length}`),ie.countFileByExtensions(e);let n=e.filter(r=>this.isIndexable(r));return M.debug(`indexable files: ${n.length}`),ie.countFileByExtensions(n),n}isIndexable(e){if(e instanceof Ut.TFolder)return!1;let n;return typeof e=="string"?n=e:n=e.path,this.supportedExtensions.has(ie.getExtension(n))&&this.privateApi.isNotExcludedPath(n)}async readPlainText(e){let n=typeof e=="string"?this.vault.getAbstractFileByPath(e):e;if(ie.getFileType(n.path)===0)return this.vault.cachedRead(n);throw Error(`unsupported file extension as plain text to read, path: ${n.path}`)}async readPlainTextLines(e){return(await this.readPlainText(e)).split(ie.SPLIT_EOL)}parseAliases(e){return((0,Ut.parseFrontMatterAliases)(e==null?void 0:e.frontmatter)||[]).join(" ")}parseTags(e){var n;return((n=e==null?void 0:e.tags)==null?void 0:n.map(r=>r.tag.slice(1)).join(" "))||""}parseHeadings(e){var n;return((n=e==null?void 0:e.headings)==null?void 0:n.map(r=>r.heading).join(" "))||""}isContentIndexable(e){return tt.contentIndexableFileTypes.has(ie.getFileType(e.path))}};tt.contentIndexableFileTypes=new Set([0,1]),tt=W([(0,cu.singleton)()],tt);var vt=class{constructor(){this.app=O(fu.App);this.dataProvider=O(tt);this.lexicalEngine=O(et);this.lineHighlighter=O(On)}async searchInVault(e){let n=new $t("no result",[]);if(e.length===0)return n;let r=await this.lexicalEngine.searchFiles(e),i=[];return r.length!==0?{currPath:Tn,items:r.map(s=>new Pn(0,s.path,s.queryTerms,s.matchedTerms,[],"nothing"))}:(M.trace("lexical matched files count is 0"),n)}async getFileSubItems(e,n){let r=n.path;if(ie.getFileType(r)!==0)return M.warn(`file type for path "${r}" is not supported for sub-items.`),[];let s=(await this.dataProvider.readPlainText(r)).split(ie.SPLIT_EOL).map((l,u)=>new Fn(l,u));M.debug("target file lines count: ",s.length);let o=await this.lexicalEngine.searchLinesByFileItem(s,"subItem",e,n,30);return this.lineHighlighter.parseAll(s,o,ut.forType("subItem",e),!1).map(l=>({text:l.text,row:l.row,col:l.col}))}async searchInFile(e){let n=new $t("",[]),r=this.app.workspace.getActiveFile();if(!e||!r)return n;if(ie.getFileType(r.path)!==0)return M.trace("Current file isn't PLAINT_TEXT"),n;let i=(await this.dataProvider.readPlainTextLines(r.path)).map((l,u)=>new Fn(l,u)),s=e.replace(/\s/g,""),a=(await this.lexicalEngine.fzfMatch(s,i)).map(l=>{let u=this.lineHighlighter.parse(i,l,ut.forType("line"),!1),c=this.lineHighlighter.parse(i,l,ut.forType("paragraph"),!0);return new Vt(u,c.text)});return{currPath:r.path,items:a}}async deprecatedSearchInFile(e){let n=new $t("",[]),r=this.app.workspace.getActiveFile();if(!e||!r||ie.getFileType(r.path)!==0)return n;let i=r.path,s=(await this.dataProvider.readPlainTextLines(i)).map((a,l)=>new Fn(a,l)),o=await this.lineHighlighter.parseLineItems(s,e);return{currPath:i,items:o}}};W([$e],vt.prototype,"searchInVault",1),W([$e],vt.prototype,"getFileSubItems",1),W([$e],vt.prototype,"searchInFile",1),W([$e],vt.prototype,"deprecatedSearchInFile",1),vt=W([(0,hu.singleton)()],vt);async function pu(){let t=O(je);Nd()}function Nd(){let t=["foo","bar","cowbaz","distant","disney","\u8FD9\u91CC\u6709\u4E00\u53E5\u9ED1\u8272\u7684\u673A\u7532"],e="\u9ED1\u8272 \u673A\u7532",n={unicode:!0,interSplit:"[^\\p{L}\\d']+",intraSplit:"\\p{Ll}\\p{Lu}",intraBound:"\\p{L}\\d|\\d\\p{L}|\\p{Ll}\\p{Lu}",intraChars:"[\\p{L}\\d']",intraContr:"'\\p{L}{1,2}\\b"},i=new du.default(n).search(t,e);M.info(i[0]),M.info(i[1]),M.info(i[2])}var we=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,ke=Object.keys,Ue=Array.isArray;typeof Promise!="undefined"&&!we.Promise&&(we.Promise=Promise);function Ye(t,e){return typeof e!="object"||ke(e).forEach(function(n){t[n]=e[n]}),t}var Tr=Object.getPrototypeOf,Bd={}.hasOwnProperty;function rt(t,e){return Bd.call(t,e)}function Nn(t,e){typeof e=="function"&&(e=e(Tr(t))),(typeof Reflect=="undefined"?ke:Reflect.ownKeys)(e).forEach(n=>{Dt(t,n,e[n])})}var Cu=Object.defineProperty;function Dt(t,e,n,r){Cu(t,e,Ye(n&&rt(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Bn(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Dt(t.prototype,"constructor",t),{extend:Nn.bind(null,t.prototype)}}}}var zd=Object.getOwnPropertyDescriptor;function ca(t,e){let n=zd(t,e),r;return n||(r=Tr(t))&&ca(r,e)}var $d=[].slice;function ns(t,e,n){return $d.call(t,e,n)}function Fu(t,e){return e(t)}function wr(t){if(!t)throw new Error("Assertion Failed")}function Pu(t){we.setImmediate?setImmediate(t):setTimeout(t,0)}function Iu(t,e){return t.reduce((n,r,i)=>{var s=e(r,i);return s&&(n[s[0]]=s[1]),n},{})}function Vd(t,e,n){try{t.apply(null,n)}catch(r){e&&e(r)}}function Ot(t,e){if(rt(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,i=e.length;r<i;++r){var s=Ot(t,e[r]);n.push(s)}return n}var o=e.indexOf(".");if(o!==-1){var a=t[e.substr(0,o)];return a===void 0?void 0:Ot(a,e.substr(o+1))}}function _t(t,e,n){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){wr(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)_t(t,e[r],n[r])}else{var s=e.indexOf(".");if(s!==-1){var o=e.substr(0,s),a=e.substr(s+1);if(a==="")n===void 0?Ue(t)&&!isNaN(parseInt(o))?t.splice(o,1):delete t[o]:t[o]=n;else{var l=t[o];(!l||!rt(t,o))&&(l=t[o]={}),_t(l,a,n)}}else n===void 0?Ue(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function Kd(t,e){typeof e=="string"?_t(t,e,void 0):"length"in e&&[].map.call(e,function(n){_t(t,n,void 0)})}function Mu(t){var e={};for(var n in t)rt(t,n)&&(e[n]=t[n]);return e}var Ud=[].concat;function ku(t){return Ud.apply([],t)}var Ou="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ku([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>we[t]),Hd=Ou.map(t=>we[t]);Iu(Ou,t=>[t,!0]);var Wt=null;function Or(t){Wt=typeof WeakMap!="undefined"&&new WeakMap;let e=Ro(t);return Wt=null,e}function Ro(t){if(!t||typeof t!="object")return t;let e=Wt&&Wt.get(t);if(e)return e;if(Ue(t)){e=[],Wt&&Wt.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(Ro(t[n]))}else if(Hd.indexOf(t.constructor)>=0)e=t;else{let s=Tr(t);e=s===Object.prototype?{}:Object.create(s),Wt&&Wt.set(t,e);for(var i in t)rt(t,i)&&(e[i]=Ro(t[i]))}return e}var{toString:Wd}={};function jo(t){return Wd.call(t).slice(8,-1)}var No=typeof Symbol!="undefined"?Symbol.iterator:"@@iterator",qd=typeof No=="symbol"?function(t){var e;return t!=null&&(e=t[No])&&e.apply(t)}:function(){return null},Rn={};function Mt(t){var e,n,r,i;if(arguments.length===1){if(Ue(t))return t.slice();if(this===Rn&&typeof t=="string")return[t];if(i=qd(t)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var fa=typeof Symbol!="undefined"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1,St=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Du(t,e){St=t,Lu=e}var Lu=()=>!0,Gd=!new Error("").stack;function gn(){if(Gd)try{throw gn.arguments,new Error}catch(t){return t}return new Error}function Bo(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(Lu).map(r=>`
`+r).join("")):""}var Xd=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Ru=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ha=Xd.concat(Ru),Yd={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function zn(t,e){this._e=gn(),this.name=t,this.message=e}Bn(zn).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Bo(this._e,2))}},toString:function(){return this.name+": "+this.message}});function ju(t,e){return t+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,r,i)=>i.indexOf(n)===r).join(`
`)}function Wi(t,e,n,r){this._e=gn(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=ju(t,e)}Bn(Wi).from(zn);function Er(t,e){this._e=gn(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=ju(t,e)}Bn(Er).from(zn);var da=ha.reduce((t,e)=>(t[e]=e+"Error",t),{}),Qd=zn,q=ha.reduce((t,e)=>{var n=e+"Error";function r(i,s){this._e=gn(),this.name=n,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=Yd[e]||n,this.inner=null)}return Bn(r).from(Qd),t[e]=r,t},{});q.Syntax=SyntaxError;q.Type=TypeError;q.Range=RangeError;var mu=Ru.reduce((t,e)=>(t[e+"Error"]=q[e],t),{});function Zd(t,e){if(!t||t instanceof zn||t instanceof TypeError||t instanceof SyntaxError||!t.name||!mu[t.name])return t;var n=new mu[t.name](e||t.message,t);return"stack"in t&&Dt(n,"stack",{get:function(){return this.inner.stack}}),n}var rs=ha.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=q[e]),t),{});rs.ModifyError=Wi;rs.DexieError=zn;rs.BulkError=Er;function ge(){}function Dr(t){return t}function Jd(t,e){return t==null||t===Dr?e:function(n){return e(t(n))}}function pn(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function ep(t,e){return t===ge?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?pn(r,this.onsuccess):r),i&&(this.onerror=this.onerror?pn(i,this.onerror):i),s!==void 0?s:n}}function tp(t,e){return t===ge?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?pn(n,this.onsuccess):n),r&&(this.onerror=this.onerror?pn(r,this.onerror):r)}}function np(t,e){return t===ge?e:function(n){var r=t.apply(this,arguments);Ye(n,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?pn(i,this.onsuccess):i),s&&(this.onerror=this.onerror?pn(s,this.onerror):s),r===void 0?o===void 0?void 0:o:Ye(r,o)}}function rp(t,e){return t===ge?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function pa(t,e){return t===ge?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}var Cr={},ip=100,sp=20,Nu=100,[zo,qi,$o]=typeof Promise=="undefined"?[]:(()=>{let t=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[t,Tr(t),t];let e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Tr(e),t]})(),Bu=qi&&qi.then,zi=zo&&zo.constructor,ma=!!$o,Vo=!1,op=$o?()=>{$o.then(Li)}:we.setImmediate?setImmediate.bind(null,Li):we.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{Li(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(Li,0)},Fr=function(t,e){xr.push([t,e]),Gi&&(op(),Gi=!1)},Ko=!0,Gi=!0,hn=[],$i=[],Uo=null,Ho=Dr,jn={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:vu,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{vu(t[0],t[1])}catch(e){}})}},H=jn,xr=[],dn=0,Vi=[];function z(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ge,this._lib=!1;var e=this._PSD=H;if(St&&(this._stackHolder=gn(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Cr)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&qo(this,this._value);return}this._state=null,this._value=null,++e.ref,$u(this,t)}var Wo={get:function(){var t=H,e=Xi;function n(r,i){var s=!t.global&&(t!==H||e!==Xi);let o=s&&!Lt();var a=new z((l,u)=>{ga(this,new zu(Qi(r,t,s,o),Qi(i,t,s,o),l,u,t))});return St&&Uu(a,this),a}return n.prototype=Cr,n},set:function(t){Dt(this,"then",t&&t.prototype===Cr?Wo:{get:function(){return t},set:Wo.set})}};Nn(z.prototype,{then:Wo,_then:function(t,e){ga(this,new zu(null,null,t,e,H))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?n(r):Ki(r)):this.then(null,r=>r&&r.name===e?n(r):Ki(r))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),Ki(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Vo=!0;var t=Ku(this,[],sp),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Vo=!1}}},timeout:function(t,e){return t<1/0?new z((n,r)=>{var i=setTimeout(()=>r(new q.Timeout(e)),t);this.then(n,r).finally(clearTimeout.bind(null,i))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&Dt(z.prototype,Symbol.toStringTag,"Dexie.Promise");jn.env=Hu();function zu(t,e,n,r,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=i}Nn(z,{all:function(){var t=Mt.apply(null,arguments).map(Yi);return new z(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach((i,s)=>z.resolve(i).then(o=>{t[s]=o,--r||e(t)},n))})},resolve:t=>{if(t instanceof z)return t;if(t&&typeof t.then=="function")return new z((n,r)=>{t.then(n,r)});var e=new z(Cr,!0,t);return Uu(e,Uo),e},reject:Ki,race:function(){var t=Mt.apply(null,arguments).map(Yi);return new z((e,n)=>{t.map(r=>z.resolve(r).then(e,n))})},PSD:{get:()=>H,set:t=>H=t},totalEchoes:{get:()=>Xi},newPSD:Gt,usePSD:Vn,scheduler:{get:()=>Fr,set:t=>{Fr=t}},rejectionMapper:{get:()=>Ho,set:t=>{Ho=t}},follow:(t,e)=>new z((n,r)=>Gt((i,s)=>{var o=H;o.unhandleds=[],o.onunhandled=s,o.finalize=pn(function(){lp(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),t()},e,n,r))});zi&&(zi.allSettled&&Dt(z,"allSettled",function(){let t=Mt.apply(null,arguments).map(Yi);return new z(e=>{t.length===0&&e([]);let n=t.length,r=new Array(n);t.forEach((i,s)=>z.resolve(i).then(o=>r[s]={status:"fulfilled",value:o},o=>r[s]={status:"rejected",reason:o}).then(()=>--n||e(r)))})}),zi.any&&typeof AggregateError!="undefined"&&Dt(z,"any",function(){let t=Mt.apply(null,arguments).map(Yi);return new z((e,n)=>{t.length===0&&n(new AggregateError([]));let r=t.length,i=new Array(r);t.forEach((s,o)=>z.resolve(s).then(a=>e(a),a=>{i[o]=a,--r||n(new AggregateError(i))}))})}));function $u(t,e){try{e(n=>{if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&Lr();n&&typeof n.then=="function"?$u(t,(i,s)=>{n instanceof z?n._then(i,s):n.then(i,s)}):(t._state=!0,t._value=n,Vu(t)),r&&Rr()}},qo.bind(null,t))}catch(n){qo(t,n)}}function qo(t,e){if($i.push(e),t._state===null){var n=t._lib&&Lr();e=Ho(e),t._state=!1,t._value=e,St&&e!==null&&typeof e=="object"&&!e._promise&&Vd(()=>{var r=ca(e,"stack");e._promise=t,Dt(e,"stack",{get:()=>Vo?r&&(r.get?r.get.apply(e):r.value):t.stack})}),up(t),Vu(t),n&&Rr()}}function Vu(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)ga(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),dn===0&&(++dn,Fr(()=>{--dn===0&&ya()},[]))}function ga(t,e){if(t._state===null){t._listeners.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++dn,Fr(ap,[n,t,e])}function ap(t,e,n){try{Uo=e;var r,i=e._value;e._state?r=t(i):($i.length&&($i=[]),r=t(i),$i.indexOf(i)===-1&&cp(e)),n.resolve(r)}catch(s){n.reject(s)}finally{Uo=null,--dn===0&&ya(),--n.psd.ref||n.psd.finalize()}}function Ku(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var i=t._value,s,o;i!=null?(s=i.name||"Error",o=i.message||i,r=Bo(i,0)):(s=i,o=""),e.push(s+(o?": "+o:"")+r)}return St&&(r=Bo(t._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),t._prev&&Ku(t._prev,e,n)),e}function Uu(t,e){var n=e?e._numPrev+1:0;n<ip&&(t._prev=e,t._numPrev=n)}function Li(){Lr()&&Rr()}function Lr(){var t=Ko;return Ko=!1,Gi=!1,t}function Rr(){var t,e,n;do for(;xr.length>0;)for(t=xr,xr=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(xr.length>0);Ko=!0,Gi=!0}function ya(){var t=hn;hn=[],t.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=Vi.slice(0),n=e.length;n;)e[--n]()}function lp(t){function e(){t(),Vi.splice(Vi.indexOf(e),1)}Vi.push(e),++dn,Fr(()=>{--dn===0&&ya()},[])}function up(t){hn.some(e=>e._value===t._value)||hn.push(t)}function cp(t){for(var e=hn.length;e;)if(hn[--e]._value===t._value){hn.splice(e,1);return}}function Ki(t){return new z(Cr,!1,t)}function Ee(t,e){var n=H;return function(){var r=Lr(),i=H;try{return Xt(n,!0),t.apply(this,arguments)}catch(s){e&&e(s)}finally{Xt(i,!1),r&&Rr()}}}var Ke={awaits:0,echoes:0,id:0},fp=0,Ui=[],Io=0,Xi=0,hp=0;function Gt(t,e,n,r){var i=H,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++hp;var o=jn.env;s.env=ma?{Promise:z,PromiseProp:{value:z,configurable:!0,writable:!0},all:z.all,race:z.race,allSettled:z.allSettled,any:z.any,resolve:z.resolve,reject:z.reject,nthen:gu(o.nthen,s),gthen:gu(o.gthen,s)}:{},e&&Ye(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Vn(s,t,n,r);return s.ref===0&&s.finalize(),a}function $n(){return Ke.id||(Ke.id=++fp),++Ke.awaits,Ke.echoes+=Nu,Ke.id}function Lt(){return Ke.awaits?(--Ke.awaits===0&&(Ke.id=0),Ke.echoes=Ke.awaits*Nu,!0):!1}(""+Bu).indexOf("[native code]")===-1&&($n=Lt=ge);function Yi(t){return Ke.echoes&&t&&t.constructor===zi?($n(),t.then(e=>(Lt(),e),e=>(Lt(),Le(e)))):t}function dp(t){++Xi,(!Ke.echoes||--Ke.echoes===0)&&(Ke.echoes=Ke.id=0),Ui.push(H),Xt(t,!0)}function pp(){var t=Ui[Ui.length-1];Ui.pop(),Xt(t,!1)}function Xt(t,e){var n=H;if((e?Ke.echoes&&(!Io++||t!==H):Io&&(!--Io||t!==H))&&Wu(e?dp.bind(null,t):pp),t!==H&&(H=t,n===jn&&(jn.env=Hu()),ma)){var r=jn.env.Promise,i=t.env;qi.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(we,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Hu(){var t=we.Promise;return ma?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(we,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:qi.then,gthen:t.prototype.then}:{}}function Vn(t,e,n,r,i){var s=H;try{return Xt(t,!0),e(n,r,i)}finally{Xt(s,!1)}}function Wu(t){Bu.call(zo,t)}function Qi(t,e,n,r){return typeof t!="function"?t:function(){var i=H;n&&$n(),Xt(e,!0);try{return t.apply(this,arguments)}finally{Xt(i,!1),r&&Wu(Lt)}}}function gu(t,e){return function(n,r){return t.call(this,Qi(n,e),Qi(r,e))}}var yu="unhandledrejection";function vu(t,e){var n;try{n=e.onuncatched(t)}catch(s){}if(n!==!1)try{var r,i={promise:e,reason:t};if(we.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(yu,!0,!0),Ye(r,i)):we.CustomEvent&&(r=new CustomEvent(yu,{detail:i}),Ye(r,i)),r&&we.dispatchEvent&&(dispatchEvent(r),!we.PromiseRejectionEvent&&we.onunhandledrejection))try{we.onunhandledrejection(r)}catch(s){}St&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch(s){}}var Le=z.reject;function Go(t,e,n,r){if(!t.idbdb||!t._state.openComplete&&!H.letThrough&&!t._vip){if(t._state.openComplete)return Le(new q.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return Le(new q.DatabaseClosed);t.open().catch(ge)}return t._state.dbReadyPromise.then(()=>Go(t,e,n,r))}else{var i=t._createTransaction(e,n,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(s){return s.name===da.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Go(t,e,n,r))):Le(s)}return i._promise(e,(s,o)=>Gt(()=>(H.trans=i,r(s,o,i)))).then(s=>i._completion.then(()=>s))}}var _u="3.2.4",fn=String.fromCharCode(65535),Xo=-1/0,Pt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",qu="String expected.",Sr=[],is=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),mp=is,gp=is,Gu=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),ss="__dbnames",Mo="readonly",ko="readwrite";function mn(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var Xu={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ri(t){return typeof t=="string"&&!/\./.test(t)?e=>(e[t]===void 0&&t in e&&(e=Or(e),delete e[t]),e):e=>e}var Yo=class{_trans(e,n,r){let i=this._tx||H.trans,s=this.name;function o(l,u,c){if(!c.schema[s])throw new q.NotFound("Table "+s+" not part of transaction");return n(c.idbtrans,c)}let a=Lr();try{return i&&i.db===this.db?i===H.trans?i._promise(e,o,r):Gt(()=>i._promise(e,o,r),{trans:i,transless:H.transless||H}):Go(this.db,e,[this.name],o)}finally{a&&Rr()}}get(e,n){return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(i=>this.hook.reading.fire(i))).then(n)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Ue(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);let n=ke(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);let r=this.schema.indexes.concat(this.schema.primKey).filter(u=>u.compound&&n.every(c=>u.keyPath.indexOf(c)>=0)&&u.keyPath.every(c=>n.indexOf(c)>=0))[0];if(r&&this.db._maxKey!==fn)return this.where(r.name).equals(r.keyPath.map(u=>e[u]));!r&&St&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);let{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(u,c){try{return s.cmp(u,c)===0}catch(f){return!1}}let[a,l]=n.reduce(([u,c],f)=>{let h=i[f],d=e[f];return[u||h,u||!h?mn(c,h&&h.multi?p=>{let m=Ot(p,f);return Ue(m)&&m.some(y=>o(d,y))}:p=>o(d,Ot(p,f))):c]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(l):r?this.filter(l):this.where(n).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Ue(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;let n=r=>{if(!r)return r;let i=Object.create(e.prototype);for(var s in r)if(rt(r,s))try{i[s]=r[s]}catch(o){}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e}defineClass(){function e(n){Ye(this,n)}return this.mapToClass(e)}add(e,n){let{auto:r,keyPath:i}=this.schema.primKey,s=e;return i&&r&&(s=Ri(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:n!=null?[n]:null,values:[s]})).then(o=>o.numFailures?z.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{_t(e,i,o)}catch(a){}return o})}update(e,n){if(typeof e=="object"&&!Ue(e)){let r=Ot(e,this.schema.primKey.keyPath);if(r===void 0)return Le(new q.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?ke(n).forEach(i=>{_t(e,i,n[i])}):n(e,{value:e,primKey:r})}catch(i){}return this.where(":id").equals(r).modify(n)}else return this.where(":id").equals(e).modify(n)}put(e,n){let{auto:r,keyPath:i}=this.schema.primKey,s=e;return i&&r&&(s=Ri(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:n!=null?[n]:null})).then(o=>o.numFailures?z.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{_t(e,i,o)}catch(a){}return o})}delete(e){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[e]})).then(n=>n.numFailures?z.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Xu})).then(e=>e.numFailures?z.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",n=>this.core.getMany({keys:e,trans:n}).then(r=>r.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,n,r){let i=Array.isArray(n)?n:void 0;r=r||(i?void 0:n);let s=r?r.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new q.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new q.InvalidArgument("Arguments objects and keys must have the same length");let u=e.length,c=l&&a?e.map(Ri(l)):e;return this.core.mutate({trans:o,type:"add",keys:i,values:c,wantResults:s}).then(({numFailures:f,results:h,lastResult:d,failures:p})=>{let m=s?h:d;if(f===0)return m;throw new Er(`${this.name}.bulkAdd(): ${f} of ${u} operations failed`,p)})})}bulkPut(e,n,r){let i=Array.isArray(n)?n:void 0;r=r||(i?void 0:n);let s=r?r.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&i)throw new q.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new q.InvalidArgument("Arguments objects and keys must have the same length");let u=e.length,c=l&&a?e.map(Ri(l)):e;return this.core.mutate({trans:o,type:"put",keys:i,values:c,wantResults:s}).then(({numFailures:f,results:h,lastResult:d,failures:p})=>{let m=s?h:d;if(f===0)return m;throw new Er(`${this.name}.bulkPut(): ${f} of ${u} operations failed`,p)})})}bulkDelete(e){let n=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:i,failures:s})=>{if(r===0)return i;throw new Er(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,s)})}};function jr(t){var e={},n=function(a,l){if(l){for(var u=arguments.length,c=new Array(u-1);--u;)c[u-1]=arguments[u];return e[a].subscribe.apply(null,c),t}else if(typeof a=="string")return e[a]};n.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return n;function s(a,l,u){if(typeof a=="object")return o(a);l||(l=rp),u||(u=ge);var c={subscribers:[],fire:u,subscribe:function(f){c.subscribers.indexOf(f)===-1&&(c.subscribers.push(f),c.fire=l(c.fire,f))},unsubscribe:function(f){c.subscribers=c.subscribers.filter(function(h){return h!==f}),c.fire=c.subscribers.reduce(l,u)}};return e[a]=n[a]=c,c}function o(a){ke(a).forEach(function(l){var u=a[l];if(Ue(u))s(l,a[l][0],a[l][1]);else if(u==="asap")var c=s(l,Dr,function(){for(var h=arguments.length,d=new Array(h);h--;)d[h]=arguments[h];c.subscribers.forEach(function(p){Pu(function(){p.apply(null,d)})})});else throw new q.InvalidArgument("Invalid event config")})}}function Nr(t,e){return Bn(e).from({prototype:t}),e}function yp(t){return Nr(Yo.prototype,function(n,r,i){this.db=t,this._tx=i,this.name=n,this.schema=r,this.hook=t._allTables[n]?t._allTables[n].hook:jr(null,{creating:[ep,ge],reading:[Jd,Dr],updating:[np,ge],deleting:[tp,ge]})})}function Dn(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Oo(t,e){t.filter=mn(t.filter,e)}function Do(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>mn(r(),e()):e,t.justLimit=n&&!r}function vp(t,e){t.isMatch=mn(t.isMatch,e)}function Hi(t,e){if(t.isPrimKey)return e.primaryKey;let n=e.getIndexByKeyPath(t.index);if(!n)throw new q.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function bu(t,e,n){let r=Hi(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function ji(t,e,n,r){let i=t.replayFilter?mn(t.filter,t.replayFilter()):t.filter;if(t.or){let s={},o=(a,l,u)=>{if(!i||i(l,u,h=>l.stop(h),h=>l.fail(h))){var c=l.primaryKey,f=""+c;f==="[object ArrayBuffer]"&&(f=""+new Uint8Array(c)),rt(s,f)||(s[f]=!0,e(a,l,u))}};return Promise.all([t.or._iterate(o,n),wu(bu(t,r,n),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}else return wu(bu(t,r,n),mn(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function wu(t,e,n,r){var i=r?(o,a,l)=>n(r(o),a,l):n,s=Ee(i);return t.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();(!e||e(o,l=>a=l,l=>{o.stop(l),a=ge},l=>{o.fail(l),a=ge}))&&s(o.value,o,l=>a=l),a()})})}function Xe(t,e){try{let n=xu(t),r=xu(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return bp(Eu(t),Eu(e));case"Array":return _p(t,e)}}catch(n){}return NaN}function _p(t,e){let n=t.length,r=e.length,i=n<r?n:r;for(let s=0;s<i;++s){let o=Xe(t[s],e[s]);if(o!==0)return o}return n===r?0:n<r?-1:1}function bp(t,e){let n=t.length,r=e.length,i=n<r?n:r;for(let s=0;s<i;++s)if(t[s]!==e[s])return t[s]<e[s]?-1:1;return n===r?0:n<r?-1:1}function xu(t){let e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";let n=jo(t);return n==="ArrayBuffer"?"binary":n}function Eu(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var Qo=class{_read(e,n){var r=this._ctx;return r.error?r.table._trans(null,Le.bind(null,r.error)):r.table._trans("readonly",e).then(n)}_write(e){var n=this._ctx;return n.error?n.table._trans(null,Le.bind(null,n.error)):n.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var n=this._ctx;n.algorithm=mn(n.algorithm,e)}_iterate(e,n){return ji(this._ctx,e,n,this._ctx.table.core)}clone(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&Ye(r,e),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(e){var n=this._ctx;return this._read(r=>ji(n,e,r,n.table.core))}count(e){return this._read(n=>{let r=this._ctx,i=r.table.core;if(Dn(r,!0))return i.count({trans:n,query:{index:Hi(r,i.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var s=0;return ji(r,()=>(++s,!1),n,i).then(()=>s)}).then(e)}sortBy(e,n){let r=e.split(".").reverse(),i=r[0],s=r.length-1;function o(u,c){return c?o(u[r[c]],c-1):u[i]}var a=this._ctx.dir==="next"?1:-1;function l(u,c){var f=o(u,s),h=o(c,s);return f<h?-a:f>h?a:0}return this.toArray(function(u){return u.sort(l)}).then(n)}toArray(e){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&Dn(r,!0)&&r.limit>0){let{valueMapper:i}=r,s=Hi(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:s,range:r.range}}).then(({result:o})=>i?o.map(i):o)}else{let i=[];return ji(r,s=>i.push(s),n,r.table.core).then(()=>i)}},e)}offset(e){var n=this._ctx;return e<=0?this:(n.offset+=e,Dn(n)?Do(n,()=>{var r=e;return(i,s)=>r===0?!0:r===1?(--r,!1):(s(()=>{i.advance(r),r=0}),!1)}):Do(n,()=>{var r=e;return()=>--r<0}),this)}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Do(this._ctx,()=>{var n=e;return function(r,i,s){return--n<=0&&i(s),n>=0}},!0),this}until(e,n){return Oo(this._ctx,function(r,i,s){return e(r.value)?(i(s),n):!0}),this}first(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){return Oo(this._ctx,function(n){return e(n.value)}),vp(this._ctx,e),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})}keys(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,s){r.push(s.key)}).then(function(){return r}).then(e)}primaryKeys(e){var n=this._ctx;if(n.dir==="next"&&Dn(n,!0)&&n.limit>0)return this._read(i=>{var s=Hi(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:s,range:n.range}})}).then(({result:i})=>i).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,s){r.push(s.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(n){return n[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return Oo(this._ctx,function(i){var s=i.primaryKey.toString(),o=rt(r,s);return r[s]=!0,!o}),this}modify(e){var n=this._ctx;return this._write(r=>{var i;if(typeof e=="function")i=e;else{var s=ke(e),o=s.length;i=function(m){for(var y=!1,g=0;g<o;++g){var v=s[g],w=e[v];Ot(m,v)!==w&&(_t(m,v,w),y=!0)}return y}}let a=n.table.core,{outbound:l,extractKey:u}=a.schema.primaryKey,c=this.db._options.modifyChunkSize||200,f=[],h=0,d=[],p=(m,y)=>{let{failures:g,numFailures:v}=y;h+=m-v;for(let w of ke(g))f.push(g[w])};return this.clone().primaryKeys().then(m=>{let y=g=>{let v=Math.min(c,m.length-g);return a.getMany({trans:r,keys:m.slice(g,g+v),cache:"immutable"}).then(w=>{let _=[],S=[],T=l?[]:null,C=[];for(let R=0;R<v;++R){let N=w[R],D={value:Or(N),primKey:m[g+R]};i.call(D,D.value,D)!==!1&&(D.value==null?C.push(m[g+R]):!l&&Xe(u(N),u(D.value))!==0?(C.push(m[g+R]),_.push(D.value)):(S.push(D.value),l&&T.push(m[g+R])))}let F=Dn(n)&&n.limit===1/0&&(typeof e!="function"||e===Lo)&&{index:n.index,range:n.range};return Promise.resolve(_.length>0&&a.mutate({trans:r,type:"add",values:_}).then(R=>{for(let N in R.failures)C.splice(parseInt(N),1);p(_.length,R)})).then(()=>(S.length>0||F&&typeof e=="object")&&a.mutate({trans:r,type:"put",keys:T,values:S,criteria:F,changeSpec:typeof e!="function"&&e}).then(R=>p(S.length,R))).then(()=>(C.length>0||F&&e===Lo)&&a.mutate({trans:r,type:"delete",keys:C,criteria:F}).then(R=>p(C.length,R))).then(()=>m.length>g+v&&y(g+c))})};return y(0).then(()=>{if(f.length>0)throw new Wi("Error modifying one or more objects",f,h,d);return m.length})})})}delete(){var e=this._ctx,n=e.range;return Dn(e)&&(e.isPrimKey&&!gp||n.type===3)?this._write(r=>{let{primaryKey:i}=e.table.core.schema,s=n;return e.table.core.count({trans:r,query:{index:i,range:s}}).then(o=>e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(({failures:a,lastResult:l,results:u,numFailures:c})=>{if(c)throw new Wi("Could not delete some values",Object.keys(a).map(f=>a[f]),o-c);return o-c}))}):this.modify(Lo)}},Lo=(t,e)=>e.value=null;function wp(t){return Nr(Qo.prototype,function(n,r){this.db=t;let i=Xu,s=null;if(r)try{i=r()}catch(u){s=u}let o=n._ctx,a=o.table,l=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:s,or:o.or,valueMapper:l!==Dr?l:null}})}function xp(t,e){return t<e?-1:t===e?0:1}function Ep(t,e){return t>e?-1:t===e?0:1}function nt(t,e,n){var r=t instanceof Zi?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function Ln(t){return new t.Collection(t,()=>Yu("")).limit(0)}function Sp(t){return t==="next"?e=>e.toUpperCase():e=>e.toLowerCase()}function Ap(t){return t==="next"?e=>e.toLowerCase():e=>e.toUpperCase()}function Tp(t,e,n,r,i,s){for(var o=Math.min(t.length,r.length),a=-1,l=0;l<o;++l){var u=e[l];if(u!==r[l])return i(t[l],n[l])<0?t.substr(0,l)+n[l]+n.substr(l+1):i(t[l],r[l])<0?t.substr(0,l)+r[l]+n.substr(l+1):a>=0?t.substr(0,a)+e[a]+n.substr(a+1):null;i(t[l],u)<0&&(a=l)}return o<r.length&&s==="next"?t+n.substr(t.length):o<t.length&&s==="prev"?t.substr(0,n.length):a<0?null:t.substr(0,a)+r[a]+n.substr(a+1)}function Ni(t,e,n,r){var i,s,o,a,l,u,c,f=n.length;if(!n.every(m=>typeof m=="string"))return nt(t,qu);function h(m){i=Sp(m),s=Ap(m),o=m==="next"?xp:Ep;var y=n.map(function(g){return{lower:s(g),upper:i(g)}}).sort(function(g,v){return o(g.lower,v.lower)});a=y.map(function(g){return g.upper}),l=y.map(function(g){return g.lower}),u=m,c=m==="next"?"":r}h("next");var d=new t.Collection(t,()=>Ht(a[0],l[f-1]+r));d._ondirectionchange=function(m){h(m)};var p=0;return d._addAlgorithm(function(m,y,g){var v=m.key;if(typeof v!="string")return!1;var w=s(v);if(e(w,l,p))return!0;for(var _=null,S=p;S<f;++S){var T=Tp(v,w,a[S],l[S],o,u);T===null&&_===null?p=S+1:(_===null||o(_,T)>0)&&(_=T)}return y(_!==null?function(){m.continue(_+c)}:g),!1}),d}function Ht(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Yu(t){return{type:1,lower:t,upper:t}}var Zi=class{get Collection(){return this._ctx.table.db.Collection}between(e,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||i)&&!(r&&i)?Ln(this):new this.Collection(this,()=>Ht(e,n,!r,!i))}catch(s){return nt(this,Pt)}}equals(e){return e==null?nt(this,Pt):new this.Collection(this,()=>Yu(e))}above(e){return e==null?nt(this,Pt):new this.Collection(this,()=>Ht(e,void 0,!0))}aboveOrEqual(e){return e==null?nt(this,Pt):new this.Collection(this,()=>Ht(e,void 0,!1))}below(e){return e==null?nt(this,Pt):new this.Collection(this,()=>Ht(void 0,e,!1,!0))}belowOrEqual(e){return e==null?nt(this,Pt):new this.Collection(this,()=>Ht(void 0,e))}startsWith(e){return typeof e!="string"?nt(this,qu):this.between(e,e+fn,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):Ni(this,(n,r)=>n.indexOf(r[0])===0,[e],fn)}equalsIgnoreCase(e){return Ni(this,(n,r)=>n===r[0],[e],"")}anyOfIgnoreCase(){var e=Mt.apply(Rn,arguments);return e.length===0?Ln(this):Ni(this,(n,r)=>r.indexOf(n)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=Mt.apply(Rn,arguments);return e.length===0?Ln(this):Ni(this,(n,r)=>r.some(i=>n.indexOf(i)===0),e,fn)}anyOf(){let e=Mt.apply(Rn,arguments),n=this._cmp;try{e.sort(n)}catch(s){return nt(this,Pt)}if(e.length===0)return Ln(this);let r=new this.Collection(this,()=>Ht(e[0],e[e.length-1]));r._ondirectionchange=s=>{n=s==="next"?this._ascending:this._descending,e.sort(n)};let i=0;return r._addAlgorithm((s,o,a)=>{let l=s.key;for(;n(l,e[i])>0;)if(++i,i===e.length)return o(a),!1;return n(l,e[i])===0?!0:(o(()=>{s.continue(e[i])}),!1)}),r}notEqual(e){return this.inAnyRange([[Xo,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let e=Mt.apply(Rn,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch(r){return nt(this,Pt)}let n=e.reduce((r,i)=>r?r.concat([[r[r.length-1][1],i]]):[[Xo,i]],null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,n){let r=this._cmp,i=this._ascending,s=this._descending,o=this._min,a=this._max;if(e.length===0)return Ln(this);if(!e.every(_=>_[0]!==void 0&&_[1]!==void 0&&i(_[0],_[1])<=0))return nt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",q.InvalidArgument);let l=!n||n.includeLowers!==!1,u=n&&n.includeUppers===!0;function c(_,S){let T=0,C=_.length;for(;T<C;++T){let F=_[T];if(r(S[0],F[1])<0&&r(S[1],F[0])>0){F[0]=o(F[0],S[0]),F[1]=a(F[1],S[1]);break}}return T===C&&_.push(S),_}let f=i;function h(_,S){return f(_[0],S[0])}let d;try{d=e.reduce(c,[]),d.sort(h)}catch(_){return nt(this,Pt)}let p=0,m=u?_=>i(_,d[p][1])>0:_=>i(_,d[p][1])>=0,y=l?_=>s(_,d[p][0])>0:_=>s(_,d[p][0])>=0;function g(_){return!m(_)&&!y(_)}let v=m,w=new this.Collection(this,()=>Ht(d[0][0],d[d.length-1][1],!l,!u));return w._ondirectionchange=_=>{_==="next"?(v=m,f=i):(v=y,f=s),d.sort(h)},w._addAlgorithm((_,S,T)=>{for(var C=_.key;v(C);)if(++p,p===d.length)return S(T),!1;return g(C)?!0:(this._cmp(C,d[p][1])===0||this._cmp(C,d[p][0])===0||S(()=>{f===i?_.continue(d[p][0]):_.continue(d[p][1])}),!1)}),w}startsWithAnyOf(){let e=Mt.apply(Rn,arguments);return e.every(n=>typeof n=="string")?e.length===0?Ln(this):this.inAnyRange(e.map(n=>[n,n+fn])):nt(this,"startsWithAnyOf() only works with strings")}};function Cp(t){return Nr(Zi.prototype,function(n,r,i){this.db=t,this._ctx={table:n,index:r===":id"?null:r,or:i};let s=t._deps.indexedDB;if(!s)throw new q.MissingAPI;this._cmp=this._ascending=s.cmp.bind(s),this._descending=(o,a)=>s.cmp(a,o),this._max=(o,a)=>s.cmp(o,a)>0?o:a,this._min=(o,a)=>s.cmp(o,a)<0?o:a,this._IDBKeyRange=t._deps.IDBKeyRange})}function Et(t){return Ee(function(e){return Pr(e),t(e.target.error),!1})}function Pr(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Ir="storagemutated",qt="x-storagemutated-1",Yt=jr(null,Ir),Zo=class{_lock(){return wr(!H.global),++this._reculock,this._reculock===1&&!H.global&&(H.lockOwnerFor=this),this}_unlock(){if(wr(!H.global),--this._reculock===0)for(H.global||(H.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Vn(e[1],e[0])}catch(n){}}return this}_locked(){return this._reculock&&H.lockOwnerFor!==this}create(e){if(!this.mode)return this;let n=this.db.idbdb,r=this.db._state.dbOpenError;if(wr(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new q.DatabaseClosed(r);case"MissingAPIError":throw new q.MissingAPI(r.message,r);default:throw new q.OpenFailed(r)}if(!this.active)throw new q.TransactionInactive;return wr(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=Ee(i=>{Pr(i),this._reject(e.error)}),e.onabort=Ee(i=>{Pr(i),this.active&&this._reject(new q.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=Ee(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Yt.storagemutated.fire(e.mutatedParts)}),this}_promise(e,n,r){if(e==="readwrite"&&this.mode!=="readwrite")return Le(new q.ReadOnly("Transaction is readonly"));if(!this.active)return Le(new q.TransactionInactive);if(this._locked())return new z((s,o)=>{this._blockedFuncs.push([()=>{this._promise(e,n,r).then(s,o)},H])});if(r)return Gt(()=>{var s=new z((o,a)=>{this._lock();let l=n(o,a,this);l&&l.then&&l.then(o,a)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new z((s,o)=>{var a=n(s,o,this);a&&a.then&&a.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var n=this._root();let r=z.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=n._waitingFor;return new z((o,a)=>{r.then(l=>n._waitingQueue.push(Ee(o.bind(null,l))),l=>n._waitingQueue.push(Ee(a.bind(null,l)))).finally(()=>{n._waitingFor===s&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new q.Abort))}table(e){let n=this._memoizedTables||(this._memoizedTables={});if(rt(n,e))return n[e];let r=this.schema[e];if(!r)throw new q.NotFound("Table "+e+" not part of transaction");let i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),n[e]=i,i}};function Fp(t){return Nr(Zo.prototype,function(n,r,i,s,o){this.db=t,this.mode=n,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=s,this.idbtrans=null,this.on=jr(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new z((a,l)=>{this._resolve=a,this._reject=l}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var l=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):l&&this.idbtrans&&this.idbtrans.abort(),Le(a)})})}function Jo(t,e,n,r,i,s,o){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:s,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+Qu(e)}}function Qu(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Zu(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:Iu(n,r=>[r.name,r])}}function Pp(t){return t.length===1?t[0]:t}var Mr=t=>{try{return t.only([[]]),Mr=()=>[[]],[[]]}catch(e){return Mr=()=>fn,fn}};function ea(t){return t==null?()=>{}:typeof t=="string"?Ip(t):e=>Ot(e,t)}function Ip(t){return t.split(".").length===1?n=>n[t]:n=>Ot(n,t)}function Su(t){return[].slice.call(t)}var Mp=0;function Ar(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function kp(t,e,n){function r(c,f){let h=Su(c.objectStoreNames);return{schema:{name:c.name,tables:h.map(d=>f.objectStore(d)).map(d=>{let{keyPath:p,autoIncrement:m}=d,y=Ue(p),g=p==null,v={},w={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:g,compound:y,keyPath:p,autoIncrement:m,unique:!0,extractKey:ea(p)},indexes:Su(d.indexNames).map(_=>d.index(_)).map(_=>{let{name:S,unique:T,multiEntry:C,keyPath:F}=_,R=Ue(F),N={name:S,compound:R,keyPath:F,unique:T,multiEntry:C,extractKey:ea(F)};return v[Ar(F)]=N,N}),getIndexByKeyPath:_=>v[Ar(_)]};return v[":id"]=w.primaryKey,p!=null&&(v[Ar(p)]=w.primaryKey),w})},hasGetAll:h.length>0&&"getAll"in f.objectStore(h[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(c){if(c.type===3)return null;if(c.type===4)throw new Error("Cannot convert never type to IDBKeyRange");let{lower:f,upper:h,lowerOpen:d,upperOpen:p}=c;return f===void 0?h===void 0?null:e.upperBound(h,!!p):h===void 0?e.lowerBound(f,!!d):e.bound(f,h,!!d,!!p)}function s(c){let f=c.name;function h({trans:m,type:y,keys:g,values:v,range:w}){return new Promise((_,S)=>{_=Ee(_);let T=m.objectStore(f),C=T.keyPath==null,F=y==="put"||y==="add";if(!F&&y!=="delete"&&y!=="deleteRange")throw new Error("Invalid operation type: "+y);let{length:R}=g||v||{length:1};if(g&&v&&g.length!==v.length)throw new Error("Given keys array must have same length as given values array.");if(R===0)return _({numFailures:0,failures:{},results:[],lastResult:void 0});let N,D=[],B=[],L=0,K=Q=>{++L,Pr(Q)};if(y==="deleteRange"){if(w.type===4)return _({numFailures:L,failures:B,results:[],lastResult:void 0});w.type===3?D.push(N=T.clear()):D.push(N=T.delete(i(w)))}else{let[Q,ae]=F?C?[v,g]:[v,null]:[g,null];if(F)for(let le=0;le<R;++le)D.push(N=ae&&ae[le]!==void 0?T[y](Q[le],ae[le]):T[y](Q[le])),N.onerror=K;else for(let le=0;le<R;++le)D.push(N=T[y](Q[le])),N.onerror=K}let ee=Q=>{let ae=Q.target.result;D.forEach((le,xe)=>le.error!=null&&(B[xe]=le.error)),_({numFailures:L,failures:B,results:y==="delete"?g:D.map(le=>le.result),lastResult:ae})};N.onerror=Q=>{K(Q),ee(Q)},N.onsuccess=ee})}function d({trans:m,values:y,query:g,reverse:v,unique:w}){return new Promise((_,S)=>{_=Ee(_);let{index:T,range:C}=g,F=m.objectStore(f),R=T.isPrimaryKey?F:F.index(T.name),N=v?w?"prevunique":"prev":w?"nextunique":"next",D=y||!("openKeyCursor"in R)?R.openCursor(i(C),N):R.openKeyCursor(i(C),N);D.onerror=Et(S),D.onsuccess=Ee(B=>{let L=D.result;if(!L){_(null);return}L.___id=++Mp,L.done=!1;let K=L.continue.bind(L),ee=L.continuePrimaryKey;ee&&(ee=ee.bind(L));let Q=L.advance.bind(L),ae=()=>{throw new Error("Cursor not started")},le=()=>{throw new Error("Cursor not stopped")};L.trans=m,L.stop=L.continue=L.continuePrimaryKey=L.advance=ae,L.fail=Ee(S),L.next=function(){let xe=1;return this.start(()=>xe--?this.continue():this.stop()).then(()=>this)},L.start=xe=>{let at=new Promise((x,P)=>{x=Ee(x),D.onerror=Et(P),L.fail=P,L.stop=j=>{L.stop=L.continue=L.continuePrimaryKey=L.advance=le,x(j)}}),ue=()=>{if(D.result)try{xe()}catch(x){L.fail(x)}else L.done=!0,L.start=()=>{throw new Error("Cursor behind last entry")},L.stop()};return D.onsuccess=Ee(x=>{D.onsuccess=ue,ue()}),L.continue=K,L.continuePrimaryKey=ee,L.advance=Q,ue(),at},_(L)},S)})}function p(m){return y=>new Promise((g,v)=>{g=Ee(g);let{trans:w,values:_,limit:S,query:T}=y,C=S===1/0?void 0:S,{index:F,range:R}=T,N=w.objectStore(f),D=F.isPrimaryKey?N:N.index(F.name),B=i(R);if(S===0)return g({result:[]});if(m){let L=_?D.getAll(B,C):D.getAllKeys(B,C);L.onsuccess=K=>g({result:K.target.result}),L.onerror=Et(v)}else{let L=0,K=_||!("openKeyCursor"in D)?D.openCursor(B):D.openKeyCursor(B),ee=[];K.onsuccess=Q=>{let ae=K.result;if(!ae)return g({result:ee});if(ee.push(_?ae.value:ae.primaryKey),++L===S)return g({result:ee});ae.continue()},K.onerror=Et(v)}})}return{name:f,schema:c,mutate:h,getMany({trans:m,keys:y}){return new Promise((g,v)=>{g=Ee(g);let w=m.objectStore(f),_=y.length,S=new Array(_),T=0,C=0,F,R=D=>{let B=D.target;(S[B._pos]=B.result)!=null,++C===T&&g(S)},N=Et(v);for(let D=0;D<_;++D)y[D]!=null&&(F=w.get(y[D]),F._pos=D,F.onsuccess=R,F.onerror=N,++T);T===0&&g(S)})},get({trans:m,key:y}){return new Promise((g,v)=>{g=Ee(g);let _=m.objectStore(f).get(y);_.onsuccess=S=>g(S.target.result),_.onerror=Et(v)})},query:p(a),openCursor:d,count({query:m,trans:y}){let{index:g,range:v}=m;return new Promise((w,_)=>{let S=y.objectStore(f),T=g.isPrimaryKey?S:S.index(g.name),C=i(v),F=C?T.count(C):T.count();F.onsuccess=Ee(R=>w(R.target.result)),F.onerror=Et(_)})}}}let{schema:o,hasGetAll:a}=r(t,n),l=o.tables.map(c=>s(c)),u={};return l.forEach(c=>u[c.name]=c),{stack:"dbcore",transaction:t.transaction.bind(t),table(c){if(!u[c])throw new Error(`Table '${c}' not found`);return u[c]},MIN_KEY:-1/0,MAX_KEY:Mr(e),schema:o}}function Op(t,e){return e.reduce((n,{create:r})=>({...n,...r(n)}),t)}function Dp(t,e,{IDBKeyRange:n,indexedDB:r},i){return{dbcore:Op(kp(e,n,i),t.dbcore)}}function va({_novip:t},e){let n=e.db,r=Dp(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(i=>{let s=i.name;t.core.schema.tables.some(o=>o.name===s)&&(i.core=t.core.table(s),t[s]instanceof t.Table&&(t[s].core=i.core))})}function Ji({_novip:t},e,n,r){n.forEach(i=>{let s=r[i];e.forEach(o=>{let a=ca(o,i);(!a||"value"in a&&a.value===void 0)&&(o===t.Transaction.prototype||o instanceof t.Transaction?Dt(o,i,{get(){return this.table(i)},set(l){Cu(this,i,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new t.Table(i,s))})})}function ta({_novip:t},e){e.forEach(n=>{for(let r in n)n[r]instanceof t.Table&&delete n[r]})}function Lp(t,e){return t._cfg.version-e._cfg.version}function Rp(t,e,n,r){let i=t._dbSchema,s=t._createTransaction("readwrite",t._storeNames,i);s.create(n),s._completion.catch(r);let o=s._reject.bind(s),a=H.transless||H;Gt(()=>{H.trans=s,H.transless=a,e===0?(ke(i).forEach(l=>{_a(n,l,i[l].primKey,i[l].indexes)}),va(t,n),z.follow(()=>t.on.populate.fire(s)).catch(o)):jp(t,e,s,n).catch(o)})}function jp({_novip:t},e,n,r){let i=[],s=t._versions,o=t._dbSchema=ba(t,t.idbdb,r),a=!1;s.filter(c=>c._cfg.version>=e).forEach(c=>{i.push(()=>{let f=o,h=c._cfg.dbschema;ra(t,f,r),ra(t,h,r),o=t._dbSchema=h;let d=Ju(f,h);d.add.forEach(m=>{_a(r,m[0],m[1].primKey,m[1].indexes)}),d.change.forEach(m=>{if(m.recreate)throw new q.Upgrade("Not yet support for changing primary key");{let y=r.objectStore(m.name);m.add.forEach(g=>na(y,g)),m.change.forEach(g=>{y.deleteIndex(g.name),na(y,g)}),m.del.forEach(g=>y.deleteIndex(g))}});let p=c._cfg.contentUpgrade;if(p&&c._cfg.version>e){va(t,r),n._memoizedTables={},a=!0;let m=Mu(h);d.del.forEach(w=>{m[w]=f[w]}),ta(t,[t.Transaction.prototype]),Ji(t,[t.Transaction.prototype],ke(m),m),n.schema=m;let y=fa(p);y&&$n();let g,v=z.follow(()=>{if(g=p(n),g&&y){var w=Lt.bind(null,null);g.then(w,w)}});return g&&typeof g.then=="function"?z.resolve(g):v.then(()=>g)}}),i.push(f=>{if(!a||!mp){let h=c._cfg.dbschema;Bp(h,f)}ta(t,[t.Transaction.prototype]),Ji(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),n.schema=t._dbSchema})});function u(){return i.length?z.resolve(i.shift()(n.idbtrans)).then(u):z.resolve()}return u().then(()=>{Np(o,r)})}function Ju(t,e){let n={del:[],add:[],change:[]},r;for(r in t)e[r]||n.del.push(r);for(r in e){let i=t[r],s=e[r];if(!i)n.add.push([r,s]);else{let o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!is)o.recreate=!0,n.change.push(o);else{let a=i.idxByName,l=s.idxByName,u;for(u in a)l[u]||o.del.push(u);for(u in l){let c=a[u],f=l[u];c?c.src!==f.src&&o.change.push(f):o.add.push(f)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}}return n}function _a(t,e,n,r){let i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(s=>na(i,s)),i}function Np(t,e){ke(t).forEach(n=>{e.db.objectStoreNames.contains(n)||_a(e,n,t[n].primKey,t[n].indexes)})}function Bp(t,e){[].slice.call(e.db.objectStoreNames).forEach(n=>t[n]==null&&e.db.deleteObjectStore(n))}function na(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function ba(t,e,n){let r={};return ns(e.objectStoreNames,0).forEach(s=>{let o=n.objectStore(s),a=o.keyPath,l=Jo(Qu(a),a||"",!1,!1,!!o.autoIncrement,a&&typeof a!="string",!0),u=[];for(let f=0;f<o.indexNames.length;++f){let h=o.index(o.indexNames[f]);a=h.keyPath;var c=Jo(h.name,a,!!h.unique,!!h.multiEntry,!1,a&&typeof a!="string",!1);u.push(c)}r[s]=Zu(s,l,u)}),r}function zp({_novip:t},e,n){t.verno=e.version/10;let r=t._dbSchema=ba(t,e,n);t._storeNames=ns(e.objectStoreNames,0),Ji(t,[t._allTables],ke(r),r)}function $p(t,e){let n=ba(t,t.idbdb,e),r=Ju(n,t._dbSchema);return!(r.add.length||r.change.some(i=>i.add.length||i.change.length))}function ra({_novip:t},e,n){let r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){let s=r[i],o=n.objectStore(s);t._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){let l=o.indexNames[a],u=o.index(l).keyPath,c=typeof u=="string"?u:"["+ns(u).join("+")+"]";if(e[s]){let f=e[s].idxByName[c];f&&(f.name=l,delete e[s].idxByName[c],e[s].idxByName[l]=f)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&we.WorkerGlobalScope&&we instanceof we.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function Vp(t){return t.split(",").map((e,n)=>{e=e.trim();let r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return Jo(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Ue(i),n===0)})}var ia=class{_parseStoresSpec(e,n){ke(e).forEach(r=>{if(e[r]!==null){var i=Vp(e[r]),s=i.shift();if(s.multi)throw new q.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new q.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new q.Schema("Index must have a name and cannot be an empty string")}),n[r]=Zu(r,s,i)}})}stores(e){let n=this.db;this._cfg.storesSource=this._cfg.storesSource?Ye(this._cfg.storesSource,e):e;let r=n._versions,i={},s={};return r.forEach(o=>{Ye(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),n._dbSchema=s,ta(n,[n._allTables,n,n.Transaction.prototype]),Ji(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],ke(s),s),n._storeNames=ke(s),this}upgrade(e){return this._cfg.contentUpgrade=pa(this._cfg.contentUpgrade||ge,e),this}};function Kp(t){return Nr(ia.prototype,function(n){this.db=t,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function wa(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new ft(ss,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function xa(t){return t&&typeof t.databases=="function"}function Up({indexedDB:t,IDBKeyRange:e}){return xa(t)?Promise.resolve(t.databases()).then(n=>n.map(r=>r.name).filter(r=>r!==ss)):wa(t,e).toCollection().primaryKeys()}function Hp({indexedDB:t,IDBKeyRange:e},n){!xa(t)&&n!==ss&&wa(t,e).put({name:n}).catch(ge)}function Wp({indexedDB:t,IDBKeyRange:e},n){!xa(t)&&n!==ss&&wa(t,e).delete(n).catch(ge)}function sa(t){return Gt(function(){return H.letThrough=!0,t()})}function qp(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function Gp(t){let e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?Le(e.dbOpenError):t);St&&(e.openCanceller._stackHolder=gn()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;let r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new q.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,o=null,a=!1;return z.race([r,(typeof navigator=="undefined"?z.resolve():qp()).then(()=>new z((l,u)=>{if(i(),!n)throw new q.MissingAPI;let c=t.name,f=e.autoSchema?n.open(c):n.open(c,Math.round(t.verno*10));if(!f)throw new q.MissingAPI;f.onerror=Et(u),f.onblocked=Ee(t._fireOnBlocked),f.onupgradeneeded=Ee(h=>{if(o=f.transaction,e.autoSchema&&!t._options.allowEmptyDB){f.onerror=Pr,o.abort(),f.result.close();let p=n.deleteDatabase(c);p.onsuccess=p.onerror=Ee(()=>{u(new q.NoSuchDatabase(`Database ${c} doesnt exist`))})}else{o.onerror=Et(u);var d=h.oldVersion>Math.pow(2,62)?0:h.oldVersion;a=d<1,t._novip.idbdb=f.result,Rp(t,d/10,o,u)}},u),f.onsuccess=Ee(()=>{o=null;let h=t._novip.idbdb=f.result,d=ns(h.objectStoreNames);if(d.length>0)try{let p=h.transaction(Pp(d),"readonly");e.autoSchema?zp(t,h,p):(ra(t,t._dbSchema,p),$p(t,p)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),va(t,p)}catch(p){}Sr.push(t),h.onversionchange=Ee(p=>{e.vcFired=!0,t.on("versionchange").fire(p)}),h.onclose=Ee(p=>{t.on("close").fire(p)}),a&&Hp(t._deps,c),l()},u)}))]).then(()=>(i(),e.onReadyBeingFired=[],z.resolve(sa(()=>t.on.ready.fire(t.vip))).then(function l(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce(pa,ge);return e.onReadyBeingFired=[],z.resolve(sa(()=>u(t.vip))).then(l)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(l=>{e.dbOpenError=l;try{o&&o.abort()}catch(u){}return r===e.openCanceller&&t._close(),Le(l)}).finally(()=>{e.openComplete=!0,s()})}function oa(t){var e=o=>t.next(o),n=o=>t.throw(o),r=s(e),i=s(n);function s(o){return a=>{var l=o(a),u=l.value;return l.done?u:!u||typeof u.then!="function"?Ue(u)?Promise.all(u).then(r,i):r(u):u.then(r,i)}}return s(e)()}function Xp(t,e,n){var r=arguments.length;if(r<2)throw new q.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var s=ku(i);return[t,s,n]}function ec(t,e,n,r,i){return z.resolve().then(()=>{let s=H.transless||H,o=t._createTransaction(e,n,t._dbSchema,r),a={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(f){return f.name===da.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>ec(t,e,n,null,i))):Le(f)}let l=fa(i);l&&$n();let u,c=z.follow(()=>{if(u=i.call(o,o),u)if(l){var f=Lt.bind(null,null);u.then(f,f)}else typeof u.next=="function"&&typeof u.throw=="function"&&(u=oa(u))},a);return(u&&typeof u.then=="function"?z.resolve(u).then(f=>o.active?f:Le(new q.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):c.then(()=>u)).then(f=>(r&&o._resolve(),o._completion.then(()=>f))).catch(f=>(o._reject(f),Le(f)))})}function Bi(t,e,n){let r=Ue(t)?t.slice():[t];for(let i=0;i<n;++i)r.push(e);return r}function Yp(t){return{...t,table(e){let n=t.table(e),{schema:r}=n,i={},s=[];function o(h,d,p){let m=Ar(h),y=i[m]=i[m]||[],g=h==null?0:typeof h=="string"?1:h.length,v=d>0,w={...p,isVirtual:v,keyTail:d,keyLength:g,extractKey:ea(h),unique:!v&&p.unique};if(y.push(w),w.isPrimaryKey||s.push(w),g>1){let _=g===2?h[0]:h.slice(0,g-1);o(_,d+1,p)}return y.sort((_,S)=>_.keyTail-S.keyTail),w}let a=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[a];for(let h of r.indexes)o(h.keyPath,0,h);function l(h){let d=i[Ar(h)];return d&&d[0]}function u(h,d){return{type:h.type===1?2:h.type,lower:Bi(h.lower,h.lowerOpen?t.MAX_KEY:t.MIN_KEY,d),lowerOpen:!0,upper:Bi(h.upper,h.upperOpen?t.MIN_KEY:t.MAX_KEY,d),upperOpen:!0}}function c(h){let d=h.query.index;return d.isVirtual?{...h,query:{index:d,range:u(h.query.range,d.keyTail)}}:h}return{...n,schema:{...r,primaryKey:a,indexes:s,getIndexByKeyPath:l},count(h){return n.count(c(h))},query(h){return n.query(c(h))},openCursor(h){let{keyTail:d,isVirtual:p,keyLength:m}=h.query.index;if(!p)return n.openCursor(h);function y(g){function v(_){_!=null?g.continue(Bi(_,h.reverse?t.MAX_KEY:t.MIN_KEY,d)):h.unique?g.continue(g.key.slice(0,m).concat(h.reverse?t.MIN_KEY:t.MAX_KEY,d)):g.continue()}return Object.create(g,{continue:{value:v},continuePrimaryKey:{value(_,S){g.continuePrimaryKey(Bi(_,t.MAX_KEY,d),S)}},primaryKey:{get(){return g.primaryKey}},key:{get(){let _=g.key;return m===1?_[0]:_.slice(0,m)}},value:{get(){return g.value}}})}return n.openCursor(c(h)).then(g=>g&&y(g))}}}}}var Qp={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Yp};function Ea(t,e,n,r){return n=n||{},r=r||"",ke(t).forEach(i=>{if(!rt(e,i))n[r+i]=void 0;else{var s=t[i],o=e[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){let a=jo(s),l=jo(o);a!==l?n[r+i]=e[i]:a==="Object"?Ea(s,o,n,r+i+"."):s!==o&&(n[r+i]=e[i])}else s!==o&&(n[r+i]=e[i])}}),ke(e).forEach(i=>{rt(t,i)||(n[r+i]=e[i])}),n}function Zp(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Jp={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){let n=t.table(e),{primaryKey:r}=n.schema;return{...n,mutate(s){let o=H.trans,{deleting:a,creating:l,updating:u}=o.table(e).hook;switch(s.type){case"add":if(l.fire===ge)break;return o._promise("readwrite",()=>c(s),!0);case"put":if(l.fire===ge&&u.fire===ge)break;return o._promise("readwrite",()=>c(s),!0);case"delete":if(a.fire===ge)break;return o._promise("readwrite",()=>c(s),!0);case"deleteRange":if(a.fire===ge)break;return o._promise("readwrite",()=>f(s),!0)}return n.mutate(s);function c(d){let p=H.trans,m=d.keys||Zp(r,d);if(!m)throw new Error("Keys missing");return d=d.type==="add"||d.type==="put"?{...d,keys:m}:{...d},d.type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),em(n,d,m).then(y=>{let g=m.map((v,w)=>{let _=y[w],S={onerror:null,onsuccess:null};if(d.type==="delete")a.fire.call(S,v,_,p);else if(d.type==="add"||_===void 0){let T=l.fire.call(S,v,d.values[w],p);v==null&&T!=null&&(v=T,d.keys[w]=v,r.outbound||_t(d.values[w],r.keyPath,v))}else{let T=Ea(_,d.values[w]),C=u.fire.call(S,T,v,_,p);if(C){let F=d.values[w];Object.keys(C).forEach(R=>{rt(F,R)?F[R]=C[R]:_t(F,R,C[R])})}}return S});return n.mutate(d).then(({failures:v,results:w,numFailures:_,lastResult:S})=>{for(let T=0;T<m.length;++T){let C=w?w[T]:m[T],F=g[T];C==null?F.onerror&&F.onerror(v[T]):F.onsuccess&&F.onsuccess(d.type==="put"&&y[T]?d.values[T]:C)}return{failures:v,results:w,numFailures:_,lastResult:S}}).catch(v=>(g.forEach(w=>w.onerror&&w.onerror(v)),Promise.reject(v)))})}function f(d){return h(d.trans,d.range,1e4)}function h(d,p,m){return n.query({trans:d,values:!1,query:{index:r,range:p},limit:m}).then(({result:y})=>c({type:"delete",keys:y,trans:d}).then(g=>g.numFailures>0?Promise.reject(g.failures[0]):y.length<m?{failures:[],numFailures:0,lastResult:void 0}:h(d,{...p,lower:y[y.length-1],lowerOpen:!0},m)))}}}}})};function em(t,e,n){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:n,cache:"immutable"})}function tc(t,e,n){try{if(!e||e.keys.length<t.length)return null;let r=[];for(let i=0,s=0;i<e.keys.length&&s<t.length;++i)Xe(e.keys[i],t[s])===0&&(r.push(n?Or(e.values[i]):e.values[i]),++s);return r.length===t.length?r:null}catch(r){return null}}var tm={stack:"dbcore",level:-1,create:t=>({table:e=>{let n=t.table(e);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);let i=tc(r.keys,r.trans._cache,r.cache==="clone");return i?z.resolve(i):n.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?Or(s):s},s))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function Sa(t){return!("from"in t)}var It=function(t,e){if(this)Ye(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{let n=new It;return t&&"d"in t&&Ye(n,t),n}};Nn(It.prototype,{add(t){return es(this,t),this},addKey(t){return kr(this,t,t),this},addKeys(t){return t.forEach(e=>kr(this,e,e)),this},[No](){return aa(this)}});function kr(t,e,n){let r=Xe(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Sa(t))return Ye(t,{from:e,to:n,d:1});let i=t.l,s=t.r;if(Xe(n,t.from)<0)return i?kr(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Au(t);if(Xe(e,t.to)>0)return s?kr(s,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Au(t);Xe(e,t.from)<0&&(t.from=e,t.l=null,t.d=s?s.d+1:1),Xe(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);let o=!t.r;i&&!t.l&&es(t,i),s&&o&&es(t,s)}function es(t,e){function n(r,{from:i,to:s,l:o,r:a}){kr(r,i,s),o&&n(r,o),a&&n(r,a)}Sa(e)||n(t,e)}function nm(t,e){let n=aa(e),r=n.next();if(r.done)return!1;let i=r.value,s=aa(t),o=s.next(i.from),a=o.value;for(;!r.done&&!o.done;){if(Xe(a.from,i.to)<=0&&Xe(a.to,i.from)>=0)return!0;Xe(i.from,a.from)<0?i=(r=n.next(a.from)).value:a=(o=s.next(i.from)).value}return!1}function aa(t){let e=Sa(t)?null:{s:0,n:t};return{next(n){let r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&Xe(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||Xe(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Au(t){var e,n;let r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){let s=i==="r"?"l":"r",o={...t},a=t[i];t.from=a.from,t.to=a.to,t[i]=a[i],o[i]=a[s],t[s]=o,o.d=Tu(o)}t.d=Tu(t)}function Tu({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}var rm={stack:"dbcore",level:0,create:t=>{let e=t.schema.name,n=new It(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{let i=t.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:a,outbound:l}=o,u={...i,mutate:h=>{let d=h.trans,p=d.mutatedParts||(d.mutatedParts={}),m=T=>{let C=`idb://${e}/${r}/${T}`;return p[C]||(p[C]=new It)},y=m(""),g=m(":dels"),{type:v}=h,[w,_]=h.type==="deleteRange"?[h.range]:h.type==="delete"?[h.keys]:h.values.length<50?[[],h.values]:[],S=h.trans._cache;return i.mutate(h).then(T=>{if(Ue(w)){v!=="delete"&&(w=T.results),y.addKeys(w);let C=tc(w,S);!C&&v!=="add"&&g.addKeys(w),(C||_)&&im(m,s,C,_)}else if(w){let C={from:w.lower,to:w.upper};g.add(C),y.add(C)}else y.add(n),g.add(n),s.indexes.forEach(C=>m(C.name).add(n));return T})}},c=({query:{index:h,range:d}})=>{var p,m;return[h,new It((p=d.lower)!==null&&p!==void 0?p:t.MIN_KEY,(m=d.upper)!==null&&m!==void 0?m:t.MAX_KEY)]},f={get:h=>[o,new It(h.key)],getMany:h=>[o,new It().addKeys(h.keys)],count:c,query:c,openCursor:c};return ke(f).forEach(h=>{u[h]=function(d){let{subscr:p}=H;if(p){let m=_=>{let S=`idb://${e}/${r}/${_}`;return p[S]||(p[S]=new It)},y=m(""),g=m(":dels"),[v,w]=f[h](d);if(m(v.name||"").add(w),!v.isPrimaryKey)if(h==="count")g.add(n);else{let _=h==="query"&&l&&d.values&&i.query({...d,values:!1});return i[h].apply(this,arguments).then(S=>{if(h==="query"){if(l&&d.values)return _.then(({result:C})=>(y.addKeys(C),S));let T=d.values?S.result.map(a):S.result;d.values?y.addKeys(T):g.addKeys(T)}else if(h==="openCursor"){let T=S,C=d.values;return T&&Object.create(T,{key:{get(){return g.addKey(T.primaryKey),T.key}},primaryKey:{get(){let F=T.primaryKey;return g.addKey(F),F}},value:{get(){return C&&y.addKey(T.primaryKey),T.value}}})}return S})}}return i[h].apply(this,arguments)}}),u}}}};function im(t,e,n,r){function i(s){let o=t(s.name||"");function a(u){return u!=null?s.extractKey(u):null}let l=u=>s.multiEntry&&Ue(u)?u.forEach(c=>o.addKey(c)):o.addKey(u);(n||r).forEach((u,c)=>{let f=n&&a(n[c]),h=r&&a(r[c]);Xe(f,h)!==0&&(f!=null&&l(f),h!=null&&l(h))})}e.indexes.forEach(i)}var ft=class{constructor(e,n){this._middlewares={},this.verno=0;let r=ft.dependencies;this._options=n={addons:ft.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};let{addons:i}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ge,dbReadyPromise:null,cancelOpen:ge,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};s.dbReadyPromise=new z(o=>{s.dbReadyResolve=o}),s.openCanceller=new z((o,a)=>{s.cancelOpen=a}),this._state=s,this.name=e,this.on=jr(this,"populate","blocked","versionchange","close",{ready:[pa,ge]}),this.on.ready.subscribe=Fu(this.on.ready.subscribe,o=>(a,l)=>{ft.vip(()=>{let u=this._state;if(u.openComplete)u.dbOpenError||z.resolve().then(a),l&&o(a);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(a),l&&o(a);else{o(a);let c=this;l||o(function f(){c.on.ready.unsubscribe(a),c.on.ready.unsubscribe(f)})}})}),this.Collection=wp(this),this.Table=yp(this),this.Transaction=Fp(this),this.Version=Kp(this),this.WhereClause=Cp(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=Mr(n.IDBKeyRange),this._createTransaction=(o,a,l,u)=>new this.Transaction(o,a,l,this._options.chromeTransactionDurability,u),this._fireOnBlocked=o=>{this.on("blocked").fire(o),Sr.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(o))},this.use(Qp),this.use(Jp),this.use(rm),this.use(tm),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(o=>o(this))}version(e){if(isNaN(e)||e<.1)throw new q.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new q.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);let n=this._versions;var r=n.filter(i=>i._cfg.version===e)[0];return r||(r=new this.Version(e),n.push(r),n.sort(Lp),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||H.letThrough||this._vip)?e():new z((n,r)=>{if(this._state.openComplete)return r(new q.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen){r(new q.DatabaseClosed);return}this.open().catch(ge)}this._state.dbReadyPromise.then(n,r)}).then(e)}use({stack:e,create:n,level:r,name:i}){i&&this.unuse({stack:e,name:i});let s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:n,level:r==null?10:r,name:i}),s.sort((o,a)=>o.level-a.level),this}unuse({stack:e,name:n,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>r?i.create!==r:n?i.name!==n:!1)),this}open(){return Gp(this)}_close(){let e=this._state,n=Sr.indexOf(this);if(n>=0&&Sr.splice(n,1),this.idbdb){try{this.idbdb.close()}catch(r){}this._novip.idbdb=null}e.dbReadyPromise=new z(r=>{e.dbReadyResolve=r}),e.openCanceller=new z((r,i)=>{e.cancelOpen=i})}close(){this._close();let e=this._state;this._options.autoOpen=!1,e.dbOpenError=new q.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){let e=arguments.length>0,n=this._state;return new z((r,i)=>{let s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=Ee(()=>{Wp(this._deps,this.name),r()}),o.onerror=Et(i),o.onblocked=this._fireOnBlocked};if(e)throw new q.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){let e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return ke(this._allTables).map(e=>this._allTables[e])}transaction(){let e=Xp.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,r){let i=H.trans;(!i||i.db!==this||e.indexOf("!")!==-1)&&(i=null);let s=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");let o,a;try{if(a=n.map(u=>{var c=u instanceof this.Table?u.name:u;if(typeof c!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return c}),e=="r"||e===Mo)o=Mo;else if(e=="rw"||e==ko)o=ko;else throw new q.InvalidArgument("Invalid transaction mode: "+e);if(i){if(i.mode===Mo&&o===ko)if(s)i=null;else throw new q.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i&&a.forEach(u=>{if(i&&i.storeNames.indexOf(u)===-1)if(s)i=null;else throw new q.SubTransaction("Table "+u+" not included in parent transaction.")}),s&&i&&!i.active&&(i=null)}}catch(u){return i?i._promise(null,(c,f)=>{f(u)}):Le(u)}let l=ec.bind(null,this,o,a,i,r);return i?i._promise(o,l,"lock"):H.trans?Vn(H.transless,()=>this._whenReady(l)):this._whenReady(l)}table(e){if(!rt(this._allTables,e))throw new q.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}},sm=typeof Symbol!="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",la=class{constructor(e){this._subscribe=e}subscribe(e,n,r){return this._subscribe(!e||typeof e=="function"?{next:e,error:n,complete:r}:e)}[sm](){return this}};function nc(t,e){return ke(e).forEach(n=>{let r=t[n]||(t[n]=new It);es(r,e[n])}),t}function om(t){let e=!1,n,r=new la(i=>{let s=fa(t);function o(y){s&&$n();let g=()=>Gt(t,{subscr:y,trans:null}),v=H.trans?Vn(H.transless,g):g();return s&&v.then(Lt,Lt),v}let a=!1,l={},u={},c={get closed(){return a},unsubscribe:()=>{a=!0,Yt.storagemutated.unsubscribe(p)}};i.start&&i.start(c);let f=!1,h=!1;function d(){return ke(u).some(y=>l[y]&&nm(l[y],u[y]))}let p=y=>{nc(l,y),d()&&m()},m=()=>{if(f||a)return;l={};let y={},g=o(y);h||(Yt(Ir,p),h=!0),f=!0,Promise.resolve(g).then(v=>{e=!0,n=v,f=!1,!a&&(d()?m():(l={},u=y,i.next&&i.next(v)))},v=>{f=!1,e=!1,i.error&&i.error(v),c.unsubscribe()})};return m(),c});return r.hasValue=()=>e,r.getValue=()=>n,r}var ua;try{ua={indexedDB:we.indexedDB||we.mozIndexedDB||we.webkitIndexedDB||we.msIndexedDB,IDBKeyRange:we.IDBKeyRange||we.webkitIDBKeyRange}}catch(t){ua={indexedDB:null,IDBKeyRange:null}}var cn=ft;Nn(cn,{...rs,delete(t){return new cn(t,{addons:[]}).delete()},exists(t){return new cn(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1)},getDatabaseNames(t){try{return Up(cn.dependencies).then(t)}catch(e){return Le(new q.MissingAPI)}},defineClass(){function t(e){Ye(this,e)}return t},ignoreTransaction(t){return H.trans?Vn(H.transless,t):t()},vip:sa,async:function(t){return function(){try{var e=oa(t.apply(this,arguments));return!e||typeof e.then!="function"?z.resolve(e):e}catch(n){return Le(n)}}},spawn:function(t,e,n){try{var r=oa(t.apply(n,e||[]));return!r||typeof r.then!="function"?z.resolve(r):r}catch(i){return Le(i)}},currentTransaction:{get:()=>H.trans||null},waitFor:function(t,e){let n=z.resolve(typeof t=="function"?cn.ignoreTransaction(t):t).timeout(e||6e4);return H.trans?H.trans.waitFor(n):n},Promise:z,debug:{get:()=>St,set:t=>{Du(t,t==="dexie"?()=>!0:Gu)}},derive:Bn,extend:Ye,props:Nn,override:Fu,Events:jr,on:Yt,liveQuery:om,extendObservabilitySet:nc,getByKeyPath:Ot,setByKeyPath:_t,delByKeyPath:Kd,shallowClone:Mu,deepClone:Or,getObjectDiff:Ea,cmp:Xe,asap:Pu,minKey:Xo,addons:[],connections:Sr,errnames:da,dependencies:ua,semVer:_u,version:_u.split(".").map(t=>parseInt(t)).reduce((t,e,n)=>t+e/Math.pow(10,n*2))});cn.maxKey=Mr(cn.dependencies.IDBKeyRange);typeof dispatchEvent!="undefined"&&typeof addEventListener!="undefined"&&(Yt(Ir,t=>{if(!kt){let e;is?(e=document.createEvent("CustomEvent"),e.initCustomEvent(qt,!0,!0,t)):e=new CustomEvent(qt,{detail:t}),kt=!0,dispatchEvent(e),kt=!1}}),addEventListener(qt,({detail:t})=>{kt||ts(t)}));function ts(t){let e=kt;try{kt=!0,Yt.storagemutated.fire(t)}finally{kt=e}}var kt=!1;if(typeof BroadcastChannel!="undefined"){let t=new BroadcastChannel(qt);typeof t.unref=="function"&&t.unref(),Yt(Ir,e=>{kt||t.postMessage(e)}),t.onmessage=e=>{e.data&&ts(e.data)}}else if(typeof self!="undefined"&&typeof navigator!="undefined"){Yt(Ir,e=>{try{kt||(typeof localStorage!="undefined"&&localStorage.setItem(qt,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:qt,changedParts:e})))}catch(n){}}),typeof addEventListener!="undefined"&&addEventListener("storage",e=>{if(e.key===qt){let n=JSON.parse(e.newValue);n&&ts(n.changedParts)}});let t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",am)}function am({data:t}){t&&t.type===qt&&ts(t.changedParts)}z.rejectionMapper=Zd;Du(St,Gu);var ac=require("obsidian");var rc=require("obsidian"),Rt=class extends rc.Notice{constructor(e,n=0){super(e+`
(clever-search)`,n)}},Aa=class{},vv=new Aa;var oc=require("obsidian");var Ta={"Reindexing...":"Reindexing...","Indexing finished":"Indexing finished","files need to be indexed. Obsidian may freeze for a while":"files need to be indexed. Obsidian may freeze for a while","Omnisearch isn't installed":"Omnisearch isn't installed","Omnisearch is installed but not enabled":"Omnisearch is installed but not enabled","Max items count":"Max items count","Max items count desc":"Due to renderer's limited capabilities, this plugin can find thousands of results, but cannot display them all at once","English word blacklist":"English word blacklist","English word blacklist desc":`Exclude some meaningless English words like "do", "and", "them" from indexing, enhancing search and indexing speed. Modify the file at ${Ei} to tailor the list to your needs.`,"Chinese patch":"Chinese patch","Chinese patch desc":"Better search result for Chinese","Chinese word blacklist":"Chinese word blacklist","Chinese word blacklist desc":`Activates only if the Chinese Patch is enabled. This excludes some meaningless Chinese words like "\u7684", "\u6240\u4EE5", "\u5C3D\u7BA1" listed in 'stop-words-zh.txt', improving search efficiency and speed. More details are listed in "English word blacklist" option`,"For Development":"For Development","Collapse development setting by default":"Collapse development setting by default","Support the Project":"Support the Project","Support the Project desc":"Enjoying this plugin? Show your support with a star on GitHub!","Visit GitHub":"Visit GitHub","Reindex the vault":"Reindex the vault",Reindex:"Reindex","Log level":"Log level"};var ic={"Reindexing...":"\u91CD\u5EFA\u7D22\u5F15\u4E2D...","Indexing finished":"\u7D22\u5F15\u5B8C\u6210","files need to be indexed. Obsidian may freeze for a while":"\u6587\u4EF6\u9700\u8981\u88AB\u7D22\u5F15, Obsidian \u53EF\u80FD\u4F1A\u5361\u987F\u4E00\u4F1A\u513F","Omnisearch isn't installed":"\u672A\u5B89\u88C5 Omnisearch","Omnisearch is installed but not enabled":"\u5B89\u88C5\u4E86 Omnisearch \u4F46\u662F\u6CA1\u6709\u542F\u7528","Max items count":"\u6700\u5927\u5019\u9009\u9879\u6570","Max items count desc":"\u867D\u7136\u672C\u63D2\u4EF6\u53EF\u4EE5\u641C\u7D22\u5230\u6210\u5343\u4E0A\u4E07\u4E2A\u7ED3\u679C\uFF0C\u4F46\u7531\u4E8E\u5E95\u5C42\u6E32\u67D3\u5668\u6027\u80FD\u9650\u5236\uFF0C\u4E0D\u80FD\u5373\u65F6\u6E32\u67D3\u6240\u6709\u7ED3\u679C","English word blacklist":"\u82F1\u6587\u5355\u8BCD\u9ED1\u540D\u5355","English word blacklist desc":`\u5EFA\u7ACB\u7D22\u5F15\u65F6\uFF0C\u5FFD\u7565\u4E00\u4E9B\u542B\u4E49\u6A21\u7CCA\u7684\u5355\u8BCD\uFF0C\u6BD4\u5982 "do", "and", "them", \u53EF\u4EE5\u52A0\u5FEB\u7D22\u5F15\u548C\u641C\u7D22\u901F\u5EA6\uFF0C\u4F46\u662F\u8FD9\u4E9B\u5355\u8BCD\u4E0D\u4F1A\u88AB\u641C\u7D22\u5230. \u53EF\u4EE5\u5728 ${Ei} \u6309\u9700\u4FEE\u6539\u5355\u8BCD\u9ED1\u540D\u5355`,"Chinese patch":"\u4E2D\u6587\u641C\u7D22\u4F18\u5316","Chinese patch desc":"\u66F4\u597D\u7684\u4E2D\u6587\u641C\u7D22\u7ED3\u679C","Chinese word blacklist":"\u4E2D\u6587\u8BCD\u8BED\u9ED1\u540D\u5355","Chinese word blacklist desc":'\u53EA\u5728\u5F00\u542F\u4E2D\u6587\u641C\u7D22\u4F18\u5316\u65F6\u751F\u6548\u3002\u5FFD\u7565 "\u7684", "\u6240\u4EE5", "\u5C3D\u7BA1" \u7B49\u8BCD\u8BED\uFF0C\u8BE6\u7EC6\u5217\u8868\u5728 "stop-words-zh.txt"\u3002\u8BE6\u89C1 "\u82F1\u6587\u5355\u8BCD\u9ED1\u540D\u5355" \u9009\u9879',"For Development":"\u5F00\u53D1\u8BBE\u7F6E","Collapse development setting by default":"\u9ED8\u8BA4\u6298\u53E0\u5F00\u53D1\u8BBE\u7F6E","Support the Project":"\u652F\u6301\u8FD9\u4E2A\u9879\u76EE","Support the Project desc":"\u5982\u679C\u89C9\u5F97\u672C\u63D2\u4EF6\u5BF9\u4F60\u6709\u5E2E\u52A9\uFF0C\u5E0C\u671B\u80FD\u5230 GitHub \u70B9\u4E2A star","Visit GitHub":"\u8BBF\u95EE GitHub","Reindex the vault":"\u91CD\u65B0\u7D22\u5F15\u5168\u5E93",Reindex:"\u91CD\u65B0\u7D22\u5F15","Log level":"\u65E5\u5FD7\u7B49\u7EA7"};var lm={en:Ta,"zh-cn":ic},sc=lm[oc.moment.locale()];function Se(t){return sc&&sc[t]||Ta[t]}var lc=Ce(Pe());var bt=class{constructor(){this.app=O(ac.App);this.privateApi=O(ct)}async initAsync(){if(this.app.plugins.plugins.omnisearch){let e="omnisearch/cache/"+this.privateApi.getAppId(),n=new ft(e);n.version(bt.DB_VERSION).stores({searchHistory:"++id",minisearch:"date"}),this.db=n}}async getLastQuery(){let e="";if(this.checkOmnisearchStatus()){let n=await this.db.searchHistory.toArray();e=n.length!==0?n[n.length-1].query:""}return e}checkOmnisearchStatus(){let e=this.app.plugins.plugins.omnisearch,n=!0;return e?e._loaded||(new Rt(Se("Omnisearch is installed but not enabled")),n=!1):(new Rt(Se("Omnisearch isn't installed")),n=!1),n}};bt.DB_VERSION=8,bt=W([(0,lc.singleton)()],bt);var uc=Ce(Pe());var Kn=class{constructor(){this.privacyModeEnabled=!1}togglePrivacyMode(){this.privacyModeEnabled=!this.privacyModeEnabled,this.privacyModeEnabled?document.body.classList.add("cs-privacy-blur"):document.body.classList.remove("cs-privacy-blur")}};Kn=W([(0,uc.singleton)()],Kn);var cc=Ce(Pe());var Un=class{async createChildThreads(){if(gt)M.warn("web worker only enabled on dev environment now");else return;M.debug("init child threads...");let e=O(tt).obsidianFs,n=".obsidian/plugins/clever-search/cs-search-worker.js";try{let r=await e.readBinary(n);M.debug(`worker script size (6x bigger than in production build): ${(r.byteLength/1e3).toFixed(2)} KB`);let i=new Blob([r],{type:"text/javascript"}),s=URL.createObjectURL(i);this.worker=new Worker(s),this.worker.addEventListener("message",o=>{console.log(`Received from worker:
`,o.data)})}catch(r){console.error("Error initializing worker:",r)}}async testTickToken(){var e;(e=this.worker)==null||e.postMessage("tikToken")}};Un=W([(0,cc.singleton)()],Un);var mc=Ce(Pe());var st=require("obsidian");var bn=Ce(Pe());var Br=Ce(Pe());var Qt=class{constructor(){this.db=O(ht)}async setMiniSearchData(e){this.db.transaction("rw",this.db.minisearch,async()=>{await this.db.minisearch.clear(),await this.db.minisearch.add({data:e}),M.trace("minisearch data saved")})}async getMiniSearchData(){var e;return((e=(await this.db.minisearch.toArray())[0])==null?void 0:e.data)||null}async setDocumentRefs(e){this.db.transaction("rw",this.db.documentRefs,async()=>{await this.db.documentRefs.clear(),await this.db.documentRefs.bulkAdd(e)})}async getDocumentRefs(){return await this.db.documentRefs.toArray()||null}async setPluginSetting(e){try{return await this.db.transaction("rw",this.db.pluginSetting,()=>{this.db.pluginSetting.clear(),this.db.pluginSetting.add({data:e})}),M.trace("settings have been saved to database"),!0}catch(n){return M.trace(`settings failed to be saved: ${n}`),!1}}async deleteOldDatabases(){let e=(await indexedDB.databases()).filter(n=>n.name===this.db.dbName&&n.version!==this.db.dbVersion*10);if(e.length){M.trace("Those IndexedDb databases will be deleted:");for(let n of e)n.name&&indexedDB.deleteDatabase(n.name)}}};W([$e],Qt.prototype,"getMiniSearchData",1),W([$e],Qt.prototype,"getDocumentRefs",1),Qt=W([(0,Br.singleton)()],Qt);var ht=class extends ft{constructor(n){super(ht.dbNamePrefix+n.getAppId());this.privateApi=n,this.version(ht._dbVersion).stores({pluginSetting:"++id",minisearch:"++id",documentRefs:"++id"})}get dbVersion(){return ht._dbVersion}get dbName(){return ht.dbNamePrefix+this.privateApi.getAppId()}};ht._dbVersion=1,ht.dbNamePrefix="clever-search/",ht=W([(0,Br.singleton)(),Yr(0,(0,Br.inject)(ct))],ht);var Ca=class{constructor(){this.listeners=new Map}on(e,n){var r;this.listeners.has(e)||this.listeners.set(e,[]),(r=this.listeners.get(e))==null||r.push(n)}off(e,n){let r=this.listeners.get(e);if(r){let i=r.indexOf(n);i>-1&&r.splice(i,1)}}emit(e,...n){var r;(r=this.listeners.get(e))==null||r.forEach(i=>{i(...n)})}},jt=new Ca;var pc=Ce(Pe());var fc=require("obsidian");var hc=Ce(Pe());var yn=class{constructor(){this.dataManager=O(it);this.app=O(fc.App);this.onCreate=e=>{M.debug(`created: ${e.path}`),this.dataManager.receiveDocOperation(new vn(e))};this.onDelete=e=>{M.debug(`deleted: ${e.path}`),this.dataManager.receiveDocOperation(new _n(e.path))};this.onRename=(e,n)=>{M.debug(`renamed: ${n} => ${e.path}`),this.dataManager.receiveDocOperation(new _n(n)),this.dataManager.receiveDocOperation(new vn(e))};this.onModify=e=>{M.debug(`modified: ${e.path}`),this.dataManager.receiveDocOperation(new _n(e.path)),this.dataManager.receiveDocOperation(new vn(e))}}start(){this.stop(),this.app.vault.on("create",this.onCreate),this.app.vault.on("delete",this.onDelete),this.app.vault.on("rename",this.onRename),this.app.vault.on("modify",this.onModify),M.trace("FileWatcher started")}stop(){this.app.vault.off("create",this.onCreate),this.app.vault.off("delete",this.onDelete),this.app.vault.off("rename",this.onRename),this.app.vault.off("modify",this.onModify)}};yn=W([(0,hc.singleton)()],yn);var it=class{constructor(){this.database=O(Qt);this.dataProvider=O(tt);this.lexicalEngine=O(et);this.shouldForceRefresh=!1;this.isLexicalEngineUpToDate=!1;this.docOperationsHandler=async e=>{e.sort((n,r)=>n.time-r.time);for(let n of e)if(n instanceof vn)await this.addDocuments([n.file]);else if(n instanceof _n)await this.deleteDocuments([n.path]);else throw Error(bl)};this.docOperationsBuffer=new Ai(this.docOperationsHandler,e=>e.path+e.type,3)}async initAsync(){await this.initLexicalEngines(),await this.updateDocRefsByMtime(),this.shouldForceRefresh||(jt.on(7,()=>this.docOperationsBuffer.forceFlush()),O(yn).start()),await this.database.setMiniSearchData(this.lexicalEngine.filesIndex.toJSON())}onunload(){O(yn).stop()}receiveDocOperation(e){this.docOperationsBuffer.add(e)}async forceRefreshAll(){let e=new Rt(Se("Reindexing..."));this.shouldForceRefresh=!0,await this.initAsync(),e.hide(),new Rt(Se("Indexing finished"),5e3),this.shouldForceRefresh=!1}async addDocuments(e){let n=await this.dataProvider.generateAllIndexedDocuments(e.filter(r=>this.dataProvider.isIndexable(r)));await this.lexicalEngine.addDocuments(n)}async deleteDocuments(e){this.lexicalEngine.deleteDocuments(e.filter(n=>this.dataProvider.isIndexable(n)))}async initLexicalEngines(){M.trace("Init lexical engine...");let e;if(!sr.loadIndexFromDatabase||this.shouldForceRefresh?e=null:e=await this.database.getMiniSearchData(),e)M.trace("Previous minisearch data is found."),await this.lexicalEngine.reIndexAll(e);else{M.trace("Indexing the whole vault...");let n=this.dataProvider.allFilesToBeIndexed(),r=0;for(let s of n)r+=s.stat.size;if(r/=1024,r>2e3){let s=(r/1024).toFixed(2)+" MB";new Rt(`${s} ${Se("files need to be indexed. Obsidian may freeze for a while")}`,7e3)}let i=await this.dataProvider.generateAllIndexedDocuments(n);await this.lexicalEngine.reIndexAll(i),this.isLexicalEngineUpToDate=!0}M.trace("Lexical engine is ready")}async updateDocRefsByMtime(){var e;if(!this.isLexicalEngineUpToDate){let n=new Map(this.dataProvider.allFilesToBeIndexed().map(a=>[a.path,a])),r=new Map((e=await this.database.getDocumentRefs())==null?void 0:e.map(a=>[a.path,a])),i=[],s=[];for(let[a,l]of n){let u=r.get(a);u?l.stat.mtime>u.lexicalMtime&&(s.push(l.path),i.push(l)):i.push(l)}for(let a of r.keys())n.has(a)||s.push(a);M.trace(`docs to delete: ${s.length}`),M.trace(`docs to add: ${i.length}`),await this.deleteDocuments(s),await this.addDocuments(i);let o=Array.from(n.values()).map(a=>({path:a.path,lexicalMtime:a.stat.mtime,embeddingMtime:a.stat.mtime}));this.database.setDocumentRefs(o),M.trace(`${o.length} doc refs updated`),this.isLexicalEngineUpToDate=!0}}};W([$e],it.prototype,"initAsync",1),it=W([(0,pc.singleton)()],it);var os=class{constructor(e,n){this.time=performance.now();this.type=e,typeof n=="string"?this.path=n:this.path=n.path}},vn=class extends os{constructor(n){super("add",n);this.file=n}},_n=class extends os{constructor(e){super("delete",e)}};var Zt=class{constructor(){this.plugin=O(un)}async initAsync(){await this.loadSettings(),bn.container.register(je,{useValue:this.setting}),this.plugin.addSettingTab(O(zr))}async loadSettings(){this.setting=Object.assign({},El,await this.plugin.loadData()),M.setLevel(this.setting.logLevel)}async saveSettings(){await this.plugin.saveData(this.setting)}};Zt=W([(0,bn.singleton)()],Zt);var zr=class extends st.PluginSettingTab{constructor(n){super(n.app,n);this.settingManager=O(Zt);this.setting=O(je);this.shouldDownloadAndRefreshIndex=!1}hide(){this.shouldDownloadAndRefreshIndex?(this.shouldDownloadAndRefreshIndex=!1,this.saveSettingDownloadRefresh()):this.settingManager.saveSettings()}display(){let{containerEl:n}=this;n.empty(),new st.Setting(n).setName(Se("Max items count")).setDesc(Se("Max items count desc")).addSlider(a=>a.setLimits(1,300,1).setValue(this.setting.ui.maxItemResults).setDynamicTooltip().onChange(async l=>{this.setting.ui.maxItemResults=l,await this.settingManager.saveSettings()})),new st.Setting(n).setName(Se("English word blacklist")).setDesc(Se("English word blacklist desc")).addToggle(a=>a.setValue(this.setting.enableStopWordsEn).onChange(async l=>{this.setting.enableStopWordsEn=l,this.shouldDownloadAndRefreshIndex=!0})),new st.Setting(n).setName(Se("Chinese patch")).setDesc(Se("Chinese patch desc")).addToggle(a=>a.setValue(this.setting.enableChinesePatch).onChange(async l=>{this.setting.enableChinesePatch=l,M.info(`enable chinese: ${O(je).enableChinesePatch}`),this.shouldDownloadAndRefreshIndex=!0})),new st.Setting(n).setName(Se("Chinese word blacklist")).setDesc(Se("Chinese word blacklist desc")).addToggle(a=>a.setValue(this.setting.enableStopWordsZh).onChange(async l=>{this.setting.enableStopWordsZh=l,this.shouldDownloadAndRefreshIndex=!0}));let r=n.createDiv("cs-dev-setting-group"),i=r.createDiv({cls:"cs-setting-group-dev-title",text:Se("For Development")}),s=r.createDiv({cls:"cs-setting-group-dev-content"}),o=this.setting.ui.collapseDevSettingByDefault;s.style.display=o?"none":"block",i.style.setProperty("--cs-dev-collapse-icon",o?To:Co),i.onclick=()=>{let a=s.style.display==="none";s.style.display=a?"block":"none",i.style.setProperty("--cs-dev-collapse-icon",a?Co:To)},new st.Setting(s).setName(Se("Collapse development setting by default")).addToggle(a=>a.setValue(this.setting.ui.collapseDevSettingByDefault).onChange(async l=>{this.setting.ui.collapseDevSettingByDefault=l})),new st.Setting(s).setName(Se("Support the Project")).setDesc(Se("Support the Project desc")).addButton(a=>{a.setButtonText(Se("Visit GitHub")).onClick(()=>{window.open("https://github.com/yan42685/obsidian-clever-search","_blank")})}),new st.Setting(s).setName("API provider1").setDesc("domain and key").addText(a=>a.setPlaceholder("api.openai.com").setValue(this.setting.apiProvider1.domain).onChange(l=>{this.setting.apiProvider1.domain=l,this.settingManager.saveSettings()})).addText(a=>a.setPlaceholder("API key").setValue(this.setting.apiProvider1.key).onChange(l=>{this.setting.apiProvider1.key=l,this.settingManager.saveSettings()})),new st.Setting(s).setName("API provider2").setDesc("description").addText(a=>a.setPlaceholder("api.openai.com").setValue(this.setting.apiProvider2.domain).onChange(l=>{this.setting.apiProvider2.domain=l,this.settingManager.saveSettings()})).addText(a=>a.setPlaceholder("API key").setValue(this.setting.apiProvider2.key).onChange(l=>{this.setting.apiProvider2.key=l,this.settingManager.saveSettings()})),new st.Setting(s).setName(Se("Reindex the vault")).addButton(a=>{a.setButtonText(Se("Reindex")).onClick(async()=>{await O(it).forceRefreshAll()})}),new st.Setting(s).setName(Se("Log level")).addDropdown(a=>a.addOptions({trace:"trace",debug:"debug",info:"info",warn:"warn",error:"error",none:"none"}).setValue(this.setting.logLevel.toLowerCase()).onChange(async l=>{let u=l;M.setLevel(u),this.setting.logLevel=u,await this.settingManager.saveSettings()}))}async saveSettingDownloadRefresh(){await O(Zt).saveSettings(),await O(Je).initAsync(),this.setting.enableChinesePatch&&await O(yt).initAsync(),await O(it).forceRefreshAll()}};zr=W([(0,bn.singleton)(),Yr(0,(0,bn.inject)(un))],zr);var wn=class{async onload(){await O(Zt).initAsync();let e=O(je);await O(Je).initAsync(),e.enableChinesePatch&&await O(yt).initAsync(),await O(Un).createChildThreads()}async onLayoutReady(){await O(it).initAsync(),await O(bt).initAsync()}onunload(){O(it).onunload()}};wn=W([(0,mc.singleton)()],wn);var Nc=require("obsidian");function Nt(){}function Ma(t){return t()}function gc(){return Object.create(null)}function Bt(t){t.forEach(Ma)}function as(t){return typeof t=="function"}function vc(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function _c(t){return Object.keys(t).length===0}var bc=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global,Vr=class{constructor(e){this.options=e,this._listeners="WeakMap"in bc?new WeakMap:void 0}observe(e,n){return this._listeners.set(e,n),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!==null&&e!==void 0?e:this._observer=new ResizeObserver(n=>{var r;for(let i of n)Vr.entries.set(i.target,i),(r=this._listeners.get(i.target))===null||r===void 0||r(i)})}};Vr.entries="WeakMap"in bc?new WeakMap:void 0;var wc=!1;function um(){wc=!0}function cm(){wc=!1}function ze(t,e){t.appendChild(e)}function xc(t,e,n){let r=fm(t);if(!r.getElementById(e)){let i=Oe("style");i.id=e,i.textContent=n,hm(r,i)}}function fm(t){if(!t)return document;let e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function hm(t,e){return ze(t.head||t,e),e.sheet}function dt(t,e,n){t.insertBefore(e,n||null)}function ot(t){t.parentNode&&t.parentNode.removeChild(t)}function ka(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function Oe(t){return document.createElement(t)}function dm(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function cs(t){return document.createTextNode(t)}function Xn(){return cs(" ")}function Oa(){return cs("")}function Jt(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function Re(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function pm(t){return Array.from(t.childNodes)}function Ec(t,e){e=""+e,t.data!==e&&(t.data=e)}function Da(t,e){t.value=e==null?"":e}function Ur(t,e,n){t.classList[n?"add":"remove"](e)}var ls=class{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,n,r=null){this.e||(this.is_svg?this.e=dm(n.nodeName):this.e=Oe(n.nodeType===11?"TEMPLATE":n.nodeName),this.t=n.tagName!=="TEMPLATE"?n:n.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)dt(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(ot)}};var Kr;function $r(t){Kr=t}function mm(){if(!Kr)throw new Error("Function called outside component initialization");return Kr}function La(t){mm().$$.on_destroy.push(t)}var Wn=[];var Gn=[],qn=[],yc=[],Sc=Promise.resolve(),Pa=!1;function Ac(){Pa||(Pa=!0,Sc.then(Tc))}function Hr(){return Ac(),Sc}function Ia(t){qn.push(t)}var Fa=new Set,Hn=0;function Tc(){if(Hn!==0)return;let t=Kr;do{try{for(;Hn<Wn.length;){let e=Wn[Hn];Hn++,$r(e),gm(e.$$)}}catch(e){throw Wn.length=0,Hn=0,e}for($r(null),Wn.length=0,Hn=0;Gn.length;)Gn.pop()();for(let e=0;e<qn.length;e+=1){let n=qn[e];Fa.has(n)||(Fa.add(n),n())}qn.length=0}while(Wn.length);for(;yc.length;)yc.pop()();Pa=!1,Fa.clear(),$r(t)}function gm(t){if(t.fragment!==null){t.update(),Bt(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Ia)}}function ym(t){let e=[],n=[];qn.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),qn=e}var vm=new Set;function _m(t,e){t&&t.i&&(vm.delete(t),t.i(e))}var bm=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],D_=new Set([...bm]);function wm(t,e,n,r){let{fragment:i,after_update:s}=t.$$;i&&i.m(e,n),r||Ia(()=>{let o=t.$$.on_mount.map(Ma).filter(as);t.$$.on_destroy?t.$$.on_destroy.push(...o):Bt(o),t.$$.on_mount=[]}),s.forEach(Ia)}function Cc(t,e){let n=t.$$;n.fragment!==null&&(ym(n.after_update),Bt(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function xm(t,e){t.$$.dirty[0]===-1&&(Wn.push(t),Ac(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Fc(t,e,n,r,i,s,o,a=[-1]){let l=Kr;$r(t);let u=t.$$={fragment:null,ctx:[],props:s,update:Nt,not_equal:i,bound:gc(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:gc(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(u.root);let c=!1;if(u.ctx=n?n(t,e.props||{},(f,h,...d)=>{let p=d.length?d[0]:h;return u.ctx&&i(u.ctx[f],u.ctx[f]=p)&&(!u.skip_bound&&u.bound[f]&&u.bound[f](p),c&&xm(t,f)),h}):[],u.update(),c=!0,Bt(u.before_update),u.fragment=r?r(u.ctx):!1,e.target){if(e.hydrate){um();let f=pm(e.target);u.fragment&&u.fragment.l(f),f.forEach(ot)}else u.fragment&&u.fragment.c();e.intro&&_m(t.$$.fragment),wm(t,e.target,e.anchor,e.customElement),cm(),Tc()}$r(l)}var Em;typeof HTMLElement=="function"&&(Em=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){let{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(Ma).filter(as);for(let e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){Bt(this.$$.on_disconnect)}$destroy(){Cc(this,1),this.$destroy=Nt}$on(t,e){if(!as(e))return Nt;let n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{let r=n.indexOf(e);r!==-1&&n.splice(r,1)}}$set(t){this.$$set&&!_c(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});var us=class{$destroy(){Cc(this,1),this.$destroy=Nt}$on(e,n){if(!as(n))return Nt;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{let i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!_c(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};function xn(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{u(r.next(c))}catch(f){o(f)}}function l(c){try{u(r.throw(c))}catch(f){o(f)}}function u(c){c.done?s(c.value):i(c.value).then(a,l)}u((r=r.apply(t,e||[])).next())})}var Wr=require("obsidian");var Ic=Ce(Pe());var Yn=class{constructor(){this.app=O(Wr.App);this.privateApi=O(ct);this.setting=O(je)}updateSubItemIndex(e,n,r){let i=e[n],s=e.length-1;return this.scrollTo("center",i,"auto"),r==="next"?n<s?n+1:n:n>0?n-1:n}async handleConfirmAsync(e,n,r,i){if(e.close(),r)if(n===1){let s=r;this.jumpInFile(s.line.row,s.line.col)}else if(n===2){let s=r,o=s.fileType;if(i!==-1){let a=s.subItems[i];if(o===0)await this.jumpInVaultAsync(s.path,a.row,a.col);else throw Error("unsupported filetype to jump")}}else throw Error(`unsupported search type to jump ${n}`)}scrollTo(e,n,r){n&&n.element&&n.element.scrollIntoView({behavior:r,block:e})}jumpInFile(e,n){this.scrollIntoViewForExistingView(e,n)}async jumpInVaultAsync(e,n,r){let i=!1;this.app.workspace.iterateAllLeaves(s=>{var o;((o=s.getViewState().state)==null?void 0:o.file)===e&&(this.app.workspace.setActiveLeaf(s,{focus:!0}),i=!0)}),i?this.scrollIntoViewForExistingView(n,r):(await this.app.workspace.openLinkText(e,"",this.setting.ui.openInNewPane),this.scrollIntoViewForExistingView(n,r))}scrollIntoViewForExistingView(e,n){this.privateApi.executeCommandById("editor:focus");let r=this.app.workspace.getActiveViewOfType(Wr.MarkdownView),i={line:e,ch:n};r?(r.editor.setCursor(i),r.editor.scrollIntoView({from:i,to:i},!0)):M.info("No view to jump")}scrollIntoViewForNewTab(e,n){let r=this.app.workspace.getActiveViewOfType(Wr.MarkdownView);r&&(r.editor.setCursor({line:e,ch:n}),r.editor.scrollIntoView({from:{line:e-10,ch:0},to:{line:e+10,ch:0}}))}};Yn=W([(0,Ic.singleton)()],Yn);function Sm(t){xc(t,"svelte-dvs2du",`.search-container.svelte-dvs2du.svelte-dvs2du.svelte-dvs2du{display:flex;white-space:pre-wrap;overflow-wrap:break-word}.search-container mark{background-color:var(--cs-highlight-bgc, rgba(219, 204, 149, 0.9));color:var(--cs-highlight-char-color, #111)}.left-pane.svelte-dvs2du.svelte-dvs2du.svelte-dvs2du{display:flex;flex-direction:column;align-items:left;width:40%}.search-bar.svelte-dvs2du.svelte-dvs2du.svelte-dvs2du{position:sticky;top:-0.2em;left:0;width:97%;height:30px}.search-bar.svelte-dvs2du.svelte-dvs2du.svelte-dvs2du::after{content:attr(data-match-count);position:absolute;right:0.6em;top:1.4em;font-size:0.8em;transform:translateY(-50%);color:var(--cs-hint-char-color, grey)}.search-bar.svelte-dvs2du input.svelte-dvs2du.svelte-dvs2du{width:100%;padding:8px 12px;border:none;border-radius:10px;background-color:var(--cs-search-bar-bgc, #20202066);box-shadow:0 2px 4px rgba(0, 0, 0, 0.18),
			0 2px 3px rgba(0, 0, 0, 0.26)}.result-items.svelte-dvs2du.svelte-dvs2du.svelte-dvs2du{display:flex;flex-direction:column;height:70vh;margin-top:0.15em}.result-items.svelte-dvs2du ul.svelte-dvs2du.svelte-dvs2du{padding:0 0.5em 0 0;margin-bottom:0;width:97%;overflow-x:hidden}.result-items.svelte-dvs2du ul.svelte-dvs2du button.svelte-dvs2du{align-items:center;justify-content:left;padding:0.65em;margin:0.5em 0 0 0.15em;width:25.35vw;height:fit-content;text-align:left;background-color:var(--cs-pane-bgc, #20202066);border-radius:4px;cursor:pointer}.result-items.svelte-dvs2du ul.svelte-dvs2du button.svelte-dvs2du:hover,.result-items.svelte-dvs2du ul.svelte-dvs2du button.selected.svelte-dvs2du{background-color:var(--cs-item-selected-color, rgba(85, 85, 85, 0.35))}.result-items.svelte-dvs2du ul button .line-item.svelte-dvs2du.svelte-dvs2du,.result-items.svelte-dvs2du ul button .file-item.svelte-dvs2du.svelte-dvs2du{text-wrap:wrap;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}.result-items.svelte-dvs2du ul button .file-item.svelte-dvs2du.svelte-dvs2du{-webkit-line-clamp:6}.result-items.svelte-dvs2du ul button .file-item span.filename.svelte-dvs2du.svelte-dvs2du{margin-top:-0.2em;display:block}.result-items.svelte-dvs2du ul button .file-item span.file-folder-path.svelte-dvs2du.svelte-dvs2du{color:var(--cs-secondary-font-color, #a29c9c);display:block}.right-pane.svelte-dvs2du.svelte-dvs2du.svelte-dvs2du{background-color:var(--cs-pane-bgc, #20202066);border-radius:6px;height:73.97vh;width:60%}.right-pane.svelte-dvs2du .preview-container.svelte-dvs2du.svelte-dvs2du{margin:0.7em 0 0 0.7em;height:72.5vh;overflow-y:auto}.right-pane.svelte-dvs2du .preview-container p.svelte-dvs2du.svelte-dvs2du,.right-pane.svelte-dvs2du .preview-container ul.svelte-dvs2du.svelte-dvs2du{margin:0;padding:0;overflow-x:hidden}.right-pane.svelte-dvs2du .preview-container p.svelte-dvs2du.svelte-dvs2du{width:39.7vw}.right-pane.svelte-dvs2du .preview-container ul button.file-sub-item.svelte-dvs2du.svelte-dvs2du{text-wrap:wrap;display:block;text-overflow:ellipsis;justify-content:left;margin-bottom:1em;height:fit-content;width:39.2vw;text-align:left;background-color:var(--cs-pane-bgc, #20202066);border-radius:4px;font-size:medium}.right-pane.svelte-dvs2du .preview-container ul button.file-sub-item.selected.svelte-dvs2du.svelte-dvs2du{background-color:var(--cs-item-selected-color, rgba(85, 85, 85, 0.35))}.right-pane.svelte-dvs2du .preview-container.svelte-dvs2du span.matched-line{display:inline-block;width:100%}.right-pane.svelte-dvs2du .preview-container.svelte-dvs2du span.matched-line.highlight-bg{background-color:var(--cs-hint-char-color, #468eeb33)}`)}function Mc(t,e,n){let r=t.slice();return r[35]=e[n],r[36]=e,r[37]=n,r}function kc(t,e,n){let r=t.slice();return r[38]=e[n],r[39]=e,r[37]=n,r}function Am(t){let e,n,r=t[38].basename+Fo+(t[38].extension==="md"?"":t[38].extension)+"",i,s,o=t[38].folderPath+"",a;return{c(){e=Oe("span"),n=Oe("span"),i=Xn(),s=Oe("span"),a=cs(o),Re(n,"class","filename svelte-dvs2du"),Re(s,"class","file-folder-path svelte-dvs2du"),Re(e,"class","file-item svelte-dvs2du")},m(l,u){dt(l,e,u),ze(e,n),n.innerHTML=r,ze(e,i),ze(e,s),ze(s,a)},p(l,u){u[0]&4&&r!==(r=l[38].basename+Fo+(l[38].extension==="md"?"":l[38].extension)+"")&&(n.innerHTML=r),u[0]&4&&o!==(o=l[38].folderPath+"")&&Ec(a,o)},d(l){l&&ot(e)}}}function Tm(t){let e,n=t[38].line.text+"";return{c(){e=Oe("span"),Re(e,"class","line-item svelte-dvs2du")},m(r,i){dt(r,e,i),e.innerHTML=n},p(r,i){i[0]&4&&n!==(n=r[38].line.text+"")&&(e.innerHTML=n)},d(r){r&&ot(e)}}}function Oc(t){let e,n,r=t[39],i=t[37],s,o;function a(p,m){if(p[38]instanceof Vt)return Tm;if(p[38]instanceof Pn)return Am}let l=a(t,[-1,-1]),u=l&&l(t),c=()=>t[18](e,r,i),f=()=>t[18](null,r,i);function h(...p){return t[19](t[37],...p)}function d(...p){return t[20](t[37],...p)}return{c(){e=Oe("button"),u&&u.c(),n=Xn(),Re(e,"class","svelte-dvs2du"),Ur(e,"selected",t[37]===t[3])},m(p,m){dt(p,e,m),u&&u.m(e,null),ze(e,n),c(),s||(o=[Jt(e,"click",h),Jt(e,"contextmenu",d)],s=!0)},p(p,m){t=p,l===(l=a(t,m))&&u?u.p(t,m):(u&&u.d(1),u=l&&l(t),u&&(u.c(),u.m(e,n))),(r!==t[39]||i!==t[37])&&(f(),r=t[39],i=t[37],c()),m[0]&8&&Ur(e,"selected",t[37]===t[3])},d(p){p&&ot(e),u&&u.d(),f(),s=!1,Bt(o)}}}function Cm(t){let e;function n(s,o){return s[5]&&s[5].fileType===0?Im:Pm}let r=n(t,[-1,-1]),i=r(t);return{c(){i.c(),e=Oa()},m(s,o){i.m(s,o),dt(s,e,o)},p(s,o){r===(r=n(s,o))&&i?i.p(s,o):(i.d(1),i=r(s),i&&(i.c(),i.m(e.parentNode,e)))},d(s){i.d(s),s&&ot(e)}}}function Fm(t){let e,n=t[4]&&Lc(t);return{c(){n&&n.c(),e=Oa()},m(r,i){n&&n.m(r,i),dt(r,e,i)},p(r,i){r[4]?n?n.p(r,i):(n=Lc(r),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(r){n&&n.d(r),r&&ot(e)}}}function Pm(t){let e;return{c(){e=Oe("span"),e.textContent=`${gt?"no result or to be impl":"no matched content"}`},m(n,r){dt(n,e,r)},p:Nt,d(n){n&&ot(e)}}}function Im(t){let e,n=t[6],r=[];for(let i=0;i<n.length;i+=1)r[i]=Dc(Mc(t,n,i));return{c(){e=Oe("ul");for(let i=0;i<r.length;i+=1)r[i].c();Re(e,"class","svelte-dvs2du")},m(i,s){dt(i,e,s);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(e,null)},p(i,s){if(s[0]&12480){n=i[6];let o;for(o=0;o<n.length;o+=1){let a=Mc(i,n,o);r[o]?r[o].p(a,s):(r[o]=Dc(a),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d(i){i&&ot(e),ka(r,i)}}}function Dc(t){let e,n,r=t[35].text+"",i,s=t[36],o=t[37],a,l;function u(...d){return t[21](t[37],...d)}function c(...d){return t[22](t[37],...d)}let f=()=>t[23](e,s,o),h=()=>t[23](null,s,o);return{c(){e=Oe("button"),n=new ls(!1),i=Xn(),n.a=i,Re(e,"class","file-sub-item svelte-dvs2du"),Ur(e,"selected",t[37]===t[7])},m(d,p){dt(d,e,p),n.m(r,e),ze(e,i),f(),a||(l=[Jt(e,"click",u),Jt(e,"contextmenu",c)],a=!0)},p(d,p){t=d,p[0]&64&&r!==(r=t[35].text+"")&&n.p(r),(s!==t[36]||o!==t[37])&&(h(),s=t[36],o=t[37],f()),p[0]&128&&Ur(e,"selected",t[37]===t[7])},d(d){d&&ot(e),h(),a=!1,Bt(l)}}}function Lc(t){let e;return{c(){e=Oe("p"),Re(e,"class","svelte-dvs2du")},m(n,r){dt(n,e,r),e.innerHTML=t[4]},p(n,r){r[0]&16&&(e.innerHTML=n[4])},d(n){n&&ot(e)}}}function Mm(t){let e,n,r,i,s,o,a,l,u,c,f,h,d=t[2].items,p=[];for(let v=0;v<d.length;v+=1)p[v]=Oc(kc(t,d,v));function m(v,w){if(v[1]===1)return Fm;if(v[1]===2)return Cm}let y=m(t,[-1,-1]),g=y&&y(t);return{c(){e=Oe("div"),n=Oe("div"),r=Oe("div"),i=Oe("input"),s=Xn(),o=Oe("div"),a=Oe("ul");for(let v=0;v<p.length;v+=1)p[v].c();l=Xn(),u=Oe("div"),c=Oe("div"),g&&g.c(),Re(i,"class","svelte-dvs2du"),Re(r,"class","search-bar svelte-dvs2du"),Re(r,"data-match-count",t[9]),Re(a,"class","svelte-dvs2du"),Re(o,"class","result-items svelte-dvs2du"),Re(n,"class","left-pane svelte-dvs2du"),Re(c,"class","preview-container svelte-dvs2du"),Re(u,"class","right-pane svelte-dvs2du"),Re(e,"class","search-container svelte-dvs2du")},m(v,w){dt(v,e,w),ze(e,n),ze(n,r),ze(r,i),Da(i,t[0]),t[16](i),ze(n,s),ze(n,o),ze(o,a);for(let _=0;_<p.length;_+=1)p[_]&&p[_].m(a,null);ze(e,l),ze(e,u),ze(u,c),g&&g.m(c,null),f||(h=[Jt(i,"input",t[15]),Jt(i,"input",t[10]),Jt(i,"blur",t[17])],f=!0)},p(v,w){if(w[0]&1&&i.value!==v[0]&&Da(i,v[0]),w[0]&512&&Re(r,"data-match-count",v[9]),w[0]&10252){d=v[2].items;let _;for(_=0;_<d.length;_+=1){let S=kc(v,d,_);p[_]?p[_].p(S,w):(p[_]=Oc(S),p[_].c(),p[_].m(a,null))}for(;_<p.length;_+=1)p[_].d(1);p.length=d.length}y===(y=m(v,w))&&g?g.p(v,w):(g&&g.d(1),g=y&&y(v),g&&(g.c(),g.m(c,null)))},i:Nt,o:Nt,d(v){v&&ot(e),t[16](null),ka(p,v),g&&g.d(),f=!1,Bt(h)}}}function km(t,e,n){let r,i=O(vt),s=O(Yn),{modal:o}=e,{searchType:a}=e,{queryText:l}=e,u=new Map,c=new $t("",[]),f=-1,h="",d=null,p=[],m,y=-1,g;function v(x){return xn(this,void 0,void 0,function*(){yield Hr();let P=c.items;if(x>=0&&x<P.length){if(n(3,f=x),a===1){let j=P[x];n(4,h=j.context)}else if(a===2)n(5,d=P[x]),n(5,d.subItems=yield i.getFileSubItems(l,d),d),n(6,p=d.subItems),n(7,y=0),yield Hr(),s.scrollTo("start",p[y],"instant");else throw Error(`unsupported search type: ${a}`);yield Hr(),s.scrollTo("center",P[x],"smooth")}else n(4,h=""),n(5,d=null),n(6,p=[]),n(3,f=-1)})}let w=Ol(100,()=>_());function _(){return xn(this,void 0,void 0,function*(){if(u.has(l)){n(2,c=u.get(l)),yield v(0);return}if(a===1)n(2,c=yield i.searchInFile(l));else if(a===2)n(2,c=yield i.searchInVault(l));else throw Error(Tn);u.set(l,c),yield v(0)})}function S(x){return xn(this,void 0,void 0,function*(){yield v(x)})}function T(){return xn(this,void 0,void 0,function*(){yield v(Math.min(f+1,c.items.length-1))})}function C(){return xn(this,void 0,void 0,function*(){yield v(Math.max(f-1,0))})}function F(x){n(7,y=x)}function R(){n(7,y=s.updateSubItemIndex(p,y,"next"))}function N(){n(7,y=s.updateSubItemIndex(p,y,"prev"))}function D(){return xn(this,void 0,void 0,function*(){let x=c.items[f];yield s.handleConfirmAsync(o,a,x,y)})}function B(x,P){jt.on(x,P),La(()=>jt.off(x,P))}B(2,T),B(4,C),B(3,R),B(5,N),B(6,D),_();function L(){l=this.value,n(0,l)}function K(x){Gn[x?"unshift":"push"](()=>{g=x,n(8,g)})}let ee=()=>setTimeout(()=>g==null?void 0:g.focus(),1);function Q(x,P,j){Gn[x?"unshift":"push"](()=>{P[j].element=x,n(2,c)})}let ae=(x,P)=>{S(x)},le=async(x,P)=>{P.preventDefault(),await S(x),await D()},xe=(x,P)=>F(x),at=(x,P)=>{P.preventDefault(),n(7,y=x),D()};function ue(x,P,j){Gn[x?"unshift":"push"](()=>{P[j].element=x,n(6,p)})}return t.$$set=x=>{"modal"in x&&n(14,o=x.modal),"searchType"in x&&n(1,a=x.searchType),"queryText"in x&&n(0,l=x.queryText)},t.$$.update=()=>{if(t.$$.dirty[0]&12){e:n(9,r=`${f+1} / ${c.items.length}`)}},[l,a,c,f,h,d,p,y,g,r,w,S,F,D,o,L,K,ee,Q,ae,le,xe,at,ue]}var Ra=class extends us{constructor(e){super(),Fc(this,e,km,Mm,vc,{modal:14,searchType:1,queryText:0},Sm,[-1,-1])}},Rc=Ra;var Qn=class extends Nc.Modal{constructor(n,r,i){var a;super(n);jt.emit(7);let s=((a=window.getSelection())==null?void 0:a.toString())||"",o=i||s;this.modalEl.replaceChildren(),this.modalEl.addClass("cs-modal"),this.mountedElement=new Rc({target:this.modalEl,props:{modal:this,searchType:r,queryText:o||""}}),this.registerHotkeys()}onOpen(){}onClose(){this.modalEl.removeEventListener("contextmenu",jc),this.mountedElement.$destroy(),M.trace("mounted element has been destroyed.")}registerHotkeys(){let n=wl;this.newHotKey([n],"J",2),this.newHotKey([],"ArrowDown",2),this.newHotKey([n],"K",4),this.newHotKey([],"ArrowUp",4),this.newHotKey([n],"N",3),this.newHotKey([n],"P",5),this.newHotKey([],"Enter",6),this.modalEl.addEventListener("contextmenu",jc)}newHotKey(n,r,i){this.scope.register(n,r,Om(i))}};function Om(t){return e=>{e.preventDefault(),jt.emit(t),console.log("emit...")}}function jc(t){t.preventDefault(),jt.emit(6),console.log("Right-click on button, confirm item event emitted.")}var hs=class extends He.Plugin{async onload(){fs.container.register(un,{useValue:this}),fs.container.register(He.App,{useValue:this.app}),fs.container.register(He.Vault,{useValue:this.app.vault});let e=O(wn);await e.onload(),this.app.workspace.onLayoutReady(()=>{e.onLayoutReady()}),this.registerCommands(),this.addCommand({id:"clever-search-in-vault",name:"Search in Vault",callback:()=>new Qn(this.app,2).open()}),gt&&(this.addCommand({id:"clever-search-triggerTest",name:"clever-search-triggerTest",callback:async()=>await pu()}),this.addCommand({id:"cs-open-test-modal",name:"Open test modal",callback:()=>this.openTestModal()}))}onunload(){document.body.classList.remove("cs-privacy-blur"),O(wn).onunload()}openTestModal(){let e=this.app.workspace.getActiveViewOfType(He.MarkdownView);if(e){let n="",r=e.contentEl.querySelector(".markdown-source-view");if(r){let s=document.createElement("div");s.appendChild(r.cloneNode(!0)),n=s.innerHTML}new Na(this.app,n).open()}else throw Error("no active MarkdownView")}registerCommands(){this.addCommand({id:"clever-search-in-file",name:"Search in file",callback:()=>new Qn(this.app,1).open()}),this.addCommand({id:"cs-toggle-privacy-mode",name:"Toggle privacy mode",callback:()=>O(Kn).togglePrivacyMode()}),this.addCommand({id:"cs-in-file-search-with-omnisearch-query",name:"Search in file with last Omnisearch query",callback:async()=>{new Qn(this.app,1,await O(bt).getLastQuery()).open()}})}exampleCode(){this.addRibbonIcon("dice","Sample Plugin",r=>{new He.Notice("This is a notice!")}).addClass("my-plugin-ribbon-class"),this.addStatusBarItem().setText("Status Bar Text"),this.addCommand({id:"open-sample-modal-simple",name:"Open sample modal (simple)",callback:()=>{new ja(this.app).open()}}),this.addCommand({id:"sample-editor-command",name:"Sample editor command",editorCallback:r=>{console.log(r.getSelection()),r.replaceSelection("Sample Editor Command")}}),this.registerDomEvent(document,"click",r=>{console.log("click",r)}),this.registerInterval(window.setInterval(()=>console.log("setInterval"),5*60*1e3))}},ja=class extends He.Modal{constructor(e){super(e)}onOpen(){let{contentEl:e}=this;e.setText("Woah!")}onClose(){let{contentEl:e}=this;e.empty()}},Na=class extends He.Modal{constructor(n,r){super(n);this.contentHTML=r}onOpen(){He.MarkdownView,He.HoverPopover,console.log(this.contentHTML),this.containerEl.style.backgroundColor="black",this.containerEl.innerHTML=this.contentHTML}onClose(){let{contentEl:n}=this;n.empty()}};0&&(module.exports={});
/*! Bundled license information:

tslib/tslib.es6.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

fzf/dist/fzf.es.js:
  (** @license
   * fzf v0.5.2
   * Copyright (c) 2021 Ajit
   * Licensed under BSD 3-Clause
   *)
*/
