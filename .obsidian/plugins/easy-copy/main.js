/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var f=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var S=(b,o)=>{for(var e in o)f(b,e,{get:o[e],enumerable:!0})},H=(b,o,e,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of v(o))!C.call(b,i)&&i!==e&&f(b,i,{get:()=>o[i],enumerable:!(t=D(o,i))||t.enumerable});return b};var A=b=>H(f({},"__esModule",{value:!0}),b);var z={};S(z,{default:()=>y});module.exports=A(z);var d=require("obsidian");var T={["en"]:{"auto-add-block-id":"Auto generate block ID","auto-add-block-id-desc":"When enabled, if there is no copyable content, a random block ID (^xxxx) will be automatically added to the end of the current line.","manual-block-id":"Manually enter Block ID","manual-block-id-desc":"If enabled, you will be prompted to enter a block ID manually.","modal-block-id":"Enter block ID","modal-block-id-desc":"Allowed: letters, numbers, hyphens (-), underscores (_). Spaces will be converted to hyphens.","error-block-id-empty":"Block ID cannot be empty","error-block-id-invalid":"Only letters, numbers, hyphens and underscores are allowed","no-file":"Cannot get current file","no-content":"No content to copy at current cursor position","inline-code-copied":"Inline code copied!","block-id-copied":"Block ID link copied!","note-link-copied":"Note link copied!","heading-copied":"Heading link copied!","bold-copied":"Bold text copied!","highlight-copied":"Highlighted text copied!","italic-copied":"Italic text copied!","inline-latex-copied":"Inline LaTeX copied!","strikethrough-copied":"Strikethrough text copied!","link-text-copied":"Link text copied!","link-url-copied":"Link URL copied!",format:"Format","block-id":"Block ID",target:"Target","add-to-menu":"Add to menu","add-to-menu-desc":"Add the command to the context menu","show-notice":"Show notice","show-notice-desc":"Show notification when content is copied","use-heading-as-display":"Use heading as display text","use-heading-as-display-desc":"Use the heading text as display text in links","link-format":"Link format","link-format-desc":"The format of the link when you copy heading link","markdown-link":"Markdown link","wiki-link":"Wiki link","customize-targets":"Customize targets","customize-targets-desc":"Enable to customize which elements can be copied (disable to copy all elements)","enable-inline-code":"Enable inline code","enable-inline-code-desc":"Enable copying inline code like `code example`","enable-bold":"Enable bold text","enable-bold-desc":"Enable copying bold text like **bold example**","enable-highlight":"Enable highlighted text","enable-highlight-desc":"Enable copying highlighted text like ==highlight example==","enable-italic":"Enable italic text","enable-italic-desc":"Enable copying italic text like *italic example*","enable-strikethrough":"Enable strikethrough text","enable-strikethrough-desc":"Enable copying strikethrough text like ~~strikethrough example~~","enable-inline-latex":"Enable inline LaTeX","enable-inline-latex-desc":"Enable copying inline LaTeX like $latex example$","enable-link":"Enable link title/url","enable-link-desc":"Enable copying link like [linktitle](linkurl) - the plugin will copy the title or the URL of the link based on the current cursor position.","contextual-copy":"Contextual copy"},["zh"]:{"auto-add-block-id":"\u81EA\u52A8\u751F\u6210\u5757ID","auto-add-block-id-desc":"\u542F\u7528\u540E\uFF0C\u5982\u679C\u6CA1\u6709\u53EF\u590D\u5236\u5185\u5BB9\u65F6\u4F1A\u81EA\u52A8\u5728\u5F53\u524D\u6587\u672C\u672B\u5C3E\u6DFB\u52A0\u4E00\u4E2A\u968F\u673A\u751F\u6210\u7684\u5757ID\uFF08^xxxx\uFF09","manual-block-id":"\u624B\u52A8\u8F93\u5165\u5757ID","manual-block-id-desc":"\u542F\u7528\u540E\uFF0C\u53EF\u4EE5\u5728\u5F39\u7A97\u4E2D\u624B\u52A8\u8F93\u5165\u5757ID","modal-block-id":"\u8F93\u5165\u5757ID","modal-block-id-desc":"\u4EC5\u5141\u8BB8\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u77ED\u6A2A\u7EBF\uFF08-\uFF09\u3001\u4E0B\u5212\u7EBF\uFF08_\uFF09\uFF0C\u7A7A\u683C\u4F1A\u81EA\u52A8\u8F6C\u4E3A\u77ED\u6A2A\u7EBF\u3002","error-block-id-empty":"\u5757ID\u4E0D\u80FD\u4E3A\u7A7A","error-block-id-invalid":"\u53EA\u5141\u8BB8\u5B57\u6BCD\u3001\u6570\u5B57\u3001-\u3001_","no-file":"\u65E0\u6CD5\u83B7\u53D6\u5F53\u524D\u6587\u4EF6","no-content":"\u5F53\u524D\u5149\u6807\u5904\u6CA1\u6709\u53EF\u590D\u5236\u7684\u5185\u5BB9","inline-code-copied":"\u884C\u5185\u4EE3\u7801\u5DF2\u590D\u5236\uFF01","block-id-copied":"\u5757ID\u94FE\u63A5\u5DF2\u590D\u5236\uFF01","note-link-copied":"\u7B14\u8BB0\u94FE\u63A5\u5DF2\u590D\u5236\uFF01","heading-copied":"\u6807\u9898\u94FE\u63A5\u5DF2\u590D\u5236\uFF01","bold-copied":"\u52A0\u7C97\u6587\u672C\u5DF2\u590D\u5236\uFF01","highlight-copied":"\u9AD8\u4EAE\u6587\u672C\u5DF2\u590D\u5236\uFF01","italic-copied":"\u659C\u4F53\u6587\u672C\u5DF2\u590D\u5236\uFF01","inline-latex-copied":"\u884C\u5185LaTeX\u5DF2\u590D\u5236\uFF01","strikethrough-copied":"\u5220\u9664\u7EBF\u6587\u672C\u5DF2\u590D\u5236\uFF01","link-text-copied":"\u94FE\u63A5\u6587\u672C\u5DF2\u590D\u5236\uFF01","link-url-copied":"\u94FE\u63A5\u5730\u5740\u5DF2\u590D\u5236\uFF01",format:"\u683C\u5F0F","block-id":"\u5757ID",target:"\u590D\u5236\u5BF9\u8C61","add-to-menu":"\u6DFB\u52A0\u5230\u83DC\u5355","add-to-menu-desc":"\u5C06\u547D\u4EE4\u6DFB\u52A0\u5230\u53F3\u952E\u83DC\u5355","show-notice":"\u663E\u793A\u901A\u77E5","show-notice-desc":"\u590D\u5236\u5185\u5BB9\u65F6\u663E\u793A\u901A\u77E5\u63D0\u793A","use-heading-as-display":"\u4F7F\u7528\u6807\u9898\u4F5C\u4E3A\u663E\u793A\u6587\u672C","use-heading-as-display-desc":"\u5728\u94FE\u63A5\u4E2D\u4F7F\u7528\u6807\u9898\u6587\u672C\u4F5C\u4E3A\u663E\u793A\u6587\u672C","link-format":"\u94FE\u63A5\u683C\u5F0F","link-format-desc":"\u590D\u5236\u6807\u9898\u94FE\u63A5\u65F6\u4F7F\u7528\u7684\u683C\u5F0F","markdown-link":"Markdown\u94FE\u63A5","wiki-link":"Wiki\u94FE\u63A5","customize-targets":"\u81EA\u5B9A\u4E49\u590D\u5236\u5BF9\u8C61","customize-targets-desc":"\u542F\u7528\u540E\u53EF\u4EE5\u81EA\u5B9A\u4E49\u54EA\u4E9B\u5143\u7D20\u53EF\u4EE5\u88AB\u590D\u5236\uFF08\u4E0D\u542F\u7528\u5219\u9ED8\u8BA4\u53EF\u590D\u5236\u6240\u6709\u5143\u7D20\uFF09","enable-inline-code":"\u542F\u7528\u884C\u5185\u4EE3\u7801","enable-inline-code-desc":"\u542F\u7528\u590D\u5236\u884C\u5185\u4EE3\u7801\uFF0C\u5982 `\u4EE3\u7801\u793A\u4F8B`","enable-bold":"\u542F\u7528\u52A0\u7C97\u6587\u672C","enable-bold-desc":"\u542F\u7528\u590D\u5236\u52A0\u7C97\u6587\u672C\uFF0C\u5982 **\u52A0\u7C97\u793A\u4F8B**","enable-highlight":"\u542F\u7528\u9AD8\u4EAE\u6587\u672C","enable-highlight-desc":"\u542F\u7528\u590D\u5236\u9AD8\u4EAE\u6587\u672C\uFF0C\u5982 ==\u9AD8\u4EAE\u793A\u4F8B==","enable-italic":"\u542F\u7528\u659C\u4F53\u6587\u672C","enable-italic-desc":"\u542F\u7528\u590D\u5236\u659C\u4F53\u6587\u672C\uFF0C\u5982 *\u659C\u4F53\u793A\u4F8B*","enable-strikethrough":"\u542F\u7528\u5220\u9664\u7EBF\u6587\u672C","enable-strikethrough-desc":"\u542F\u7528\u590D\u5236\u5220\u9664\u7EBF\u6587\u672C\uFF0C\u5982 ~~\u5220\u9664\u7EBF\u793A\u4F8B~~","enable-inline-latex":"\u542F\u7528\u884C\u5185LaTeX","enable-inline-latex-desc":"\u542F\u7528\u590D\u5236\u884C\u5185LaTeX\uFF0C\u5982 $latex \u793A\u4F8B$","enable-link":"\u542F\u7528\u94FE\u63A5\u6587\u672C","enable-link-desc":"\u542F\u7528\u590D\u5236\u94FE\u63A5\u6587\u672C\uFF0C\u5982 [\u94FE\u63A5\u6807\u9898](\u94FE\u63A5\u5730\u5740) - \u63D2\u4EF6\u4F1A\u6839\u636E\u5F53\u524D\u5149\u6807\u6240\u5728\u7684\u4E0D\u540C\u4F4D\u7F6E\u590D\u5236\u6807\u9898\u6216\u8005\u94FE\u63A5URL","contextual-copy":"\u667A\u80FD\u590D\u5236"},["zh-tw"]:{"auto-add-block-id":"\u81EA\u52D5\u65B0\u589E\u584AID","auto-add-block-id-desc":"\u555F\u7528\u5F8C\uFF0C\u82E5\u6C92\u6709\u53EF\u8907\u88FD\u5167\u5BB9\u6642\uFF0C\u6703\u81EA\u52D5\u5728\u7576\u524D\u6587\u672C\u672B\u5C3E\u65B0\u589E\u4E00\u500B\u96A8\u6A5F\u7684\u584AID\uFF08^xxxx\uFF09","manual-block-id":"\u624B\u52D5\u8F38\u5165\u584AID","manual-block-id-desc":"\u555F\u7528\u5F8C\uFF0C\u53EF\u4EE5\u5728\u5F48\u7A97\u4E2D\u624B\u52D5\u8F38\u5165\u584AID","modal-block-id":"\u8F38\u5165\u584AID","modal-block-id-desc":"\u50C5\u5141\u8A31\u5B57\u6BCD\u3001\u6578\u5B57\u3001\u9023\u5B57\u865F\uFF08-\uFF09\u3001\u5E95\u7DDA\uFF08_\uFF09\uFF0C\u7A7A\u683C\u6703\u81EA\u52D5\u8F49\u70BA\u9023\u5B57\u865F\u3002","error-block-id-empty":"\u584AID \u4E0D\u80FD\u70BA\u7A7A","error-block-id-invalid":"\u53EA\u5141\u8A31\u5B57\u6BCD\u3001\u6578\u5B57\u3001-\u3001_","no-file":"\u7121\u6CD5\u7372\u53D6\u7576\u524D\u6587\u4EF6","no-content":"\u7576\u524D\u5149\u6A19\u8655\u6C92\u6709\u53EF\u8907\u88FD\u7684\u5167\u5BB9","inline-code-copied":"\u884C\u5167\u4EE3\u78BC\u5DF2\u8907\u88FD\uFF01","block-id-copied":"\u584AID\u9023\u7D50\u5DF2\u8907\u88FD\uFF01","note-link-copied":"\u7B46\u8A18\u9023\u7D50\u5DF2\u8907\u88FD\uFF01","heading-copied":"\u6A19\u984C\u9023\u7D50\u5DF2\u8907\u88FD\uFF01","bold-copied":"\u52A0\u7C97\u6587\u672C\u5DF2\u8907\u88FD\uFF01","highlight-copied":"\u9AD8\u4EAE\u6587\u672C\u5DF2\u8907\u88FD\uFF01","italic-copied":"\u659C\u9AD4\u6587\u672C\u5DF2\u8907\u88FD\uFF01","inline-latex-copied":"\u884C\u5167LaTeX\u5DF2\u8907\u88FD\uFF01","strikethrough-copied":"\u522A\u9664\u7DDA\u6587\u672C\u5DF2\u8907\u88FD\uFF01","link-text-copied":"\u9023\u7D50\u6587\u672C\u5DF2\u8907\u88FD\uFF01","link-url-copied":"\u9023\u7D50\u5730\u5740\u5DF2\u8907\u88FD\uFF01",format:"\u683C\u5F0F","block-id":"\u584AID",target:"\u8907\u88FD\u5C0D\u8C61","add-to-menu":"\u6DFB\u52A0\u5230\u83DC\u55AE","add-to-menu-desc":"\u5C07\u547D\u4EE4\u6DFB\u52A0\u5230\u53F3\u9375\u83DC\u55AE","show-notice":"\u986F\u793A\u901A\u77E5","show-notice-desc":"\u8907\u88FD\u5167\u5BB9\u6642\u986F\u793A\u901A\u77E5\u63D0\u793A","use-heading-as-display":"\u4F7F\u7528\u6A19\u984C\u4F5C\u70BA\u986F\u793A\u6587\u672C","use-heading-as-display-desc":"\u5728\u9023\u7D50\u4E2D\u4F7F\u7528\u6A19\u984C\u6587\u672C\u4F5C\u70BA\u986F\u793A\u6587\u672C","link-format":"\u9023\u7D50\u683C\u5F0F","link-format-desc":"\u8907\u88FD\u6A19\u984C\u9023\u7D50\u6642\u4F7F\u7528\u7684\u683C\u5F0F","markdown-link":"Markdown\u9023\u7D50","wiki-link":"Wiki\u9023\u7D50","customize-targets":"\u81EA\u5B9A\u7FA9\u8907\u88FD\u5C0D\u8C61","customize-targets-desc":"\u555F\u7528\u5F8C\u53EF\u4EE5\u81EA\u5B9A\u7FA9\u54EA\u4E9B\u5143\u7D20\u53EF\u4EE5\u88AB\u8907\u88FD\uFF08\u4E0D\u555F\u7528\u5247\u9ED8\u8BA4\u53EF\u8907\u88FD\u6240\u6709\u5143\u7D20\uFF09","enable-inline-code":"\u555F\u7528\u884C\u5167\u4EE3\u78BC","enable-inline-code-desc":"\u555F\u7528\u8907\u88FD\u884C\u5167\u4EE3\u78BC\uFF0C\u5982 `\u4EE3\u78BC\u793A\u4F8B`","enable-bold":"\u555F\u7528\u52A0\u7C97\u6587\u672C","enable-bold-desc":"\u555F\u7528\u8907\u88FD\u52A0\u7C97\u6587\u672C\uFF0C\u5982 **\u52A0\u7C97\u793A\u4F8B**","enable-highlight":"\u555F\u7528\u9AD8\u4EAE\u6587\u672C","enable-highlight-desc":"\u555F\u7528\u8907\u88FD\u9AD8\u4EAE\u6587\u672C\uFF0C\u5982 ==\u9AD8\u4EAE\u793A\u4F8B==","enable-italic":"\u555F\u7528\u659C\u9AD4\u6587\u672C","enable-italic-desc":"\u555F\u7528\u8907\u88FD\u659C\u9AD4\u6587\u672C\uFF0C\u5982 *\u659C\u9AD4\u793A\u4F8B*","enable-strikethrough":"\u555F\u7528\u522A\u9664\u7DDA\u6587\u672C","enable-strikethrough-desc":"\u555F\u7528\u8907\u88FD\u522A\u9664\u7DDA\u6587\u672C\uFF0C\u5982 ~~\u522A\u9664\u7DDA\u793A\u4F8B~~","enable-inline-latex":"\u555F\u7528\u884C\u5167LaTeX","enable-inline-latex-desc":"\u555F\u7528\u8907\u88FD\u884C\u5167LaTeX\uFF0C\u5982 $latex \u793A\u4F8B$","enable-link":"\u555F\u7528\u9023\u7D50\u6587\u672C","enable-link-desc":"\u555F\u7528\u8907\u88FD\u9023\u7D50\uFF0C\u5982 [\u9023\u7D50\u6A19\u984C](\u9023\u7D50\u5730\u5740) - \u63D2\u4EF6\u6703\u6839\u64DA\u7576\u524D\u5149\u6A19\u6240\u5728\u7684\u4E0D\u540C\u4F4D\u7F6E\u8907\u88FD\u6A19\u984C\u6216\u8005\u9023\u7D50URL","contextual-copy":"\u667A\u80FD\u8907\u88FD"}},I=class{constructor(o="en"){this.language=o}setLanguage(o){this.language=o}t(o){return T[this.language][o]||T["en"][o]||o}};var E={addToMenu:!0,showNotice:!0,useHeadingAsDisplayText:!0,linkFormat:"wiki-link",customizeTargets:!1,enableInlineCode:!0,enableBold:!0,enableHighlight:!0,enableItalic:!0,enableStrikethrough:!0,enableInlineLatex:!0,enableLink:!0,autoAddBlockId:!1,allowManualBlockId:!1};var c=require("obsidian");var w=class extends c.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new c.Setting(e).setName(this.plugin.t("add-to-menu")).setDesc(this.plugin.t("add-to-menu-desc")).addToggle(t=>t.setValue(this.plugin.settings.addToMenu).onChange(async i=>{this.plugin.settings.addToMenu=i,await this.plugin.saveSettings()})),new c.Setting(e).setName(this.plugin.t("show-notice")).setDesc(this.plugin.t("show-notice-desc")).addToggle(t=>t.setValue(this.plugin.settings.showNotice).onChange(async i=>{this.plugin.settings.showNotice=i,await this.plugin.saveSettings()})),new c.Setting(e).setName(this.plugin.t("format")).setHeading(),new c.Setting(e).setName(this.plugin.t("use-heading-as-display")).setDesc(this.plugin.t("use-heading-as-display-desc")).addToggle(t=>t.setValue(this.plugin.settings.useHeadingAsDisplayText).onChange(async i=>{this.plugin.settings.useHeadingAsDisplayText=i,await this.plugin.saveSettings()})),new c.Setting(e).setName(this.plugin.t("link-format")).setDesc(this.plugin.t("link-format-desc")).addDropdown(t=>t.addOption("markdown-link",this.plugin.t("markdown-link")).addOption("wiki-link",this.plugin.t("wiki-link")).setValue(this.plugin.settings.linkFormat).onChange(async i=>{this.plugin.settings.linkFormat=i,await this.plugin.saveSettings()})),new c.Setting(e).setName(this.plugin.t("block-id")).setHeading(),new c.Setting(e).setName(this.plugin.t("auto-add-block-id")).setDesc(this.plugin.t("auto-add-block-id-desc")).addToggle(t=>t.setValue(this.plugin.settings.autoAddBlockId).onChange(async i=>{this.plugin.settings.autoAddBlockId=i,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.autoAddBlockId&&new c.Setting(e).setName(this.plugin.t("manual-block-id")).setDesc(this.plugin.t("manual-block-id-desc")).addToggle(t=>t.setValue(this.plugin.settings.allowManualBlockId).onChange(async i=>{this.plugin.settings.allowManualBlockId=i,await this.plugin.saveSettings()})),new c.Setting(e).setName(this.plugin.t("target")).setHeading(),new c.Setting(e).setName(this.plugin.t("customize-targets")).setDesc(this.plugin.t("customize-targets-desc")).addToggle(t=>t.setValue(this.plugin.settings.customizeTargets).onChange(async i=>{this.plugin.settings.customizeTargets=i,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.customizeTargets&&(new c.Setting(e).setName(this.plugin.t("enable-inline-code")).setDesc(this.plugin.t("enable-inline-code-desc")).addToggle(t=>t.setValue(this.plugin.settings.enableInlineCode).onChange(async i=>{this.plugin.settings.enableInlineCode=i,await this.plugin.saveSettings()})),new c.Setting(e).setName(this.plugin.t("enable-bold")).setDesc(this.plugin.t("enable-bold-desc")).addToggle(t=>t.setValue(this.plugin.settings.enableBold).onChange(async i=>{this.plugin.settings.enableBold=i,await this.plugin.saveSettings()})),new c.Setting(e).setName(this.plugin.t("enable-highlight")).setDesc(this.plugin.t("enable-highlight-desc")).addToggle(t=>t.setValue(this.plugin.settings.enableHighlight).onChange(async i=>{this.plugin.settings.enableHighlight=i,await this.plugin.saveSettings()})),new c.Setting(e).setName(this.plugin.t("enable-italic")).setDesc(this.plugin.t("enable-italic-desc")).addToggle(t=>t.setValue(this.plugin.settings.enableItalic).onChange(async i=>{this.plugin.settings.enableItalic=i,await this.plugin.saveSettings()})),new c.Setting(e).setName(this.plugin.t("enable-strikethrough")).setDesc(this.plugin.t("enable-strikethrough-desc")).addToggle(t=>t.setValue(this.plugin.settings.enableStrikethrough).onChange(async i=>{this.plugin.settings.enableStrikethrough=i,await this.plugin.saveSettings()})),new c.Setting(e).setName(this.plugin.t("enable-inline-latex")).setDesc(this.plugin.t("enable-inline-latex-desc")).addToggle(t=>t.setValue(this.plugin.settings.enableInlineLatex).onChange(async i=>{this.plugin.settings.enableInlineLatex=i,await this.plugin.saveSettings()})),new c.Setting(e).setName(this.plugin.t("enable-link")).setDesc(this.plugin.t("enable-link-desc")).addToggle(t=>t.setValue(this.plugin.settings.enableLink).onChange(async i=>{this.plugin.settings.enableLink=i,await this.plugin.saveSettings()})))}};var N=require("obsidian"),x=class extends N.Modal{constructor(e,t,i,l,n){super(e);this.onSubmit=n,this.title=t,this.desc=i,this.t=l}onOpen(){let{contentEl:e}=this;e.empty(),this.setTitle(this.title),this.inputEl=e.createEl("input",{type:"text",placeholder:"Block ID...",cls:"blockid-modal-input"}),this.inputEl.focus();let t=e.createEl("div",{text:this.desc,cls:"blockid-modal-desc"});this.errorEl=e.createEl("div",{text:"",cls:"blockid-modal-error"}),this.inputEl.addEventListener("keydown",i=>{i.key==="Enter"?(i.preventDefault(),i.stopPropagation(),this.submit()):i.key==="Escape"&&(i.preventDefault(),i.stopPropagation(),this.close(),this.onSubmit(null))})}submit(){let e=this.inputEl.value.trim();if(!e){this.errorEl.textContent=this.t("error-block-id-empty");return}if(!/^[-_a-zA-Z0-9\s]+$/.test(e)){this.errorEl.textContent=this.t("error-block-id-invalid");return}e=e.replace(/\s+/g,"-").replace(/[^a-zA-Z0-9\-_]/g,""),this.close(),this.onSubmit(e)}};var y=class extends d.Plugin{async onload(){await this.loadSettings(),this.initializeI18n(),this.addCommand({id:"contextual-copy",name:this.t("contextual-copy"),editorCallback:(e,t)=>{this.contextualCopy(e,t)}}),this.addSettingTab(new w(this.app,this)),this.registerEvent(this.app.workspace.on("editor-menu",(e,t,i)=>{this.settings.addToMenu&&e.addItem(l=>{l.setTitle(this.t("contextual-copy")).setIcon("copy-slash").onClick(async()=>{this.contextualCopy(t,i)})})}))}onunload(){}async loadSettings(){this.settings=Object.assign({},E,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}t(e){return this.i18n.t(e)}isContinuousText(e){return e.trim()!==""&&!e.trim().startsWith("#")&&!e.trim().startsWith("- ")}detectBlockRange(e,t){if(e.getLine(t).trim().startsWith("- ")){let s=t;for(;s<e.lineCount()-1&&this.isContinuousText(e.getLine(s+1));)s++;return{start:t,end:s}}let i=e.lineCount(),l=t;for(;l>0&&this.isContinuousText(e.getLine(l-1));)l--;let n=t;for(;n<i-1&&this.isContinuousText(e.getLine(n+1));)n++;return{start:l,end:n}}detectBlockId(e,t){let i=e.getCursor(),{end:l}=this.detectBlockRange(e,i.line),n=e.getLine(l),s=n.trimEnd().match(/\^([a-zA-Z0-9_-]+)$/);return s?{type:"block-id",curLine:n,match:s[1],range:[n.lastIndexOf("^"),n.length]}:null}determineContextType(e,t){if(!t.file)return new d.Notice(this.t("no-file")),{type:"null",curLine:"",match:null,range:null};let l=e.getCursor(),n=e.getLine(l.line),s=l.ch,r=n.slice(0,s),u=n.slice(s),m=d.Platform.isIosApp?/\*([^*]+)\*(?!\*)/g:/(?<!\*)\*([^*]+)\*(?!\*)/g,g=[{type:"bold",regex:/\*\*([^*]+)\*\*/g,enable:!this.settings.customizeTargets||this.settings.enableBold},{type:"italic",regex:m,enable:!this.settings.customizeTargets||this.settings.enableItalic},{type:"highlight",regex:/==([^=]+)==/g,enable:!this.settings.customizeTargets||this.settings.enableHighlight},{type:"strikethrough",regex:/~~([^~]+)~~/g,enable:!this.settings.customizeTargets||this.settings.enableStrikethrough},{type:"inline-code",regex:/`([^`]+)`/g,enable:!this.settings.customizeTargets||this.settings.enableInlineCode},{type:"inline-latex",regex:/\$([^$]*)\$/g,enable:!this.settings.customizeTargets||this.settings.enableInlineLatex}];for(let a of g){if(!a.enable)continue;let k=this.getMatchInfo(r,u,a.regex);if(k)return{type:a.type,curLine:n,match:k.content,range:k.range}}if(!this.settings.customizeTargets||this.settings.enableLink){let a=this.isCursorInLink(r,u);if(a)return{type:a.type,curLine:n,match:a.content,range:a.range}}let p=this.detectBlockId(e,t);if(p)return p;let h=/^(#+)\s/;if(h.test(n)){let a=n.match(h),k=n.replace(h,"").trim();return{type:"heading",curLine:n,match:k,range:a?[a[0].length,n.length]:null}}return{type:"null",curLine:n,match:null,range:null}}getMatchInfo(e,t,i){let l;for(;(l=i.exec(e+t))!==null;){let n=l.index,s=l.index+l[0].length;if(e.length>=n&&e.length<=s)return{content:l[1],range:[n,s]}}return null}isCursorInLink(e,t){let i=/\[([^\]]*?)\]\(([^)]*?)\)/g,l=e+t,n;for(;(n=i.exec(l))!==null;){let s=n.index,r=s+n[0].length,u=e.length;if(u>=s&&u<=r){let m=s+1,g=s+n[1].length+1,p=g+2,h=p+n[2].length;if(u>=m&&u<=g)return{type:"link-title",content:n[1],range:[m,g]};if(u>=p&&u<=h)return{type:"line-url",content:n[2],range:[p,h]}}}return null}async contextualCopy(e,t){let i=t.file;if(!i){new d.Notice(this.t("no-file"));return}let l=i.basename,n=this.determineContextType(e,t);if(n.type=="null"){if(this.settings.autoAddBlockId){let s="",r=this.settings.allowManualBlockId;if(r){let a=await new Promise(k=>{new x(this.app,this.t("modal-block-id"),this.t("modal-block-id-desc"),this.t.bind(this),L=>{k(L!=null?L:null)}).open()});if(!a)return;s=a}else s=`${Math.random().toString(36).substr(2,6)}`;let u=e.getCursor(),{start:m,end:g}=this.detectBlockRange(e,u.line),p=e.getLine(m),h=e.getLine(g);if(!/\^[a-zA-Z0-9_-]+$/.test(h.trim())){let a="^"+s;h.startsWith("> ")||h.startsWith("``")?a=`
`+a:h.endsWith(" ")||(a=" "+a),e.replaceRange(a,{line:g,ch:h.length});let k=!r;this.copyBlockLink(s,l,k,p);return}}new d.Notice(this.t("no-content"));return}switch(n.type){case"block-id":this.copyBlockLink(n.match,l,!0,n.curLine);return;case"bold":navigator.clipboard.writeText(n.match),this.settings.showNotice&&new d.Notice(this.t("bold-copied"));return;case"italic":navigator.clipboard.writeText(n.match),this.settings.showNotice&&new d.Notice(this.t("italic-copied"));return;case"highlight":navigator.clipboard.writeText(n.match),this.settings.showNotice&&new d.Notice(this.t("highlight-copied"));return;case"strikethrough":navigator.clipboard.writeText(n.match),this.settings.showNotice&&new d.Notice(this.t("strikethrough-copied"));return;case"inline-code":navigator.clipboard.writeText(n.match),this.settings.showNotice&&new d.Notice(this.t("inline-code-copied"));return;case"inline-latex":navigator.clipboard.writeText(n.match),this.settings.showNotice&&new d.Notice(this.t("inline-latex-copied"));return;case"link-title":navigator.clipboard.writeText(n.match),this.settings.showNotice&&new d.Notice(this.t("link-text-copied"));return;case"line-url":navigator.clipboard.writeText(n.match),this.settings.showNotice&&new d.Notice(this.t("link-url-copied"));return;case"heading":this.copyHeadingLink(n.match,l);return;default:break}}copyBlockLink(e,t,i,l=""){let n=e,s=l;s=s.replace(/\^.*\s*$/,""),s=s.trim().replace(/- \[.\]\s+/,"").replace("- ","").replace(/=|\*|\[|\]|\(|\)|`|>\s+/g,"");let r=n;if(i&&s)if(/^[a-zA-Z\s,.!?"()\[-\]_\^\-\~:;0-9]*$/.test(s)){let g=3;r=s.trim().split(" ").slice(0,g).join(" ")}else{let g=5,p=s;if(p.length>g){let h=s.trim().match(/(\S+?)[\~\,\.\-\=\[，。？！…：\n\s]/),a=null;h?a=h[1]:a=p,a.length>g?r=a.slice(0,g)+"...":a.length<3?r=p.slice(0,g):r=a}}let u=this.settings.linkFormat==="wiki-link"?`[[${t}#^${n}|${r}]]`:`[^${r}](${t}#^${n})`;navigator.clipboard.writeText(u),this.settings.showNotice&&new d.Notice(this.t("block-id-copied")+`
^${r}`)}copyHeadingLink(e,t){let i=e;i.startsWith("[[")&&i.endsWith("]]")&&(i=i.slice(2,-2));let l=i,n=0,s="";this.settings.linkFormat==="wiki-link"?(s=`[[${t}#${i}|${l}]]`,this.settings.useHeadingAsDisplayText&&t===l&&(s=`[[${t}]]`,n=1)):s=`[${l}](${t}#${i})`,navigator.clipboard.writeText(s),this.settings.showNotice&&(n?new d.Notice(this.t("note-link-copied")):new d.Notice(this.t("heading-copied")))}initializeI18n(){let e=this.getObsidianLanguage(),t="en";e.startsWith("zh")&&(e==="zh-tw"?t="zh-tw":t="zh"),this.i18n=new I(t)}getObsidianLanguage(){return window.localStorage.getItem("language")||"en"}};
